(()=>{var exports={};exports.id=665,exports.ids=[665],exports.modules={7849:S=>{"use strict";S.exports=require("next/dist/client/components/action-async-storage.external")},2934:S=>{"use strict";S.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:S=>{"use strict";S.exports=require("next/dist/client/components/request-async-storage.external")},4580:S=>{"use strict";S.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:S=>{"use strict";S.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:S=>{"use strict";S.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:S=>{"use strict";S.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9523:S=>{"use strict";S.exports=require("dns")},2361:S=>{"use strict";S.exports=require("events")},7147:S=>{"use strict";S.exports=require("fs")},3685:S=>{"use strict";S.exports=require("http")},5158:S=>{"use strict";S.exports=require("http2")},1808:S=>{"use strict";S.exports=require("net")},2037:S=>{"use strict";S.exports=require("os")},1017:S=>{"use strict";S.exports=require("path")},7282:S=>{"use strict";S.exports=require("process")},2781:S=>{"use strict";S.exports=require("stream")},4404:S=>{"use strict";S.exports=require("tls")},7310:S=>{"use strict";S.exports=require("url")},3837:S=>{"use strict";S.exports=require("util")},9796:S=>{"use strict";S.exports=require("zlib")},3593:(S,T,R)=>{"use strict";R.r(T),R.d(T,{GlobalError:()=>M.a,__next_app__:()=>W,originalPathname:()=>K,pages:()=>$,routeModule:()=>Q,tree:()=>V});var N=R(482),O=R(9108),P=R(2563),M=R.n(P),L=R(8300),U={};for(let S in L)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(S)&&(U[S]=()=>L[S]);R.d(T,U);let V=["",{children:["(auth)",{children:["login",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(R.bind(R,8241)),"/Users/webtrova/Documents/GitHub/tourneyV5/app/(auth)/login/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(R.bind(R,8077)),"/Users/webtrova/Documents/GitHub/tourneyV5/app/(auth)/layout.tsx"],"not-found":[()=>Promise.resolve().then(R.t.bind(R,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async S=>(await Promise.resolve().then(R.bind(R,7481))).default(S)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(R.bind(R,2905)),"/Users/webtrova/Documents/GitHub/tourneyV5/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(R.t.bind(R,9361,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async S=>(await Promise.resolve().then(R.bind(R,7481))).default(S)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],$=["/Users/webtrova/Documents/GitHub/tourneyV5/app/(auth)/login/page.tsx"],K="/(auth)/login/page",W={require:R,loadChunk:()=>Promise.resolve()},Q=new N.AppPageRouteModule({definition:{kind:O.x.APP_PAGE,page:"/(auth)/login/page",pathname:"/login",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:V}})},8968:(S,T,R)=>{Promise.resolve().then(R.bind(R,7600))},7600:(S,T,R)=>{"use strict";let N,O,P,M,L,U;R.r(T),R.d(T,{default:()=>wI});var V,$,K,W,Q,Y=R(5344),X=R(3729),Z=R(2254);let ee=()=>void 0,et={NODE_CLIENT:!1,SDK_VERSION:"${JSCORE_VERSION}"},er=function(S){let T=[],R=0;for(let N=0;N<S.length;N++){let O=S.charCodeAt(N);O<128?T[R++]=O:(O<2048?T[R++]=O>>6|192:((64512&O)==55296&&N+1<S.length&&(64512&S.charCodeAt(N+1))==56320?(O=65536+((1023&O)<<10)+(1023&S.charCodeAt(++N)),T[R++]=O>>18|240,T[R++]=O>>12&63|128):T[R++]=O>>12|224,T[R++]=O>>6&63|128),T[R++]=63&O|128)}return T},en=function(S){let T=[],R=0,N=0;for(;R<S.length;){let O=S[R++];if(O<128)T[N++]=String.fromCharCode(O);else if(O>191&&O<224){let P=S[R++];T[N++]=String.fromCharCode((31&O)<<6|63&P)}else if(O>239&&O<365){let P=((7&O)<<18|(63&S[R++])<<12|(63&S[R++])<<6|63&S[R++])-65536;T[N++]=String.fromCharCode(55296+(P>>10)),T[N++]=String.fromCharCode(56320+(1023&P))}else{let P=S[R++],M=S[R++];T[N++]=String.fromCharCode((15&O)<<12|(63&P)<<6|63&M)}}return T.join("")},ei={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(S,T){if(!Array.isArray(S))throw Error("encodeByteArray takes an array as a parameter");this.init_();let R=T?this.byteToCharMapWebSafe_:this.byteToCharMap_,N=[];for(let T=0;T<S.length;T+=3){let O=S[T],P=T+1<S.length,M=P?S[T+1]:0,L=T+2<S.length,U=L?S[T+2]:0,V=O>>2,$=(3&O)<<4|M>>4,K=(15&M)<<2|U>>6,W=63&U;L||(W=64,P||(K=64)),N.push(R[V],R[$],R[K],R[W])}return N.join("")},encodeString(S,T){return this.HAS_NATIVE_SUPPORT&&!T?btoa(S):this.encodeByteArray(er(S),T)},decodeString(S,T){return this.HAS_NATIVE_SUPPORT&&!T?atob(S):en(this.decodeStringToByteArray(S,T))},decodeStringToByteArray(S,T){this.init_();let R=T?this.charToByteMapWebSafe_:this.charToByteMap_,N=[];for(let T=0;T<S.length;){let O=R[S.charAt(T++)],P=T<S.length?R[S.charAt(T)]:0,M=++T<S.length?R[S.charAt(T)]:64,L=++T<S.length?R[S.charAt(T)]:64;if(++T,null==O||null==P||null==M||null==L)throw new es;let U=O<<2|P>>4;if(N.push(U),64!==M){let S=P<<4&240|M>>2;if(N.push(S),64!==L){let S=M<<6&192|L;N.push(S)}}}return N},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let S=0;S<this.ENCODED_VALS.length;S++)this.byteToCharMap_[S]=this.ENCODED_VALS.charAt(S),this.charToByteMap_[this.byteToCharMap_[S]]=S,this.byteToCharMapWebSafe_[S]=this.ENCODED_VALS_WEBSAFE.charAt(S),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[S]]=S,S>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(S)]=S,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(S)]=S)}}};class es extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let ea=function(S){let T=er(S);return ei.encodeByteArray(T,!0)},eo=function(S){return ea(S).replace(/\./g,"")},eu=function(S){try{return ei.decodeString(S,!0)}catch(S){console.error("base64Decode failed: ",S)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ec(){if("undefined"!=typeof self)return self;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eh=()=>ec().__FIREBASE_DEFAULTS__,ed=()=>{if("undefined"==typeof process||void 0===process.env)return;let S=process.env.__FIREBASE_DEFAULTS__;if(S)return JSON.parse(S)},ep=()=>{let S;if("undefined"==typeof document)return;try{S=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(S){return}let T=S&&eu(S[1]);return T&&JSON.parse(T)},ef=()=>{try{return ee()||eh()||ed()||ep()}catch(S){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${S}`);return}},eg=S=>{var T,R;return null===(R=null===(T=ef())||void 0===T?void 0:T.emulatorHosts)||void 0===R?void 0:R[S]},em=S=>{let T=eg(S);if(!T)return;let R=T.lastIndexOf(":");if(R<=0||R+1===T.length)throw Error(`Invalid host ${T} with no separate hostname and port!`);let N=parseInt(T.substring(R+1),10);return"["===T[0]?[T.substring(1,R-1),N]:[T.substring(0,R),N]},ey=()=>{var S;return null===(S=ef())||void 0===S?void 0:S.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ev{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((S,T)=>{this.resolve=S,this.reject=T})}wrapCallback(S){return(T,R)=>{T?this.reject(T):this.resolve(R),"function"==typeof S&&(this.promise.catch(()=>{}),1===S.length?S(T):S(T,R))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eb(S,T){if(S.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let R={alg:"none",type:"JWT"},N=T||"demo-project",O=S.iat||0,P=S.sub||S.user_id;if(!P)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let M=Object.assign({iss:`https://securetoken.google.com/${N}`,aud:N,iat:O,exp:O+3600,auth_time:O,sub:P,user_id:P,firebase:{sign_in_provider:"custom",identities:{}}},S),L="";return[eo(JSON.stringify(R)),eo(JSON.stringify(M)),L].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eS(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function eT(){return!1}function ew(){var S;let T=null===(S=ef())||void 0===S?void 0:S.forceEnvironment;if("node"===T)return!0;if("browser"===T)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(S){return!1}}function eC(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function eE(){let S="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof S&&void 0!==S.id}function eI(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function e_(){return!ew()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ek(){try{return"object"==typeof indexedDB}catch(S){return!1}}function eR(){return new Promise((S,T)=>{try{let R=!0,N="validate-browser-context-for-indexeddb-analytics-module",O=self.indexedDB.open(N);O.onsuccess=()=>{O.result.close(),R||self.indexedDB.deleteDatabase(N),S(!0)},O.onupgradeneeded=()=>{R=!1},O.onerror=()=>{var S;T((null===(S=O.error)||void 0===S?void 0:S.message)||"")}}catch(S){T(S)}})}function eA(){return"undefined"!=typeof navigator&&!!navigator.cookieEnabled}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eD="FirebaseError";class eN extends Error{constructor(S,T,R){super(T),this.code=S,this.customData=R,this.name=eD,Object.setPrototypeOf(this,eN.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,eO.prototype.create)}}class eO{constructor(S,T,R){this.service=S,this.serviceName=T,this.errors=R}create(S,...T){let R=T[0]||{},N=`${this.service}/${S}`,O=this.errors[S],P=O?ex(O,R):"Error",M=`${this.serviceName}: ${P} (${N}).`;return new eN(N,M,R)}}function ex(S,T){return S.replace(eP,(S,R)=>{let N=T[R];return null!=N?String(N):`<${R}?>`})}let eP=/\{\$([^}]+)}/g;function eM(S,T){if(S===T)return!0;let R=Object.keys(S),N=Object.keys(T);for(let O of R){if(!N.includes(O))return!1;let R=S[O],P=T[O];if(eL(R)&&eL(P)){if(!eM(R,P))return!1}else if(R!==P)return!1}for(let S of N)if(!R.includes(S))return!1;return!0}function eL(S){return null!==S&&"object"==typeof S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eB(S){let T=[];for(let[R,N]of Object.entries(S))Array.isArray(N)?N.forEach(S=>{T.push(encodeURIComponent(R)+"="+encodeURIComponent(S))}):T.push(encodeURIComponent(R)+"="+encodeURIComponent(N));return T.length?"&"+T.join("&"):""}function eF(S){let T={};return S.replace(/^\?/,"").split("&").forEach(S=>{if(S){let[R,N]=S.split("=");T[decodeURIComponent(R)]=decodeURIComponent(N)}}),T}function eU(S){let T=S.indexOf("?");if(!T)return"";let R=S.indexOf("#",T);return S.substring(T,R>0?R:void 0)}function ej(S,T){let R=new eV(S,T);return R.subscribe.bind(R)}class eV{constructor(S,T){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=T,this.task.then(()=>{S(this)}).catch(S=>{this.error(S)})}next(S){this.forEachObserver(T=>{T.next(S)})}error(S){this.forEachObserver(T=>{T.error(S)}),this.close(S)}complete(){this.forEachObserver(S=>{S.complete()}),this.close()}subscribe(S,T,R){let N;if(void 0===S&&void 0===T&&void 0===R)throw Error("Missing Observer.");void 0===(N=ez(S,["next","error","complete"])?S:{next:S,error:T,complete:R}).next&&(N.next=eq),void 0===N.error&&(N.error=eq),void 0===N.complete&&(N.complete=eq);let O=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?N.error(this.finalError):N.complete()}catch(S){}}),this.observers.push(N),O}unsubscribeOne(S){void 0!==this.observers&&void 0!==this.observers[S]&&(delete this.observers[S],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(S){if(!this.finalized)for(let T=0;T<this.observers.length;T++)this.sendOne(T,S)}sendOne(S,T){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[S])try{T(this.observers[S])}catch(S){"undefined"!=typeof console&&console.error&&console.error(S)}})}close(S){this.finalized||(this.finalized=!0,void 0!==S&&(this.finalError=S),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ez(S,T){if("object"!=typeof S||null===S)return!1;for(let R of T)if(R in S&&"function"==typeof S[R])return!0;return!1}function eq(){}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e$=1e3,eG=2,eK=144e5,eH=.5;function eW(S,T=e$,R=eG){let N=T*Math.pow(R,S),O=Math.round(eH*N*(Math.random()-.5)*2);return Math.min(eK,N+O)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eQ(S){return S&&S._delegate?S._delegate:S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */et.NODE_CLIENT=!0;class eY{constructor(S,T,R){this.name=S,this.instanceFactory=T,this.type=R,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(S){return this.instantiationMode=S,this}setMultipleInstances(S){return this.multipleInstances=S,this}setServiceProps(S){return this.serviceProps=S,this}setInstanceCreatedCallback(S){return this.onInstanceCreated=S,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eJ="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eX{constructor(S,T){this.name=S,this.container=T,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(S){let T=this.normalizeInstanceIdentifier(S);if(!this.instancesDeferred.has(T)){let S=new ev;if(this.instancesDeferred.set(T,S),this.isInitialized(T)||this.shouldAutoInitialize())try{let R=this.getOrInitializeService({instanceIdentifier:T});R&&S.resolve(R)}catch(S){}}return this.instancesDeferred.get(T).promise}getImmediate(S){var T;let R=this.normalizeInstanceIdentifier(null==S?void 0:S.identifier),N=null!==(T=null==S?void 0:S.optional)&&void 0!==T&&T;if(this.isInitialized(R)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:R})}catch(S){if(N)return null;throw S}else{if(N)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(S){if(S.name!==this.name)throw Error(`Mismatching Component ${S.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=S,this.shouldAutoInitialize()){if(e0(S))try{this.getOrInitializeService({instanceIdentifier:eJ})}catch(S){}for(let[S,T]of this.instancesDeferred.entries()){let R=this.normalizeInstanceIdentifier(S);try{let S=this.getOrInitializeService({instanceIdentifier:R});T.resolve(S)}catch(S){}}}}clearInstance(S=eJ){this.instancesDeferred.delete(S),this.instancesOptions.delete(S),this.instances.delete(S)}async delete(){let S=Array.from(this.instances.values());await Promise.all([...S.filter(S=>"INTERNAL"in S).map(S=>S.INTERNAL.delete()),...S.filter(S=>"_delete"in S).map(S=>S._delete())])}isComponentSet(){return null!=this.component}isInitialized(S=eJ){return this.instances.has(S)}getOptions(S=eJ){return this.instancesOptions.get(S)||{}}initialize(S={}){let{options:T={}}=S,R=this.normalizeInstanceIdentifier(S.instanceIdentifier);if(this.isInitialized(R))throw Error(`${this.name}(${R}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let N=this.getOrInitializeService({instanceIdentifier:R,options:T});for(let[S,T]of this.instancesDeferred.entries())R===this.normalizeInstanceIdentifier(S)&&T.resolve(N);return N}onInit(S,T){var R;let N=this.normalizeInstanceIdentifier(T),O=null!==(R=this.onInitCallbacks.get(N))&&void 0!==R?R:new Set;O.add(S),this.onInitCallbacks.set(N,O);let P=this.instances.get(N);return P&&S(P,N),()=>{O.delete(S)}}invokeOnInitCallbacks(S,T){let R=this.onInitCallbacks.get(T);if(R)for(let N of R)try{N(S,T)}catch(S){}}getOrInitializeService({instanceIdentifier:S,options:T={}}){let R=this.instances.get(S);if(!R&&this.component&&(R=this.component.instanceFactory(this.container,{instanceIdentifier:eZ(S),options:T}),this.instances.set(S,R),this.instancesOptions.set(S,T),this.invokeOnInitCallbacks(R,S),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,S,R)}catch(S){}return R||null}normalizeInstanceIdentifier(S=eJ){return this.component?this.component.multipleInstances?S:eJ:S}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function eZ(S){return S===eJ?void 0:S}function e0(S){return"EAGER"===S.instantiationMode}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e1{constructor(S){this.name=S,this.providers=new Map}addComponent(S){let T=this.getProvider(S.name);if(T.isComponentSet())throw Error(`Component ${S.name} has already been registered with ${this.name}`);T.setComponent(S)}addOrOverwriteComponent(S){this.getProvider(S.name).isComponentSet()&&this.providers.delete(S.name),this.addComponent(S)}getProvider(S){if(this.providers.has(S))return this.providers.get(S);let T=new eX(S,this);return this.providers.set(S,T),T}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e2=[];!function(S){S[S.DEBUG=0]="DEBUG",S[S.VERBOSE=1]="VERBOSE",S[S.INFO=2]="INFO",S[S.WARN=3]="WARN",S[S.ERROR=4]="ERROR",S[S.SILENT=5]="SILENT"}(V||(V={}));let e4={debug:V.DEBUG,verbose:V.VERBOSE,info:V.INFO,warn:V.WARN,error:V.ERROR,silent:V.SILENT},e3=V.INFO,e6={[V.DEBUG]:"log",[V.VERBOSE]:"log",[V.INFO]:"info",[V.WARN]:"warn",[V.ERROR]:"error"},e9=(S,T,...R)=>{if(T<S.logLevel)return;let N=new Date().toISOString(),O=e6[T];if(O)console[O](`[${N}]  ${S.name}:`,...R);else throw Error(`Attempted to log a message with an invalid logType (value: ${T})`)};class e5{constructor(S){this.name=S,this._logLevel=e3,this._logHandler=e9,this._userLogHandler=null,e2.push(this)}get logLevel(){return this._logLevel}set logLevel(S){if(!(S in V))throw TypeError(`Invalid value "${S}" assigned to \`logLevel\``);this._logLevel=S}setLogLevel(S){this._logLevel="string"==typeof S?e4[S]:S}get logHandler(){return this._logHandler}set logHandler(S){if("function"!=typeof S)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=S}get userLogHandler(){return this._userLogHandler}set userLogHandler(S){this._userLogHandler=S}debug(...S){this._userLogHandler&&this._userLogHandler(this,V.DEBUG,...S),this._logHandler(this,V.DEBUG,...S)}log(...S){this._userLogHandler&&this._userLogHandler(this,V.VERBOSE,...S),this._logHandler(this,V.VERBOSE,...S)}info(...S){this._userLogHandler&&this._userLogHandler(this,V.INFO,...S),this._logHandler(this,V.INFO,...S)}warn(...S){this._userLogHandler&&this._userLogHandler(this,V.WARN,...S),this._logHandler(this,V.WARN,...S)}error(...S){this._userLogHandler&&this._userLogHandler(this,V.ERROR,...S),this._logHandler(this,V.ERROR,...S)}}let e7=(S,T)=>T.some(T=>S instanceof T);function e8(){return N||(N=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function te(){return O||(O=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let tt=new WeakMap,tr=new WeakMap,ti=new WeakMap,ts=new WeakMap,ta=new WeakMap;function tl(S){let T=new Promise((T,R)=>{let N=()=>{S.removeEventListener("success",O),S.removeEventListener("error",P)},O=()=>{T(tf(S.result)),N()},P=()=>{R(S.error),N()};S.addEventListener("success",O),S.addEventListener("error",P)});return T.then(T=>{T instanceof IDBCursor&&tt.set(T,S)}).catch(()=>{}),ta.set(T,S),T}function tu(S){if(tr.has(S))return;let T=new Promise((T,R)=>{let N=()=>{S.removeEventListener("complete",O),S.removeEventListener("error",P),S.removeEventListener("abort",P)},O=()=>{T(),N()},P=()=>{R(S.error||new DOMException("AbortError","AbortError")),N()};S.addEventListener("complete",O),S.addEventListener("error",P),S.addEventListener("abort",P)});tr.set(S,T)}let tc={get(S,T,R){if(S instanceof IDBTransaction){if("done"===T)return tr.get(S);if("objectStoreNames"===T)return S.objectStoreNames||ti.get(S);if("store"===T)return R.objectStoreNames[1]?void 0:R.objectStore(R.objectStoreNames[0])}return tf(S[T])},set:(S,T,R)=>(S[T]=R,!0),has:(S,T)=>S instanceof IDBTransaction&&("done"===T||"store"===T)||T in S};function th(S){tc=S(tc)}function td(S){return S!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?te().includes(S)?function(...T){return S.apply(tg(this),T),tf(tt.get(this))}:function(...T){return tf(S.apply(tg(this),T))}:function(T,...R){let N=S.call(tg(this),T,...R);return ti.set(N,T.sort?T.sort():[T]),tf(N)}}function tp(S){return"function"==typeof S?td(S):(S instanceof IDBTransaction&&tu(S),e7(S,e8()))?new Proxy(S,tc):S}function tf(S){if(S instanceof IDBRequest)return tl(S);if(ts.has(S))return ts.get(S);let T=tp(S);return T!==S&&(ts.set(S,T),ta.set(T,S)),T}let tg=S=>ta.get(S);function tm(S,T,{blocked:R,upgrade:N,blocking:O,terminated:P}={}){let M=indexedDB.open(S,T),L=tf(M);return N&&M.addEventListener("upgradeneeded",S=>{N(tf(M.result),S.oldVersion,S.newVersion,tf(M.transaction),S)}),R&&M.addEventListener("blocked",S=>R(S.oldVersion,S.newVersion,S)),L.then(S=>{P&&S.addEventListener("close",()=>P()),O&&S.addEventListener("versionchange",S=>O(S.oldVersion,S.newVersion,S))}).catch(()=>{}),L}let ty=["get","getKey","getAll","getAllKeys","count"],tv=["put","add","delete","clear"],tb=new Map;function tS(S,T){if(!(S instanceof IDBDatabase&&!(T in S)&&"string"==typeof T))return;if(tb.get(T))return tb.get(T);let R=T.replace(/FromIndex$/,""),N=T!==R,O=tv.includes(R);if(!(R in(N?IDBIndex:IDBObjectStore).prototype)||!(O||ty.includes(R)))return;let P=async function(S,...T){let P=this.transaction(S,O?"readwrite":"readonly"),M=P.store;return N&&(M=M.index(T.shift())),(await Promise.all([M[R](...T),O&&P.done]))[0]};return tb.set(T,P),P}th(S=>({...S,get:(T,R,N)=>tS(T,R)||S.get(T,R,N),has:(T,R)=>!!tS(T,R)||S.has(T,R)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tT{constructor(S){this.container=S}getPlatformInfoString(){return this.container.getProviders().map(S=>{if(!tw(S))return null;{let T=S.getImmediate();return`${T.library}/${T.version}`}}).filter(S=>S).join(" ")}}function tw(S){let T=S.getComponent();return(null==T?void 0:T.type)==="VERSION"}let tC="@firebase/app",tE="0.11.4",tI=new e5("@firebase/app"),t_="11.6.0",tk="[DEFAULT]",tR={[tC]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},tA=new Map,tD=new Map,tN=new Map;function tO(S,T){try{S.container.addComponent(T)}catch(R){tI.debug(`Component ${T.name} failed to register with FirebaseApp ${S.name}`,R)}}function tP(S){let T=S.name;if(tN.has(T))return tI.debug(`There were multiple attempts to register component ${T}.`),!1;for(let R of(tN.set(T,S),tA.values()))tO(R,S);for(let T of tD.values())tO(T,S);return!0}function tM(S,T){let R=S.container.getProvider("heartbeat").getImmediate({optional:!0});return R&&R.triggerHeartbeat(),S.container.getProvider(T)}function tL(S){return null!=S&&void 0!==S.settings}let tB=new eO("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tF{constructor(S,T,R){this._isDeleted=!1,this._options=Object.assign({},S),this._config=Object.assign({},T),this._name=T.name,this._automaticDataCollectionEnabled=T.automaticDataCollectionEnabled,this._container=R,this.container.addComponent(new eY("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(S){this.checkDestroyed(),this._automaticDataCollectionEnabled=S}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(S){this._isDeleted=S}checkDestroyed(){if(this.isDeleted)throw tB.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tU=t_;function tj(S,T={}){let R=S;"object"!=typeof T&&(T={name:T});let N=Object.assign({name:tk,automaticDataCollectionEnabled:!1},T),O=N.name;if("string"!=typeof O||!O)throw tB.create("bad-app-name",{appName:String(O)});if(R||(R=ey()),!R)throw tB.create("no-options");let P=tA.get(O);if(P){if(eM(R,P.options)&&eM(N,P.config))return P;throw tB.create("duplicate-app",{appName:O})}let M=new e1(O);for(let S of tN.values())M.addComponent(S);let L=new tF(R,N,M);return tA.set(O,L),L}function tV(S=tk){let T=tA.get(S);if(!T&&S===tk&&ey())return tj();if(!T)throw tB.create("no-app",{appName:S});return T}function tz(S,T,R){var N;let O=null!==(N=tR[S])&&void 0!==N?N:S;R&&(O+=`-${R}`);let P=O.match(/\s|\//),M=T.match(/\s|\//);if(P||M){let S=[`Unable to register library "${O}" with version "${T}":`];P&&S.push(`library name "${O}" contains illegal characters (whitespace or "/")`),P&&M&&S.push("and"),M&&S.push(`version name "${T}" contains illegal characters (whitespace or "/")`),tI.warn(S.join(" "));return}tP(new eY(`${O}-version`,()=>({library:O,version:T}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tq="firebase-heartbeat-database",t$=1,tG="firebase-heartbeat-store",tK=null;function tH(){return tK||(tK=tm(tq,t$,{upgrade:(S,T)=>{if(0===T)try{S.createObjectStore(tG)}catch(S){console.warn(S)}}}).catch(S=>{throw tB.create("idb-open",{originalErrorMessage:S.message})})),tK}async function tW(S){try{let T=(await tH()).transaction(tG),R=await T.objectStore(tG).get(tY(S));return await T.done,R}catch(S){if(S instanceof eN)tI.warn(S.message);else{let T=tB.create("idb-get",{originalErrorMessage:null==S?void 0:S.message});tI.warn(T.message)}}}async function tQ(S,T){try{let R=(await tH()).transaction(tG,"readwrite"),N=R.objectStore(tG);await N.put(T,tY(S)),await R.done}catch(S){if(S instanceof eN)tI.warn(S.message);else{let T=tB.create("idb-set",{originalErrorMessage:null==S?void 0:S.message});tI.warn(T.message)}}}function tY(S){return`${S.name}!${S.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tJ=1024,tX=30;class tZ{constructor(S){this.container=S,this._heartbeatsCache=null;let T=this.container.getProvider("app").getImmediate();this._storage=new t2(T),this._heartbeatsCachePromise=this._storage.read().then(S=>(this._heartbeatsCache=S,S))}async triggerHeartbeat(){var S,T;try{let R=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),N=t0();if((null===(S=this._heartbeatsCache)||void 0===S?void 0:S.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(T=this._heartbeatsCache)||void 0===T?void 0:T.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===N||this._heartbeatsCache.heartbeats.some(S=>S.date===N))return;if(this._heartbeatsCache.heartbeats.push({date:N,agent:R}),this._heartbeatsCache.heartbeats.length>tX){let S=t3(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(S,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(S){tI.warn(S)}}async getHeartbeatsHeader(){var S;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(S=this._heartbeatsCache)||void 0===S?void 0:S.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let T=t0(),{heartbeatsToSend:R,unsentEntries:N}=t1(this._heartbeatsCache.heartbeats),O=eo(JSON.stringify({version:2,heartbeats:R}));return this._heartbeatsCache.lastSentHeartbeatDate=T,N.length>0?(this._heartbeatsCache.heartbeats=N,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),O}catch(S){return tI.warn(S),""}}}function t0(){return new Date().toISOString().substring(0,10)}function t1(S,T=tJ){let R=[],N=S.slice();for(let O of S){let S=R.find(S=>S.agent===O.agent);if(S){if(S.dates.push(O.date),t4(R)>T){S.dates.pop();break}}else if(R.push({agent:O.agent,dates:[O.date]}),t4(R)>T){R.pop();break}N=N.slice(1)}return{heartbeatsToSend:R,unsentEntries:N}}class t2{constructor(S){this.app=S,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ek()&&eR().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let S=await tW(this.app);return(null==S?void 0:S.heartbeats)?S:{heartbeats:[]}}}async overwrite(S){var T;if(await this._canUseIndexedDBPromise){let R=await this.read();return tQ(this.app,{lastSentHeartbeatDate:null!==(T=S.lastSentHeartbeatDate)&&void 0!==T?T:R.lastSentHeartbeatDate,heartbeats:S.heartbeats})}}async add(S){var T;if(await this._canUseIndexedDBPromise){let R=await this.read();return tQ(this.app,{lastSentHeartbeatDate:null!==(T=S.lastSentHeartbeatDate)&&void 0!==T?T:R.lastSentHeartbeatDate,heartbeats:[...R.heartbeats,...S.heartbeats]})}}}function t4(S){return eo(JSON.stringify({version:2,heartbeats:S})).length}function t3(S){if(0===S.length)return -1;let T=0,R=S[0].date;for(let N=1;N<S.length;N++)S[N].date<R&&(R=S[N].date,T=N);return T}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(S){tP(new eY("platform-logger",S=>new tT(S),"PRIVATE")),tP(new eY("heartbeat",S=>new tZ(S),"PRIVATE")),tz(tC,tE,""),tz(tC,tE,"esm2017"),tz("fire-js","")})(0),/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */tz("firebase","11.6.0","app");function t6(S,T){var R={};for(var N in S)Object.prototype.hasOwnProperty.call(S,N)&&0>T.indexOf(N)&&(R[N]=S[N]);if(null!=S&&"function"==typeof Object.getOwnPropertySymbols)for(var O=0,N=Object.getOwnPropertySymbols(S);O<N.length;O++)0>T.indexOf(N[O])&&Object.prototype.propertyIsEnumerable.call(S,N[O])&&(R[N[O]]=S[N[O]]);return R}Object.create;function t9(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}Object.create,"function"==typeof SuppressedError&&SuppressedError;let t5=t9,t7=new eO("auth","Firebase",t9()),t8=new e5("@firebase/auth");function rt(S,...T){t8.logLevel<=V.WARN&&t8.warn(`Auth (${tU}): ${S}`,...T)}function rr(S,...T){t8.logLevel<=V.ERROR&&t8.error(`Auth (${tU}): ${S}`,...T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rn(S,...T){throw ro(S,...T)}function ri(S,...T){return ro(S,...T)}function rs(S,T,R){return new eO("auth","Firebase",Object.assign(Object.assign({},t5()),{[T]:R})).create(T,{appName:S.name})}function ra(S){return rs(S,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ro(S,...T){if("string"!=typeof S){let R=T[0],N=[...T.slice(1)];return N[0]&&(N[0].appName=S.name),S._errorFactory.create(R,...N)}return t7.create(S,...T)}function rl(S,T,...R){if(!S)throw ro(T,...R)}function ru(S){let T="INTERNAL ASSERTION FAILED: "+S;throw rr(T),Error(T)}function rc(S,T){S||ru(T)}function rh(){return"http:"===rd()||"https:"===rd()}function rd(){var S;return"undefined"!=typeof self&&(null===(S=self.location)||void 0===S?void 0:S.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rp(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(rh()||eE()||"connection"in navigator))||navigator.onLine}function rf(){if("undefined"==typeof navigator)return null;let S=navigator;return S.languages&&S.languages[0]||S.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rg{constructor(S,T){this.shortDelay=S,this.longDelay=T,rc(T>S,"Short delay should be less than long delay!"),this.isMobile=eT()||eI()}get(){return rp()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rm(S,T){rc(S.emulator,"Emulator should always be set here");let{url:R}=S.emulator;return T?`${R}${T.startsWith("/")?T.slice(1):T}`:R}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ry{static initialize(S,T,R){this.fetchImpl=S,T&&(this.headersImpl=T),R&&(this.responseImpl=R)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void ru("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void ru("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void ru("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},rb=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],rS=new rg(3e4,6e4);function rT(S,T){return S.tenantId&&!T.tenantId?Object.assign(Object.assign({},T),{tenantId:S.tenantId}):T}async function rw(S,T,R,N,O={}){return rC(S,O,async()=>{let O={},P={};N&&("GET"===T?P=N:O={body:JSON.stringify(N)});let M=eB(Object.assign({key:S.config.apiKey},P)).slice(1),L=await S._getAdditionalHeaders();L["Content-Type"]="application/json",S.languageCode&&(L["X-Firebase-Locale"]=S.languageCode);let U=Object.assign({method:T,headers:L},O);return eC()||(U.referrerPolicy="no-referrer"),ry.fetch()(await rI(S,S.config.apiHost,R,M),U)})}async function rC(S,T,R){S._canInitEmulator=!1;let N=Object.assign(Object.assign({},rv),T);try{let T=new rk(S),O=await Promise.race([R(),T.promise]);T.clearNetworkTimeout();let P=await O.json();if("needConfirmation"in P)throw rR(S,"account-exists-with-different-credential",P);if(O.ok&&!("errorMessage"in P))return P;{let[T,R]=(O.ok?P.errorMessage:P.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===T)throw rR(S,"credential-already-in-use",P);if("EMAIL_EXISTS"===T)throw rR(S,"email-already-in-use",P);if("USER_DISABLED"===T)throw rR(S,"user-disabled",P);let M=N[T]||T.toLowerCase().replace(/[_\s]+/g,"-");if(R)throw rs(S,M,R);rn(S,M)}}catch(T){if(T instanceof eN)throw T;rn(S,"network-request-failed",{message:String(T)})}}async function rE(S,T,R,N,O={}){let P=await rw(S,T,R,N,O);return"mfaPendingCredential"in P&&rn(S,"multi-factor-auth-required",{_serverResponse:P}),P}async function rI(S,T,R,N){let O=`${T}${R}?${N}`,P=S,M=P.config.emulator?rm(S.config,O):`${S.config.apiScheme}://${O}`;return rb.includes(R)&&(await P._persistenceManagerAvailable,"COOKIE"===P._getPersistenceType())?P._getPersistence()._getFinalTarget(M).toString():M}function r_(S){switch(S){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class rk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(S){this.auth=S,this.timer=null,this.promise=new Promise((S,T)=>{this.timer=setTimeout(()=>T(ri(this.auth,"network-request-failed")),rS.get())})}}function rR(S,T,R){let N={appName:S.name};R.email&&(N.email=R.email),R.phoneNumber&&(N.phoneNumber=R.phoneNumber);let O=ri(S,T,N);return O.customData._tokenResponse=R,O}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rA(S){return void 0!==S&&void 0!==S.enterprise}class rD{constructor(S){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===S.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=S.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=S.recaptchaEnforcementState}getProviderEnforcementState(S){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let T of this.recaptchaEnforcementState)if(T.provider&&T.provider===S)return r_(T.enforcementState);return null}isProviderEnabled(S){return"ENFORCE"===this.getProviderEnforcementState(S)||"AUDIT"===this.getProviderEnforcementState(S)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rN(S,T){return rw(S,"GET","/v2/recaptchaConfig",rT(S,T))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rO(S,T){return rw(S,"POST","/v1/accounts:delete",T)}async function rx(S,T){return rw(S,"POST","/v1/accounts:lookup",T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rP(S){if(S)try{let T=new Date(Number(S));if(!isNaN(T.getTime()))return T.toUTCString()}catch(S){}}async function rM(S,T=!1){let R=eQ(S),N=await R.getIdToken(T),O=rB(N);rl(O&&O.exp&&O.auth_time&&O.iat,R.auth,"internal-error");let P="object"==typeof O.firebase?O.firebase:void 0,M=null==P?void 0:P.sign_in_provider;return{claims:O,token:N,authTime:rP(rL(O.auth_time)),issuedAtTime:rP(rL(O.iat)),expirationTime:rP(rL(O.exp)),signInProvider:M||null,signInSecondFactor:(null==P?void 0:P.sign_in_second_factor)||null}}function rL(S){return 1e3*Number(S)}function rB(S){let[T,R,N]=S.split(".");if(void 0===T||void 0===R||void 0===N)return rr("JWT malformed, contained fewer than 3 sections"),null;try{let S=eu(R);if(!S)return rr("Failed to decode base64 JWT payload"),null;return JSON.parse(S)}catch(S){return rr("Caught error parsing JWT payload as JSON",null==S?void 0:S.toString()),null}}function rF(S){let T=rB(S);return rl(T,"internal-error"),rl(void 0!==T.exp,"internal-error"),rl(void 0!==T.iat,"internal-error"),Number(T.exp)-Number(T.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rU(S,T,R=!1){if(R)return T;try{return await T}catch(T){throw T instanceof eN&&rj(T)&&S.auth.currentUser===S&&await S.auth.signOut(),T}}function rj({code:S}){return"auth/user-disabled"===S||"auth/user-token-expired"===S}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rV{constructor(S){this.user=S,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(S){var T;if(!S)return this.errorBackoff=3e4,Math.max(0,(null!==(T=this.user.stsTokenManager.expirationTime)&&void 0!==T?T:0)-Date.now()-3e5);{let S=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),S}}schedule(S=!1){if(!this.isRunning)return;let T=this.getInterval(S);this.timerId=setTimeout(async()=>{await this.iteration()},T)}async iteration(){try{await this.user.getIdToken(!0)}catch(S){(null==S?void 0:S.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rz{constructor(S,T){this.createdAt=S,this.lastLoginAt=T,this._initializeTime()}_initializeTime(){this.lastSignInTime=rP(this.lastLoginAt),this.creationTime=rP(this.createdAt)}_copy(S){this.createdAt=S.createdAt,this.lastLoginAt=S.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rq(S){var T;let R=S.auth,N=await S.getIdToken(),O=await rU(S,rx(R,{idToken:N}));rl(null==O?void 0:O.users.length,R,"internal-error");let P=O.users[0];S._notifyReloadListener(P);let M=(null===(T=P.providerUserInfo)||void 0===T?void 0:T.length)?rK(P.providerUserInfo):[],L=rG(S.providerData,M),U=S.isAnonymous,V=!(S.email&&P.passwordHash)&&!(null==L?void 0:L.length),$=!!U&&V;Object.assign(S,{uid:P.localId,displayName:P.displayName||null,photoURL:P.photoUrl||null,email:P.email||null,emailVerified:P.emailVerified||!1,phoneNumber:P.phoneNumber||null,tenantId:P.tenantId||null,providerData:L,metadata:new rz(P.createdAt,P.lastLoginAt),isAnonymous:$})}async function r$(S){let T=eQ(S);await rq(T),await T.auth._persistUserIfCurrent(T),T.auth._notifyListenersIfCurrent(T)}function rG(S,T){return[...S.filter(S=>!T.some(T=>T.providerId===S.providerId)),...T]}function rK(S){return S.map(S=>{var{providerId:T}=S,R=t6(S,["providerId"]);return{providerId:T,uid:R.rawId||"",displayName:R.displayName||null,email:R.email||null,phoneNumber:R.phoneNumber||null,photoURL:R.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rH(S,T){let R=await rC(S,{},async()=>{let R=eB({grant_type:"refresh_token",refresh_token:T}).slice(1),{tokenApiHost:N,apiKey:O}=S.config,P=await rI(S,N,"/v1/token",`key=${O}`),M=await S._getAdditionalHeaders();return M["Content-Type"]="application/x-www-form-urlencoded",ry.fetch()(P,{method:"POST",headers:M,body:R})});return{accessToken:R.access_token,expiresIn:R.expires_in,refreshToken:R.refresh_token}}async function rW(S,T){return rw(S,"POST","/v2/accounts:revokeToken",rT(S,T))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rQ{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(S){rl(S.idToken,"internal-error"),rl(void 0!==S.idToken,"internal-error"),rl(void 0!==S.refreshToken,"internal-error");let T="expiresIn"in S&&void 0!==S.expiresIn?Number(S.expiresIn):rF(S.idToken);this.updateTokensAndExpiration(S.idToken,S.refreshToken,T)}updateFromIdToken(S){rl(0!==S.length,"internal-error");let T=rF(S);this.updateTokensAndExpiration(S,null,T)}async getToken(S,T=!1){return T||!this.accessToken||this.isExpired?(rl(this.refreshToken,S,"user-token-expired"),this.refreshToken)?(await this.refresh(S,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(S,T){let{accessToken:R,refreshToken:N,expiresIn:O}=await rH(S,T);this.updateTokensAndExpiration(R,N,Number(O))}updateTokensAndExpiration(S,T,R){this.refreshToken=T||null,this.accessToken=S||null,this.expirationTime=Date.now()+1e3*R}static fromJSON(S,T){let{refreshToken:R,accessToken:N,expirationTime:O}=T,P=new rQ;return R&&(rl("string"==typeof R,"internal-error",{appName:S}),P.refreshToken=R),N&&(rl("string"==typeof N,"internal-error",{appName:S}),P.accessToken=N),O&&(rl("number"==typeof O,"internal-error",{appName:S}),P.expirationTime=O),P}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(S){this.accessToken=S.accessToken,this.refreshToken=S.refreshToken,this.expirationTime=S.expirationTime}_clone(){return Object.assign(new rQ,this.toJSON())}_performRefresh(){return ru("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rY(S,T){rl("string"==typeof S||void 0===S,"internal-error",{appName:T})}class rJ{constructor(S){var{uid:T,auth:R,stsTokenManager:N}=S,O=t6(S,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new rV(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=T,this.auth=R,this.stsTokenManager=N,this.accessToken=N.accessToken,this.displayName=O.displayName||null,this.email=O.email||null,this.emailVerified=O.emailVerified||!1,this.phoneNumber=O.phoneNumber||null,this.photoURL=O.photoURL||null,this.isAnonymous=O.isAnonymous||!1,this.tenantId=O.tenantId||null,this.providerData=O.providerData?[...O.providerData]:[],this.metadata=new rz(O.createdAt||void 0,O.lastLoginAt||void 0)}async getIdToken(S){let T=await rU(this,this.stsTokenManager.getToken(this.auth,S));return rl(T,this.auth,"internal-error"),this.accessToken!==T&&(this.accessToken=T,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),T}getIdTokenResult(S){return rM(this,S)}reload(){return r$(this)}_assign(S){this!==S&&(rl(this.uid===S.uid,this.auth,"internal-error"),this.displayName=S.displayName,this.photoURL=S.photoURL,this.email=S.email,this.emailVerified=S.emailVerified,this.phoneNumber=S.phoneNumber,this.isAnonymous=S.isAnonymous,this.tenantId=S.tenantId,this.providerData=S.providerData.map(S=>Object.assign({},S)),this.metadata._copy(S.metadata),this.stsTokenManager._assign(S.stsTokenManager))}_clone(S){let T=new rJ(Object.assign(Object.assign({},this),{auth:S,stsTokenManager:this.stsTokenManager._clone()}));return T.metadata._copy(this.metadata),T}_onReload(S){rl(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=S,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(S){this.reloadListener?this.reloadListener(S):this.reloadUserInfo=S}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(S,T=!1){let R=!1;S.idToken&&S.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(S),R=!0),T&&await rq(this),await this.auth._persistUserIfCurrent(this),R&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tL(this.auth.app))return Promise.reject(ra(this.auth));let S=await this.getIdToken();return await rU(this,rO(this.auth,{idToken:S})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(S=>Object.assign({},S)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(S,T){var R,N,O,P,M,L,U,V;let $=null!==(R=T.displayName)&&void 0!==R?R:void 0,K=null!==(N=T.email)&&void 0!==N?N:void 0,W=null!==(O=T.phoneNumber)&&void 0!==O?O:void 0,Q=null!==(P=T.photoURL)&&void 0!==P?P:void 0,Y=null!==(M=T.tenantId)&&void 0!==M?M:void 0,X=null!==(L=T._redirectEventId)&&void 0!==L?L:void 0,Z=null!==(U=T.createdAt)&&void 0!==U?U:void 0,ee=null!==(V=T.lastLoginAt)&&void 0!==V?V:void 0,{uid:et,emailVerified:er,isAnonymous:en,providerData:ei,stsTokenManager:es}=T;rl(et&&es,S,"internal-error");let ea=rQ.fromJSON(this.name,es);rl("string"==typeof et,S,"internal-error"),rY($,S.name),rY(K,S.name),rl("boolean"==typeof er,S,"internal-error"),rl("boolean"==typeof en,S,"internal-error"),rY(W,S.name),rY(Q,S.name),rY(Y,S.name),rY(X,S.name),rY(Z,S.name),rY(ee,S.name);let eo=new rJ({uid:et,auth:S,email:K,emailVerified:er,displayName:$,isAnonymous:en,photoURL:Q,phoneNumber:W,tenantId:Y,stsTokenManager:ea,createdAt:Z,lastLoginAt:ee});return ei&&Array.isArray(ei)&&(eo.providerData=ei.map(S=>Object.assign({},S))),X&&(eo._redirectEventId=X),eo}static async _fromIdTokenResponse(S,T,R=!1){let N=new rQ;N.updateFromServerResponse(T);let O=new rJ({uid:T.localId,auth:S,stsTokenManager:N,isAnonymous:R});return await rq(O),O}static async _fromGetAccountInfoResponse(S,T,R){let N=T.users[0];rl(void 0!==N.localId,"internal-error");let O=void 0!==N.providerUserInfo?rK(N.providerUserInfo):[],P=!(N.email&&N.passwordHash)&&!(null==O?void 0:O.length),M=new rQ;M.updateFromIdToken(R);let L=new rJ({uid:N.localId,auth:S,stsTokenManager:M,isAnonymous:P});return Object.assign(L,{uid:N.localId,displayName:N.displayName||null,photoURL:N.photoUrl||null,email:N.email||null,emailVerified:N.emailVerified||!1,phoneNumber:N.phoneNumber||null,tenantId:N.tenantId||null,providerData:O,metadata:new rz(N.createdAt,N.lastLoginAt),isAnonymous:!(N.email&&N.passwordHash)&&!(null==O?void 0:O.length)}),L}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rX=new Map;function rZ(S){rc(S instanceof Function,"Expected a class definition");let T=rX.get(S);return T?rc(T instanceof S,"Instance stored in cache mismatched with class"):(T=new S,rX.set(S,T)),T}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r0{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(S,T){this.storage[S]=T}async _get(S){let T=this.storage[S];return void 0===T?null:T}async _remove(S){delete this.storage[S]}_addListener(S,T){}_removeListener(S,T){}}r0.type="NONE";let r1=r0;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r2(S,T,R){return`firebase:${S}:${T}:${R}`}class r4{constructor(S,T,R){this.persistence=S,this.auth=T,this.userKey=R;let{config:N,name:O}=this.auth;this.fullUserKey=r2(this.userKey,N.apiKey,O),this.fullPersistenceKey=r2("persistence",N.apiKey,O),this.boundEventHandler=T._onStorageEvent.bind(T),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(S){return this.persistence._set(this.fullUserKey,S.toJSON())}async getCurrentUser(){let S=await this.persistence._get(this.fullUserKey);if(!S)return null;if("string"==typeof S){let T=await rx(this.auth,{idToken:S}).catch(()=>void 0);return T?rJ._fromGetAccountInfoResponse(this.auth,T,S):null}return rJ._fromJSON(this.auth,S)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(S){if(this.persistence===S)return;let T=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=S,T)return this.setCurrentUser(T)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(S,T,R="authUser"){if(!T.length)return new r4(rZ(r1),S,R);let N=(await Promise.all(T.map(async S=>{if(await S._isAvailable())return S}))).filter(S=>S),O=N[0]||rZ(r1),P=r2(R,S.config.apiKey,S.name),M=null;for(let R of T)try{let T=await R._get(P);if(T){let N;if("string"==typeof T){let R=await rx(S,{idToken:T}).catch(()=>void 0);if(!R)break;N=await rJ._fromGetAccountInfoResponse(S,R,T)}else N=rJ._fromJSON(S,T);R!==O&&(M=N),O=R;break}}catch(S){}let L=N.filter(S=>S._shouldAllowMigration);return O._shouldAllowMigration&&L.length&&(O=L[0],M&&await O._set(P,M.toJSON()),await Promise.all(T.map(async S=>{if(S!==O)try{await S._remove(P)}catch(S){}}))),new r4(O,S,R)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r3(S){let T=S.toLowerCase();if(T.includes("opera/")||T.includes("opr/")||T.includes("opios/"))return"Opera";if(r7(T))return"IEMobile";if(T.includes("msie")||T.includes("trident/"))return"IE";{if(T.includes("edge/"))return"Edge";if(r6(T))return"Firefox";if(T.includes("silk/"))return"Silk";if(ne(T))return"Blackberry";if(nt(T))return"Webos";if(r9(T))return"Safari";if((T.includes("chrome/")||r5(T))&&!T.includes("edge/"))return"Chrome";if(r8(T))return"Android";let R=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,N=S.match(R);if((null==N?void 0:N.length)===2)return N[1]}return"Other"}function r6(S=eS()){return/firefox\//i.test(S)}function r9(S=eS()){let T=S.toLowerCase();return T.includes("safari/")&&!T.includes("chrome/")&&!T.includes("crios/")&&!T.includes("android")}function r5(S=eS()){return/crios\//i.test(S)}function r7(S=eS()){return/iemobile/i.test(S)}function r8(S=eS()){return/android/i.test(S)}function ne(S=eS()){return/blackberry/i.test(S)}function nt(S=eS()){return/webos/i.test(S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nn(S,T=[]){let R;switch(S){case"Browser":R=r3(eS());break;case"Worker":R=`${r3(eS())}-${S}`;break;default:R=S}let N=T.length?T.join(","):"FirebaseCore-web";return`${R}/JsCore/${tU}/${N}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(S){this.auth=S,this.queue=[]}pushCallback(S,T){let R=T=>new Promise((R,N)=>{try{let N=S(T);R(N)}catch(S){N(S)}});R.onAbort=T,this.queue.push(R);let N=this.queue.length-1;return()=>{this.queue[N]=()=>Promise.resolve()}}async runMiddleware(S){if(this.auth.currentUser===S)return;let T=[];try{for(let R of this.queue)await R(S),R.onAbort&&T.push(R.onAbort)}catch(S){for(let S of(T.reverse(),T))try{S()}catch(S){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==S?void 0:S.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function na(S,T={}){return rw(S,"GET","/v2/passwordPolicy",rT(S,T))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let no=6;class nu{constructor(S){var T,R,N,O;let P=S.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(T=P.minPasswordLength)&&void 0!==T?T:no,P.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=P.maxPasswordLength),void 0!==P.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=P.containsLowercaseCharacter),void 0!==P.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=P.containsUppercaseCharacter),void 0!==P.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=P.containsNumericCharacter),void 0!==P.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=P.containsNonAlphanumericCharacter),this.enforcementState=S.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(N=null===(R=S.allowedNonAlphanumericCharacters)||void 0===R?void 0:R.join(""))&&void 0!==N?N:"",this.forceUpgradeOnSignin=null!==(O=S.forceUpgradeOnSignin)&&void 0!==O&&O,this.schemaVersion=S.schemaVersion}validatePassword(S){var T,R,N,O,P,M;let L={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(S,L),this.validatePasswordCharacterOptions(S,L),L.isValid&&(L.isValid=null===(T=L.meetsMinPasswordLength)||void 0===T||T),L.isValid&&(L.isValid=null===(R=L.meetsMaxPasswordLength)||void 0===R||R),L.isValid&&(L.isValid=null===(N=L.containsLowercaseLetter)||void 0===N||N),L.isValid&&(L.isValid=null===(O=L.containsUppercaseLetter)||void 0===O||O),L.isValid&&(L.isValid=null===(P=L.containsNumericCharacter)||void 0===P||P),L.isValid&&(L.isValid=null===(M=L.containsNonAlphanumericCharacter)||void 0===M||M),L}validatePasswordLengthOptions(S,T){let R=this.customStrengthOptions.minPasswordLength,N=this.customStrengthOptions.maxPasswordLength;R&&(T.meetsMinPasswordLength=S.length>=R),N&&(T.meetsMaxPasswordLength=S.length<=N)}validatePasswordCharacterOptions(S,T){let R;this.updatePasswordCharacterOptionsStatuses(T,!1,!1,!1,!1);for(let N=0;N<S.length;N++)R=S.charAt(N),this.updatePasswordCharacterOptionsStatuses(T,R>="a"&&R<="z",R>="A"&&R<="Z",R>="0"&&R<="9",this.allowedNonAlphanumericCharacters.includes(R))}updatePasswordCharacterOptionsStatuses(S,T,R,N,O){this.customStrengthOptions.containsLowercaseLetter&&(S.containsLowercaseLetter||(S.containsLowercaseLetter=T)),this.customStrengthOptions.containsUppercaseLetter&&(S.containsUppercaseLetter||(S.containsUppercaseLetter=R)),this.customStrengthOptions.containsNumericCharacter&&(S.containsNumericCharacter||(S.containsNumericCharacter=N)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(S.containsNonAlphanumericCharacter||(S.containsNonAlphanumericCharacter=O))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc{constructor(S,T,R,N){this.app=S,this.heartbeatServiceProvider=T,this.appCheckServiceProvider=R,this.config=N,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nd(this),this.idTokenSubscription=new nd(this),this.beforeStateQueue=new ni(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=t7,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=S.name,this.clientVersion=N.sdkClientVersion,this._persistenceManagerAvailable=new Promise(S=>this._resolvePersistenceManagerAvailable=S)}_initializeWithPersistence(S,T){return T&&(this._popupRedirectResolver=rZ(T)),this._initializationPromise=this.queue(async()=>{var R,N,O;if(!this._deleted&&(this.persistenceManager=await r4.create(this,S),null===(R=this._resolvePersistenceManagerAvailable)||void 0===R||R.call(this),!this._deleted)){if(null===(N=this._popupRedirectResolver)||void 0===N?void 0:N._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(S){}await this.initializeCurrentUser(T),this.lastNotifiedUid=(null===(O=this.currentUser)||void 0===O?void 0:O.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let S=await this.assertedPersistence.getCurrentUser();if(this.currentUser||S){if(this.currentUser&&S&&this.currentUser.uid===S.uid){this._currentUser._assign(S),await this.currentUser.getIdToken();return}await this._updateCurrentUser(S,!0)}}async initializeCurrentUserFromIdToken(S){try{let T=await rx(this,{idToken:S}),R=await rJ._fromGetAccountInfoResponse(this,T,S);await this.directlySetCurrentUser(R)}catch(S){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",S),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(S){var T;if(tL(this.app)){let S=this.app.settings.authIdToken;return S?new Promise(T=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(S).then(T,T))}):this.directlySetCurrentUser(null)}let R=await this.assertedPersistence.getCurrentUser(),N=R,O=!1;if(S&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let R=null===(T=this.redirectUser)||void 0===T?void 0:T._redirectEventId,P=null==N?void 0:N._redirectEventId,M=await this.tryRedirectSignIn(S);(!R||R===P)&&(null==M?void 0:M.user)&&(N=M.user,O=!0)}if(!N)return this.directlySetCurrentUser(null);if(!N._redirectEventId){if(O)try{await this.beforeStateQueue.runMiddleware(N)}catch(S){N=R,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(S))}return N?this.reloadAndSetCurrentUserOrClear(N):this.directlySetCurrentUser(null)}return(rl(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===N._redirectEventId)?this.directlySetCurrentUser(N):this.reloadAndSetCurrentUserOrClear(N)}async tryRedirectSignIn(S){let T=null;try{T=await this._popupRedirectResolver._completeRedirectFn(this,S,!0)}catch(S){await this._setRedirectUser(null)}return T}async reloadAndSetCurrentUserOrClear(S){try{await rq(S)}catch(S){if((null==S?void 0:S.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(S)}useDeviceLanguage(){this.languageCode=rf()}async _delete(){this._deleted=!0}async updateCurrentUser(S){if(tL(this.app))return Promise.reject(ra(this));let T=S?eQ(S):null;return T&&rl(T.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(T&&T._clone(this))}async _updateCurrentUser(S,T=!1){if(!this._deleted)return S&&rl(this.tenantId===S.tenantId,this,"tenant-id-mismatch"),T||await this.beforeStateQueue.runMiddleware(S),this.queue(async()=>{await this.directlySetCurrentUser(S),this.notifyAuthListeners()})}async signOut(){return tL(this.app)?Promise.reject(ra(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(S){return tL(this.app)?Promise.reject(ra(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(rZ(S))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(S){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let T=this._getPasswordPolicyInternal();return T.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):T.validatePassword(S)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let S=new nu(await na(this));null===this.tenantId?this._projectPasswordPolicy=S:this._tenantPasswordPolicies[this.tenantId]=S}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(S){this._errorFactory=new eO("auth","Firebase",S())}onAuthStateChanged(S,T,R){return this.registerStateListener(this.authStateSubscription,S,T,R)}beforeAuthStateChanged(S,T){return this.beforeStateQueue.pushCallback(S,T)}onIdTokenChanged(S,T,R){return this.registerStateListener(this.idTokenSubscription,S,T,R)}authStateReady(){return new Promise((S,T)=>{if(this.currentUser)S();else{let R=this.onAuthStateChanged(()=>{R(),S()},T)}})}async revokeAccessToken(S){if(this.currentUser){let T={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:S,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(T.tenantId=this.tenantId),await rW(this,T)}}toJSON(){var S;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(S=this._currentUser)||void 0===S?void 0:S.toJSON()}}async _setRedirectUser(S,T){let R=await this.getOrInitRedirectPersistenceManager(T);return null===S?R.removeCurrentUser():R.setCurrentUser(S)}async getOrInitRedirectPersistenceManager(S){if(!this.redirectPersistenceManager){let T=S&&rZ(S)||this._popupRedirectResolver;rl(T,this,"argument-error"),this.redirectPersistenceManager=await r4.create(this,[rZ(T._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(S){var T,R;return(this._isInitialized&&await this.queue(async()=>{}),(null===(T=this._currentUser)||void 0===T?void 0:T._redirectEventId)===S)?this._currentUser:(null===(R=this.redirectUser)||void 0===R?void 0:R._redirectEventId)===S?this.redirectUser:null}async _persistUserIfCurrent(S){if(S===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(S))}_notifyListenersIfCurrent(S){S===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var S,T;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let R=null!==(T=null===(S=this.currentUser)||void 0===S?void 0:S.uid)&&void 0!==T?T:null;this.lastNotifiedUid!==R&&(this.lastNotifiedUid=R,this.authStateSubscription.next(this.currentUser))}registerStateListener(S,T,R,N){if(this._deleted)return()=>{};let O="function"==typeof T?T:T.next.bind(T),P=!1,M=this._isInitialized?Promise.resolve():this._initializationPromise;if(rl(M,this,"internal-error"),M.then(()=>{P||O(this.currentUser)}),"function"==typeof T){let O=S.addObserver(T,R,N);return()=>{P=!0,O()}}{let R=S.addObserver(T);return()=>{P=!0,R()}}}async directlySetCurrentUser(S){this.currentUser&&this.currentUser!==S&&this._currentUser._stopProactiveRefresh(),S&&this.isProactiveRefreshEnabled&&S._startProactiveRefresh(),this.currentUser=S,S?await this.assertedPersistence.setCurrentUser(S):await this.assertedPersistence.removeCurrentUser()}queue(S){return this.operations=this.operations.then(S,S),this.operations}get assertedPersistence(){return rl(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(S){!S||this.frameworks.includes(S)||(this.frameworks.push(S),this.frameworks.sort(),this.clientVersion=nn(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var S;let T={"X-Client-Version":this.clientVersion};this.app.options.appId&&(T["X-Firebase-gmpid"]=this.app.options.appId);let R=await (null===(S=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===S?void 0:S.getHeartbeatsHeader());R&&(T["X-Firebase-Client"]=R);let N=await this._getAppCheckToken();return N&&(T["X-Firebase-AppCheck"]=N),T}async _getAppCheckToken(){var S;if(tL(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let T=await (null===(S=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===S?void 0:S.getToken());return(null==T?void 0:T.error)&&rt(`Error while retrieving App Check token: ${T.error}`),null==T?void 0:T.token}}function nh(S){return eQ(S)}class nd{constructor(S){this.auth=S,this.observer=null,this.addObserver=ej(S=>this.observer=S)}get next(){return rl(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class np{constructor(){this.enterprise=new nf}ready(S){S()}execute(S,T){return Promise.resolve("token")}render(S,T){return""}}class nf{ready(S){S()}execute(S,T){return Promise.resolve("token")}render(S,T){return""}}let ng="recaptcha-enterprise",nm="NO_RECAPTCHA";class ny{constructor(S){this.type=ng,this.auth=nh(S)}async verify(S="verify",T=!1){async function R(S){if(!T){if(null==S.tenantId&&null!=S._agentRecaptchaConfig)return S._agentRecaptchaConfig.siteKey;if(null!=S.tenantId&&void 0!==S._tenantRecaptchaConfigs[S.tenantId])return S._tenantRecaptchaConfigs[S.tenantId].siteKey}return new Promise(async(T,R)=>{rN(S,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(N=>{if(void 0===N.recaptchaKey)R(Error("recaptcha Enterprise site key undefined"));else{let R=new rD(N);return null==S.tenantId?S._agentRecaptchaConfig=R:S._tenantRecaptchaConfigs[S.tenantId]=R,T(R.siteKey)}}).catch(S=>{R(S)})})}function N(T,R,N){let O=window.grecaptcha;rA(O)?O.enterprise.ready(()=>{O.enterprise.execute(T,{action:S}).then(S=>{R(S)}).catch(()=>{R(nm)})}):N(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new np().execute("siteKey",{action:"verify"}):new Promise((S,O)=>{R(this.auth).then(R=>{if(!T&&rA(window.grecaptcha))N(R,S,O);else{O(Error("RecaptchaVerifier is only supported in browser"));return}}).catch(S=>{O(S)})})}}async function nv(S,T,R,N=!1,O=!1){let P;let M=new ny(S);if(O)P=nm;else try{P=await M.verify(R)}catch(S){P=await M.verify(R,!0)}let L=Object.assign({},T);if("mfaSmsEnrollment"===R||"mfaSmsSignIn"===R){if("phoneEnrollmentInfo"in L){let S=L.phoneEnrollmentInfo.phoneNumber,T=L.phoneEnrollmentInfo.recaptchaToken;Object.assign(L,{phoneEnrollmentInfo:{phoneNumber:S,recaptchaToken:T,captchaResponse:P,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in L){let S=L.phoneSignInInfo.recaptchaToken;Object.assign(L,{phoneSignInInfo:{recaptchaToken:S,captchaResponse:P,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return L}return N?Object.assign(L,{captchaResp:P}):Object.assign(L,{captchaResponse:P}),Object.assign(L,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(L,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),L}async function nb(S,T,R,N,O){var P,M;if("EMAIL_PASSWORD_PROVIDER"===O){if(null===(P=S._getRecaptchaConfig())||void 0===P||!P.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return N(S,T).catch(async O=>{if("auth/missing-recaptcha-token"!==O.code)return Promise.reject(O);{console.log(`${R} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let O=await nv(S,T,R,"getOobCode"===R);return N(S,O)}});{let O=await nv(S,T,R,"getOobCode"===R);return N(S,O)}}if("PHONE_PROVIDER"!==O)return Promise.reject(O+" provider is not supported.");if(null===(M=S._getRecaptchaConfig())||void 0===M?void 0:M.isProviderEnabled("PHONE_PROVIDER")){let O=await nv(S,T,R);return N(S,O).catch(async O=>{var P;if((null===(P=S._getRecaptchaConfig())||void 0===P?void 0:P.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===O.code||"auth/invalid-app-credential"===O.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${R} flow.`);let O=await nv(S,T,R,!1,!0);return N(S,O)}return Promise.reject(O)})}{let O=await nv(S,T,R,!1,!0);return N(S,O)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nS(S,T){let R=tM(S,"auth");if(R.isInitialized()){let S=R.getImmediate();if(eM(R.getOptions(),null!=T?T:{}))return S;rn(S,"already-initialized")}return R.initialize({options:T})}function nT(S,T){let R=(null==T?void 0:T.persistence)||[],N=(Array.isArray(R)?R:[R]).map(rZ);(null==T?void 0:T.errorMap)&&S._updateErrorMap(T.errorMap),S._initializeWithPersistence(N,null==T?void 0:T.popupRedirectResolver)}function nw(S,T,R){let N=nh(S);rl(/^https?:\/\//.test(T),N,"invalid-emulator-scheme");let O=!!(null==R?void 0:R.disableWarnings),P=nC(T),{host:M,port:L}=nE(T),U=null===L?"":`:${L}`,V={url:`${P}//${M}${U}/`},$=Object.freeze({host:M,port:L,protocol:P.replace(":",""),options:Object.freeze({disableWarnings:O})});if(!N._canInitEmulator){rl(N.config.emulator&&N.emulatorConfig,N,"emulator-config-failed"),rl(eM(V,N.config.emulator)&&eM($,N.emulatorConfig),N,"emulator-config-failed");return}N.config.emulator=V,N.emulatorConfig=$,N.settings.appVerificationDisabledForTesting=!0,O||n_()}function nC(S){let T=S.indexOf(":");return T<0?"":S.substr(0,T+1)}function nE(S){let T=nC(S),R=/(\/\/)?([^?#/]+)/.exec(S.substr(T.length));if(!R)return{host:"",port:null};let N=R[2].split("@").pop()||"",O=/^(\[[^\]]+\])(:|$)/.exec(N);if(O){let S=O[1];return{host:S,port:nI(N.substr(S.length+1))}}{let[S,T]=N.split(":");return{host:S,port:nI(T)}}}function nI(S){if(!S)return null;let T=Number(S);return isNaN(T)?null:T}function n_(){"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk{constructor(S,T){this.providerId=S,this.signInMethod=T}toJSON(){return ru("not implemented")}_getIdTokenResponse(S){return ru("not implemented")}_linkToIdToken(S,T){return ru("not implemented")}_getReauthenticationResolver(S){return ru("not implemented")}}async function nR(S,T){return rw(S,"POST","/v1/accounts:signUp",T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nA(S,T){return rE(S,"POST","/v1/accounts:signInWithPassword",rT(S,T))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nD(S,T){return rE(S,"POST","/v1/accounts:signInWithEmailLink",rT(S,T))}async function nN(S,T){return rE(S,"POST","/v1/accounts:signInWithEmailLink",rT(S,T))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nO extends nk{constructor(S,T,R,N=null){super("password",R),this._email=S,this._password=T,this._tenantId=N}static _fromEmailAndPassword(S,T){return new nO(S,T,"password")}static _fromEmailAndCode(S,T,R=null){return new nO(S,T,"emailLink",R)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(S){let T="string"==typeof S?JSON.parse(S):S;if((null==T?void 0:T.email)&&(null==T?void 0:T.password)){if("password"===T.signInMethod)return this._fromEmailAndPassword(T.email,T.password);if("emailLink"===T.signInMethod)return this._fromEmailAndCode(T.email,T.password,T.tenantId)}return null}async _getIdTokenResponse(S){switch(this.signInMethod){case"password":return nb(S,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",nA,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nD(S,{email:this._email,oobCode:this._password});default:rn(S,"internal-error")}}async _linkToIdToken(S,T){switch(this.signInMethod){case"password":return nb(S,{idToken:T,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",nR,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nN(S,{idToken:T,email:this._email,oobCode:this._password});default:rn(S,"internal-error")}}_getReauthenticationResolver(S){return this._getIdTokenResponse(S)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nx(S,T){return rE(S,"POST","/v1/accounts:signInWithIdp",rT(S,T))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nP="http://localhost";class nM extends nk{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(S){let T=new nM(S.providerId,S.signInMethod);return S.idToken||S.accessToken?(S.idToken&&(T.idToken=S.idToken),S.accessToken&&(T.accessToken=S.accessToken),S.nonce&&!S.pendingToken&&(T.nonce=S.nonce),S.pendingToken&&(T.pendingToken=S.pendingToken)):S.oauthToken&&S.oauthTokenSecret?(T.accessToken=S.oauthToken,T.secret=S.oauthTokenSecret):rn("argument-error"),T}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(S){let T="string"==typeof S?JSON.parse(S):S,{providerId:R,signInMethod:N}=T,O=t6(T,["providerId","signInMethod"]);if(!R||!N)return null;let P=new nM(R,N);return P.idToken=O.idToken||void 0,P.accessToken=O.accessToken||void 0,P.secret=O.secret,P.nonce=O.nonce,P.pendingToken=O.pendingToken||null,P}_getIdTokenResponse(S){return nx(S,this.buildRequest())}_linkToIdToken(S,T){let R=this.buildRequest();return R.idToken=T,nx(S,R)}_getReauthenticationResolver(S){let T=this.buildRequest();return T.autoCreate=!1,nx(S,T)}buildRequest(){let S={requestUri:nP,returnSecureToken:!0};if(this.pendingToken)S.pendingToken=this.pendingToken;else{let T={};this.idToken&&(T.id_token=this.idToken),this.accessToken&&(T.access_token=this.accessToken),this.secret&&(T.oauth_token_secret=this.secret),T.providerId=this.providerId,this.nonce&&!this.pendingToken&&(T.nonce=this.nonce),S.postBody=eB(T)}return S}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nL(S,T){return rE(S,"POST","/v1/accounts:signInWithPhoneNumber",rT(S,T))}async function nB(S,T){let R=await rE(S,"POST","/v1/accounts:signInWithPhoneNumber",rT(S,T));if(R.temporaryProof)throw rR(S,"account-exists-with-different-credential",R);return R}let nF={USER_NOT_FOUND:"user-not-found"};async function nU(S,T){return rE(S,"POST","/v1/accounts:signInWithPhoneNumber",rT(S,Object.assign(Object.assign({},T),{operation:"REAUTH"})),nF)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nj extends null{constructor(S){super("phone","phone"),this.params=S}static _fromVerification(S,T){return new nj({verificationId:S,verificationCode:T})}static _fromTokenResponse(S,T){return new nj({phoneNumber:S,temporaryProof:T})}_getIdTokenResponse(S){return nL(S,this._makeVerificationRequest())}_linkToIdToken(S,T){return nB(S,Object.assign({idToken:T},this._makeVerificationRequest()))}_getReauthenticationResolver(S){return nU(S,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:S,phoneNumber:T,verificationId:R,verificationCode:N}=this.params;return S&&T?{temporaryProof:S,phoneNumber:T}:{sessionInfo:R,code:N}}toJSON(){let S={providerId:this.providerId};return this.params.phoneNumber&&(S.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(S.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(S.verificationCode=this.params.verificationCode),this.params.verificationId&&(S.verificationId=this.params.verificationId),S}static fromJSON(S){"string"==typeof S&&(S=JSON.parse(S));let{verificationId:T,verificationCode:R,phoneNumber:N,temporaryProof:O}=S;return R||T||N||O?new nj({verificationId:T,verificationCode:R,phoneNumber:N,temporaryProof:O}):null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nV(S){switch(S){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function nz(S){let T=eF(eU(S)).link,R=T?eF(eU(T)).deep_link_id:null,N=eF(eU(S)).deep_link_id;return(N?eF(eU(N)).link:null)||N||R||T||S}class nq{constructor(S){var T,R,N,O,P,M;let L=eF(eU(S)),U=null!==(T=L.apiKey)&&void 0!==T?T:null,V=null!==(R=L.oobCode)&&void 0!==R?R:null,$=nV(null!==(N=L.mode)&&void 0!==N?N:null);rl(U&&V&&$,"argument-error"),this.apiKey=U,this.operation=$,this.code=V,this.continueUrl=null!==(O=L.continueUrl)&&void 0!==O?O:null,this.languageCode=null!==(P=L.languageCode)&&void 0!==P?P:null,this.tenantId=null!==(M=L.tenantId)&&void 0!==M?M:null}static parseLink(S){let T=nz(S);try{return new nq(T)}catch(S){return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n${constructor(){this.providerId=n$.PROVIDER_ID}static credential(S,T){return nO._fromEmailAndPassword(S,T)}static credentialWithLink(S,T){let R=nq.parseLink(T);return rl(R,"argument-error"),nO._fromEmailAndCode(S,R.code,R.tenantId)}}n$.PROVIDER_ID="password",n$.EMAIL_PASSWORD_SIGN_IN_METHOD="password",n$.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nG{constructor(S){this.providerId=S,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(S){this.defaultLanguageCode=S}setCustomParameters(S){return this.customParameters=S,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nK extends nG{constructor(){super(...arguments),this.scopes=[]}addScope(S){return this.scopes.includes(S)||this.scopes.push(S),this}getScopes(){return[...this.scopes]}}class nH extends null{static credentialFromJSON(S){let T="string"==typeof S?JSON.parse(S):S;return rl("providerId"in T&&"signInMethod"in T,"argument-error"),nM._fromParams(T)}credential(S){return this._credential(Object.assign(Object.assign({},S),{nonce:S.rawNonce}))}_credential(S){return rl(S.idToken||S.accessToken,"argument-error"),nM._fromParams(Object.assign(Object.assign({},S),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(S){return nH.oauthCredentialFromTaggedObject(S)}static credentialFromError(S){return nH.oauthCredentialFromTaggedObject(S.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:S}){if(!S)return null;let{oauthIdToken:T,oauthAccessToken:R,oauthTokenSecret:N,pendingToken:O,nonce:P,providerId:M}=S;if(!R&&!N&&!T&&!O||!M)return null;try{return new nH(M)._credential({idToken:T,accessToken:R,nonce:P,pendingToken:O})}catch(S){return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nW extends nK{constructor(){super("facebook.com")}static credential(S){return nM._fromParams({providerId:nW.PROVIDER_ID,signInMethod:nW.FACEBOOK_SIGN_IN_METHOD,accessToken:S})}static credentialFromResult(S){return nW.credentialFromTaggedObject(S)}static credentialFromError(S){return nW.credentialFromTaggedObject(S.customData||{})}static credentialFromTaggedObject({_tokenResponse:S}){if(!S||!("oauthAccessToken"in S)||!S.oauthAccessToken)return null;try{return nW.credential(S.oauthAccessToken)}catch(S){return null}}}nW.FACEBOOK_SIGN_IN_METHOD="facebook.com",nW.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nQ extends nK{constructor(){super("google.com"),this.addScope("profile")}static credential(S,T){return nM._fromParams({providerId:nQ.PROVIDER_ID,signInMethod:nQ.GOOGLE_SIGN_IN_METHOD,idToken:S,accessToken:T})}static credentialFromResult(S){return nQ.credentialFromTaggedObject(S)}static credentialFromError(S){return nQ.credentialFromTaggedObject(S.customData||{})}static credentialFromTaggedObject({_tokenResponse:S}){if(!S)return null;let{oauthIdToken:T,oauthAccessToken:R}=S;if(!T&&!R)return null;try{return nQ.credential(T,R)}catch(S){return null}}}nQ.GOOGLE_SIGN_IN_METHOD="google.com",nQ.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nY extends nK{constructor(){super("github.com")}static credential(S){return nM._fromParams({providerId:nY.PROVIDER_ID,signInMethod:nY.GITHUB_SIGN_IN_METHOD,accessToken:S})}static credentialFromResult(S){return nY.credentialFromTaggedObject(S)}static credentialFromError(S){return nY.credentialFromTaggedObject(S.customData||{})}static credentialFromTaggedObject({_tokenResponse:S}){if(!S||!("oauthAccessToken"in S)||!S.oauthAccessToken)return null;try{return nY.credential(S.oauthAccessToken)}catch(S){return null}}}nY.GITHUB_SIGN_IN_METHOD="github.com",nY.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nJ="http://localhost";class nX extends null{constructor(S,T){super(S,S),this.pendingToken=T}_getIdTokenResponse(S){return nx(S,this.buildRequest())}_linkToIdToken(S,T){let R=this.buildRequest();return R.idToken=T,nx(S,R)}_getReauthenticationResolver(S){let T=this.buildRequest();return T.autoCreate=!1,nx(S,T)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(S){let{providerId:T,signInMethod:R,pendingToken:N}="string"==typeof S?JSON.parse(S):S;return T&&R&&N&&T===R?new nX(T,N):null}static _create(S,T){return new nX(S,T)}buildRequest(){return{requestUri:nJ,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nZ="saml.";class n0 extends null{constructor(S){rl(S.startsWith(nZ),"argument-error"),super(S)}static credentialFromResult(S){return n0.samlCredentialFromTaggedObject(S)}static credentialFromError(S){return n0.samlCredentialFromTaggedObject(S.customData||{})}static credentialFromJSON(S){let T=nX.fromJSON(S);return rl(T,"argument-error"),T}static samlCredentialFromTaggedObject({_tokenResponse:S}){if(!S)return null;let{pendingToken:T,providerId:R}=S;if(!T||!R)return null;try{return nX._create(R,T)}catch(S){return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4 extends nK{constructor(){super("twitter.com")}static credential(S,T){return nM._fromParams({providerId:n4.PROVIDER_ID,signInMethod:n4.TWITTER_SIGN_IN_METHOD,oauthToken:S,oauthTokenSecret:T})}static credentialFromResult(S){return n4.credentialFromTaggedObject(S)}static credentialFromError(S){return n4.credentialFromTaggedObject(S.customData||{})}static credentialFromTaggedObject({_tokenResponse:S}){if(!S)return null;let{oauthAccessToken:T,oauthTokenSecret:R}=S;if(!T||!R)return null;try{return n4.credential(T,R)}catch(S){return null}}}n4.TWITTER_SIGN_IN_METHOD="twitter.com",n4.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(S){this.user=S.user,this.providerId=S.providerId,this._tokenResponse=S._tokenResponse,this.operationType=S.operationType}static async _fromIdTokenResponse(S,T,R,N=!1){return new n3({user:await rJ._fromIdTokenResponse(S,R,N),providerId:n6(R),_tokenResponse:R,operationType:T})}static async _forOperation(S,T,R){return await S._updateTokensIfNecessary(R,!0),new n3({user:S,providerId:n6(R),_tokenResponse:R,operationType:T})}}function n6(S){return S.providerId?S.providerId:"phoneNumber"in S?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n9 extends eN{constructor(S,T,R,N){var O;super(T.code,T.message),this.operationType=R,this.user=N,Object.setPrototypeOf(this,n9.prototype),this.customData={appName:S.name,tenantId:null!==(O=S.tenantId)&&void 0!==O?O:void 0,_serverResponse:T.customData._serverResponse,operationType:R}}static _fromErrorAndOperation(S,T,R,N){return new n9(S,T,R,N)}}function n5(S,T,R,N){return("reauthenticate"===T?R._getReauthenticationResolver(S):R._getIdTokenResponse(S)).catch(R=>{if("auth/multi-factor-auth-required"===R.code)throw n9._fromErrorAndOperation(S,R,T,N);throw R})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n7(S,T,R=!1){if(tL(S.app))return Promise.reject(ra(S));let N="signIn",O=await n5(S,N,T),P=await n3._fromIdTokenResponse(S,N,O);return R||await S._updateCurrentUser(P.user),P}async function n8(S,T){return n7(nh(S),T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(S,T){this.factorId=S,this.uid=T.mfaEnrollmentId,this.enrollmentTime=new Date(T.enrolledAt).toUTCString(),this.displayName=T.displayName}static _fromServerResponse(S,T){return"phoneInfo"in T?ir._fromServerResponse(S,T):"totpInfo"in T?ii._fromServerResponse(S,T):rn(S,"internal-error")}}class ir extends null{constructor(S){super("phone",S),this.phoneNumber=S.phoneInfo}static _fromServerResponse(S,T){return new ir(T)}}class ii extends null{constructor(S){super("totp",S)}static _fromServerResponse(S,T){return new ii(T)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function is(S){let T=nh(S);T._getPasswordPolicyInternal()&&await T._updatePasswordPolicy()}function ia(S,T,R){return tL(S.app)?Promise.reject(ra(S)):n8(eQ(S),n$.credential(T,R)).catch(async T=>{throw"auth/password-does-not-meet-requirements"===T.code&&is(S),T})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class io{constructor(S,T,R){this.type=S,this.credential=T,this.user=R}static _fromIdtoken(S,T){return new io("enroll",S,T)}static _fromMfaPendingCredential(S){return new io("signin",S)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(S){var T,R;if(null==S?void 0:S.multiFactorSession){if(null===(T=S.multiFactorSession)||void 0===T?void 0:T.pendingCredential)return io._fromMfaPendingCredential(S.multiFactorSession.pendingCredential);if(null===(R=S.multiFactorSession)||void 0===R?void 0:R.idToken)return io._fromIdtoken(S.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class il{constructor(S,T,R){this.session=S,this.hints=T,this.signInResolver=R}static _fromError(S,T){let R=nh(S),N=T.customData._serverResponse,O=(N.mfaInfo||[]).map(S=>ie._fromServerResponse(R,S));rl(N.mfaPendingCredential,R,"internal-error");let P=io._fromMfaPendingCredential(N.mfaPendingCredential);return new il(P,O,async S=>{let O=await S._process(R,P);delete N.mfaInfo,delete N.mfaPendingCredential;let M=Object.assign(Object.assign({},N),{idToken:O.idToken,refreshToken:O.refreshToken});switch(T.operationType){case"signIn":let L=await n3._fromIdTokenResponse(R,T.operationType,M);return await R._updateCurrentUser(L.user),L;case"reauthenticate":return rl(T.user,R,"internal-error"),n3._forOperation(T.user,T.operationType,M);default:rn(R,"internal-error")}})}async resolveSignIn(S){let T=S;return this.signInResolver(T)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iu(S,T){return rw(S,"POST","/v2/accounts/mfaEnrollment:start",rT(S,T))}function ic(S,T){return rw(S,"POST","/v2/accounts/mfaEnrollment:finalize",rT(S,T))}function ih(S,T){return rw(S,"POST","/v2/accounts/mfaEnrollment:withdraw",rT(S,T))}class ip{constructor(S){this.user=S,this.enrolledFactors=[],S._onReload(T=>{T.mfaInfo&&(this.enrolledFactors=T.mfaInfo.map(T=>ie._fromServerResponse(S.auth,T)))})}static _fromUser(S){return new ip(S)}async getSession(){return io._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(S,T){let R=S,N=await this.getSession(),O=await rU(this.user,R._process(this.user.auth,N,T));return await this.user._updateTokensIfNecessary(O),this.user.reload()}async unenroll(S){let T="string"==typeof S?S:S.uid,R=await this.user.getIdToken();try{let S=await rU(this.user,ih(this.user.auth,{idToken:R,mfaEnrollmentId:T}));this.enrolledFactors=this.enrolledFactors.filter(({uid:S})=>S!==T),await this.user._updateTokensIfNecessary(S),await this.user.reload()}catch(S){throw S}}}new WeakMap;var ig="@firebase/auth",im="1.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iy{constructor(S){this.auth=S,this.internalListeners=new Map}getUid(){var S;return this.assertAuthConfigured(),(null===(S=this.auth.currentUser)||void 0===S?void 0:S.uid)||null}async getToken(S){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(S)}:null}addAuthTokenListener(S){if(this.assertAuthConfigured(),this.internalListeners.has(S))return;let T=this.auth.onIdTokenChanged(T=>{S((null==T?void 0:T.stsTokenManager.accessToken)||null)});this.internalListeners.set(S,T),this.updateProactiveRefresh()}removeAuthTokenListener(S){this.assertAuthConfigured();let T=this.internalListeners.get(S);T&&(this.internalListeners.delete(S),T(),this.updateProactiveRefresh())}assertAuthConfigured(){rl(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iv(S){switch(S){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ib(S){tP(new eY("auth",(T,{options:R})=>{let N=T.getProvider("app").getImmediate(),O=T.getProvider("heartbeat"),P=T.getProvider("app-check-internal"),{apiKey:M,authDomain:L}=N.options;rl(M&&!M.includes(":"),"invalid-api-key",{appName:N.name});let U=new nc(N,O,P,{apiKey:M,authDomain:L,clientPlatform:S,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nn(S)});return nT(U,R),U},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((S,T,R)=>{S.getProvider("auth-internal").initialize()})),tP(new eY("auth-internal",S=>new iy(nh(S.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),tz(ig,im,iv(S)),tz(ig,im,"esm2017")}function iS(S=tV()){let T=tM(S,"auth");if(T.isInitialized())return T.getImmediate();let R=nS(S),N=eg("auth");return N&&nw(R,`http://${N}`),R}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iT(S,T){return rw(S,"POST","/v2/accounts/mfaSignIn:finalize",rT(S,T))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ry.initialize(fetch,Headers,Response),ib("Node"),ri("operation-not-supported-in-this-environment"),nc.prototype.setPersistence=async()=>{};class iw{constructor(S){this.factorId=S}_process(S,T,R){switch(T.type){case"enroll":return this._finalizeEnroll(S,T.credential,R);case"signin":return this._finalizeSignIn(S,T.credential);default:return ru("unexpected MultiFactorSessionType")}}}class iC{static assertionForEnrollment(S,T){return iE._fromSecret(S,T)}static assertionForSignIn(S,T){return iE._fromEnrollmentId(S,T)}static async generateSecret(S){var T;let R=S;rl(void 0!==(null===(T=R.user)||void 0===T?void 0:T.auth),"internal-error");let N=await iu(R.user.auth,{idToken:R.credential,totpEnrollmentInfo:{}});return iI._fromStartTotpMfaEnrollmentResponse(N,R.user.auth)}}iC.FACTOR_ID="totp";class iE extends iw{constructor(S,T,R){super("totp"),this.otp=S,this.enrollmentId=T,this.secret=R}static _fromSecret(S,T){return new iE(T,void 0,S)}static _fromEnrollmentId(S,T){return new iE(T,S)}async _finalizeEnroll(S,T,R){return rl(void 0!==this.secret,S,"argument-error"),ic(S,{idToken:T,displayName:R,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(S,T){rl(void 0!==this.enrollmentId&&void 0!==this.otp,S,"argument-error");let R={verificationCode:this.otp};return iT(S,{mfaPendingCredential:T,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:R})}}class iI{constructor(S,T,R,N,O,P,M){this.sessionInfo=P,this.auth=M,this.secretKey=S,this.hashingAlgorithm=T,this.codeLength=R,this.codeIntervalSeconds=N,this.enrollmentCompletionDeadline=O}static _fromStartTotpMfaEnrollmentResponse(S,T){return new iI(S.totpSessionInfo.sharedSecretKey,S.totpSessionInfo.hashingAlgorithm,S.totpSessionInfo.verificationCodeLength,S.totpSessionInfo.periodSec,new Date(S.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),S.totpSessionInfo.sessionInfo,T)}_makeTotpVerificationInfo(S){return{sessionInfo:this.sessionInfo,verificationCode:S}}generateQrCodeUrl(S,T){var R;let N=!1;return(i_(S)||i_(T))&&(N=!0),N&&(i_(S)&&(S=(null===(R=this.auth.currentUser)||void 0===R?void 0:R.email)||"unknownuser"),i_(T)&&(T=this.auth.name)),`otpauth://totp/${T}:${S}?secret=${this.secretKey}&issuer=${T}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function i_(S){return void 0===S||(null==S?void 0:S.length)===0}var ik=R(3837);require("crypto");var iR="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},iA={};(function(){function S(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function T(S,T,R){R||(R=0);var N=Array(16);if("string"==typeof T)for(var O=0;16>O;++O)N[O]=T.charCodeAt(R++)|T.charCodeAt(R++)<<8|T.charCodeAt(R++)<<16|T.charCodeAt(R++)<<24;else for(O=0;16>O;++O)N[O]=T[R++]|T[R++]<<8|T[R++]<<16|T[R++]<<24;T=S.g[0],R=S.g[1],O=S.g[2];var P=S.g[3],M=T+(P^R&(O^P))+N[0]+3614090360&4294967295;M=P+(O^(T=R+(M<<7&4294967295|M>>>25))&(R^O))+N[1]+3905402710&4294967295,M=O+(R^(P=T+(M<<12&4294967295|M>>>20))&(T^R))+N[2]+606105819&4294967295,M=R+(T^(O=P+(M<<17&4294967295|M>>>15))&(P^T))+N[3]+3250441966&4294967295,M=T+(P^(R=O+(M<<22&4294967295|M>>>10))&(O^P))+N[4]+4118548399&4294967295,M=P+(O^(T=R+(M<<7&4294967295|M>>>25))&(R^O))+N[5]+1200080426&4294967295,M=O+(R^(P=T+(M<<12&4294967295|M>>>20))&(T^R))+N[6]+2821735955&4294967295,M=R+(T^(O=P+(M<<17&4294967295|M>>>15))&(P^T))+N[7]+4249261313&4294967295,M=T+(P^(R=O+(M<<22&4294967295|M>>>10))&(O^P))+N[8]+1770035416&4294967295,M=P+(O^(T=R+(M<<7&4294967295|M>>>25))&(R^O))+N[9]+2336552879&4294967295,M=O+(R^(P=T+(M<<12&4294967295|M>>>20))&(T^R))+N[10]+4294925233&4294967295,M=R+(T^(O=P+(M<<17&4294967295|M>>>15))&(P^T))+N[11]+2304563134&4294967295,M=T+(P^(R=O+(M<<22&4294967295|M>>>10))&(O^P))+N[12]+1804603682&4294967295,M=P+(O^(T=R+(M<<7&4294967295|M>>>25))&(R^O))+N[13]+4254626195&4294967295,M=O+(R^(P=T+(M<<12&4294967295|M>>>20))&(T^R))+N[14]+2792965006&4294967295,M=R+(T^(O=P+(M<<17&4294967295|M>>>15))&(P^T))+N[15]+1236535329&4294967295,R=O+(M<<22&4294967295|M>>>10),M=T+(O^P&(R^O))+N[1]+4129170786&4294967295,T=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(T^R))+N[6]+3225465664&4294967295,P=T+(M<<9&4294967295|M>>>23),M=O+(T^R&(P^T))+N[11]+643717713&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^T&(O^P))+N[0]+3921069994&4294967295,R=O+(M<<20&4294967295|M>>>12),M=T+(O^P&(R^O))+N[5]+3593408605&4294967295,T=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(T^R))+N[10]+38016083&4294967295,P=T+(M<<9&4294967295|M>>>23),M=O+(T^R&(P^T))+N[15]+3634488961&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^T&(O^P))+N[4]+3889429448&4294967295,R=O+(M<<20&4294967295|M>>>12),M=T+(O^P&(R^O))+N[9]+568446438&4294967295,T=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(T^R))+N[14]+3275163606&4294967295,P=T+(M<<9&4294967295|M>>>23),M=O+(T^R&(P^T))+N[3]+4107603335&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^T&(O^P))+N[8]+1163531501&4294967295,R=O+(M<<20&4294967295|M>>>12),M=T+(O^P&(R^O))+N[13]+2850285829&4294967295,T=R+(M<<5&4294967295|M>>>27),M=P+(R^O&(T^R))+N[2]+4243563512&4294967295,P=T+(M<<9&4294967295|M>>>23),M=O+(T^R&(P^T))+N[7]+1735328473&4294967295,O=P+(M<<14&4294967295|M>>>18),M=R+(P^T&(O^P))+N[12]+2368359562&4294967295,M=T+((R=O+(M<<20&4294967295|M>>>12))^O^P)+N[5]+4294588738&4294967295,M=P+((T=R+(M<<4&4294967295|M>>>28))^R^O)+N[8]+2272392833&4294967295,M=O+((P=T+(M<<11&4294967295|M>>>21))^T^R)+N[11]+1839030562&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^T)+N[14]+4259657740&4294967295,M=T+((R=O+(M<<23&4294967295|M>>>9))^O^P)+N[1]+2763975236&4294967295,M=P+((T=R+(M<<4&4294967295|M>>>28))^R^O)+N[4]+1272893353&4294967295,M=O+((P=T+(M<<11&4294967295|M>>>21))^T^R)+N[7]+4139469664&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^T)+N[10]+3200236656&4294967295,M=T+((R=O+(M<<23&4294967295|M>>>9))^O^P)+N[13]+681279174&4294967295,M=P+((T=R+(M<<4&4294967295|M>>>28))^R^O)+N[0]+3936430074&4294967295,M=O+((P=T+(M<<11&4294967295|M>>>21))^T^R)+N[3]+3572445317&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^T)+N[6]+76029189&4294967295,M=T+((R=O+(M<<23&4294967295|M>>>9))^O^P)+N[9]+3654602809&4294967295,M=P+((T=R+(M<<4&4294967295|M>>>28))^R^O)+N[12]+3873151461&4294967295,M=O+((P=T+(M<<11&4294967295|M>>>21))^T^R)+N[15]+530742520&4294967295,M=R+((O=P+(M<<16&4294967295|M>>>16))^P^T)+N[2]+3299628645&4294967295,R=O+(M<<23&4294967295|M>>>9),M=T+(O^(R|~P))+N[0]+4096336452&4294967295,T=R+(M<<6&4294967295|M>>>26),M=P+(R^(T|~O))+N[7]+1126891415&4294967295,P=T+(M<<10&4294967295|M>>>22),M=O+(T^(P|~R))+N[14]+2878612391&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~T))+N[5]+4237533241&4294967295,R=O+(M<<21&4294967295|M>>>11),M=T+(O^(R|~P))+N[12]+1700485571&4294967295,T=R+(M<<6&4294967295|M>>>26),M=P+(R^(T|~O))+N[3]+2399980690&4294967295,P=T+(M<<10&4294967295|M>>>22),M=O+(T^(P|~R))+N[10]+4293915773&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~T))+N[1]+2240044497&4294967295,R=O+(M<<21&4294967295|M>>>11),M=T+(O^(R|~P))+N[8]+1873313359&4294967295,T=R+(M<<6&4294967295|M>>>26),M=P+(R^(T|~O))+N[15]+4264355552&4294967295,P=T+(M<<10&4294967295|M>>>22),M=O+(T^(P|~R))+N[6]+2734768916&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~T))+N[13]+1309151649&4294967295,R=O+(M<<21&4294967295|M>>>11),M=T+(O^(R|~P))+N[4]+4149444226&4294967295,T=R+(M<<6&4294967295|M>>>26),M=P+(R^(T|~O))+N[11]+3174756917&4294967295,P=T+(M<<10&4294967295|M>>>22),M=O+(T^(P|~R))+N[2]+718787259&4294967295,O=P+(M<<15&4294967295|M>>>17),M=R+(P^(O|~T))+N[9]+3951481745&4294967295,S.g[0]=S.g[0]+T&4294967295,S.g[1]=S.g[1]+(O+(M<<21&4294967295|M>>>11))&4294967295,S.g[2]=S.g[2]+O&4294967295,S.g[3]=S.g[3]+P&4294967295}function R(S,T){var R=P;return Object.prototype.hasOwnProperty.call(R,S)?R[S]:R[S]=T(S)}function N(S,T){this.h=T;for(var R=[],N=!0,O=S.length-1;0<=O;O--){var P=0|S[O];N&&P==T||(R[O]=P,N=!1)}this.g=R}(function(S,T){function R(){}R.prototype=T.prototype,S.D=T.prototype,S.prototype=new R,S.prototype.constructor=S,S.C=function(S,R,N){for(var O=Array(arguments.length-2),P=2;P<arguments.length;P++)O[P-2]=arguments[P];return T.prototype[R].apply(S,O)}})(S,function(){this.blockSize=-1}),S.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},S.prototype.u=function(S,R){void 0===R&&(R=S.length);for(var N=R-this.blockSize,O=this.B,P=this.h,M=0;M<R;){if(0==P)for(;M<=N;)T(this,S,M),M+=this.blockSize;if("string"==typeof S){for(;M<R;)if(O[P++]=S.charCodeAt(M++),P==this.blockSize){T(this,O),P=0;break}}else for(;M<R;)if(O[P++]=S[M++],P==this.blockSize){T(this,O),P=0;break}}this.h=P,this.o+=R},S.prototype.v=function(){var S=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);S[0]=128;for(var T=1;T<S.length-8;++T)S[T]=0;var R=8*this.o;for(T=S.length-8;T<S.length;++T)S[T]=255&R,R/=256;for(this.u(S),S=Array(16),T=R=0;4>T;++T)for(var N=0;32>N;N+=8)S[R++]=this.g[T]>>>N&255;return S};var O,P={};function M(S){return -128<=S&&128>S?R(S,function(S){return new N([0|S],0>S?-1:0)}):new N([0|S],0>S?-1:0)}function L(S){if(isNaN(S)||!isFinite(S))return V;if(0>S)return Z(L(-S));for(var T=[],R=1,O=0;S>=R;O++)T[O]=S/R|0,R*=4294967296;return new N(T,0)}function U(S,T){if(0==S.length)throw Error("number format error: empty string");if(2>(T=T||10)||36<T)throw Error("radix out of range: "+T);if("-"==S.charAt(0))return Z(U(S.substring(1),T));if(0<=S.indexOf("-"))throw Error('number format error: interior "-" character');for(var R=L(Math.pow(T,8)),N=V,O=0;O<S.length;O+=8){var P=Math.min(8,S.length-O),M=parseInt(S.substring(O,O+P),T);8>P?(P=L(Math.pow(T,P)),N=N.j(P).add(L(M))):N=(N=N.j(R)).add(L(M))}return N}var V=M(0),W=M(1),Q=M(16777216);function Y(S){if(0!=S.h)return!1;for(var T=0;T<S.g.length;T++)if(0!=S.g[T])return!1;return!0}function X(S){return -1==S.h}function Z(S){for(var T=S.g.length,R=[],O=0;O<T;O++)R[O]=~S.g[O];return new N(R,~S.h).add(W)}function ee(S,T){return S.add(Z(T))}function et(S,T){for(;(65535&S[T])!=S[T];)S[T+1]+=S[T]>>>16,S[T]&=65535,T++}function er(S,T){this.g=S,this.h=T}function en(S,T){if(Y(T))throw Error("division by zero");if(Y(S))return new er(V,V);if(X(S))return T=en(Z(S),T),new er(Z(T.g),Z(T.h));if(X(T))return T=en(S,Z(T)),new er(Z(T.g),T.h);if(30<S.g.length){if(X(S)||X(T))throw Error("slowDivide_ only works with positive integers.");for(var R=W,N=T;0>=N.l(S);)R=ei(R),N=ei(N);var O=es(R,1),P=es(N,1);for(N=es(N,2),R=es(R,2);!Y(N);){var M=P.add(N);0>=M.l(S)&&(O=O.add(R),P=M),N=es(N,1),R=es(R,1)}return T=ee(S,O.j(T)),new er(O,T)}for(O=V;0<=S.l(T);){for(N=48>=(N=Math.ceil(Math.log(R=Math.max(1,Math.floor(S.m()/T.m())))/Math.LN2))?1:Math.pow(2,N-48),M=(P=L(R)).j(T);X(M)||0<M.l(S);)R-=N,M=(P=L(R)).j(T);Y(P)&&(P=W),O=O.add(P),S=ee(S,M)}return new er(O,S)}function ei(S){for(var T=S.g.length+1,R=[],O=0;O<T;O++)R[O]=S.i(O)<<1|S.i(O-1)>>>31;return new N(R,S.h)}function es(S,T){var R=T>>5;T%=32;for(var O=S.g.length-R,P=[],M=0;M<O;M++)P[M]=0<T?S.i(M+R)>>>T|S.i(M+R+1)<<32-T:S.i(M+R);return new N(P,S.h)}(O=N.prototype).m=function(){if(X(this))return-Z(this).m();for(var S=0,T=1,R=0;R<this.g.length;R++){var N=this.i(R);S+=(0<=N?N:4294967296+N)*T,T*=4294967296}return S},O.toString=function(S){if(2>(S=S||10)||36<S)throw Error("radix out of range: "+S);if(Y(this))return"0";if(X(this))return"-"+Z(this).toString(S);for(var T=L(Math.pow(S,6)),R=this,N="";;){var O=en(R,T).g,P=((0<(R=ee(R,O.j(T))).g.length?R.g[0]:R.h)>>>0).toString(S);if(Y(R=O))return P+N;for(;6>P.length;)P="0"+P;N=P+N}},O.i=function(S){return 0>S?0:S<this.g.length?this.g[S]:this.h},O.l=function(S){return X(S=ee(this,S))?-1:Y(S)?0:1},O.abs=function(){return X(this)?Z(this):this},O.add=function(S){for(var T=Math.max(this.g.length,S.g.length),R=[],O=0,P=0;P<=T;P++){var M=O+(65535&this.i(P))+(65535&S.i(P)),L=(M>>>16)+(this.i(P)>>>16)+(S.i(P)>>>16);O=L>>>16,M&=65535,L&=65535,R[P]=L<<16|M}return new N(R,-2147483648&R[R.length-1]?-1:0)},O.j=function(S){if(Y(this)||Y(S))return V;if(X(this))return X(S)?Z(this).j(Z(S)):Z(Z(this).j(S));if(X(S))return Z(this.j(Z(S)));if(0>this.l(Q)&&0>S.l(Q))return L(this.m()*S.m());for(var T=this.g.length+S.g.length,R=[],O=0;O<2*T;O++)R[O]=0;for(O=0;O<this.g.length;O++)for(var P=0;P<S.g.length;P++){var M=this.i(O)>>>16,U=65535&this.i(O),$=S.i(P)>>>16,K=65535&S.i(P);R[2*O+2*P]+=U*K,et(R,2*O+2*P),R[2*O+2*P+1]+=M*K,et(R,2*O+2*P+1),R[2*O+2*P+1]+=U*$,et(R,2*O+2*P+1),R[2*O+2*P+2]+=M*$,et(R,2*O+2*P+2)}for(O=0;O<T;O++)R[O]=R[2*O+1]<<16|R[2*O];for(O=T;O<2*T;O++)R[O]=0;return new N(R,0)},O.A=function(S){return en(this,S).h},O.and=function(S){for(var T=Math.max(this.g.length,S.g.length),R=[],O=0;O<T;O++)R[O]=this.i(O)&S.i(O);return new N(R,this.h&S.h)},O.or=function(S){for(var T=Math.max(this.g.length,S.g.length),R=[],O=0;O<T;O++)R[O]=this.i(O)|S.i(O);return new N(R,this.h|S.h)},O.xor=function(S){for(var T=Math.max(this.g.length,S.g.length),R=[],O=0;O<T;O++)R[O]=this.i(O)^S.i(O);return new N(R,this.h^S.h)},S.prototype.digest=S.prototype.v,S.prototype.reset=S.prototype.s,S.prototype.update=S.prototype.u,K=iA.Md5=S,N.prototype.add=N.prototype.add,N.prototype.multiply=N.prototype.j,N.prototype.modulo=N.prototype.A,N.prototype.compare=N.prototype.l,N.prototype.toNumber=N.prototype.m,N.prototype.toString=N.prototype.toString,N.prototype.getBits=N.prototype.i,N.fromNumber=L,N.fromString=U,$=iA.Integer=N}).apply(void 0!==iR?iR:"undefined"!=typeof self?self:{});var iD=R(2165),iN=R(8715);let iO="@firebase/firestore",ix="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP{constructor(S){this.uid=S}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(S){return S.uid===this.uid}}iP.UNAUTHENTICATED=new iP(null),iP.GOOGLE_CREDENTIALS=new iP("google-credentials-uid"),iP.FIRST_PARTY=new iP("first-party-uid"),iP.MOCK_USER=new iP("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iM="11.5.0";function iL(S){iM=S}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iB(S){return(0,ik.inspect)(S,{depth:100})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iF=new e5("@firebase/firestore");function iU(){return iF.logLevel}function ij(S,...T){if(iF.logLevel<=V.DEBUG){let R=T.map(iq);iF.debug(`Firestore (${iM}): ${S}`,...R)}}function iV(S,...T){if(iF.logLevel<=V.ERROR){let R=T.map(iq);iF.error(`Firestore (${iM}): ${S}`,...R)}}function iz(S,...T){if(iF.logLevel<=V.WARN){let R=T.map(iq);iF.warn(`Firestore (${iM}): ${S}`,...R)}}function iq(S){if("string"==typeof S)return S;try{return iB(S)}catch(T){return S}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i$(S="Unexpected state"){let T=`FIRESTORE (${iM}) INTERNAL ASSERTION FAILED: `+S;throw iV(T),Error(T)}function iG(S,T){S||i$()}function iK(S,T){return S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iH={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class iW extends eN{constructor(S,T){super(S,T),this.code=S,this.message=T,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iQ{constructor(){this.promise=new Promise((S,T)=>{this.resolve=S,this.reject=T})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iY{constructor(S,T){this.user=T,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${S}`)}}class iJ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(S,T){S.enqueueRetryable(()=>T(iP.UNAUTHENTICATED))}shutdown(){}}class iX{constructor(S){this.token=S,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(S,T){this.changeListener=T,S.enqueueRetryable(()=>T(this.token.user))}shutdown(){this.changeListener=null}}class iZ{constructor(S){this.authProvider=S,this.currentUser=iP.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(S,T){iG(void 0===this.tokenListener);let R=this.tokenCounter,N=S=>this.tokenCounter!==R?(R=this.tokenCounter,T(S)):Promise.resolve(),O=new iQ;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),O.resolve(),O=new iQ,S.enqueueRetryable(()=>N(this.currentUser))};let P=()=>{let T=O;S.enqueueRetryable(async()=>{await T.promise,await N(this.currentUser)})},M=S=>{ij("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=S,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),P())};this.authProvider.onInit(S=>M(S)),setTimeout(()=>{if(!this.auth){let S=this.authProvider.getImmediate({optional:!0});S?M(S):(ij("FirebaseAuthCredentialsProvider","Auth not yet detected"),O.resolve(),O=new iQ)}},0),P()}getToken(){let S=this.tokenCounter,T=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(T).then(T=>this.tokenCounter!==S?(ij("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):T?(iG("string"==typeof T.accessToken),new iY(T.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let S=this.auth&&this.auth.getUid();return iG(null===S||"string"==typeof S),new iP(S)}}class i0{constructor(S,T,R){this.sessionIndex=S,this.iamToken=T,this.authTokenFactory=R,this.type="FirstParty",this.user=iP.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let S=this.getAuthToken();return S&&this._headers.set("Authorization",S),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class i1{constructor(S,T,R){this.sessionIndex=S,this.iamToken=T,this.authTokenFactory=R}getToken(){return Promise.resolve(new i0(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(S,T){S.enqueueRetryable(()=>T(iP.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class i2{constructor(S){this.value=S,this.type="AppCheck",this.headers=new Map,S&&S.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class i4{constructor(S,T){this.appCheckProvider=T,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,tL(S)&&S.settings.appCheckToken&&(this.serverAppAppCheckToken=S.settings.appCheckToken)}start(S,T){iG(void 0===this.tokenListener);let R=S=>{null!=S.error&&ij("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${S.error.message}`);let R=S.token!==this.latestAppCheckToken;return this.latestAppCheckToken=S.token,ij("FirebaseAppCheckTokenProvider",`Received ${R?"new":"existing"} token.`),R?T(S.token):Promise.resolve()};this.tokenListener=T=>{S.enqueueRetryable(()=>R(T))};let N=S=>{ij("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=S,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(S=>N(S)),setTimeout(()=>{if(!this.appCheck){let S=this.appCheckProvider.getImmediate({optional:!0});S?N(S):ij("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new i2(this.serverAppAppCheckToken));let S=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(S).then(S=>S?(iG("string"==typeof S.token),this.latestAppCheckToken=S.token,new i2(S.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function i3(S){if(!S)return new iJ;switch(S.type){case"firstParty":return new i1(S.sessionIndex||"0",S.iamToken||null,S.authTokenFactory||null);case"provider":return S.client;default:throw new iW(iH.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i6(S){return randomBytes$1(S)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i9(){return new ik.TextEncoder}function i5(){return new TextDecoder("utf-8")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i7{static newId(){let S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",T=Math.floor(256/S.length)*S.length,R="",N=20;for(;R.length<N;){let O=i6(40);for(let P=0;P<O.length;++P)R.length<N&&O[P]<T&&(R+=S.charAt(O[P]%S.length))}return R}}function i8(S,T){return S<T?-1:S>T?1:0}function se(S,T){let R=0;for(;R<S.length&&R<T.length;){let N=S.codePointAt(R),O=T.codePointAt(R);if(N!==O){if(N<128&&O<128)return i8(N,O);{let P=i9(),M=sr(P.encode(st(S,R)),P.encode(st(T,R)));if(0!==M)return M;return i8(N,O)}}R+=N>65535?2:1}return i8(S.length,T.length)}function st(S,T){return S.codePointAt(T)>65535?S.substring(T,T+2):S.substring(T,T+1)}function sr(S,T){for(let R=0;R<S.length&&R<T.length;++R)if(S[R]!==T[R])return i8(S[R],T[R]);return i8(S.length,T.length)}function sn(S,T,R){return S.length===T.length&&S.every((S,N)=>R(S,T[N]))}function si(S){return S+"\x00"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ss=-62135596800,sa=1e6;class so{static now(){return so.fromMillis(Date.now())}static fromDate(S){return so.fromMillis(S.getTime())}static fromMillis(S){let T=Math.floor(S/1e3),R=Math.floor((S-1e3*T)*sa);return new so(T,R)}constructor(S,T){if(this.seconds=S,this.nanoseconds=T,T<0||T>=1e9)throw new iW(iH.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+T);if(S<ss||S>=253402300800)throw new iW(iH.INVALID_ARGUMENT,"Timestamp seconds out of range: "+S)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/sa}_compareTo(S){return this.seconds===S.seconds?i8(this.nanoseconds,S.nanoseconds):i8(this.seconds,S.seconds)}isEqual(S){return S.seconds===this.seconds&&S.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds-ss).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{static fromTimestamp(S){return new sl(S)}static min(){return new sl(new so(0,0))}static max(){return new sl(new so(253402300799,1e9-1))}constructor(S){this.timestamp=S}compareTo(S){return this.timestamp._compareTo(S.timestamp)}isEqual(S){return this.timestamp.isEqual(S.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let su="__name__";class sc{constructor(S,T,R){void 0===T?T=0:T>S.length&&i$(),void 0===R?R=S.length-T:R>S.length-T&&i$(),this.segments=S,this.offset=T,this.len=R}get length(){return this.len}isEqual(S){return 0===sc.comparator(this,S)}child(S){let T=this.segments.slice(this.offset,this.limit());return S instanceof sc?S.forEach(S=>{T.push(S)}):T.push(S),this.construct(T)}limit(){return this.offset+this.length}popFirst(S){return S=void 0===S?1:S,this.construct(this.segments,this.offset+S,this.length-S)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(S){return this.segments[this.offset+S]}isEmpty(){return 0===this.length}isPrefixOf(S){if(S.length<this.length)return!1;for(let T=0;T<this.length;T++)if(this.get(T)!==S.get(T))return!1;return!0}isImmediateParentOf(S){if(this.length+1!==S.length)return!1;for(let T=0;T<this.length;T++)if(this.get(T)!==S.get(T))return!1;return!0}forEach(S){for(let T=this.offset,R=this.limit();T<R;T++)S(this.segments[T])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(S,T){let R=Math.min(S.length,T.length);for(let N=0;N<R;N++){let R=sc.compareSegments(S.get(N),T.get(N));if(0!==R)return R}return i8(S.length,T.length)}static compareSegments(S,T){let R=sc.isNumericId(S),N=sc.isNumericId(T);return R&&!N?-1:!R&&N?1:R&&N?sc.extractNumericId(S).compare(sc.extractNumericId(T)):se(S,T)}static isNumericId(S){return S.startsWith("__id")&&S.endsWith("__")}static extractNumericId(S){return $.fromString(S.substring(4,S.length-2))}}class sh extends sc{construct(S,T,R){return new sh(S,T,R)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...S){let T=[];for(let R of S){if(R.indexOf("//")>=0)throw new iW(iH.INVALID_ARGUMENT,`Invalid segment (${R}). Paths must not contain // in them.`);T.push(...R.split("/").filter(S=>S.length>0))}return new sh(T)}static emptyPath(){return new sh([])}}let sd=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class sp extends sc{construct(S,T,R){return new sp(S,T,R)}static isValidIdentifier(S){return sd.test(S)}canonicalString(){return this.toArray().map(S=>(S=S.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),sp.isValidIdentifier(S)||(S="`"+S+"`"),S)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===su}static keyField(){return new sp([su])}static fromServerFormat(S){let T=[],R="",N=0,O=()=>{if(0===R.length)throw new iW(iH.INVALID_ARGUMENT,`Invalid field path (${S}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);T.push(R),R=""},P=!1;for(;N<S.length;){let T=S[N];if("\\"===T){if(N+1===S.length)throw new iW(iH.INVALID_ARGUMENT,"Path has trailing escape character: "+S);let T=S[N+1];if(!("\\"===T||"."===T||"`"===T))throw new iW(iH.INVALID_ARGUMENT,"Path has invalid escape sequence: "+S);R+=T,N+=2}else"`"===T?P=!P:"."!==T||P?R+=T:O(),N++}if(O(),P)throw new iW(iH.INVALID_ARGUMENT,"Unterminated ` in path: "+S);return new sp(T)}static emptyPath(){return new sp([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sf{constructor(S){this.path=S}static fromPath(S){return new sf(sh.fromString(S))}static fromName(S){return new sf(sh.fromString(S).popFirst(5))}static empty(){return new sf(sh.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(S){return this.path.length>=2&&this.path.get(this.path.length-2)===S}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(S){return null!==S&&0===sh.comparator(this.path,S.path)}toString(){return this.path.toString()}static comparator(S,T){return sh.comparator(S.path,T.path)}static isDocumentKey(S){return S.length%2==0}static fromSegments(S){return new sf(new sh(S.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sg=-1,sm=0;class sy{constructor(S,T,R,N){this.indexId=S,this.collectionGroup=T,this.fields=R,this.indexState=N}}function sv(S){return S.fields.find(S=>2===S.kind)}function sb(S){return S.fields.filter(S=>2!==S.kind)}function sS(S){let T=sb(S);return 0===T.length?0:T[T.length-1].kind}function sT(S,T){let R=i8(S.collectionGroup,T.collectionGroup);if(0!==R)return R;for(let N=0;N<Math.min(S.fields.length,T.fields.length);++N)if(0!==(R=sE(S.fields[N],T.fields[N])))return R;return i8(S.fields.length,T.fields.length)}function sw(S){return`id=${S.indexId}|cg=${S.collectionGroup}|f=${S.fields.map(S=>`${S.fieldPath}:${S.kind}`).join(",")}`}sy.UNKNOWN_ID=-1;class sC{constructor(S,T){this.fieldPath=S,this.kind=T}}function sE(S,T){let R=sp.comparator(S.fieldPath,T.fieldPath);return 0!==R?R:i8(S.kind,T.kind)}class sI{constructor(S,T){this.sequenceNumber=S,this.offset=T}static empty(){return new sI(sm,sR.min())}}function s_(S,T){let R=S.toTimestamp().seconds,N=S.toTimestamp().nanoseconds+1;return new sR(sl.fromTimestamp(1e9===N?new so(R+1,0):new so(R,N)),sf.empty(),T)}function sk(S){return new sR(S.readTime,S.key,sg)}class sR{constructor(S,T,R){this.readTime=S,this.documentKey=T,this.largestBatchId=R}static min(){return new sR(sl.min(),sf.empty(),sg)}static max(){return new sR(sl.max(),sf.empty(),sg)}}function sA(S,T){let R=S.readTime.compareTo(T.readTime);return 0!==R||0!==(R=sf.comparator(S.documentKey,T.documentKey))?R:i8(S.largestBatchId,T.largestBatchId)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sD=null;class sN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(S){this.onCommittedListeners.push(S)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(S=>S())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sO(S){if(S.code===iH.FAILED_PRECONDITION&&S.message===sD)ij("LocalStore","Unexpectedly lost primary lease");else throw S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sx{constructor(S){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,S(S=>{this.isDone=!0,this.result=S,this.nextCallback&&this.nextCallback(S)},S=>{this.isDone=!0,this.error=S,this.catchCallback&&this.catchCallback(S)})}catch(S){return this.next(void 0,S)}next(S,T){return(this.callbackAttached&&i$(),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(T,this.error):this.wrapSuccess(S,this.result):new sx((R,N)=>{this.nextCallback=T=>{this.wrapSuccess(S,T).next(R,N)},this.catchCallback=S=>{this.wrapFailure(T,S).next(R,N)}})}toPromise(){return new Promise((S,T)=>{this.next(S,T)})}wrapUserFunction(S){try{let T=S();if(T instanceof sx)return T;return sx.resolve(T)}catch(S){return sx.reject(S)}}wrapSuccess(S,T){return S?this.wrapUserFunction(()=>S(T)):sx.resolve(T)}wrapFailure(S,T){return S?this.wrapUserFunction(()=>S(T)):sx.reject(T)}static resolve(S){return new sx((T,R)=>{T(S)})}static reject(S){return new sx((T,R)=>{R(S)})}static waitFor(S){return new sx((T,R)=>{let N=0,O=0,P=!1;S.forEach(S=>{++N,S.next(()=>{++O,P&&O===N&&T()},S=>R(S))}),P=!0,O===N&&T()})}static or(S){let T=sx.resolve(!1);for(let R of S)T=T.next(S=>S?sx.resolve(S):R());return T}static forEach(S,T){let R=[];return S.forEach((S,N)=>{R.push(T.call(this,S,N))}),this.waitFor(R)}static mapArray(S,T){return new sx((R,N)=>{let O=S.length,P=Array(O),M=0;for(let L=0;L<O;L++){let U=L;T(S[U]).next(S=>{P[U]=S,++M===O&&R(P)},S=>N(S))}})}static doWhile(S,T){return new sx((R,N)=>{let O=()=>{!0===S()?T().next(()=>{O()},N):R()};O()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sP="SimpleDb",sM=3;class sL{static open(S,T,R,N){try{return new sL(T,S.transaction(N,R))}catch(S){throw new sj(T,S)}}constructor(S,T){this.action=S,this.transaction=T,this.aborted=!1,this.completionDeferred=new iQ,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{T.error?this.completionDeferred.reject(new sj(S,T.error)):this.completionDeferred.resolve()},this.transaction.onerror=T=>{let R=sG(T.target.error);this.completionDeferred.reject(new sj(S,R))}}get completionPromise(){return this.completionDeferred.promise}abort(S){S&&this.completionDeferred.reject(S),this.aborted||(ij(sP,"Aborting transaction:",S?S.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let S=this.transaction;this.aborted||"function"!=typeof S.commit||S.commit()}store(S){return new sz(this.transaction.objectStore(S))}}class sB{static delete(S){return ij(sP,"Removing database:",S),sq(window.indexedDB.deleteDatabase(S)).toPromise()}static isAvailable(){if(!isIndexedDBAvailable())return!1;if(sB.isMockPersistence())return!0;let S=getUA(),T=sB.getIOSVersion(S),R=0<T&&T<10,N=sF(S),O=0<N&&N<4.5;return!(S.indexOf("MSIE ")>0||S.indexOf("Trident/")>0||S.indexOf("Edge/")>0)&&!R&&!O}static isMockPersistence(){var S;return"undefined"!=typeof process&&(null===(S=process.env)||void 0===S?void 0:S.USE_MOCK_PERSISTENCE)==="YES"}static getStore(S,T){return S.store(T)}static getIOSVersion(S){let T=S.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(T?T[1].split("_").slice(0,2).join("."):"-1")}constructor(S,T,R){this.name=S,this.version=T,this.schemaConverter=R,12.2===sB.getIOSVersion(getUA())&&iV("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(S){return this.db||(ij(sP,"Opening database:",this.name),this.db=await new Promise((T,R)=>{let N=indexedDB.open(this.name,this.version);N.onsuccess=S=>{T(S.target.result)},N.onblocked=()=>{R(new sj(S,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},N.onerror=T=>{let N=T.target.error;"VersionError"===N.name?R(new iW(iH.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===N.name?R(new iW(iH.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+N)):R(new sj(S,N))},N.onupgradeneeded=S=>{ij(sP,'Database "'+this.name+'" requires upgrade from version:',S.oldVersion);let T=S.target.result;this.schemaConverter.createOrUpgrade(T,N.transaction,S.oldVersion,this.version).next(()=>{ij(sP,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=S=>this.versionchangelistener(S)),this.db}setVersionChangeListener(S){this.versionchangelistener=S,this.db&&(this.db.onversionchange=T=>S(T))}async runTransaction(S,T,R,N){let O="readonly"===T,P=0;for(;;){++P;try{this.db=await this.ensureDb(S);let T=sL.open(this.db,S,O?"readonly":"readwrite",R),P=N(T).next(S=>(T.maybeCommit(),S)).catch(S=>(T.abort(S),sx.reject(S))).toPromise();return P.catch(()=>{}),await T.completionPromise,P}catch(R){let S=R,T="FirebaseError"!==S.name&&P<sM;if(ij(sP,"Transaction failed with error:",S.message,"Retrying:",T),this.close(),!T)return Promise.reject(S)}}}close(){this.db&&this.db.close(),this.db=void 0}}function sF(S){let T=S.match(/Android ([\d.]+)/i);return Number(T?T[1].split(".").slice(0,2).join("."):"-1")}class sU{constructor(S){this.dbCursor=S,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(S){this.dbCursor=S}done(){this.shouldStop=!0}skip(S){this.nextKey=S}delete(){return sq(this.dbCursor.delete())}}class sj extends null{constructor(S,T){super(iH.UNAVAILABLE,`IndexedDB transaction '${S}' failed: ${T}`),this.name="IndexedDbTransactionError"}}function sV(S){return"IndexedDbTransactionError"===S.name}class sz{constructor(S){this.store=S}put(S,T){let R;return void 0!==T?(ij(sP,"PUT",this.store.name,S,T),R=this.store.put(T,S)):(ij(sP,"PUT",this.store.name,"<auto-key>",S),R=this.store.put(S)),sq(R)}add(S){return ij(sP,"ADD",this.store.name,S,S),sq(this.store.add(S))}get(S){return sq(this.store.get(S)).next(T=>(void 0===T&&(T=null),ij(sP,"GET",this.store.name,S,T),T))}delete(S){return ij(sP,"DELETE",this.store.name,S),sq(this.store.delete(S))}count(){return ij(sP,"COUNT",this.store.name),sq(this.store.count())}loadAll(S,T){let R=this.options(S,T),N=R.index?this.store.index(R.index):this.store;if("function"==typeof N.getAll){let S=N.getAll(R.range);return new sx((T,R)=>{S.onerror=S=>{R(S.target.error)},S.onsuccess=S=>{T(S.target.result)}})}{let S=this.cursor(R),T=[];return this.iterateCursor(S,(S,R)=>{T.push(R)}).next(()=>T)}}loadFirst(S,T){let R=this.store.getAll(S,null===T?void 0:T);return new sx((S,T)=>{R.onerror=S=>{T(S.target.error)},R.onsuccess=T=>{S(T.target.result)}})}deleteAll(S,T){ij(sP,"DELETE ALL",this.store.name);let R=this.options(S,T);R.keysOnly=!1;let N=this.cursor(R);return this.iterateCursor(N,(S,T,R)=>R.delete())}iterate(S,T){let R;T?R=S:(R={},T=S);let N=this.cursor(R);return this.iterateCursor(N,T)}iterateSerial(S){let T=this.cursor({});return new sx((R,N)=>{T.onerror=S=>{N(sG(S.target.error))},T.onsuccess=T=>{let N=T.target.result;if(!N){R();return}S(N.primaryKey,N.value).next(S=>{S?N.continue():R()})}})}iterateCursor(S,T){let R=[];return new sx((N,O)=>{S.onerror=S=>{O(S.target.error)},S.onsuccess=S=>{let O=S.target.result;if(!O){N();return}let P=new sU(O),M=T(O.primaryKey,O.value,P);if(M instanceof sx){let S=M.catch(S=>(P.done(),sx.reject(S)));R.push(S)}P.isDone?N():null===P.skipToKey?O.continue():O.continue(P.skipToKey)}}).next(()=>sx.waitFor(R))}options(S,T){let R;return void 0!==S&&("string"==typeof S?R=S:T=S),{index:R,range:T}}cursor(S){let T="next";if(S.reverse&&(T="prev"),!S.index)return this.store.openCursor(S.range,T);{let R=this.store.index(S.index);return S.keysOnly?R.openKeyCursor(S.range,T):R.openCursor(S.range,T)}}}function sq(S){return new sx((T,R)=>{S.onsuccess=S=>{T(S.target.result)},S.onerror=S=>{R(sG(S.target.error))}})}let s$=!1;function sG(S){let T=sB.getIOSVersion(getUA());if(T>=12.2&&T<13){let T="An internal error was encountered in the Indexed Database server";if(S.message.indexOf(T)>=0){let S=new iW("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${T}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return s$||(s$=!0,setTimeout(()=>{throw S},0)),S}}return S}let sK="IndexBackfiller",sH=null,sW=null,sQ=50;class sY{constructor(S,T){this.asyncQueue=S,this.backfiller=T,this.task=null}start(){this.schedule(sH)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(S){ij(sK,`Scheduled in ${S}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",S,async()=>{this.task=null;try{let S=await this.backfiller.backfill();ij(sK,`Documents written: ${S}`)}catch(S){sV(S)?ij(sK,"Ignoring IndexedDB error during index backfill: ",S):await sO(S)}await this.schedule(sW)})}}class sJ{constructor(S,T){this.localStore=S,this.persistence=T}async backfill(S=sQ){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",T=>this.writeIndexEntries(T,S))}writeIndexEntries(S,T){let R=new Set,N=T,O=!0;return sx.doWhile(()=>!0===O&&N>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(S).next(T=>{if(!(null===T||R.has(T)))return ij(sK,`Processing collection: ${T}`),this.writeEntriesForCollectionGroup(S,T,N).next(S=>{N-=S,R.add(T)});O=!1})).next(()=>T-N)}writeEntriesForCollectionGroup(S,T,R){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(S,T).next(N=>this.localStore.localDocuments.getNextDocuments(S,T,N,R).next(R=>{let O=R.changes;return this.localStore.indexManager.updateIndexEntries(S,O).next(()=>this.getNewOffset(N,R)).next(R=>(ij(sK,`Updating offset: ${R}`),this.localStore.indexManager.updateCollectionGroup(S,T,R))).next(()=>O.size)}))}getNewOffset(S,T){let R=S;return T.changes.forEach((S,T)=>{let N=sk(T);sA(N,R)>0&&(R=N)}),new sR(R.readTime,R.documentKey,Math.max(T.batchId,S.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sX{constructor(S,T){this.previousValue=S,T&&(T.sequenceNumberHandler=S=>this.setPreviousValue(S),this.writeNewSequenceNumber=S=>T.writeSequenceNumber(S))}setPreviousValue(S){return this.previousValue=Math.max(S,this.previousValue),this.previousValue}next(){let S=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(S),S}}sX.INVALID=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sZ="\x01",s0="\x01",s1="\x10",s2="\x11";function s4(S){let T="";for(let R=0;R<S.length;R++)T.length>0&&(T=s6(T)),T=s3(S.get(R),T);return s6(T)}function s3(S,T){let R=T,N=S.length;for(let T=0;T<N;T++){let N=S.charAt(T);switch(N){case"\x00":R+=sZ+s1;break;case sZ:R+=sZ+s2;break;default:R+=N}}return R}function s6(S){return S+sZ+s0}function s9(S){let T=S.length;if(iG(T>=2),2===T)return iG(S.charAt(0)===sZ&&S.charAt(1)===s0),sh.emptyPath();let R=T-2,N=[],O="";for(let P=0;P<T;){let T=S.indexOf(sZ,P);switch((T<0||T>R)&&i$(),S.charAt(T+1)){case s0:let M;let L=S.substring(P,T);0===O.length?M=L:(O+=L,M=O,O=""),N.push(M);break;case s1:O+=S.substring(P,T)+"\x00";break;case s2:O+=S.substring(P,T+1);break;default:i$()}P=T+2}return new sh(N)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let s5="remoteDocuments",s7="owner",s8="owner",ae="mutationQueues",at="userId",ar="mutations",an="batchId",ai="userMutationsIndex",as=null;function aa(S){return[S]}function ao(S,T){return[S,s4(T)]}function al(S,T,R){return[S,s4(T),R]}let au={},ac="documentMutations",ah="remoteDocumentsV14",ad=null,ap="documentKeyIndex",af=null,ag="collectionGroupIndex",am=null,ay="remoteDocumentGlobal",av="remoteDocumentGlobalKey",ab="targets",aS="targetId",aT="queryTargetsIndex",aw=null,aC="targetDocuments",aE=null,aI="documentTargetsIndex",a_=null,ak="targetGlobalKey",aR="targetGlobal",aA="collectionParents",aD=null,aN="clientMetadata",aO="clientId",ax="bundles",aP="bundleId",aM="namedQueries",aL="name",aB="indexConfiguration",aF="indexId",aU="collectionGroupIndex",aj="collectionGroup",aV="indexState",az=null,aq="sequenceNumberIndex",a$=null,aG="indexEntries",aK=null,aH="documentKeyIndex",aW=null,aQ="documentOverlays",aY=null,aJ="collectionPathOverlayIndex",aX=null,aZ="collectionGroupOverlayIndex",a0=null,a1="globals",a2="name",a4=[ae,ar,ac,s5,ab,s7,aR,aC,aN,ay,aA,ax,aM],a3=[...a4,aQ],a6=[ae,ar,ac,ah,ab,s7,aR,aC,aN,ay,aA,ax,aM,aQ],a9=a6,a5=[...a9,aB,aV,aG],a7=null,a8=[...a5,a1];function oe(S){return 17===S?a8:16===S?a7:15===S?a5:14===S?a9:13===S?a6:12===S?a3:11===S?a4:void i$()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ot extends null{constructor(S,T){super(),this.simpleDbTransaction=S,this.currentSequenceNumber=T}}function or(S,T){let R=iK(S);return sB.getStore(R.simpleDbTransaction,T)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function on(S){let T=0;for(let R in S)Object.prototype.hasOwnProperty.call(S,R)&&T++;return T}function oi(S,T){for(let R in S)Object.prototype.hasOwnProperty.call(S,R)&&T(R,S[R])}function oa(S){for(let T in S)if(Object.prototype.hasOwnProperty.call(S,T))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(S,T){this.comparator=S,this.root=T||ou.EMPTY}insert(S,T){return new oo(this.comparator,this.root.insert(S,T,this.comparator).copy(null,null,ou.BLACK,null,null))}remove(S){return new oo(this.comparator,this.root.remove(S,this.comparator).copy(null,null,ou.BLACK,null,null))}get(S){let T=this.root;for(;!T.isEmpty();){let R=this.comparator(S,T.key);if(0===R)return T.value;R<0?T=T.left:R>0&&(T=T.right)}return null}indexOf(S){let T=0,R=this.root;for(;!R.isEmpty();){let N=this.comparator(S,R.key);if(0===N)return T+R.left.size;N<0?R=R.left:(T+=R.left.size+1,R=R.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(S){return this.root.inorderTraversal(S)}forEach(S){this.inorderTraversal((T,R)=>(S(T,R),!1))}toString(){let S=[];return this.inorderTraversal((T,R)=>(S.push(`${T}:${R}`),!1)),`{${S.join(", ")}}`}reverseTraversal(S){return this.root.reverseTraversal(S)}getIterator(){return new ol(this.root,null,this.comparator,!1)}getIteratorFrom(S){return new ol(this.root,S,this.comparator,!1)}getReverseIterator(){return new ol(this.root,null,this.comparator,!0)}getReverseIteratorFrom(S){return new ol(this.root,S,this.comparator,!0)}}class ol{constructor(S,T,R,N){this.isReverse=N,this.nodeStack=[];let O=1;for(;!S.isEmpty();)if(O=T?R(S.key,T):1,T&&N&&(O*=-1),O<0)S=this.isReverse?S.left:S.right;else if(0===O){this.nodeStack.push(S);break}else this.nodeStack.push(S),S=this.isReverse?S.right:S.left}getNext(){let S=this.nodeStack.pop(),T={key:S.key,value:S.value};if(this.isReverse)for(S=S.left;!S.isEmpty();)this.nodeStack.push(S),S=S.right;else for(S=S.right;!S.isEmpty();)this.nodeStack.push(S),S=S.left;return T}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let S=this.nodeStack[this.nodeStack.length-1];return{key:S.key,value:S.value}}}class ou{constructor(S,T,R,N,O){this.key=S,this.value=T,this.color=null!=R?R:ou.RED,this.left=null!=N?N:ou.EMPTY,this.right=null!=O?O:ou.EMPTY,this.size=this.left.size+1+this.right.size}copy(S,T,R,N,O){return new ou(null!=S?S:this.key,null!=T?T:this.value,null!=R?R:this.color,null!=N?N:this.left,null!=O?O:this.right)}isEmpty(){return!1}inorderTraversal(S){return this.left.inorderTraversal(S)||S(this.key,this.value)||this.right.inorderTraversal(S)}reverseTraversal(S){return this.right.reverseTraversal(S)||S(this.key,this.value)||this.left.reverseTraversal(S)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(S,T,R){let N=this,O=R(S,N.key);return(N=O<0?N.copy(null,null,null,N.left.insert(S,T,R),null):0===O?N.copy(null,T,null,null,null):N.copy(null,null,null,null,N.right.insert(S,T,R))).fixUp()}removeMin(){if(this.left.isEmpty())return ou.EMPTY;let S=this;return S.left.isRed()||S.left.left.isRed()||(S=S.moveRedLeft()),(S=S.copy(null,null,null,S.left.removeMin(),null)).fixUp()}remove(S,T){let R;let N=this;if(0>T(S,N.key))N.left.isEmpty()||N.left.isRed()||N.left.left.isRed()||(N=N.moveRedLeft()),N=N.copy(null,null,null,N.left.remove(S,T),null);else{if(N.left.isRed()&&(N=N.rotateRight()),N.right.isEmpty()||N.right.isRed()||N.right.left.isRed()||(N=N.moveRedRight()),0===T(S,N.key)){if(N.right.isEmpty())return ou.EMPTY;R=N.right.min(),N=N.copy(R.key,R.value,null,null,N.right.removeMin())}N=N.copy(null,null,null,null,N.right.remove(S,T))}return N.fixUp()}isRed(){return this.color}fixUp(){let S=this;return S.right.isRed()&&!S.left.isRed()&&(S=S.rotateLeft()),S.left.isRed()&&S.left.left.isRed()&&(S=S.rotateRight()),S.left.isRed()&&S.right.isRed()&&(S=S.colorFlip()),S}moveRedLeft(){let S=this.colorFlip();return S.right.left.isRed()&&(S=(S=(S=S.copy(null,null,null,null,S.right.rotateRight())).rotateLeft()).colorFlip()),S}moveRedRight(){let S=this.colorFlip();return S.left.left.isRed()&&(S=(S=S.rotateRight()).colorFlip()),S}rotateLeft(){let S=this.copy(null,null,ou.RED,null,this.right.left);return this.right.copy(null,null,this.color,S,null)}rotateRight(){let S=this.copy(null,null,ou.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,S)}colorFlip(){let S=this.left.copy(null,null,!this.left.color,null,null),T=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,S,T)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw i$();let S=this.left.check();if(S===this.right.check())return S+(this.isRed()?0:1);throw i$()}}ou.EMPTY=null,ou.RED=!0,ou.BLACK=!1;class oc{constructor(){this.size=0}get key(){throw i$()}get value(){throw i$()}get color(){throw i$()}get left(){throw i$()}get right(){throw i$()}copy(S,T,R,N,O){return this}insert(S,T,R){return new ou(S,T)}remove(S,T){return this}isEmpty(){return!0}inorderTraversal(S){return!1}reverseTraversal(S){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}ou.EMPTY=new oc;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oh{constructor(S){this.comparator=S,this.data=new oo(this.comparator)}has(S){return null!==this.data.get(S)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(S){return this.data.indexOf(S)}forEach(S){this.data.inorderTraversal((T,R)=>(S(T),!1))}forEachInRange(S,T){let R=this.data.getIteratorFrom(S[0]);for(;R.hasNext();){let N=R.getNext();if(this.comparator(N.key,S[1])>=0)return;T(N.key)}}forEachWhile(S,T){let R;for(R=void 0!==T?this.data.getIteratorFrom(T):this.data.getIterator();R.hasNext();)if(!S(R.getNext().key))return}firstAfterOrEqual(S){let T=this.data.getIteratorFrom(S);return T.hasNext()?T.getNext().key:null}getIterator(){return new od(this.data.getIterator())}getIteratorFrom(S){return new od(this.data.getIteratorFrom(S))}add(S){return this.copy(this.data.remove(S).insert(S,!0))}delete(S){return this.has(S)?this.copy(this.data.remove(S)):this}isEmpty(){return this.data.isEmpty()}unionWith(S){let T=this;return T.size<S.size&&(T=S,S=this),S.forEach(S=>{T=T.add(S)}),T}isEqual(S){if(!(S instanceof oh)||this.size!==S.size)return!1;let T=this.data.getIterator(),R=S.data.getIterator();for(;T.hasNext();){let S=T.getNext().key,N=R.getNext().key;if(0!==this.comparator(S,N))return!1}return!0}toArray(){let S=[];return this.forEach(T=>{S.push(T)}),S}toString(){let S=[];return this.forEach(T=>S.push(T)),"SortedSet("+S.toString()+")"}copy(S){let T=new oh(this.comparator);return T.data=S,T}}class od{constructor(S){this.iter=S}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function of(S,T,R,N,O){let P=S.getIterator(),M=T.getIterator(),L=og(P),U=og(M);for(;L||U;){let S=!1,T=!1;if(L&&U){let N=R(L,U);N<0?T=!0:N>0&&(S=!0)}else null!=L?T=!0:S=!0;S?(N(U),U=og(M)):T?(O(L),L=og(P)):(L=og(P),U=og(M))}}function og(S){return S.hasNext()?S.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om{constructor(S){this.fields=S,S.sort(sp.comparator)}static empty(){return new om([])}unionWith(S){let T=new oh(sp.comparator);for(let S of this.fields)T=T.add(S);for(let R of S)T=T.add(R);return new om(T.toArray())}covers(S){for(let T of this.fields)if(T.isPrefixOf(S))return!0;return!1}isEqual(S){return sn(this.fields,S.fields,(S,T)=>S.isEqual(T))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oy(S){return Buffer.from(S,"base64").toString("binary")}function ov(S){return Buffer.from(S,"binary").toString("base64")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ob{constructor(S){this.binaryString=S}static fromBase64String(S){return new ob(oy(S))}static fromUint8Array(S){return new ob(oS(S))}[Symbol.iterator](){let S=0;return{next:()=>S<this.binaryString.length?{value:this.binaryString.charCodeAt(S++),done:!1}:{value:void 0,done:!0}}}toBase64(){return ov(this.binaryString)}toUint8Array(){return oT(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(S){return i8(this.binaryString,S.binaryString)}isEqual(S){return this.binaryString===S.binaryString}}function oS(S){let T="";for(let R=0;R<S.length;++R)T+=String.fromCharCode(S[R]);return T}function oT(S){let T=new Uint8Array(S.length);for(let R=0;R<S.length;R++)T[R]=S.charCodeAt(R);return T}ob.EMPTY_BYTE_STRING=new ob("");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ow=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function oC(S){if(iG(!!S),"string"==typeof S){let T=0,R=ow.exec(S);if(iG(!!R),R[1]){let S=R[1];T=Number(S=(S+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(S).getTime()/1e3),nanos:T}}return{seconds:oE(S.seconds),nanos:oE(S.nanos)}}function oE(S){return"number"==typeof S?S:"string"==typeof S?Number(S):0}function oI(S){return"string"==typeof S?ob.fromBase64String(S):ob.fromUint8Array(S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let o_="server_timestamp",ok="__type__",oR="__previous_value__",oA="__local_write_time__";function oD(S){var T,R;return(null===(R=((null===(T=null==S?void 0:S.mapValue)||void 0===T?void 0:T.fields)||{})[ok])||void 0===R?void 0:R.stringValue)===o_}function oN(S,T){let R={fields:{[ok]:{stringValue:o_},[oA]:{timestampValue:{seconds:S.seconds,nanos:S.nanoseconds}}}};return T&&oD(T)&&(T=oO(T)),T&&(R.fields[oR]=T),{mapValue:R}}function oO(S){let T=S.mapValue.fields[oR];return oD(T)?oO(T):T}function ox(S){let T=oC(S.mapValue.fields[oA].timestampValue);return new so(T.seconds,T.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oP{constructor(S,T,R,N,O,P,M,L,U){this.databaseId=S,this.appId=T,this.persistenceKey=R,this.host=N,this.ssl=O,this.forceLongPolling=P,this.autoDetectLongPolling=M,this.longPollingOptions=L,this.useFetchStreams=U}}let oM="(default)";class oL{constructor(S,T){this.projectId=S,this.database=T||oM}static empty(){return new oL("","")}get isDefaultDatabase(){return this.database===oM}isEqual(S){return S instanceof oL&&S.projectId===this.projectId&&S.database===this.database}}function oB(S,T){if(!Object.prototype.hasOwnProperty.apply(S.options,["projectId"]))throw new iW(iH.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oL(S.options.projectId,T)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oF=-1;function oU(S){return null==S}function oj(S){return 0===S&&1/S==-1/0}function oV(S){return"number"==typeof S&&Number.isInteger(S)&&!oj(S)&&S<=Number.MAX_SAFE_INTEGER&&S>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oz="__type__",oq="__max__",o$={mapValue:{fields:{__type__:{stringValue:oq}}}},oG="__vector__",oK="value",oH={nullValue:"NULL_VALUE"};function oW(S){return"nullValue"in S?0:"booleanValue"in S?1:"integerValue"in S||"doubleValue"in S?2:"timestampValue"in S?3:"stringValue"in S?5:"bytesValue"in S?6:"referenceValue"in S?7:"geoPointValue"in S?8:"arrayValue"in S?9:"mapValue"in S?oD(S)?4:lE(S)?9007199254740991:lw(S)?10:11:i$()}function oQ(S,T){if(S===T)return!0;let R=oW(S);if(R!==oW(T))return!1;switch(R){case 0:case 9007199254740991:return!0;case 1:return S.booleanValue===T.booleanValue;case 4:return ox(S).isEqual(ox(T));case 3:return oY(S,T);case 5:return S.stringValue===T.stringValue;case 6:return oX(S,T);case 7:return S.referenceValue===T.referenceValue;case 8:return oJ(S,T);case 2:return oZ(S,T);case 9:return sn(S.arrayValue.values||[],T.arrayValue.values||[],oQ);case 10:case 11:return o0(S,T);default:return i$()}}function oY(S,T){if("string"==typeof S.timestampValue&&"string"==typeof T.timestampValue&&S.timestampValue.length===T.timestampValue.length)return S.timestampValue===T.timestampValue;let R=oC(S.timestampValue),N=oC(T.timestampValue);return R.seconds===N.seconds&&R.nanos===N.nanos}function oJ(S,T){return oE(S.geoPointValue.latitude)===oE(T.geoPointValue.latitude)&&oE(S.geoPointValue.longitude)===oE(T.geoPointValue.longitude)}function oX(S,T){return oI(S.bytesValue).isEqual(oI(T.bytesValue))}function oZ(S,T){if("integerValue"in S&&"integerValue"in T)return oE(S.integerValue)===oE(T.integerValue);if("doubleValue"in S&&"doubleValue"in T){let R=oE(S.doubleValue),N=oE(T.doubleValue);return R===N?oj(R)===oj(N):isNaN(R)&&isNaN(N)}return!1}function o0(S,T){let R=S.mapValue.fields||{},N=T.mapValue.fields||{};if(on(R)!==on(N))return!1;for(let S in R)if(R.hasOwnProperty(S)&&(void 0===N[S]||!oQ(R[S],N[S])))return!1;return!0}function o1(S,T){return void 0!==(S.values||[]).find(S=>oQ(S,T))}function o2(S,T){if(S===T)return 0;let R=oW(S),N=oW(T);if(R!==N)return i8(R,N);switch(R){case 0:case 9007199254740991:return 0;case 1:return i8(S.booleanValue,T.booleanValue);case 2:return o4(S,T);case 3:return o3(S.timestampValue,T.timestampValue);case 4:return o3(ox(S),ox(T));case 5:return se(S.stringValue,T.stringValue);case 6:return o5(S.bytesValue,T.bytesValue);case 7:return o6(S.referenceValue,T.referenceValue);case 8:return o9(S.geoPointValue,T.geoPointValue);case 9:return o7(S.arrayValue,T.arrayValue);case 10:return o8(S.mapValue,T.mapValue);case 11:return lt(S.mapValue,T.mapValue);default:throw i$()}}function o4(S,T){let R=oE(S.integerValue||S.doubleValue),N=oE(T.integerValue||T.doubleValue);return R<N?-1:R>N?1:R===N?0:isNaN(R)?isNaN(N)?0:-1:1}function o3(S,T){if("string"==typeof S&&"string"==typeof T&&S.length===T.length)return i8(S,T);let R=oC(S),N=oC(T),O=i8(R.seconds,N.seconds);return 0!==O?O:i8(R.nanos,N.nanos)}function o6(S,T){let R=S.split("/"),N=T.split("/");for(let S=0;S<R.length&&S<N.length;S++){let T=i8(R[S],N[S]);if(0!==T)return T}return i8(R.length,N.length)}function o9(S,T){let R=i8(oE(S.latitude),oE(T.latitude));return 0!==R?R:i8(oE(S.longitude),oE(T.longitude))}function o5(S,T){let R=oI(S),N=oI(T);return R.compareTo(N)}function o7(S,T){let R=S.values||[],N=T.values||[];for(let S=0;S<R.length&&S<N.length;++S){let T=o2(R[S],N[S]);if(T)return T}return i8(R.length,N.length)}function o8(S,T){var R,N,O,P;let M=S.fields||{},L=T.fields||{},U=null===(R=M[oK])||void 0===R?void 0:R.arrayValue,V=null===(N=L[oK])||void 0===N?void 0:N.arrayValue,$=i8((null===(O=null==U?void 0:U.values)||void 0===O?void 0:O.length)||0,(null===(P=null==V?void 0:V.values)||void 0===P?void 0:P.length)||0);return 0!==$?$:o7(U,V)}function lt(S,T){if(S===o$.mapValue&&T===o$.mapValue)return 0;if(S===o$.mapValue)return 1;if(T===o$.mapValue)return -1;let R=S.fields||{},N=Object.keys(R),O=T.fields||{},P=Object.keys(O);N.sort(),P.sort();for(let S=0;S<N.length&&S<P.length;++S){let T=se(N[S],P[S]);if(0!==T)return T;let M=o2(R[N[S]],O[P[S]]);if(0!==M)return M}return i8(N.length,P.length)}function lr(S){return ln(S)}function ln(S){if("nullValue"in S)return"null";if("booleanValue"in S)return""+S.booleanValue;if("integerValue"in S)return""+S.integerValue;if("doubleValue"in S)return""+S.doubleValue;if("timestampValue"in S)return ls(S.timestampValue);if("stringValue"in S)return S.stringValue;if("bytesValue"in S)return li(S.bytesValue);else if("referenceValue"in S)return ll(S.referenceValue);else if("geoPointValue"in S)return la(S.geoPointValue);else if("arrayValue"in S)return lc(S.arrayValue);else if("mapValue"in S)return lu(S.mapValue);else return i$()}function li(S){return oI(S).toBase64()}function ls(S){let T=oC(S);return`time(${T.seconds},${T.nanos})`}function la(S){return`geo(${S.latitude},${S.longitude})`}function ll(S){return sf.fromName(S).toString()}function lu(S){let T=Object.keys(S.fields||{}).sort(),R="{",N=!0;for(let O of T)N?N=!1:R+=",",R+=`${O}:${ln(S.fields[O])}`;return R+"}"}function lc(S){let T="[",R=!0;for(let N of S.values||[])R?R=!1:T+=",",T+=ln(N);return T+"]"}function lh(S){switch(oW(S)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let T=oO(S);return T?16+lh(T):16;case 5:return 2*S.stringValue.length;case 6:return oI(S.bytesValue).approximateByteSize();case 7:return S.referenceValue.length;case 9:return lp(S.arrayValue);case 10:case 11:return ld(S.mapValue);default:throw i$()}}function ld(S){let T=0;return oi(S.fields,(S,R)=>{T+=S.length+lh(R)}),T}function lp(S){return(S.values||[]).reduce((S,T)=>S+lh(T),0)}function lf(S,T){return{referenceValue:`projects/${S.projectId}/databases/${S.database}/documents/${T.path.canonicalString()}`}}function lg(S){return!!S&&"integerValue"in S}function lm(S){return!!S&&"doubleValue"in S}function ly(S){return lg(S)||lm(S)}function lv(S){return!!S&&"arrayValue"in S}function lb(S){return!!S&&"nullValue"in S}function lS(S){return!!S&&"doubleValue"in S&&isNaN(Number(S.doubleValue))}function lT(S){return!!S&&"mapValue"in S}function lw(S){var T,R;return(null===(R=((null===(T=null==S?void 0:S.mapValue)||void 0===T?void 0:T.fields)||{})[oz])||void 0===R?void 0:R.stringValue)===oG}function lC(S){if(S.geoPointValue)return{geoPointValue:Object.assign({},S.geoPointValue)};if(S.timestampValue&&"object"==typeof S.timestampValue)return{timestampValue:Object.assign({},S.timestampValue)};if(S.mapValue){let T={mapValue:{fields:{}}};return oi(S.mapValue.fields,(S,R)=>T.mapValue.fields[S]=lC(R)),T}{if(!S.arrayValue)return Object.assign({},S);let T={arrayValue:{values:[]}};for(let R=0;R<(S.arrayValue.values||[]).length;++R)T.arrayValue.values[R]=lC(S.arrayValue.values[R]);return T}}function lE(S){return(((S.mapValue||{}).fields||{}).__type__||{}).stringValue===oq}let lI={mapValue:{fields:{[oz]:{stringValue:oG},[oK]:{arrayValue:{}}}}};function l_(S){if("nullValue"in S)return oH;if("booleanValue"in S)return{booleanValue:!1};if("integerValue"in S||"doubleValue"in S)return{doubleValue:NaN};if("timestampValue"in S)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in S)return{stringValue:""};if("bytesValue"in S)return{bytesValue:""};if("referenceValue"in S)return lf(oL.empty(),sf.empty());else if("geoPointValue"in S)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in S)return{arrayValue:{}};else if(!("mapValue"in S))return i$();else return lw(S)?lI:{mapValue:{}}}function lk(S){if("nullValue"in S)return{booleanValue:!1};if("booleanValue"in S)return{doubleValue:NaN};if("integerValue"in S||"doubleValue"in S)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in S)return{stringValue:""};if("stringValue"in S)return{bytesValue:""};if("bytesValue"in S)return lf(oL.empty(),sf.empty());if("referenceValue"in S)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in S)return{arrayValue:{}};else if("arrayValue"in S)return lI;else if(!("mapValue"in S))return i$();else return lw(S)?{mapValue:{}}:o$}function lR(S,T){let R=o2(S.value,T.value);return 0!==R?R:S.inclusive&&!T.inclusive?-1:!S.inclusive&&T.inclusive?1:0}function lA(S,T){let R=o2(S.value,T.value);return 0!==R?R:S.inclusive&&!T.inclusive?1:!S.inclusive&&T.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lD{constructor(S){this.value=S}static empty(){return new lD({mapValue:{}})}field(S){if(S.isEmpty())return this.value;{let T=this.value;for(let R=0;R<S.length-1;++R)if(!lT(T=(T.mapValue.fields||{})[S.get(R)]))return null;return(T=(T.mapValue.fields||{})[S.lastSegment()])||null}}set(S,T){this.getFieldsMap(S.popLast())[S.lastSegment()]=lC(T)}setAll(S){let T=sp.emptyPath(),R={},N=[];S.forEach((S,O)=>{if(!T.isImmediateParentOf(O)){let S=this.getFieldsMap(T);this.applyChanges(S,R,N),R={},N=[],T=O.popLast()}S?R[O.lastSegment()]=lC(S):N.push(O.lastSegment())});let O=this.getFieldsMap(T);this.applyChanges(O,R,N)}delete(S){let T=this.field(S.popLast());lT(T)&&T.mapValue.fields&&delete T.mapValue.fields[S.lastSegment()]}isEqual(S){return oQ(this.value,S.value)}getFieldsMap(S){let T=this.value;T.mapValue.fields||(T.mapValue={fields:{}});for(let R=0;R<S.length;++R){let N=T.mapValue.fields[S.get(R)];lT(N)&&N.mapValue.fields||(N={mapValue:{fields:{}}},T.mapValue.fields[S.get(R)]=N),T=N}return T.mapValue.fields}applyChanges(S,T,R){for(let N of(oi(T,(T,R)=>S[T]=R),R))delete S[N]}clone(){return new lD(lC(this.value))}}function lN(S){let T=[];return oi(S.fields,(S,R)=>{let N=new sp([S]);if(lT(R)){let S=lN(R.mapValue).fields;if(0===S.length)T.push(N);else for(let R of S)T.push(N.child(R))}else T.push(N)}),new om(T)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lO{constructor(S,T,R,N,O,P,M){this.key=S,this.documentType=T,this.version=R,this.readTime=N,this.createTime=O,this.data=P,this.documentState=M}static newInvalidDocument(S){return new lO(S,0,sl.min(),sl.min(),sl.min(),lD.empty(),0)}static newFoundDocument(S,T,R,N){return new lO(S,1,T,sl.min(),R,N,0)}static newNoDocument(S,T){return new lO(S,2,T,sl.min(),sl.min(),lD.empty(),0)}static newUnknownDocument(S,T){return new lO(S,3,T,sl.min(),sl.min(),lD.empty(),2)}convertToFoundDocument(S,T){return this.createTime.isEqual(sl.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=S),this.version=S,this.documentType=1,this.data=T,this.documentState=0,this}convertToNoDocument(S){return this.version=S,this.documentType=2,this.data=lD.empty(),this.documentState=0,this}convertToUnknownDocument(S){return this.version=S,this.documentType=3,this.data=lD.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=sl.min(),this}setReadTime(S){return this.readTime=S,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(S){return S instanceof lO&&this.key.isEqual(S.key)&&this.version.isEqual(S.version)&&this.documentType===S.documentType&&this.documentState===S.documentState&&this.data.isEqual(S.data)}mutableCopy(){return new lO(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function lx(S,T,R){let N=T.data.field(S),O=R.data.field(S);return null!==N&&null!==O?o2(N,O):i$()}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lP{constructor(S,T){this.position=S,this.inclusive=T}}function lM(S,T,R){let N=0;for(let O=0;O<S.position.length;O++){let P=T[O],M=S.position[O];if(N=P.field.isKeyField()?sf.comparator(sf.fromName(M.referenceValue),R.key):o2(M,R.data.field(P.field)),"desc"===P.dir&&(N*=-1),0!==N)break}return N}function lL(S,T,R){let N=lM(S,T,R);return S.inclusive?N>=0:N>0}function lB(S,T,R){let N=lM(S,T,R);return S.inclusive?N<=0:N<0}function lF(S,T){if(null===S)return null===T;if(null===T||S.inclusive!==T.inclusive||S.position.length!==T.position.length)return!1;for(let R=0;R<S.position.length;R++)if(!oQ(S.position[R],T.position[R]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lU{constructor(S,T="asc"){this.field=S,this.dir=T}}function lj(S){return S.field.canonicalString()+S.dir}function lV(S){return`${S.field.canonicalString()} (${S.dir})`}function lz(S,T){return S.dir===T.dir&&S.field.isEqual(T.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lq{}class l$ extends lq{constructor(S,T,R){super(),this.field=S,this.op=T,this.value=R}static create(S,T,R){return S.isKeyField()?"in"===T||"not-in"===T?this.createKeyFieldInFilter(S,T,R):new l3(S,T,R):"array-contains"===T?new l7(S,R):"in"===T?new l8(S,R):"not-in"===T?new ue(S,R):"array-contains-any"===T?new ut(S,R):new l$(S,T,R)}static createKeyFieldInFilter(S,T,R){return"in"===T?new l6(S,R):new l9(S,R)}matches(S){let T=S.data.field(this.field);return"!="===this.op?null!==T&&this.matchesComparison(o2(T,this.value)):null!==T&&oW(this.value)===oW(T)&&this.matchesComparison(o2(T,this.value))}matchesComparison(S){switch(this.op){case"<":return S<0;case"<=":return S<=0;case"==":return 0===S;case"!=":return 0!==S;case">":return S>0;case">=":return S>=0;default:return i$()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class lG extends lq{constructor(S,T){super(),this.filters=S,this.op=T,this.memoizedFlattenedFilters=null}static create(S,T){return new lG(S,T)}matches(S){return lK(this)?void 0===this.filters.find(T=>!T.matches(S)):void 0!==this.filters.find(T=>T.matches(S))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((S,T)=>S.concat(T.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function lK(S){return"and"===S.op}function lH(S){return"or"===S.op}function lW(S){return lQ(S)&&lK(S)}function lQ(S){for(let T of S.filters)if(T instanceof lG)return!1;return!0}function lY(S){if(S instanceof l$)return S.field.canonicalString()+S.op.toString()+lr(S.value);if(lW(S))return S.filters.map(S=>lY(S)).join(",");{let T=S.filters.map(S=>lY(S)).join(",");return`${S.op}(${T})`}}function lJ(S,T){return S instanceof l$?lX(S,T):S instanceof lG?lZ(S,T):void i$()}function lX(S,T){return T instanceof l$&&S.op===T.op&&S.field.isEqual(T.field)&&oQ(S.value,T.value)}function lZ(S,T){return T instanceof lG&&S.op===T.op&&S.filters.length===T.filters.length&&S.filters.reduce((S,R,N)=>S&&lJ(R,T.filters[N]),!0)}function l0(S,T){let R=S.filters.concat(T);return lG.create(R,S.op)}function l1(S){return S instanceof l$?l4(S):S instanceof lG?l2(S):"Filter"}function l2(S){return S.op.toString()+" {"+S.getFilters().map(l1).join(" ,")+"}"}function l4(S){return`${S.field.canonicalString()} ${S.op} ${lr(S.value)}`}class l3 extends l${constructor(S,T,R){super(S,T,R),this.key=sf.fromName(R.referenceValue)}matches(S){let T=sf.comparator(S.key,this.key);return this.matchesComparison(T)}}class l6 extends l${constructor(S,T){super(S,"in",T),this.keys=l5("in",T)}matches(S){return this.keys.some(T=>T.isEqual(S.key))}}class l9 extends l${constructor(S,T){super(S,"not-in",T),this.keys=l5("not-in",T)}matches(S){return!this.keys.some(T=>T.isEqual(S.key))}}function l5(S,T){var R;return((null===(R=T.arrayValue)||void 0===R?void 0:R.values)||[]).map(S=>sf.fromName(S.referenceValue))}class l7 extends l${constructor(S,T){super(S,"array-contains",T)}matches(S){let T=S.data.field(this.field);return lv(T)&&o1(T.arrayValue,this.value)}}class l8 extends l${constructor(S,T){super(S,"in",T)}matches(S){let T=S.data.field(this.field);return null!==T&&o1(this.value.arrayValue,T)}}class ue extends l${constructor(S,T){super(S,"not-in",T)}matches(S){if(o1(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let T=S.data.field(this.field);return null!==T&&!o1(this.value.arrayValue,T)}}class ut extends l${constructor(S,T){super(S,"array-contains-any",T)}matches(S){let T=S.data.field(this.field);return!!lv(T)&&!!T.arrayValue.values&&T.arrayValue.values.some(S=>o1(this.value.arrayValue,S))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ur{constructor(S,T=null,R=[],N=[],O=null,P=null,M=null){this.path=S,this.collectionGroup=T,this.orderBy=R,this.filters=N,this.limit=O,this.startAt=P,this.endAt=M,this.memoizedCanonicalId=null}}function un(S,T=null,R=[],N=[],O=null,P=null,M=null){return new ur(S,T,R,N,O,P,M)}function ui(S){let T=iK(S);if(null===T.memoizedCanonicalId){let S=T.path.canonicalString();null!==T.collectionGroup&&(S+="|cg:"+T.collectionGroup),S+="|f:"+T.filters.map(S=>lY(S)).join(",")+"|ob:"+T.orderBy.map(S=>lj(S)).join(","),oU(T.limit)||(S+="|l:"+T.limit),T.startAt&&(S+="|lb:"+(T.startAt.inclusive?"b:":"a:")+T.startAt.position.map(S=>lr(S)).join(",")),T.endAt&&(S+="|ub:"+(T.endAt.inclusive?"a:":"b:")+T.endAt.position.map(S=>lr(S)).join(",")),T.memoizedCanonicalId=S}return T.memoizedCanonicalId}function us(S){let T=S.path.canonicalString();return null!==S.collectionGroup&&(T+=" collectionGroup="+S.collectionGroup),S.filters.length>0&&(T+=`, filters: [${S.filters.map(S=>l1(S)).join(", ")}]`),oU(S.limit)||(T+=", limit: "+S.limit),S.orderBy.length>0&&(T+=`, orderBy: [${S.orderBy.map(S=>lV(S)).join(", ")}]`),S.startAt&&(T+=", startAt: "+(S.startAt.inclusive?"b:":"a:")+S.startAt.position.map(S=>lr(S)).join(",")),S.endAt&&(T+=", endAt: "+(S.endAt.inclusive?"a:":"b:")+S.endAt.position.map(S=>lr(S)).join(",")),`Target(${T})`}function uo(S,T){if(S.limit!==T.limit||S.orderBy.length!==T.orderBy.length)return!1;for(let R=0;R<S.orderBy.length;R++)if(!lz(S.orderBy[R],T.orderBy[R]))return!1;if(S.filters.length!==T.filters.length)return!1;for(let R=0;R<S.filters.length;R++)if(!lJ(S.filters[R],T.filters[R]))return!1;return!!(S.collectionGroup===T.collectionGroup&&S.path.isEqual(T.path)&&lF(S.startAt,T.startAt))&&lF(S.endAt,T.endAt)}function ul(S){return sf.isDocumentKey(S.path)&&null===S.collectionGroup&&0===S.filters.length}function uu(S,T){return S.filters.filter(S=>S instanceof l$&&S.field.isEqual(T))}function uc(S,T){let R=sv(T);if(void 0===R)return null;for(let T of uu(S,R.fieldPath))switch(T.op){case"array-contains-any":return T.value.arrayValue.values||[];case"array-contains":return[T.value]}return null}function uh(S,T){let R=new Map;for(let N of sb(T))for(let T of uu(S,N.fieldPath))switch(T.op){case"==":case"in":R.set(N.fieldPath.canonicalString(),T.value);break;case"not-in":case"!=":return R.set(N.fieldPath.canonicalString(),T.value),Array.from(R.values())}return null}function ud(S,T){let R=[],N=!0;for(let O of sb(T)){let T=0===O.kind?uf(S,O.fieldPath,S.startAt):ug(S,O.fieldPath,S.startAt);R.push(T.value),N&&(N=T.inclusive)}return new lP(R,N)}function up(S,T){let R=[],N=!0;for(let O of sb(T)){let T=0===O.kind?ug(S,O.fieldPath,S.endAt):uf(S,O.fieldPath,S.endAt);R.push(T.value),N&&(N=T.inclusive)}return new lP(R,N)}function uf(S,T,R){let N=oH,O=!0;for(let R of uu(S,T)){let S=oH,T=!0;switch(R.op){case"<":case"<=":S=l_(R.value);break;case"==":case"in":case">=":S=R.value;break;case">":S=R.value,T=!1;break;case"!=":case"not-in":S=oH}0>lR({value:N,inclusive:O},{value:S,inclusive:T})&&(N=S,O=T)}if(null!==R){for(let P=0;P<S.orderBy.length;++P)if(S.orderBy[P].field.isEqual(T)){let S=R.position[P];0>lR({value:N,inclusive:O},{value:S,inclusive:R.inclusive})&&(N=S,O=R.inclusive);break}}return{value:N,inclusive:O}}function ug(S,T,R){let N=o$,O=!0;for(let R of uu(S,T)){let S=o$,T=!0;switch(R.op){case">=":case">":S=lk(R.value),T=!1;break;case"==":case"in":case"<=":S=R.value;break;case"<":S=R.value,T=!1;break;case"!=":case"not-in":S=o$}lA({value:N,inclusive:O},{value:S,inclusive:T})>0&&(N=S,O=T)}if(null!==R){for(let P=0;P<S.orderBy.length;++P)if(S.orderBy[P].field.isEqual(T)){let S=R.position[P];lA({value:N,inclusive:O},{value:S,inclusive:R.inclusive})>0&&(N=S,O=R.inclusive);break}}return{value:N,inclusive:O}}function um(S){let T=new oh(sp.comparator),R=!1;for(let N of S.filters)for(let S of N.getFlattenedFilters())S.field.isKeyField()||("array-contains"===S.op||"array-contains-any"===S.op?R=!0:T=T.add(S.field));for(let R of S.orderBy)R.field.isKeyField()||(T=T.add(R.field));return T.size+(R?1:0)}function uy(S){return null!==S.limit}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uv{constructor(S,T=null,R=[],N=[],O=null,P="F",M=null,L=null){this.path=S,this.collectionGroup=T,this.explicitOrderBy=R,this.filters=N,this.limit=O,this.limitType=P,this.startAt=M,this.endAt=L,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function ub(S,T,R,N,O,P,M,L){return new uv(S,T,R,N,O,P,M,L)}function uS(S){return new uv(S)}function uT(S,T){return new uv(T,null,S.explicitOrderBy.slice(),S.filters.slice(),S.limit,S.limitType,S.startAt,S.endAt)}function uw(S){return 0===S.filters.length&&null===S.limit&&null==S.startAt&&null==S.endAt&&(0===S.explicitOrderBy.length||1===S.explicitOrderBy.length&&S.explicitOrderBy[0].field.isKeyField())}function uC(S){let T=new oh(sp.comparator);return S.filters.forEach(S=>{S.getFlattenedFilters().forEach(S=>{S.isInequality()&&(T=T.add(S.field))})}),T}function uE(S){return sf.isDocumentKey(S.path)&&null===S.collectionGroup&&0===S.filters.length}function uI(S){return null!==S.collectionGroup}function u_(S){let T=iK(S);if(null===T.memoizedNormalizedOrderBy){T.memoizedNormalizedOrderBy=[];let S=new Set;for(let R of T.explicitOrderBy)T.memoizedNormalizedOrderBy.push(R),S.add(R.field.canonicalString());let R=T.explicitOrderBy.length>0?T.explicitOrderBy[T.explicitOrderBy.length-1].dir:"asc";uC(T).forEach(N=>{S.has(N.canonicalString())||N.isKeyField()||T.memoizedNormalizedOrderBy.push(new lU(N,R))}),S.has(sp.keyField().canonicalString())||T.memoizedNormalizedOrderBy.push(new lU(sp.keyField(),R))}return T.memoizedNormalizedOrderBy}function uk(S){let T=iK(S);return T.memoizedTarget||(T.memoizedTarget=uA(T,u_(S))),T.memoizedTarget}function uR(S){let T=iK(S);return T.memoizedAggregateTarget||(T.memoizedAggregateTarget=uA(T,S.explicitOrderBy)),T.memoizedAggregateTarget}function uA(S,T){if("F"===S.limitType)return un(S.path,S.collectionGroup,T,S.filters,S.limit,S.startAt,S.endAt);{T=T.map(S=>{let T="desc"===S.dir?"asc":"desc";return new lU(S.field,T)});let R=S.endAt?new lP(S.endAt.position,S.endAt.inclusive):null,N=S.startAt?new lP(S.startAt.position,S.startAt.inclusive):null;return un(S.path,S.collectionGroup,T,S.filters,S.limit,R,N)}}function uD(S,T){let R=S.filters.concat([T]);return new uv(S.path,S.collectionGroup,S.explicitOrderBy.slice(),R,S.limit,S.limitType,S.startAt,S.endAt)}function uN(S,T){let R=S.explicitOrderBy.concat([T]);return new uv(S.path,S.collectionGroup,R,S.filters.slice(),S.limit,S.limitType,S.startAt,S.endAt)}function uO(S,T,R){return new uv(S.path,S.collectionGroup,S.explicitOrderBy.slice(),S.filters.slice(),T,R,S.startAt,S.endAt)}function ux(S,T){return new uv(S.path,S.collectionGroup,S.explicitOrderBy.slice(),S.filters.slice(),S.limit,S.limitType,T,S.endAt)}function uP(S,T){return new uv(S.path,S.collectionGroup,S.explicitOrderBy.slice(),S.filters.slice(),S.limit,S.limitType,S.startAt,T)}function uM(S,T){return uo(uk(S),uk(T))&&S.limitType===T.limitType}function uL(S){return`${ui(uk(S))}|lt:${S.limitType}`}function uB(S){return`Query(target=${us(uk(S))}; limitType=${S.limitType})`}function uF(S,T){return T.isFoundDocument()&&uU(S,T)&&uj(S,T)&&uV(S,T)&&uz(S,T)}function uU(S,T){let R=T.key.path;return null!==S.collectionGroup?T.key.hasCollectionId(S.collectionGroup)&&S.path.isPrefixOf(R):sf.isDocumentKey(S.path)?S.path.isEqual(R):S.path.isImmediateParentOf(R)}function uj(S,T){for(let R of u_(S))if(!R.field.isKeyField()&&null===T.data.field(R.field))return!1;return!0}function uV(S,T){for(let R of S.filters)if(!R.matches(T))return!1;return!0}function uz(S,T){return(!S.startAt||!!lB(S.startAt,u_(S),T))&&(!S.endAt||!!lL(S.endAt,u_(S),T))}function uq(S){return S.collectionGroup||(S.path.length%2==1?S.path.lastSegment():S.path.get(S.path.length-2))}function u$(S){return(T,R)=>{let N=!1;for(let O of u_(S)){let S=uG(O,T,R);if(0!==S)return S;N=N||O.field.isKeyField()}return 0}}function uG(S,T,R){let N=S.field.isKeyField()?sf.comparator(T.key,R.key):lx(S.field,T,R);switch(S.dir){case"asc":return N;case"desc":return -1*N;default:return i$()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uK{constructor(S,T){this.mapKeyFn=S,this.equalsFn=T,this.inner={},this.innerSize=0}get(S){let T=this.mapKeyFn(S),R=this.inner[T];if(void 0!==R){for(let[T,N]of R)if(this.equalsFn(T,S))return N}}has(S){return void 0!==this.get(S)}set(S,T){let R=this.mapKeyFn(S),N=this.inner[R];if(void 0===N){this.inner[R]=[[S,T]],this.innerSize++;return}for(let R=0;R<N.length;R++)if(this.equalsFn(N[R][0],S)){N[R]=[S,T];return}N.push([S,T]),this.innerSize++}delete(S){let T=this.mapKeyFn(S),R=this.inner[T];if(void 0===R)return!1;for(let N=0;N<R.length;N++)if(this.equalsFn(R[N][0],S))return 1===R.length?delete this.inner[T]:R.splice(N,1),this.innerSize--,!0;return!1}forEach(S){oi(this.inner,(T,R)=>{for(let[T,N]of R)S(T,N)})}isEmpty(){return oa(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uH=new oo(sf.comparator);function uW(){return uH}let uQ=new oo(sf.comparator);function uY(...S){let T=uQ;for(let R of S)T=T.insert(R.key,R);return T}function uJ(){return u1()}function uX(S){let T=uQ;return S.forEach((S,R)=>T=T.insert(S,R.overlayedDocument)),T}function uZ(){return u1()}function u0(){return u1()}function u1(){return new uK(S=>S.toString(),(S,T)=>S.isEqual(T))}let u2=new oo(sf.comparator);function u4(){return u2}let u3=new oh(sf.comparator);function u6(...S){let T=u3;for(let R of S)T=T.add(R);return T}let u9=new oh(i8);function u5(){return u9}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u7(S,T){if(S.useProto3Json){if(isNaN(T))return{doubleValue:"NaN"};if(T===1/0)return{doubleValue:"Infinity"};if(T===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:oj(T)?"-0":T}}function u8(S){return{integerValue:""+S}}function ce(S,T){return oV(T)?u8(T):u7(S,T)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(){this._=void 0}}function cr(S,T,R){return S instanceof ca?oN(R,T):S instanceof co?cl(S,T):S instanceof cu?cc(S,T):cd(S,T)}function cn(S,T,R){return S instanceof co?cl(S,T):S instanceof cu?cc(S,T):R}function ci(S,T){return S instanceof ch?ly(T)?T:{integerValue:0}:null}function cs(S,T){return S instanceof co&&T instanceof co||S instanceof cu&&T instanceof cu?sn(S.elements,T.elements,oQ):S instanceof ch&&T instanceof ch?oQ(S.operand,T.operand):S instanceof ca&&T instanceof ca}class ca extends ct{}class co extends ct{constructor(S){super(),this.elements=S}}function cl(S,T){let R=cf(T);for(let T of S.elements)R.some(S=>oQ(S,T))||R.push(T);return{arrayValue:{values:R}}}class cu extends ct{constructor(S){super(),this.elements=S}}function cc(S,T){let R=cf(T);for(let T of S.elements)R=R.filter(S=>!oQ(S,T));return{arrayValue:{values:R}}}class ch extends ct{constructor(S,T){super(),this.serializer=S,this.operand=T}}function cd(S,T){let R=ci(S,T),N=cp(R)+cp(S.operand);return lg(R)&&lg(S.operand)?u8(N):u7(S.serializer,N)}function cp(S){return oE(S.integerValue||S.doubleValue)}function cf(S){return lv(S)&&S.arrayValue.values?S.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(S,T){this.field=S,this.transform=T}}function cy(S,T){return S.field.isEqual(T.field)&&cs(S.transform,T.transform)}function cv(S,T){return void 0===S&&void 0===T||!!S&&!!T&&sn(S,T,(S,T)=>cy(S,T))}class cS{constructor(S,T){this.version=S,this.transformResults=T}}class cT{constructor(S,T){this.updateTime=S,this.exists=T}static none(){return new cT}static exists(S){return new cT(void 0,S)}static updateTime(S){return new cT(S)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(S){return this.exists===S.exists&&(this.updateTime?!!S.updateTime&&this.updateTime.isEqual(S.updateTime):!S.updateTime)}}function cw(S,T){return void 0!==S.updateTime?T.isFoundDocument()&&T.version.isEqual(S.updateTime):void 0===S.exists||S.exists===T.isFoundDocument()}class cC{}function cE(S,T){if(!S.hasLocalMutations||T&&0===T.fields.length)return null;if(null===T)return S.isNoDocument()?new cF(S.key,cT.none()):new cA(S.key,S.data,cT.none());{let R=S.data,N=lD.empty(),O=new oh(sp.comparator);for(let S of T.fields)if(!O.has(S)){let T=R.field(S);null===T&&S.length>1&&(S=S.popLast(),T=R.field(S)),null===T?N.delete(S):N.set(S,T),O=O.add(S)}return new cO(S.key,N,new om(O.toArray()),cT.none())}}function cI(S,T,R){S instanceof cA?cD(S,T,R):S instanceof cO?cx(S,T,R):cU(S,T,R)}function c_(S,T,R,N){return S instanceof cA?cN(S,T,R,N):S instanceof cO?cP(S,T,R,N):cj(S,T,R)}function ck(S,T){let R=null;for(let N of S.fieldTransforms){let S=T.data.field(N.field),O=ci(N.transform,S||null);null!=O&&(null===R&&(R=lD.empty()),R.set(N.field,O))}return R||null}function cR(S,T){return!!(S.type===T.type&&S.key.isEqual(T.key)&&S.precondition.isEqual(T.precondition)&&cv(S.fieldTransforms,T.fieldTransforms))&&(0===S.type?S.value.isEqual(T.value):1!==S.type||S.data.isEqual(T.data)&&S.fieldMask.isEqual(T.fieldMask))}class cA extends cC{constructor(S,T,R,N=[]){super(),this.key=S,this.value=T,this.precondition=R,this.fieldTransforms=N,this.type=0}getFieldMask(){return null}}function cD(S,T,R){let N=S.value.clone(),O=cL(S.fieldTransforms,T,R.transformResults);N.setAll(O),T.convertToFoundDocument(R.version,N).setHasCommittedMutations()}function cN(S,T,R,N){if(!cw(S.precondition,T))return R;let O=S.value.clone(),P=cB(S.fieldTransforms,N,T);return O.setAll(P),T.convertToFoundDocument(T.version,O).setHasLocalMutations(),null}class cO extends cC{constructor(S,T,R,N,O=[]){super(),this.key=S,this.data=T,this.fieldMask=R,this.precondition=N,this.fieldTransforms=O,this.type=1}getFieldMask(){return this.fieldMask}}function cx(S,T,R){if(!cw(S.precondition,T)){T.convertToUnknownDocument(R.version);return}let N=cL(S.fieldTransforms,T,R.transformResults),O=T.data;O.setAll(cM(S)),O.setAll(N),T.convertToFoundDocument(R.version,O).setHasCommittedMutations()}function cP(S,T,R,N){if(!cw(S.precondition,T))return R;let O=cB(S.fieldTransforms,N,T),P=T.data;return(P.setAll(cM(S)),P.setAll(O),T.convertToFoundDocument(T.version,P).setHasLocalMutations(),null===R)?null:R.unionWith(S.fieldMask.fields).unionWith(S.fieldTransforms.map(S=>S.field))}function cM(S){let T=new Map;return S.fieldMask.fields.forEach(R=>{if(!R.isEmpty()){let N=S.data.field(R);T.set(R,N)}}),T}function cL(S,T,R){let N=new Map;iG(S.length===R.length);for(let O=0;O<R.length;O++){let P=S[O],M=P.transform,L=T.data.field(P.field);N.set(P.field,cn(M,L,R[O]))}return N}function cB(S,T,R){let N=new Map;for(let O of S){let S=O.transform,P=R.data.field(O.field);N.set(O.field,cr(S,P,T))}return N}class cF extends cC{constructor(S,T){super(),this.key=S,this.precondition=T,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function cU(S,T,R){T.convertToNoDocument(R.version).setHasCommittedMutations()}function cj(S,T,R){return cw(S.precondition,T)?(T.convertToNoDocument(T.version).setHasLocalMutations(),null):R}class cV extends null{constructor(S,T){super(),this.key=S,this.precondition=T,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cz{constructor(S,T,R,N){this.batchId=S,this.localWriteTime=T,this.baseMutations=R,this.mutations=N}applyToRemoteDocument(S,T){let R=T.mutationResults;for(let T=0;T<this.mutations.length;T++){let N=this.mutations[T];N.key.isEqual(S.key)&&cI(N,S,R[T])}}applyToLocalView(S,T){for(let R of this.baseMutations)R.key.isEqual(S.key)&&(T=c_(R,S,T,this.localWriteTime));for(let R of this.mutations)R.key.isEqual(S.key)&&(T=c_(R,S,T,this.localWriteTime));return T}applyToLocalDocumentSet(S,T){let R=u0();return this.mutations.forEach(N=>{let O=S.get(N.key),P=O.overlayedDocument,M=this.applyToLocalView(P,O.mutatedFields),L=cE(P,M=T.has(N.key)?null:M);null!==L&&R.set(N.key,L),P.isValidDocument()||P.convertToNoDocument(sl.min())}),R}keys(){return this.mutations.reduce((S,T)=>S.add(T.key),u6())}isEqual(S){return this.batchId===S.batchId&&sn(this.mutations,S.mutations,(S,T)=>cR(S,T))&&sn(this.baseMutations,S.baseMutations,(S,T)=>cR(S,T))}}class cq{constructor(S,T,R,N){this.batch=S,this.commitVersion=T,this.mutationResults=R,this.docVersions=N}static from(S,T,R){iG(S.mutations.length===R.length);let N=u4(),O=S.mutations;for(let S=0;S<O.length;S++)N=N.insert(O[S].key,R[S].version);return new cq(S,T,R,N)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c${constructor(S,T){this.largestBatchId=S,this.mutation=T}getKey(){return this.mutation.key}isEqual(S){return null!==S&&this.mutation===S.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cG{constructor(S,T){this.count=S,this.unchangedNames=T}}function cK(S){switch(S){case iH.OK:return i$();case iH.CANCELLED:case iH.UNKNOWN:case iH.DEADLINE_EXCEEDED:case iH.RESOURCE_EXHAUSTED:case iH.INTERNAL:case iH.UNAVAILABLE:case iH.UNAUTHENTICATED:return!1;case iH.INVALID_ARGUMENT:case iH.NOT_FOUND:case iH.ALREADY_EXISTS:case iH.PERMISSION_DENIED:case iH.FAILED_PRECONDITION:case iH.ABORTED:case iH.OUT_OF_RANGE:case iH.UNIMPLEMENTED:case iH.DATA_LOSS:return!0;default:return i$()}}function cH(S){return cK(S)&&S!==iH.ABORTED}function cW(S){if(void 0===S)return iV("GRPC error has no .code"),iH.UNKNOWN;switch(S){case W.OK:return iH.OK;case W.CANCELLED:return iH.CANCELLED;case W.UNKNOWN:return iH.UNKNOWN;case W.DEADLINE_EXCEEDED:return iH.DEADLINE_EXCEEDED;case W.RESOURCE_EXHAUSTED:return iH.RESOURCE_EXHAUSTED;case W.INTERNAL:return iH.INTERNAL;case W.UNAVAILABLE:return iH.UNAVAILABLE;case W.UNAUTHENTICATED:return iH.UNAUTHENTICATED;case W.INVALID_ARGUMENT:return iH.INVALID_ARGUMENT;case W.NOT_FOUND:return iH.NOT_FOUND;case W.ALREADY_EXISTS:return iH.ALREADY_EXISTS;case W.PERMISSION_DENIED:return iH.PERMISSION_DENIED;case W.FAILED_PRECONDITION:return iH.FAILED_PRECONDITION;case W.ABORTED:return iH.ABORTED;case W.OUT_OF_RANGE:return iH.OUT_OF_RANGE;case W.UNIMPLEMENTED:return iH.UNIMPLEMENTED;case W.DATA_LOSS:return iH.DATA_LOSS;default:return i$()}}!function(S){S[S.OK=0]="OK",S[S.CANCELLED=1]="CANCELLED",S[S.UNKNOWN=2]="UNKNOWN",S[S.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",S[S.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",S[S.NOT_FOUND=5]="NOT_FOUND",S[S.ALREADY_EXISTS=6]="ALREADY_EXISTS",S[S.PERMISSION_DENIED=7]="PERMISSION_DENIED",S[S.UNAUTHENTICATED=16]="UNAUTHENTICATED",S[S.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",S[S.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",S[S.ABORTED=10]="ABORTED",S[S.OUT_OF_RANGE=11]="OUT_OF_RANGE",S[S.UNIMPLEMENTED=12]="UNIMPLEMENTED",S[S.INTERNAL=13]="INTERNAL",S[S.UNAVAILABLE=14]="UNAVAILABLE",S[S.DATA_LOSS=15]="DATA_LOSS"}(W||(W={}));/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cQ extends null{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cY=null;function cJ(S){if(cY)throw Error("a TestingHooksSpi instance is already set");cY=S}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cX=new $([4294967295,4294967295],0);function cZ(S){let T=i9().encode(S),R=new Md5;return R.update(T),new Uint8Array(R.digest())}function c0(S){let T=new DataView(S.buffer),R=T.getUint32(0,!0),N=T.getUint32(4,!0),O=T.getUint32(8,!0),P=T.getUint32(12,!0);return[new Integer([R,N],0),new Integer([O,P],0)]}class c4{constructor(S,T,R){if(this.bitmap=S,this.padding=T,this.hashCount=R,T<0||T>=8)throw new c6(`Invalid padding: ${T}`);if(R<0||S.length>0&&0===this.hashCount)throw new c6(`Invalid hash count: ${R}`);if(0===S.length&&0!==T)throw new c6(`Invalid padding when bitmap length is 0: ${T}`);this.bitCount=8*S.length-T,this.bitCountInInteger=Integer.fromNumber(this.bitCount)}getBitIndex(S,T,R){let N=S.add(T.multiply(Integer.fromNumber(R)));return 1===N.compare(cX)&&(N=new Integer([N.getBits(0),N.getBits(1)],0)),N.modulo(this.bitCountInInteger).toNumber()}isBitSet(S){return(this.bitmap[Math.floor(S/8)]&1<<S%8)!=0}mightContain(S){if(0===this.bitCount)return!1;let[T,R]=c0(cZ(S));for(let S=0;S<this.hashCount;S++){let N=this.getBitIndex(T,R,S);if(!this.isBitSet(N))return!1}return!0}static create(S,T,R){let N=S%8==0?0:8-S%8,O=new c4(new Uint8Array(Math.ceil(S/8)),N,T);return R.forEach(S=>O.insert(S)),O}insert(S){if(0===this.bitCount)return;let[T,R]=c0(cZ(S));for(let S=0;S<this.hashCount;S++){let N=this.getBitIndex(T,R,S);this.setBit(N)}}setBit(S){let T=Math.floor(S/8),R=S%8;this.bitmap[T]|=1<<R}}class c6 extends null{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c9{constructor(S,T,R,N,O){this.snapshotVersion=S,this.targetChanges=T,this.targetMismatches=R,this.documentUpdates=N,this.resolvedLimboDocuments=O}static createSynthesizedRemoteEventForCurrentChange(S,T,R){let N=new Map;return N.set(S,c5.createSynthesizedTargetChangeForCurrentChange(S,T,R)),new c9(sl.min(),N,new oo(i8),uW(),u6())}}class c5{constructor(S,T,R,N,O){this.resumeToken=S,this.current=T,this.addedDocuments=R,this.modifiedDocuments=N,this.removedDocuments=O}static createSynthesizedTargetChangeForCurrentChange(S,T,R){return new c5(R,T,u6(),u6(),u6())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c7{constructor(S,T,R,N){this.updatedTargetIds=S,this.removedTargetIds=T,this.key=R,this.newDoc=N}}class c8{constructor(S,T){this.targetId=S,this.existenceFilter=T}}class he{constructor(S,T,R=ob.EMPTY_BYTE_STRING,N=null){this.state=S,this.targetIds=T,this.resumeToken=R,this.cause=N}}class ht{constructor(){this.pendingResponses=0,this.documentChanges=ha(),this._resumeToken=ob.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(S){S.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=S)}toTargetChange(){let S=u6(),T=u6(),R=u6();return this.documentChanges.forEach((N,O)=>{switch(O){case 0:S=S.add(N);break;case 2:T=T.add(N);break;case 1:R=R.add(N);break;default:i$()}}),new c5(this._resumeToken,this._current,S,T,R)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=ha()}addDocumentChange(S,T){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(S,T)}removeDocumentChange(S){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(S)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,iG(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let hr="WatchChangeAggregator";class hn{constructor(S){this.metadataProvider=S,this.targetStates=new Map,this.pendingDocumentUpdates=uW(),this.pendingDocumentUpdatesByTarget=hs(),this.pendingDocumentTargetMapping=hs(),this.pendingTargetResets=new oo(i8)}handleDocumentChange(S){for(let T of S.updatedTargetIds)S.newDoc&&S.newDoc.isFoundDocument()?this.addDocumentToTarget(T,S.newDoc):this.removeDocumentFromTarget(T,S.key,S.newDoc);for(let T of S.removedTargetIds)this.removeDocumentFromTarget(T,S.key,S.newDoc)}handleTargetChange(S){this.forEachTarget(S,T=>{let R=this.ensureTargetState(T);switch(S.state){case 0:this.isActiveTarget(T)&&R.updateResumeToken(S.resumeToken);break;case 1:R.recordTargetResponse(),R.isPending||R.clearPendingChanges(),R.updateResumeToken(S.resumeToken);break;case 2:R.recordTargetResponse(),R.isPending||this.removeTarget(T);break;case 3:this.isActiveTarget(T)&&(R.markCurrent(),R.updateResumeToken(S.resumeToken));break;case 4:this.isActiveTarget(T)&&(this.resetTarget(T),R.updateResumeToken(S.resumeToken));break;default:i$()}})}forEachTarget(S,T){S.targetIds.length>0?S.targetIds.forEach(T):this.targetStates.forEach((S,R)=>{this.isActiveTarget(R)&&T(R)})}handleExistenceFilter(S){let T=S.targetId,R=S.existenceFilter.count,N=this.targetDataForActiveTarget(T);if(N){let O=N.target;if(ul(O)){if(0===R){let S=new sf(O.path);this.removeDocumentFromTarget(T,S,lO.newNoDocument(S,sl.min()))}else iG(1===R)}else{let N=this.getCurrentDocumentCountForTarget(T);if(N!==R){let R=this.parseBloomFilter(S),O=R?this.applyBloomFilter(R,S,N):1;if(0!==O){this.resetTarget(T);let S=2===O?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(T,S)}null==cY||cY.notifyOnExistenceFilterMismatch(ho(N,S.existenceFilter,this.metadataProvider.getDatabaseId(),R,O))}}}}parseBloomFilter(S){let T,R;let N=S.existenceFilter.unchangedNames;if(!N||!N.bits)return null;let{bits:{bitmap:O="",padding:P=0},hashCount:M=0}=N;try{T=oI(O).toUint8Array()}catch(S){if(S instanceof cQ)return iz("Decoding the base64 bloom filter in existence filter failed ("+S.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw S}try{R=new c4(T,P,M)}catch(S){return S instanceof c6?iz("BloomFilter error: ",S):iz("Applying bloom filter failed: ",S),null}return 0===R.bitCount?null:R}applyBloomFilter(S,T,R){return T.existenceFilter.count===R-this.filterRemovedDocuments(S,T.targetId)?0:2}filterRemovedDocuments(S,T){let R=this.metadataProvider.getRemoteKeysForTarget(T),N=0;return R.forEach(R=>{let O=this.metadataProvider.getDatabaseId(),P=`projects/${O.projectId}/databases/${O.database}/documents/${R.path.canonicalString()}`;!S.mightContain(P)&&(this.removeDocumentFromTarget(T,R,null),N++)}),N}createRemoteEvent(S){let T=new Map;this.targetStates.forEach((R,N)=>{let O=this.targetDataForActiveTarget(N);if(O){if(R.current&&ul(O.target)){let T=new sf(O.target.path);this.ensureDocumentUpdateByTarget(T).has(N)||this.targetContainsDocument(N,T)||this.removeDocumentFromTarget(N,T,lO.newNoDocument(T,S))}R.hasPendingChanges&&(T.set(N,R.toTargetChange()),R.clearPendingChanges())}});let R=u6();this.pendingDocumentTargetMapping.forEach((S,T)=>{let N=!0;T.forEachWhile(S=>{let T=this.targetDataForActiveTarget(S);return!T||"TargetPurposeLimboResolution"===T.purpose||(N=!1,!1)}),N&&(R=R.add(S))}),this.pendingDocumentUpdates.forEach((T,R)=>R.setReadTime(S));let N=new c9(S,T,this.pendingTargetResets,this.pendingDocumentUpdates,R);return this.pendingDocumentUpdates=uW(),this.pendingDocumentUpdatesByTarget=hs(),this.pendingDocumentTargetMapping=hs(),this.pendingTargetResets=new oo(i8),N}addDocumentToTarget(S,T){if(!this.isActiveTarget(S))return;let R=this.targetContainsDocument(S,T.key)?2:0;this.ensureTargetState(S).addDocumentChange(T.key,R),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(T.key,T),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(T.key,this.ensureDocumentUpdateByTarget(T.key).add(S)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(T.key,this.ensureDocumentTargetMapping(T.key).add(S))}removeDocumentFromTarget(S,T,R){if(!this.isActiveTarget(S))return;let N=this.ensureTargetState(S);this.targetContainsDocument(S,T)?N.addDocumentChange(T,1):N.removeDocumentChange(T),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(T,this.ensureDocumentTargetMapping(T).delete(S)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(T,this.ensureDocumentTargetMapping(T).add(S)),R&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(T,R))}removeTarget(S){this.targetStates.delete(S)}getCurrentDocumentCountForTarget(S){let T=this.ensureTargetState(S).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(S).size+T.addedDocuments.size-T.removedDocuments.size}recordPendingTargetRequest(S){this.ensureTargetState(S).recordPendingTargetRequest()}ensureTargetState(S){let T=this.targetStates.get(S);return T||(T=new ht,this.targetStates.set(S,T)),T}ensureDocumentTargetMapping(S){let T=this.pendingDocumentTargetMapping.get(S);return T||(T=new oh(i8),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(S,T)),T}ensureDocumentUpdateByTarget(S){let T=this.pendingDocumentUpdatesByTarget.get(S);return T||(T=new oh(i8),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(S,T)),T}isActiveTarget(S){let T=null!==this.targetDataForActiveTarget(S);return T||ij(hr,"Detected inactive target",S),T}targetDataForActiveTarget(S){let T=this.targetStates.get(S);return T&&T.isPending?null:this.metadataProvider.getTargetDataForTarget(S)}resetTarget(S){this.targetStates.set(S,new ht),this.metadataProvider.getRemoteKeysForTarget(S).forEach(T=>{this.removeDocumentFromTarget(S,T,null)})}targetContainsDocument(S,T){return this.metadataProvider.getRemoteKeysForTarget(S).has(T)}}function hs(){return new oo(sf.comparator)}function ha(){return new oo(sf.comparator)}function ho(S,T,R,N,O){var P,M,L,U,V,$;let K={localCacheCount:S,existenceFilterCount:T.count,databaseId:R.database,projectId:R.projectId},W=T.unchangedNames;return W&&(K.bloomFilter={applied:0===O,hashCount:null!==(P=null==W?void 0:W.hashCount)&&void 0!==P?P:0,bitmapLength:null!==(U=null===(L=null===(M=null==W?void 0:W.bits)||void 0===M?void 0:M.bitmap)||void 0===L?void 0:L.length)&&void 0!==U?U:0,padding:null!==($=null===(V=null==W?void 0:W.bits)||void 0===V?void 0:V.padding)&&void 0!==$?$:0,mightContain:S=>{var T;return null!==(T=null==N?void 0:N.mightContain(S))&&void 0!==T&&T}}),K}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hl=(()=>{let S={};return S.asc="ASCENDING",S.desc="DESCENDING",S})(),hu=(()=>{let S={};return S["<"]="LESS_THAN",S["<="]="LESS_THAN_OR_EQUAL",S[">"]="GREATER_THAN",S[">="]="GREATER_THAN_OR_EQUAL",S["=="]="EQUAL",S["!="]="NOT_EQUAL",S["array-contains"]="ARRAY_CONTAINS",S.in="IN",S["not-in"]="NOT_IN",S["array-contains-any"]="ARRAY_CONTAINS_ANY",S})(),hc=(()=>{let S={};return S.and="AND",S.or="OR",S})();class hh{constructor(S,T){this.databaseId=S,this.useProto3Json=T}}function hd(S){return new iW(void 0===S.code?iH.UNKNOWN:cW(S.code),S.message||"")}function hp(S,T){return S.useProto3Json||oU(T)?T:{value:T}}function hf(S){let T;return oU(T="object"==typeof S?S.value:S)?null:T}function hg(S,T){if(!S.useProto3Json)return{seconds:""+T.seconds,nanos:T.nanoseconds};{let S=new Date(1e3*T.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),R=("000000000"+T.nanoseconds).slice(-9);return`${S}.${R}Z`}}function hm(S){let T=oC(S);return new so(T.seconds,T.nanos)}function hy(S,T){return S.useProto3Json?T.toBase64():T.toUint8Array()}function hv(S,T){return S.useProto3Json?(iG(void 0===T||"string"==typeof T),ob.fromBase64String(T||"")):(iG(void 0===T||T instanceof Buffer||T instanceof Uint8Array),ob.fromUint8Array(T||new Uint8Array))}function hS(S,T){return hg(S,T.toTimestamp())}function hT(S){return iG(!!S),sl.fromTimestamp(hm(S))}function hw(S,T){return hC(S,T).canonicalString()}function hC(S,T){let R=hD(S).child("documents");return void 0===T?R:R.child(T)}function hE(S){let T=sh.fromString(S);return iG(dE(T)),T}function hI(S,T){return hw(S.databaseId,T.path)}function h_(S,T){let R=hE(T);if(R.get(1)!==S.databaseId.projectId)throw new iW(iH.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+R.get(1)+" vs "+S.databaseId.projectId);if(R.get(3)!==S.databaseId.database)throw new iW(iH.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+R.get(3)+" vs "+S.databaseId.database);return new sf(hN(R))}function hk(S,T){return hw(S.databaseId,T)}function hR(S){let T=hE(S);return 4===T.length?sh.emptyPath():hN(T)}function hA(S){return new sh(["projects",S.databaseId.projectId,"databases",S.databaseId.database]).canonicalString()}function hD(S){return new sh(["projects",S.projectId,"databases",S.database])}function hN(S){return iG(S.length>4&&"documents"===S.get(4)),S.popFirst(5)}function hO(S,T,R){return{name:hI(S,T),fields:R.value.mapValue.fields}}function hx(S,T){return{name:hI(S,T.key),fields:T.data.value.mapValue.fields,updateTime:hg(S,T.version.toTimestamp()),createTime:hg(S,T.createTime.toTimestamp())}}function hP(S,T,R){let N=h_(S,T.name),O=hT(T.updateTime),P=T.createTime?hT(T.createTime):sl.min(),M=new lD({mapValue:{fields:T.fields}}),L=lO.newFoundDocument(N,O,P,M);return R&&L.setHasCommittedMutations(),R?L.setHasCommittedMutations():L}function hM(S,T){iG(!!T.found),T.found.name,T.found.updateTime;let R=h_(S,T.found.name),N=hT(T.found.updateTime),O=T.found.createTime?hT(T.found.createTime):sl.min(),P=new lD({mapValue:{fields:T.found.fields}});return lO.newFoundDocument(R,N,O,P)}function hL(S,T){iG(!!T.missing),iG(!!T.readTime);let R=h_(S,T.missing),N=hT(T.readTime);return lO.newNoDocument(R,N)}function hB(S,T){return"found"in T?hM(S,T):"missing"in T?hL(S,T):i$()}function hF(S,T){let R;if("targetChange"in T){T.targetChange;let N=hU(T.targetChange.targetChangeType||"NO_CHANGE"),O=T.targetChange.targetIds||[],P=hv(S,T.targetChange.resumeToken),M=T.targetChange.cause;R=new he(N,O,P,M&&hd(M)||null)}else if("documentChange"in T){T.documentChange;let N=T.documentChange;N.document,N.document.name,N.document.updateTime;let O=h_(S,N.document.name),P=hT(N.document.updateTime),M=N.document.createTime?hT(N.document.createTime):sl.min(),L=new lD({mapValue:{fields:N.document.fields}}),U=lO.newFoundDocument(O,P,M,L);R=new c7(N.targetIds||[],N.removedTargetIds||[],U.key,U)}else if("documentDelete"in T){T.documentDelete;let N=T.documentDelete;N.document;let O=h_(S,N.document),P=N.readTime?hT(N.readTime):sl.min(),M=lO.newNoDocument(O,P);R=new c7([],N.removedTargetIds||[],M.key,M)}else if("documentRemove"in T){T.documentRemove;let N=T.documentRemove;N.document;let O=h_(S,N.document);R=new c7([],N.removedTargetIds||[],O,null)}else{if(!("filter"in T))return i$();T.filter;let S=T.filter;S.targetId;let{count:N=0,unchangedNames:O}=S,P=new cG(N,O);R=new c8(S.targetId,P)}return R}function hU(S){return"NO_CHANGE"===S?0:"ADD"===S?1:"REMOVE"===S?2:"CURRENT"===S?3:"RESET"===S?4:i$()}function hj(S){if(!("targetChange"in S))return sl.min();let T=S.targetChange;return T.targetIds&&T.targetIds.length||!T.readTime?sl.min():hT(T.readTime)}function hV(S,T){let R;if(T instanceof cA)R={update:hO(S,T.key,T.value)};else if(T instanceof cF)R={delete:hI(S,T.key)};else if(T instanceof cO)R={update:hO(S,T.key,T.data),updateMask:dw(T.fieldMask)};else{if(!(T instanceof cV))return i$();R={verify:hI(S,T.key)}}return T.fieldTransforms.length>0&&(R.updateTransforms=T.fieldTransforms.map(T=>hH(S,T))),T.precondition.isNone||(R.currentDocument=hq(S,T.precondition)),R}function hz(S,T){let R=T.currentDocument?h$(T.currentDocument):cT.none(),N=T.updateTransforms?T.updateTransforms.map(T=>hW(S,T)):[];if(T.update){T.update.name;let O=h_(S,T.update.name),P=new lD({mapValue:{fields:T.update.fields}});return T.updateMask?new cO(O,P,dC(T.updateMask),R,N):new cA(O,P,R,N)}return T.delete?new cF(h_(S,T.delete),R):T.verify?new cV(h_(S,T.verify),R):i$()}function hq(S,T){return void 0!==T.updateTime?{updateTime:hS(S,T.updateTime)}:void 0!==T.exists?{exists:T.exists}:i$()}function h$(S){return void 0!==S.updateTime?cT.updateTime(hT(S.updateTime)):void 0!==S.exists?cT.exists(S.exists):cT.none()}function hG(S,T){let R=S.updateTime?hT(S.updateTime):hT(T);return R.isEqual(sl.min())&&(R=hT(T)),new cS(R,S.transformResults||[])}function hK(S,T){return S&&S.length>0?(iG(void 0!==T),S.map(S=>hG(S,T))):[]}function hH(S,T){let R=T.transform;if(R instanceof ca)return{fieldPath:T.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(R instanceof co)return{fieldPath:T.field.canonicalString(),appendMissingElements:{values:R.elements}};if(R instanceof cu)return{fieldPath:T.field.canonicalString(),removeAllFromArray:{values:R.elements}};if(R instanceof ch)return{fieldPath:T.field.canonicalString(),increment:R.operand};throw i$()}function hW(S,T){let R=null;return"setToServerValue"in T?(iG("REQUEST_TIME"===T.setToServerValue),R=new ca):"appendMissingElements"in T?R=new co(T.appendMissingElements.values||[]):"removeAllFromArray"in T?R=new cu(T.removeAllFromArray.values||[]):"increment"in T?R=new ch(S,T.increment):i$(),new cm(sp.fromServerFormat(T.fieldPath),R)}function hQ(S,T){return{documents:[hk(S,T.path)]}}function hY(S){return iG(1===S.documents.length),uk(uS(hR(S.documents[0])))}function hJ(S,T){let R;let N={structuredQuery:{}},O=T.path;null!==T.collectionGroup?(R=O,N.structuredQuery.from=[{collectionId:T.collectionGroup,allDescendants:!0}]):(R=O.popLast(),N.structuredQuery.from=[{collectionId:O.lastSegment()}]),N.parent=hk(S,R);let P=h3(T.filters);P&&(N.structuredQuery.where=P);let M=h5(T.orderBy);M&&(N.structuredQuery.orderBy=M);let L=hp(S,T.limit);return null!==L&&(N.structuredQuery.limit=L),T.startAt&&(N.structuredQuery.startAt=h8(T.startAt)),T.endAt&&(N.structuredQuery.endAt=de(T.endAt)),{queryTarget:N,parent:R}}function hX(S,T,R,N){let{queryTarget:O,parent:P}=hJ(S,T),M={},L=[],U=0;return R.forEach(S=>{let T=N?S.alias:`aggregate_${U++}`;M[T]=S.alias,"count"===S.aggregateType?L.push({alias:T,count:{}}):"avg"===S.aggregateType?L.push({alias:T,avg:{field:dc(S.fieldPath)}}):"sum"===S.aggregateType&&L.push({alias:T,sum:{field:dc(S.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:L,structuredQuery:O.structuredQuery},parent:O.parent},aliasMap:M,parent:P}}function hZ(S){let T=hR(S.parent),R=S.structuredQuery,N=R.from?R.from.length:0,O=null;if(N>0){iG(1===N);let S=R.from[0];S.allDescendants?O=S.collectionId:T=T.child(S.collectionId)}let P=[];R.where&&(P=h6(R.where));let M=[];R.orderBy&&(M=h7(R.orderBy));let L=null;R.limit&&(L=hf(R.limit));let U=null;R.startAt&&(U=dt(R.startAt));let V=null;return R.endAt&&(V=dr(R.endAt)),ub(T,O,M,P,L,"F",U,V)}function h0(S){return uk(hZ(S))}function h1(S,T){let R=h2(T.purpose);return null==R?null:{"goog-listen-tags":R}}function h2(S){switch(S){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return i$()}}function h4(S,T){let R;let N=T.target;if((R=ul(N)?{documents:hQ(S,N)}:{query:hJ(S,N).queryTarget}).targetId=T.targetId,T.resumeToken.approximateByteSize()>0){R.resumeToken=hy(S,T.resumeToken);let N=hp(S,T.expectedCount);null!==N&&(R.expectedCount=N)}else if(T.snapshotVersion.compareTo(sl.min())>0){R.readTime=hg(S,T.snapshotVersion.toTimestamp());let N=hp(S,T.expectedCount);null!==N&&(R.expectedCount=N)}return R}function h3(S){if(0!==S.length)return df(lG.create(S,"and"))}function h6(S){let T=h9(S);return T instanceof lG&&lW(T)?T.getFilters():[T]}function h9(S){return void 0!==S.unaryFilter?dy(S):void 0!==S.fieldFilter?dS(S):void 0!==S.compositeFilter?dT(S):i$()}function h5(S){if(0!==S.length)return S.map(S=>dd(S))}function h7(S){return S.map(S=>dp(S))}function h8(S){return{before:S.inclusive,values:S.position}}function de(S){return{before:!S.inclusive,values:S.position}}function dt(S){let T=!!S.before;return new lP(S.values||[],T)}function dr(S){let T=!S.before;return new lP(S.values||[],T)}function dn(S){return hl[S]}function di(S){switch(S){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function ds(S){return hu[S]}function da(S){return hc[S]}function dl(S){switch(S){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return i$()}}function du(S){switch(S){case"AND":return"and";case"OR":return"or";default:return i$()}}function dc(S){return{fieldPath:S.canonicalString()}}function dh(S){return sp.fromServerFormat(S.fieldPath)}function dd(S){return{field:dc(S.field),direction:dn(S.dir)}}function dp(S){return new lU(dh(S.field),di(S.direction))}function df(S){return S instanceof l$?dm(S):S instanceof lG?dg(S):i$()}function dg(S){let T=S.getFilters().map(S=>df(S));return 1===T.length?T[0]:{compositeFilter:{op:da(S.op),filters:T}}}function dm(S){if("=="===S.op){if(lS(S.value))return{unaryFilter:{field:dc(S.field),op:"IS_NAN"}};if(lb(S.value))return{unaryFilter:{field:dc(S.field),op:"IS_NULL"}}}else if("!="===S.op){if(lS(S.value))return{unaryFilter:{field:dc(S.field),op:"IS_NOT_NAN"}};if(lb(S.value))return{unaryFilter:{field:dc(S.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dc(S.field),op:ds(S.op),value:S.value}}}function dy(S){switch(S.unaryFilter.op){case"IS_NAN":let T=dh(S.unaryFilter.field);return l$.create(T,"==",{doubleValue:NaN});case"IS_NULL":let R=dh(S.unaryFilter.field);return l$.create(R,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let N=dh(S.unaryFilter.field);return l$.create(N,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let O=dh(S.unaryFilter.field);return l$.create(O,"!=",{nullValue:"NULL_VALUE"});default:return i$()}}function dS(S){return l$.create(dh(S.fieldFilter.field),dl(S.fieldFilter.op),S.fieldFilter.value)}function dT(S){return lG.create(S.compositeFilter.filters.map(S=>h9(S)),du(S.compositeFilter.op))}function dw(S){let T=[];return S.fields.forEach(S=>T.push(S.canonicalString())),{fieldPaths:T}}function dC(S){return new om((S.fieldPaths||[]).map(S=>sp.fromServerFormat(S)))}function dE(S){return S.length>=4&&"projects"===S.get(0)&&"databases"===S.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dI{constructor(S,T,R,N,O=sl.min(),P=sl.min(),M=ob.EMPTY_BYTE_STRING,L=null){this.target=S,this.targetId=T,this.purpose=R,this.sequenceNumber=N,this.snapshotVersion=O,this.lastLimboFreeSnapshotVersion=P,this.resumeToken=M,this.expectedCount=L}withSequenceNumber(S){return new dI(this.target,this.targetId,this.purpose,S,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(S,T){return new dI(this.target,this.targetId,this.purpose,this.sequenceNumber,T,this.lastLimboFreeSnapshotVersion,S,null)}withExpectedCount(S){return new dI(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,S)}withLastLimboFreeSnapshotVersion(S){return new dI(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,S,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_{constructor(S){this.remoteSerializer=S}}function dk(S,T){let R;if(T.document)R=hP(S.remoteSerializer,T.document,!!T.hasCommittedMutations);else if(T.noDocument){let S=sf.fromSegments(T.noDocument.path),N=dO(T.noDocument.readTime);R=lO.newNoDocument(S,N),T.hasCommittedMutations&&R.setHasCommittedMutations()}else{if(!T.unknownDocument)return i$();let S=sf.fromSegments(T.unknownDocument.path),N=dO(T.unknownDocument.version);R=lO.newUnknownDocument(S,N)}return T.readTime&&R.setReadTime(dD(T.readTime)),R}function dR(S,T){let R=T.key,N={prefixPath:R.getCollectionPath().popLast().toArray(),collectionGroup:R.collectionGroup,documentId:R.path.lastSegment(),readTime:dA(T.readTime),hasCommittedMutations:T.hasCommittedMutations};if(T.isFoundDocument())N.document=hx(S.remoteSerializer,T);else if(T.isNoDocument())N.noDocument={path:R.path.toArray(),readTime:dN(T.version)};else{if(!T.isUnknownDocument())return i$();N.unknownDocument={path:R.path.toArray(),version:dN(T.version)}}return N}function dA(S){let T=S.toTimestamp();return[T.seconds,T.nanoseconds]}function dD(S){let T=new so(S[0],S[1]);return sl.fromTimestamp(T)}function dN(S){let T=S.toTimestamp();return{seconds:T.seconds,nanoseconds:T.nanoseconds}}function dO(S){let T=new so(S.seconds,S.nanoseconds);return sl.fromTimestamp(T)}function dx(S,T,R){let N=R.baseMutations.map(T=>hV(S.remoteSerializer,T)),O=R.mutations.map(T=>hV(S.remoteSerializer,T));return{userId:T,batchId:R.batchId,localWriteTimeMs:R.localWriteTime.toMillis(),baseMutations:N,mutations:O}}function dP(S,T){let R=(T.baseMutations||[]).map(T=>hz(S.remoteSerializer,T));for(let S=0;S<T.mutations.length-1;++S){let R=T.mutations[S];if(S+1<T.mutations.length&&void 0!==T.mutations[S+1].transform){let N=T.mutations[S+1];R.updateTransforms=N.transform.fieldTransforms,T.mutations.splice(S+1,1),++S}}let N=T.mutations.map(T=>hz(S.remoteSerializer,T)),O=so.fromMillis(T.localWriteTimeMs);return new cz(T.batchId,O,R,N)}function dM(S){let T;let R=dO(S.readTime),N=void 0!==S.lastLimboFreeSnapshotVersion?dO(S.lastLimboFreeSnapshotVersion):sl.min();return new dI(T=dB(S.query)?hY(S.query):h0(S.query),S.targetId,"TargetPurposeListen",S.lastListenSequenceNumber,R,N,ob.fromBase64String(S.resumeToken))}function dL(S,T){let R;let N=dN(T.snapshotVersion),O=dN(T.lastLimboFreeSnapshotVersion);R=ul(T.target)?hQ(S.remoteSerializer,T.target):hJ(S.remoteSerializer,T.target).queryTarget;let P=T.resumeToken.toBase64();return{targetId:T.targetId,canonicalId:ui(T.target),readTime:N,resumeToken:P,lastListenSequenceNumber:T.sequenceNumber,lastLimboFreeSnapshotVersion:O,query:R}}function dB(S){return void 0!==S.documents}function dF(S){return{id:S.bundleId,createTime:dO(S.createTime),version:S.version}}function dU(S){return{bundleId:S.id,createTime:dN(hT(S.createTime)),version:S.version}}function dj(S){return{name:S.name,query:dz(S.bundledQuery),readTime:dO(S.readTime)}}function dV(S){return{name:S.name,readTime:dN(hT(S.readTime)),bundledQuery:S.bundledQuery}}function dz(S){let T=hZ({parent:S.parent,structuredQuery:S.structuredQuery});return"LAST"===S.limitType?uO(T,T.limit,"L"):T}function dq(S){return{name:S.name,query:dz(S.bundledQuery),readTime:hT(S.readTime)}}function d$(S){return{id:S.id,version:S.version,createTime:hT(S.createTime)}}function dG(S,T){return new c$(T.largestBatchId,hz(S.remoteSerializer,T.overlayMutation))}function dK(S,T,R){let[N,O,P]=dH(T,R.mutation.key);return{userId:T,collectionPath:O,documentId:P,collectionGroup:R.mutation.key.getCollectionGroup(),largestBatchId:R.largestBatchId,overlayMutation:hV(S.remoteSerializer,R.mutation)}}function dH(S,T){let R=T.path.lastSegment();return[S,s4(T.path.popLast()),R]}function dW(S){return{indexId:S.indexId,collectionGroup:S.collectionGroup,fields:S.fields.map(S=>[S.fieldPath.canonicalString(),S.kind])}}function dQ(S,T){let R=T?new sI(T.sequenceNumber,new sR(dO(T.readTime),new sf(s9(T.documentKey)),T.largestBatchId)):sI.empty(),N=S.fields.map(([S,T])=>new sC(sp.fromServerFormat(S),T));return new sy(S.indexId,S.collectionGroup,N,R)}function dY(S,T,R,N){return{indexId:S,uid:T,sequenceNumber:R,readTime:dN(N.readTime),documentKey:s4(N.documentKey.path),largestBatchId:N.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dJ{getBundleMetadata(S,T){return dX(S).get(T).next(S=>{if(S)return dF(S)})}saveBundleMetadata(S,T){return dX(S).put(dU(T))}getNamedQuery(S,T){return dZ(S).get(T).next(S=>{if(S)return dj(S)})}saveNamedQuery(S,T){return dZ(S).put(dV(T))}}function dX(S){return or(S,ax)}function dZ(S){return or(S,aM)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d0{constructor(S,T){this.serializer=S,this.userId=T}static forUser(S,T){return new d0(S,T.uid||"")}getOverlay(S,T){return d4(S).get(dH(this.userId,T)).next(S=>S?dG(this.serializer,S):null)}getOverlays(S,T){let R=uZ();return sx.forEach(T,T=>this.getOverlay(S,T).next(S=>{null!==S&&R.set(T,S)})).next(()=>R)}saveOverlays(S,T,R){let N=[];return R.forEach((R,O)=>{let P=new c$(T,O);N.push(this.saveOverlay(S,P))}),sx.waitFor(N)}removeOverlaysForBatchId(S,T,R){let N=new Set;T.forEach(S=>N.add(s4(S.getCollectionPath())));let O=[];return N.forEach(T=>{let N=IDBKeyRange.bound([this.userId,T,R],[this.userId,T,R+1],!1,!0);O.push(d4(S).deleteAll(aJ,N))}),sx.waitFor(O)}getOverlaysForCollection(S,T,R){let N=uZ(),O=s4(T),P=IDBKeyRange.bound([this.userId,O,R],[this.userId,O,Number.POSITIVE_INFINITY],!0);return d4(S).loadAll(aJ,P).next(S=>{for(let T of S){let S=dG(this.serializer,T);N.set(S.getKey(),S)}return N})}getOverlaysForCollectionGroup(S,T,R,N){let O;let P=uZ(),M=IDBKeyRange.bound([this.userId,T,R],[this.userId,T,Number.POSITIVE_INFINITY],!0);return d4(S).iterate({index:aZ,range:M},(S,T,R)=>{let M=dG(this.serializer,T);P.size()<N||M.largestBatchId===O?(P.set(M.getKey(),M),O=M.largestBatchId):R.done()}).next(()=>P)}saveOverlay(S,T){return d4(S).put(dK(this.serializer,this.userId,T))}}function d4(S){return or(S,aQ)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d3{globalsStore(S){return or(S,a1)}getSessionToken(S){return this.globalsStore(S).get("sessionToken").next(S=>{let T=null==S?void 0:S.value;return T?ob.fromUint8Array(T):ob.EMPTY_BYTE_STRING})}setSessionToken(S,T){return this.globalsStore(S).put({name:"sessionToken",value:T.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let d6=5,d9=10,d5=13,d7=15,d8=20,pe=25,pt=30,pr=37,pn=45,pi=50,ps=53,pa=55,po=60,pl=2;class pu{constructor(){}writeIndexValue(S,T){this.writeIndexValueAux(S,T),T.writeInfinity()}writeIndexValueAux(S,T){if("nullValue"in S)this.writeValueTypeLabel(T,d6);else if("booleanValue"in S)this.writeValueTypeLabel(T,d9),T.writeNumber(S.booleanValue?1:0);else if("integerValue"in S)this.writeValueTypeLabel(T,d7),T.writeNumber(oE(S.integerValue));else if("doubleValue"in S){let R=oE(S.doubleValue);isNaN(R)?this.writeValueTypeLabel(T,d5):(this.writeValueTypeLabel(T,d7),oj(R)?T.writeNumber(0):T.writeNumber(R))}else if("timestampValue"in S){let R=S.timestampValue;this.writeValueTypeLabel(T,d8),"string"==typeof R&&(R=oC(R)),T.writeString(`${R.seconds||""}`),T.writeNumber(R.nanos||0)}else if("stringValue"in S)this.writeIndexString(S.stringValue,T),this.writeTruncationMarker(T);else if("bytesValue"in S)this.writeValueTypeLabel(T,pt),T.writeBytes(oI(S.bytesValue)),this.writeTruncationMarker(T);else if("referenceValue"in S)this.writeIndexEntityRef(S.referenceValue,T);else if("geoPointValue"in S){let R=S.geoPointValue;this.writeValueTypeLabel(T,pn),T.writeNumber(R.latitude||0),T.writeNumber(R.longitude||0)}else"mapValue"in S?lE(S)?this.writeValueTypeLabel(T,Number.MAX_SAFE_INTEGER):lw(S)?this.writeIndexVector(S.mapValue,T):(this.writeIndexMap(S.mapValue,T),this.writeTruncationMarker(T)):"arrayValue"in S?(this.writeIndexArray(S.arrayValue,T),this.writeTruncationMarker(T)):i$()}writeIndexString(S,T){this.writeValueTypeLabel(T,pe),this.writeUnlabeledIndexString(S,T)}writeUnlabeledIndexString(S,T){T.writeString(S)}writeIndexMap(S,T){let R=S.fields||{};for(let S of(this.writeValueTypeLabel(T,pa),Object.keys(R)))this.writeIndexString(S,T),this.writeIndexValueAux(R[S],T)}writeIndexVector(S,T){var R,N;let O=S.fields||{};this.writeValueTypeLabel(T,ps);let P=oK,M=(null===(N=null===(R=O[P].arrayValue)||void 0===R?void 0:R.values)||void 0===N?void 0:N.length)||0;this.writeValueTypeLabel(T,d7),T.writeNumber(oE(M)),this.writeIndexString(P,T),this.writeIndexValueAux(O[P],T)}writeIndexArray(S,T){let R=S.values||[];for(let S of(this.writeValueTypeLabel(T,pi),R))this.writeIndexValueAux(S,T)}writeIndexEntityRef(S,T){this.writeValueTypeLabel(T,pr),sf.fromName(S).path.forEach(S=>{this.writeValueTypeLabel(T,po),this.writeUnlabeledIndexString(S,T)})}writeValueTypeLabel(S,T){S.writeNumber(T)}writeTruncationMarker(S){S.writeNumber(pl)}}pu.INSTANCE=new pu;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pc="\uD800",ph="\uDBFF",pd=0,pp=255,pf=1,pg=255,pm=255,py=0,pv=64,pb=8,pS=1024;function pT(S){let T=new DataView(new ArrayBuffer(8));return T.setFloat64(0,S,!1),new Uint8Array(T.buffer)}function pw(S){if(0===S)return 8;let T=0;return S>>4==0&&(T+=4,S<<=4),S>>6==0&&(T+=2,S<<=2),S>>7==0&&(T+=1),T}function pC(S){let T=0;for(let R=0;R<8;++R){let N=pw(255&S[R]);if(T+=N,8!==N)break}return T}function pE(S){return Math.ceil((pv-pC(S))/pb)}class pI{constructor(){this.buffer=new Uint8Array(pS),this.position=0}writeBytesAscending(S){let T=S[Symbol.iterator](),R=T.next();for(;!R.done;)this.writeByteAscending(R.value),R=T.next();this.writeSeparatorAscending()}writeBytesDescending(S){let T=S[Symbol.iterator](),R=T.next();for(;!R.done;)this.writeByteDescending(R.value),R=T.next();this.writeSeparatorDescending()}writeUtf8Ascending(S){for(let T of S){let S=T.charCodeAt(0);if(S<128)this.writeByteAscending(S);else if(S<2048)this.writeByteAscending(960|S>>>6),this.writeByteAscending(128|63&S);else if(T<pc||ph<T)this.writeByteAscending(480|S>>>12),this.writeByteAscending(128|63&S>>>6),this.writeByteAscending(128|63&S);else{let S=T.codePointAt(0);this.writeByteAscending(240|S>>>18),this.writeByteAscending(128|63&S>>>12),this.writeByteAscending(128|63&S>>>6),this.writeByteAscending(128|63&S)}}this.writeSeparatorAscending()}writeUtf8Descending(S){for(let T of S){let S=T.charCodeAt(0);if(S<128)this.writeByteDescending(S);else if(S<2048)this.writeByteDescending(960|S>>>6),this.writeByteDescending(128|63&S);else if(T<pc||ph<T)this.writeByteDescending(480|S>>>12),this.writeByteDescending(128|63&S>>>6),this.writeByteDescending(128|63&S);else{let S=T.codePointAt(0);this.writeByteDescending(240|S>>>18),this.writeByteDescending(128|63&S>>>12),this.writeByteDescending(128|63&S>>>6),this.writeByteDescending(128|63&S)}}this.writeSeparatorDescending()}writeNumberAscending(S){let T=this.toOrderedBits(S),R=pE(T);this.ensureAvailable(1+R),this.buffer[this.position++]=255&R;for(let S=T.length-R;S<T.length;++S)this.buffer[this.position++]=255&T[S]}writeNumberDescending(S){let T=this.toOrderedBits(S),R=pE(T);this.ensureAvailable(1+R),this.buffer[this.position++]=~(255&R);for(let S=T.length-R;S<T.length;++S)this.buffer[this.position++]=~(255&T[S])}writeInfinityAscending(){this.writeEscapedByteAscending(pg),this.writeEscapedByteAscending(pm)}writeInfinityDescending(){this.writeEscapedByteDescending(pg),this.writeEscapedByteDescending(pm)}reset(){this.position=0}seed(S){this.ensureAvailable(S.length),this.buffer.set(S,this.position),this.position+=S.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(S){let T=pT(S),R=(128&T[0])!=0;T[0]^=R?255:128;for(let S=1;S<T.length;++S)T[S]^=R?255:0;return T}writeByteAscending(S){let T=255&S;T===pd?(this.writeEscapedByteAscending(pd),this.writeEscapedByteAscending(pp)):T===pg?(this.writeEscapedByteAscending(pg),this.writeEscapedByteAscending(py)):this.writeEscapedByteAscending(T)}writeByteDescending(S){let T=255&S;T===pd?(this.writeEscapedByteDescending(pd),this.writeEscapedByteDescending(pp)):T===pg?(this.writeEscapedByteDescending(pg),this.writeEscapedByteDescending(py)):this.writeEscapedByteDescending(S)}writeSeparatorAscending(){this.writeEscapedByteAscending(pd),this.writeEscapedByteAscending(pf)}writeSeparatorDescending(){this.writeEscapedByteDescending(pd),this.writeEscapedByteDescending(pf)}writeEscapedByteAscending(S){this.ensureAvailable(1),this.buffer[this.position++]=S}writeEscapedByteDescending(S){this.ensureAvailable(1),this.buffer[this.position++]=~S}ensureAvailable(S){let T=S+this.position;if(T<=this.buffer.length)return;let R=2*this.buffer.length;R<T&&(R=T);let N=new Uint8Array(R);N.set(this.buffer),this.buffer=N}}class p_{constructor(S){this.orderedCode=S}writeBytes(S){this.orderedCode.writeBytesAscending(S)}writeString(S){this.orderedCode.writeUtf8Ascending(S)}writeNumber(S){this.orderedCode.writeNumberAscending(S)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class pk{constructor(S){this.orderedCode=S}writeBytes(S){this.orderedCode.writeBytesDescending(S)}writeString(S){this.orderedCode.writeUtf8Descending(S)}writeNumber(S){this.orderedCode.writeNumberDescending(S)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class pR{constructor(){this.orderedCode=new pI,this.ascending=new p_(this.orderedCode),this.descending=new pk(this.orderedCode)}seed(S){this.orderedCode.seed(S)}forKind(S){return 0===S?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pA{constructor(S,T,R,N){this.indexId=S,this.documentKey=T,this.arrayValue=R,this.directionalValue=N}successor(){let S=this.directionalValue.length,T=0===S||255===this.directionalValue[S-1]?S+1:S,R=new Uint8Array(T);return R.set(this.directionalValue,0),T!==S?R.set([0],this.directionalValue.length):++R[R.length-1],new pA(this.indexId,this.documentKey,this.arrayValue,R)}}function pD(S,T){let R=S.indexId-T.indexId;return 0!==R||0!==(R=pN(S.arrayValue,T.arrayValue))||0!==(R=pN(S.directionalValue,T.directionalValue))?R:sf.comparator(S.documentKey,T.documentKey)}function pN(S,T){for(let R=0;R<S.length&&R<T.length;++R){let N=S[R]-T[R];if(0!==N)return N}return S.length-T.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pO{constructor(S){for(let T of(this.inequalityFilters=new oh((S,T)=>sp.comparator(S.field,T.field)),this.collectionId=null!=S.collectionGroup?S.collectionGroup:S.path.lastSegment(),this.orderBys=S.orderBy,this.equalityFilters=[],S.filters)){let S=T;S.isInequality()?this.inequalityFilters=this.inequalityFilters.add(S):this.equalityFilters.push(S)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(S){if(iG(S.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let T=sv(S);if(void 0!==T&&!this.hasMatchingEqualityFilter(T))return!1;let R=sb(S),N=new Set,O=0,P=0;for(;O<R.length;++O)if(this.hasMatchingEqualityFilter(R[O]))N=N.add(R[O].fieldPath.canonicalString());else break;if(O===R.length)return!0;if(this.inequalityFilters.size>0){let S=this.inequalityFilters.getIterator().getNext();if(!N.has(S.field.canonicalString())){let T=R[O];if(!this.matchesFilter(S,T)||!this.matchesOrderBy(this.orderBys[P++],T))return!1}++O}for(;O<R.length;++O){let S=R[O];if(P>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[P++],S))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let S=new oh(sp.comparator),T=[];for(let R of this.equalityFilters)if(!R.field.isKeyField()){if("array-contains"===R.op||"array-contains-any"===R.op)T.push(new sC(R.field,2));else{if(S.has(R.field))continue;S=S.add(R.field),T.push(new sC(R.field,0))}}for(let R of this.orderBys)R.field.isKeyField()||S.has(R.field)||(S=S.add(R.field),T.push(new sC(R.field,"asc"===R.dir?0:1)));return new sy(sy.UNKNOWN_ID,this.collectionId,T,sI.empty())}hasMatchingEqualityFilter(S){for(let T of this.equalityFilters)if(this.matchesFilter(T,S))return!0;return!1}matchesFilter(S,T){if(void 0===S||!S.field.isEqual(T.fieldPath))return!1;let R="array-contains"===S.op||"array-contains-any"===S.op;return 2===T.kind===R}matchesOrderBy(S,T){return!!S.field.isEqual(T.fieldPath)&&(0===T.kind&&"asc"===S.dir||1===T.kind&&"desc"===S.dir)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function px(S){var T,R;if(iG(S instanceof l$||S instanceof lG),S instanceof l$){if(!(S instanceof l8))return S;{let N=(null===(R=null===(T=S.value.arrayValue)||void 0===T?void 0:T.values)||void 0===R?void 0:R.map(T=>l$.create(S.field,"==",T)))||[];return lG.create(N,"or")}}let N=S.filters.map(S=>px(S));return lG.create(N,S.op)}function pP(S){if(0===S.getFilters().length)return[];let T=pU(px(S));return(iG(pB(T)),pM(T)||pL(T))?[T]:T.getFilters()}function pM(S){return S instanceof l$}function pL(S){return S instanceof lG&&lW(S)}function pB(S){return pM(S)||pL(S)||pF(S)}function pF(S){if(S instanceof lG&&lH(S)){for(let T of S.getFilters())if(!pM(T)&&!pL(T))return!1;return!0}return!1}function pU(S){if(iG(S instanceof l$||S instanceof lG),S instanceof l$)return S;if(1===S.filters.length)return pU(S.filters[0]);let T=S.filters.map(S=>pU(S)),R=lG.create(T,S.op);return pB(R=p$(R))?R:(iG(R instanceof lG),iG(lK(R)),iG(R.filters.length>1),R.filters.reduce((S,T)=>pj(S,T)))}function pj(S,T){let R;return iG(S instanceof l$||S instanceof lG),iG(T instanceof l$||T instanceof lG),p$(R=S instanceof l$?T instanceof l$?pV(S,T):pq(S,T):T instanceof l$?pq(T,S):pz(S,T))}function pV(S,T){return lG.create([S,T],"and")}function pz(S,T){if(iG(S.filters.length>0&&T.filters.length>0),lK(S)&&lK(T))return l0(S,T.getFilters());let R=lH(S)?S:T,N=lH(S)?T:S,O=R.filters.map(S=>pj(S,N));return lG.create(O,"or")}function pq(S,T){if(lK(T))return l0(T,S.getFilters());{let R=T.filters.map(T=>pj(S,T));return lG.create(R,"or")}}function p$(S){if(iG(S instanceof l$||S instanceof lG),S instanceof l$)return S;let T=S.getFilters();if(1===T.length)return p$(T[0]);if(lQ(S))return S;let R=T.map(S=>p$(S)),N=[];return(R.forEach(T=>{T instanceof l$?N.push(T):T instanceof lG&&(T.op===S.op?N.push(...T.filters):N.push(T))}),1===N.length)?N[0]:lG.create(N,S.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pG{constructor(){this.collectionParentIndex=new pK}addToCollectionParentIndex(S,T){return this.collectionParentIndex.add(T),sx.resolve()}getCollectionParents(S,T){return sx.resolve(this.collectionParentIndex.getEntries(T))}addFieldIndex(S,T){return sx.resolve()}deleteFieldIndex(S,T){return sx.resolve()}deleteAllFieldIndexes(S){return sx.resolve()}createTargetIndexes(S,T){return sx.resolve()}getDocumentsMatchingTarget(S,T){return sx.resolve(null)}getIndexType(S,T){return sx.resolve(0)}getFieldIndexes(S,T){return sx.resolve([])}getNextCollectionGroupToUpdate(S){return sx.resolve(null)}getMinOffset(S,T){return sx.resolve(sR.min())}getMinOffsetFromCollectionGroup(S,T){return sx.resolve(sR.min())}updateCollectionGroup(S,T,R){return sx.resolve()}updateIndexEntries(S,T){return sx.resolve()}}class pK{constructor(){this.index={}}add(S){let T=S.lastSegment(),R=S.popLast(),N=this.index[T]||new oh(sh.comparator),O=!N.has(R);return this.index[T]=N.add(R),O}has(S){let T=S.lastSegment(),R=S.popLast(),N=this.index[T];return N&&N.has(R)}getEntries(S){return(this.index[S]||new oh(sh.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pH="IndexedDbIndexManager",pW=new Uint8Array(0);class pQ{constructor(S,T){this.databaseId=T,this.collectionParentsCache=new pK,this.targetToDnfSubTargets=new uK(S=>ui(S),(S,T)=>uo(S,T)),this.uid=S.uid||""}addToCollectionParentIndex(S,T){if(!this.collectionParentsCache.has(T)){let R=T.lastSegment(),N=T.popLast();S.addOnCommittedListener(()=>{this.collectionParentsCache.add(T)});let O={collectionId:R,parent:s4(N)};return pY(S).put(O)}return sx.resolve()}getCollectionParents(S,T){let R=[],N=IDBKeyRange.bound([T,""],[si(T),""],!1,!0);return pY(S).loadAll(N).next(S=>{for(let N of S){if(N.collectionId!==T)break;R.push(s9(N.parent))}return R})}addFieldIndex(S,T){let R=pX(S),N=dW(T);delete N.indexId;let O=R.add(N);if(!T.indexState)return O.next();{let R=pZ(S);return O.next(S=>{R.put(dY(S,this.uid,T.indexState.sequenceNumber,T.indexState.offset))})}}deleteFieldIndex(S,T){let R=pX(S),N=pZ(S),O=pJ(S);return R.delete(T.indexId).next(()=>N.delete(IDBKeyRange.bound([T.indexId],[T.indexId+1],!1,!0))).next(()=>O.delete(IDBKeyRange.bound([T.indexId],[T.indexId+1],!1,!0)))}deleteAllFieldIndexes(S){let T=pX(S),R=pJ(S),N=pZ(S);return T.deleteAll().next(()=>R.deleteAll()).next(()=>N.deleteAll())}createTargetIndexes(S,T){return sx.forEach(this.getSubTargets(T),T=>this.getIndexType(S,T).next(R=>{if(0===R||1===R){let R=new pO(T).buildTargetIndex();if(null!=R)return this.addFieldIndex(S,R)}}))}getDocumentsMatchingTarget(S,T){let R=pJ(S),N=!0,O=new Map;return sx.forEach(this.getSubTargets(T),T=>this.getFieldIndex(S,T).next(S=>{N&&(N=!!S),O.set(T,S)})).next(()=>{if(!N)return sx.resolve(null);{let S=u6(),N=[];return sx.forEach(O,(O,P)=>{ij(pH,`Using index ${sw(O)} to execute ${ui(T)}`);let M=uc(P,O),L=uh(P,O),U=ud(P,O),V=up(P,O),$=this.encodeBound(O,P,U),K=this.encodeBound(O,P,V),W=this.encodeValues(O,P,L),Q=this.generateIndexRanges(O.indexId,M,$,U.inclusive,K,V.inclusive,W);return sx.forEach(Q,O=>R.loadFirst(O,T.limit).next(T=>{T.forEach(T=>{let R=sf.fromSegments(T.documentKey);S.has(R)||(S=S.add(R),N.push(R))})}))}).next(()=>N)}})}getSubTargets(S){let T=this.targetToDnfSubTargets.get(S);return T||(T=0===S.filters.length?[S]:pP(lG.create(S.filters,"and")).map(T=>un(S.path,S.collectionGroup,S.orderBy,T.getFilters(),S.limit,S.startAt,S.endAt)),this.targetToDnfSubTargets.set(S,T)),T}generateIndexRanges(S,T,R,N,O,P,M){let L=(null!=T?T.length:1)*Math.max(R.length,O.length),U=L/(null!=T?T.length:1),V=[];for(let $=0;$<L;++$){let L=T?this.encodeSingleElement(T[$/U]):pW,K=this.generateLowerBound(S,L,R[$%U],N),W=this.generateUpperBound(S,L,O[$%U],P),Q=M.map(T=>this.generateLowerBound(S,L,T,!0));V.push(...this.createRange(K,W,Q))}return V}generateLowerBound(S,T,R,N){let O=new pA(S,sf.empty(),T,R);return N?O:O.successor()}generateUpperBound(S,T,R,N){let O=new pA(S,sf.empty(),T,R);return N?O.successor():O}getFieldIndex(S,T){let R=new pO(T),N=null!=T.collectionGroup?T.collectionGroup:T.path.lastSegment();return this.getFieldIndexes(S,N).next(S=>{let T=null;for(let N of S)R.servedByIndex(N)&&(!T||N.fields.length>T.fields.length)&&(T=N);return T})}getIndexType(S,T){let R=2,N=this.getSubTargets(T);return sx.forEach(N,T=>this.getFieldIndex(S,T).next(S=>{S?0!==R&&S.fields.length<um(T)&&(R=1):R=0})).next(()=>uy(T)&&N.length>1&&2===R?1:R)}encodeDirectionalElements(S,T){let R=new pR;for(let N of sb(S)){let S=T.data.field(N.fieldPath);if(null==S)return null;let O=R.forKind(N.kind);pu.INSTANCE.writeIndexValue(S,O)}return R.encodedBytes()}encodeSingleElement(S){let T=new pR;return pu.INSTANCE.writeIndexValue(S,T.forKind(0)),T.encodedBytes()}encodeDirectionalKey(S,T){let R=new pR;return pu.INSTANCE.writeIndexValue(lf(this.databaseId,T),R.forKind(sS(S))),R.encodedBytes()}encodeValues(S,T,R){if(null===R)return[];let N=[];N.push(new pR);let O=0;for(let P of sb(S)){let S=R[O++];for(let R of N)if(this.isInFilter(T,P.fieldPath)&&lv(S))N=this.expandIndexValues(N,P,S);else{let T=R.forKind(P.kind);pu.INSTANCE.writeIndexValue(S,T)}}return this.getEncodedBytes(N)}encodeBound(S,T,R){return this.encodeValues(S,T,R.position)}getEncodedBytes(S){let T=[];for(let R=0;R<S.length;++R)T[R]=S[R].encodedBytes();return T}expandIndexValues(S,T,R){let N=[...S],O=[];for(let S of R.arrayValue.values||[])for(let R of N){let N=new pR;N.seed(R.encodedBytes()),pu.INSTANCE.writeIndexValue(S,N.forKind(T.kind)),O.push(N)}return O}isInFilter(S,T){return!!S.filters.find(S=>S instanceof l$&&S.field.isEqual(T)&&("in"===S.op||"not-in"===S.op))}getFieldIndexes(S,T){let R=pX(S),N=pZ(S);return(T?R.loadAll(aU,IDBKeyRange.bound(T,T)):R.loadAll()).next(S=>{let T=[];return sx.forEach(S,S=>N.get([S.indexId,this.uid]).next(R=>{T.push(dQ(S,R))})).next(()=>T)})}getNextCollectionGroupToUpdate(S){return this.getFieldIndexes(S).next(S=>0===S.length?null:(S.sort((S,T)=>{let R=S.indexState.sequenceNumber-T.indexState.sequenceNumber;return 0!==R?R:i8(S.collectionGroup,T.collectionGroup)}),S[0].collectionGroup))}updateCollectionGroup(S,T,R){let N=pX(S),O=pZ(S);return this.getNextSequenceNumber(S).next(S=>N.loadAll(aU,IDBKeyRange.bound(T,T)).next(T=>sx.forEach(T,T=>O.put(dY(T.indexId,this.uid,S,R)))))}updateIndexEntries(S,T){let R=new Map;return sx.forEach(T,(T,N)=>{let O=R.get(T.collectionGroup);return(O?sx.resolve(O):this.getFieldIndexes(S,T.collectionGroup)).next(O=>(R.set(T.collectionGroup,O),sx.forEach(O,R=>this.getExistingIndexEntries(S,T,R).next(T=>{let O=this.computeIndexEntries(N,R);return T.isEqual(O)?sx.resolve():this.updateEntries(S,N,R,T,O)}))))})}addIndexEntry(S,T,R,N){return pJ(S).put({indexId:N.indexId,uid:this.uid,arrayValue:N.arrayValue,directionalValue:N.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(R,T.key),documentKey:T.key.path.toArray()})}deleteIndexEntry(S,T,R,N){return pJ(S).delete([N.indexId,this.uid,N.arrayValue,N.directionalValue,this.encodeDirectionalKey(R,T.key),T.key.path.toArray()])}getExistingIndexEntries(S,T,R){let N=pJ(S),O=new oh(pD);return N.iterate({index:aH,range:IDBKeyRange.only([R.indexId,this.uid,this.encodeDirectionalKey(R,T)])},(S,N)=>{O=O.add(new pA(R.indexId,T,N.arrayValue,N.directionalValue))}).next(()=>O)}computeIndexEntries(S,T){let R=new oh(pD),N=this.encodeDirectionalElements(T,S);if(null==N)return R;let O=sv(T);if(null!=O){let P=S.data.field(O.fieldPath);if(lv(P))for(let O of P.arrayValue.values||[])R=R.add(new pA(T.indexId,S.key,this.encodeSingleElement(O),N))}else R=R.add(new pA(T.indexId,S.key,pW,N));return R}updateEntries(S,T,R,N,O){ij(pH,"Updating index entries for document '%s'",T.key);let P=[];return of(N,O,pD,N=>{P.push(this.addIndexEntry(S,T,R,N))},N=>{P.push(this.deleteIndexEntry(S,T,R,N))}),sx.waitFor(P)}getNextSequenceNumber(S){let T=1;return pZ(S).iterate({index:aq,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(S,R,N)=>{N.done(),T=R.sequenceNumber+1}).next(()=>T)}createRange(S,T,R){R=R.sort((S,T)=>pD(S,T)).filter((S,T,R)=>!T||0!==pD(S,R[T-1]));let N=[];for(let O of(N.push(S),R)){let R=pD(O,S),P=pD(O,T);if(0===R)N[0]=S.successor();else if(R>0&&P<0)N.push(O),N.push(O.successor());else if(P>0)break}N.push(T);let O=[];for(let S=0;S<N.length;S+=2){if(this.isRangeMatchable(N[S],N[S+1]))return[];let T=[N[S].indexId,this.uid,N[S].arrayValue,N[S].directionalValue,pW,[]],R=[N[S+1].indexId,this.uid,N[S+1].arrayValue,N[S+1].directionalValue,pW,[]];O.push(IDBKeyRange.bound(T,R))}return O}isRangeMatchable(S,T){return pD(S,T)>0}getMinOffsetFromCollectionGroup(S,T){return this.getFieldIndexes(S,T).next(p0)}getMinOffset(S,T){return sx.mapArray(this.getSubTargets(T),T=>this.getFieldIndex(S,T).next(S=>S||i$())).next(p0)}}function pY(S){return or(S,aA)}function pJ(S){return or(S,aG)}function pX(S){return or(S,aB)}function pZ(S){return or(S,aV)}function p0(S){iG(0!==S.length);let T=S[0].indexState.offset,R=T.largestBatchId;for(let N=1;N<S.length;N++){let O=S[N].indexState.offset;0>sA(O,T)&&(T=O),R<O.largestBatchId&&(R=O.largestBatchId)}return new sR(T.readTime,T.documentKey,R)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p4(S,T,R){let N=S.store(ar),O=S.store(ac),P=[],M=IDBKeyRange.only(R.batchId),L=0,U=N.iterate({range:M},(S,T,R)=>(L++,R.delete()));P.push(U.next(()=>{iG(1===L)}));let V=[];for(let S of R.mutations){let N=al(T,S.key.path,R.batchId);P.push(O.delete(N)),V.push(S.key)}return sx.waitFor(P).next(()=>V)}function p3(S){let T;if(!S)return 0;if(S.document)T=S.document;else if(S.unknownDocument)T=S.unknownDocument;else if(S.noDocument)T=S.noDocument;else throw i$();return JSON.stringify(T).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p6{constructor(S,T,R,N){this.userId=S,this.serializer=T,this.indexManager=R,this.referenceDelegate=N,this.documentKeysByBatchId={}}static forUser(S,T,R,N){return iG(""!==S.uid),new p6(S.isAuthenticated()?S.uid:"",T,R,N)}checkEmpty(S){let T=!0,R=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return p7(S).iterate({index:ai,range:R},(S,R,N)=>{T=!1,N.done()}).next(()=>T)}addMutationBatch(S,T,R,N){let O=p8(S),P=p7(S);return P.add({}).next(M=>{iG("number"==typeof M);let L=new cz(M,T,R,N),U=dx(this.serializer,this.userId,L),V=[],$=new oh((S,T)=>i8(S.canonicalString(),T.canonicalString()));for(let S of N){let T=al(this.userId,S.key.path,M);$=$.add(S.key.path.popLast()),V.push(P.put(U)),V.push(O.put(T,au))}return $.forEach(T=>{V.push(this.indexManager.addToCollectionParentIndex(S,T))}),S.addOnCommittedListener(()=>{this.documentKeysByBatchId[M]=L.keys()}),sx.waitFor(V).next(()=>L)})}lookupMutationBatch(S,T){return p7(S).get(T).next(S=>S?(iG(S.userId===this.userId),dP(this.serializer,S)):null)}lookupMutationKeys(S,T){return this.documentKeysByBatchId[T]?sx.resolve(this.documentKeysByBatchId[T]):this.lookupMutationBatch(S,T).next(S=>{if(!S)return null;{let R=S.keys();return this.documentKeysByBatchId[T]=R,R}})}getNextMutationBatchAfterBatchId(S,T){let R=T+1,N=IDBKeyRange.lowerBound([this.userId,R]),O=null;return p7(S).iterate({index:ai,range:N},(S,T,N)=>{T.userId===this.userId&&(iG(T.batchId>=R),O=dP(this.serializer,T)),N.done()}).next(()=>O)}getHighestUnacknowledgedBatchId(S){let T=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),R=oF;return p7(S).iterate({index:ai,range:T,reverse:!0},(S,T,N)=>{R=T.batchId,N.done()}).next(()=>R)}getAllMutationBatches(S){let T=IDBKeyRange.bound([this.userId,oF],[this.userId,Number.POSITIVE_INFINITY]);return p7(S).loadAll(ai,T).next(S=>S.map(S=>dP(this.serializer,S)))}getAllMutationBatchesAffectingDocumentKey(S,T){let R=ao(this.userId,T.path),N=IDBKeyRange.lowerBound(R),O=[];return p8(S).iterate({range:N},(R,N,P)=>{let[M,L,U]=R,V=s9(L);if(M!==this.userId||!T.path.isEqual(V)){P.done();return}return p7(S).get(U).next(S=>{if(!S)throw i$();iG(S.userId===this.userId),O.push(dP(this.serializer,S))})}).next(()=>O)}getAllMutationBatchesAffectingDocumentKeys(S,T){let R=new oh(i8),N=[];return T.forEach(T=>{let O=ao(this.userId,T.path),P=IDBKeyRange.lowerBound(O),M=p8(S).iterate({range:P},(S,N,O)=>{let[P,M,L]=S,U=s9(M);if(P!==this.userId||!T.path.isEqual(U)){O.done();return}R=R.add(L)});N.push(M)}),sx.waitFor(N).next(()=>this.lookupMutationBatches(S,R))}getAllMutationBatchesAffectingQuery(S,T){let R=T.path,N=R.length+1,O=ao(this.userId,R),P=IDBKeyRange.lowerBound(O),M=new oh(i8);return p8(S).iterate({range:P},(S,T,O)=>{let[P,L,U]=S,V=s9(L);if(P!==this.userId||!R.isPrefixOf(V)){O.done();return}V.length===N&&(M=M.add(U))}).next(()=>this.lookupMutationBatches(S,M))}lookupMutationBatches(S,T){let R=[],N=[];return T.forEach(T=>{N.push(p7(S).get(T).next(S=>{if(null===S)throw i$();iG(S.userId===this.userId),R.push(dP(this.serializer,S))}))}),sx.waitFor(N).next(()=>R)}removeMutationBatch(S,T){return p4(S.simpleDbTransaction,this.userId,T).next(R=>(S.addOnCommittedListener(()=>{this.removeCachedMutationKeys(T.batchId)}),sx.forEach(R,T=>this.referenceDelegate.markPotentiallyOrphaned(S,T))))}removeCachedMutationKeys(S){delete this.documentKeysByBatchId[S]}performConsistencyCheck(S){return this.checkEmpty(S).next(T=>{if(!T)return sx.resolve();let R=IDBKeyRange.lowerBound(aa(this.userId)),N=[];return p8(S).iterate({range:R},(S,T,R)=>{if(S[0]!==this.userId){R.done();return}{let T=s9(S[1]);N.push(T)}}).next(()=>{iG(0===N.length)})})}containsKey(S,T){return p9(S,this.userId,T)}getMutationQueueMetadata(S){return fe(S).get(this.userId).next(S=>S||{userId:this.userId,lastAcknowledgedBatchId:oF,lastStreamToken:""})}}function p9(S,T,R){let N=ao(T,R.path),O=N[1],P=IDBKeyRange.lowerBound(N),M=!1;return p8(S).iterate({range:P,keysOnly:!0},(S,R,N)=>{let[P,L,U]=S;P===T&&L===O&&(M=!0),N.done()}).next(()=>M)}function p5(S,T){let R=!1;return fe(S).iterateSerial(N=>p9(S,N,T).next(S=>(S&&(R=!0),sx.resolve(!S)))).next(()=>R)}function p7(S){return or(S,ar)}function p8(S){return or(S,ac)}function fe(S){return or(S,ae)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ft=2;class fr{constructor(S){this.lastId=S}next(){return this.lastId+=ft,this.lastId}static forTargetCache(){return new fr(2-ft)}static forSyncEngine(){return new fr(1-ft)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(S,T){this.referenceDelegate=S,this.serializer=T}allocateTargetId(S){return this.retrieveMetadata(S).next(T=>{let R=new fr(T.highestTargetId);return T.highestTargetId=R.next(),this.saveMetadata(S,T).next(()=>T.highestTargetId)})}getLastRemoteSnapshotVersion(S){return this.retrieveMetadata(S).next(S=>sl.fromTimestamp(new so(S.lastRemoteSnapshotVersion.seconds,S.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(S){return this.retrieveMetadata(S).next(S=>S.highestListenSequenceNumber)}setTargetsMetadata(S,T,R){return this.retrieveMetadata(S).next(N=>(N.highestListenSequenceNumber=T,R&&(N.lastRemoteSnapshotVersion=R.toTimestamp()),T>N.highestListenSequenceNumber&&(N.highestListenSequenceNumber=T),this.saveMetadata(S,N)))}addTargetData(S,T){return this.saveTargetData(S,T).next(()=>this.retrieveMetadata(S).next(R=>(R.targetCount+=1,this.updateMetadataFromTargetData(T,R),this.saveMetadata(S,R))))}updateTargetData(S,T){return this.saveTargetData(S,T)}removeTargetData(S,T){return this.removeMatchingKeysForTargetId(S,T.targetId).next(()=>fa(S).delete(T.targetId)).next(()=>this.retrieveMetadata(S)).next(T=>(iG(T.targetCount>0),T.targetCount-=1,this.saveMetadata(S,T)))}removeTargets(S,T,R){let N=0,O=[];return fa(S).iterate((P,M)=>{let L=dM(M);L.sequenceNumber<=T&&null===R.get(L.targetId)&&(N++,O.push(this.removeTargetData(S,L)))}).next(()=>sx.waitFor(O)).next(()=>N)}forEachTarget(S,T){return fa(S).iterate((S,R)=>{T(dM(R))})}retrieveMetadata(S){return fo(S).get(ak).next(S=>(iG(null!==S),S))}saveMetadata(S,T){return fo(S).put(ak,T)}saveTargetData(S,T){return fa(S).put(dL(this.serializer,T))}updateMetadataFromTargetData(S,T){let R=!1;return S.targetId>T.highestTargetId&&(T.highestTargetId=S.targetId,R=!0),S.sequenceNumber>T.highestListenSequenceNumber&&(T.highestListenSequenceNumber=S.sequenceNumber,R=!0),R}getTargetCount(S){return this.retrieveMetadata(S).next(S=>S.targetCount)}getTargetData(S,T){let R=ui(T),N=IDBKeyRange.bound([R,Number.NEGATIVE_INFINITY],[R,Number.POSITIVE_INFINITY]),O=null;return fa(S).iterate({range:N,index:aT},(S,R,N)=>{let P=dM(R);uo(T,P.target)&&(O=P,N.done())}).next(()=>O)}addMatchingKeys(S,T,R){let N=[],O=fl(S);return T.forEach(T=>{let P=s4(T.path);N.push(O.put({targetId:R,path:P})),N.push(this.referenceDelegate.addReference(S,R,T))}),sx.waitFor(N)}removeMatchingKeys(S,T,R){let N=fl(S);return sx.forEach(T,T=>{let O=s4(T.path);return sx.waitFor([N.delete([R,O]),this.referenceDelegate.removeReference(S,R,T)])})}removeMatchingKeysForTargetId(S,T){let R=fl(S),N=IDBKeyRange.bound([T],[T+1],!1,!0);return R.delete(N)}getMatchingKeysForTargetId(S,T){let R=IDBKeyRange.bound([T],[T+1],!1,!0),N=fl(S),O=u6();return N.iterate({range:R,keysOnly:!0},(S,T,R)=>{let N=new sf(s9(S[1]));O=O.add(N)}).next(()=>O)}containsKey(S,T){let R=s4(T.path),N=IDBKeyRange.bound([R],[si(R)],!1,!0),O=0;return fl(S).iterate({index:aI,keysOnly:!0,range:N},([S,T],R,N)=>{0!==S&&(O++,N.done())}).next(()=>O>0)}getTargetDataForTarget(S,T){return fa(S).get(T).next(S=>S?dM(S):null)}}function fa(S){return or(S,ab)}function fo(S){return or(S,aR)}function fl(S){return or(S,aC)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},fc=-1,fh=41943040;class fd{static withCacheSize(S){return new fd(S,fd.DEFAULT_COLLECTION_PERCENTILE,fd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(S,T,R){this.cacheSizeCollectionThreshold=S,this.percentileToCollect=T,this.maximumSequenceNumbersToCollect=R}}fd.DEFAULT_COLLECTION_PERCENTILE=10,fd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,fd.DEFAULT=new fd(fh,fd.DEFAULT_COLLECTION_PERCENTILE,fd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),fd.DISABLED=new fd(fc,0,0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fp="LruGarbageCollector",ff=1048576,fg=null,fm=null;function fy([S,T],[R,N]){let O=i8(S,R);return 0===O?i8(T,N):O}class fv{constructor(S){this.maxElements=S,this.buffer=new oh(fy),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(S){let T=[S,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(T);else{let S=this.buffer.last();0>fy(T,S)&&(this.buffer=this.buffer.delete(S).add(T))}}get maxValue(){return this.buffer.last()[0]}}class fb{constructor(S,T,R){this.garbageCollector=S,this.asyncQueue=T,this.localStore=R,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==fc&&this.scheduleGC(fg)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(S){ij(fp,`Garbage collection scheduled in ${S}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",S,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(S){sV(S)?ij(fp,"Ignoring IndexedDB error during garbage collection: ",S):await sO(S)}await this.scheduleGC(fm)})}}class fS{constructor(S,T){this.delegate=S,this.params=T}calculateTargetCount(S,T){return this.delegate.getSequenceNumberCount(S).next(S=>Math.floor(T/100*S))}nthSequenceNumber(S,T){if(0===T)return sx.resolve(sX.INVALID);let R=new fv(T);return this.delegate.forEachTarget(S,S=>R.addElement(S.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(S,S=>R.addElement(S))).next(()=>R.maxValue)}removeTargets(S,T,R){return this.delegate.removeTargets(S,T,R)}removeOrphanedDocuments(S,T){return this.delegate.removeOrphanedDocuments(S,T)}collect(S,T){return this.params.cacheSizeCollectionThreshold===fc?(ij("LruGarbageCollector","Garbage collection skipped; disabled"),sx.resolve(fu)):this.getCacheSize(S).next(R=>R<this.params.cacheSizeCollectionThreshold?(ij("LruGarbageCollector",`Garbage collection skipped; Cache size ${R} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),fu):this.runGarbageCollection(S,T))}getCacheSize(S){return this.delegate.getCacheSize(S)}runGarbageCollection(S,T){let R,N,O,P,M,L,U;let V=Date.now();return this.calculateTargetCount(S,this.params.percentileToCollect).next(T=>(T>this.params.maximumSequenceNumbersToCollect?(ij("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${T}`),N=this.params.maximumSequenceNumbersToCollect):N=T,P=Date.now(),this.nthSequenceNumber(S,N))).next(N=>(R=N,M=Date.now(),this.removeTargets(S,R,T))).next(T=>(O=T,L=Date.now(),this.removeOrphanedDocuments(S,R))).next(S=>(U=Date.now(),iU()<=LogLevel.DEBUG&&ij("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${P-V}ms
	Determined least recently used ${N} in ${M-P}ms
	Removed ${O} targets in ${L-M}ms
	Removed ${S} documents in ${U-L}ms
Total Duration: ${U-V}ms`),sx.resolve({didRun:!0,sequenceNumbersCollected:N,targetsRemoved:O,documentsRemoved:S})))}}function fT(S,T){return new fS(S,T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fw{constructor(S,T){this.db=S,this.garbageCollector=fT(this,T)}getSequenceNumberCount(S){let T=this.orphanedDocumentCount(S);return this.db.getTargetCache().getTargetCount(S).next(S=>T.next(T=>S+T))}orphanedDocumentCount(S){let T=0;return this.forEachOrphanedDocumentSequenceNumber(S,S=>{T++}).next(()=>T)}forEachTarget(S,T){return this.db.getTargetCache().forEachTarget(S,T)}forEachOrphanedDocumentSequenceNumber(S,T){return this.forEachOrphanedDocument(S,(S,R)=>T(R))}addReference(S,T,R){return fI(S,R)}removeReference(S,T,R){return fI(S,R)}removeTargets(S,T,R){return this.db.getTargetCache().removeTargets(S,T,R)}markPotentiallyOrphaned(S,T){return fI(S,T)}isPinned(S,T){return p5(S,T)}removeOrphanedDocuments(S,T){let R=this.db.getRemoteDocumentCache().newChangeBuffer(),N=[],O=0;return this.forEachOrphanedDocument(S,(P,M)=>{if(M<=T){let T=this.isPinned(S,P).next(T=>{if(!T)return O++,R.getEntry(S,P).next(()=>(R.removeEntry(P,sl.min()),fl(S).delete(fC(P))))});N.push(T)}}).next(()=>sx.waitFor(N)).next(()=>R.apply(S)).next(()=>O)}removeTarget(S,T){let R=T.withSequenceNumber(S.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(S,R)}updateLimboDocument(S,T){return fI(S,T)}forEachOrphanedDocument(S,T){let R;let N=fl(S),O=sX.INVALID;return N.iterate({index:aI},([S,N],{path:P,sequenceNumber:M})=>{0===S?(O!==sX.INVALID&&T(new sf(s9(R)),O),O=M,R=P):O=sX.INVALID}).next(()=>{O!==sX.INVALID&&T(new sf(s9(R)),O)})}getCacheSize(S){return this.db.getRemoteDocumentCache().getSize(S)}}function fC(S){return[0,s4(S.path)]}function fE(S,T){return{targetId:0,path:s4(S.path),sequenceNumber:T}}function fI(S,T){return fl(S).put(fE(T,S.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_{constructor(){this.changes=new uK(S=>S.toString(),(S,T)=>S.isEqual(T)),this.changesApplied=!1}addEntry(S){this.assertNotApplied(),this.changes.set(S.key,S)}removeEntry(S,T){this.assertNotApplied(),this.changes.set(S,lO.newInvalidDocument(S).setReadTime(T))}getEntry(S,T){this.assertNotApplied();let R=this.changes.get(T);return void 0!==R?sx.resolve(R):this.getFromCache(S,T)}getEntries(S,T){return this.getAllFromCache(S,T)}apply(S){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(S)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{constructor(S){this.serializer=S}setIndexManager(S){this.indexManager=S}addEntry(S,T,R){return fN(S).put(R)}removeEntry(S,T,R){return fN(S).delete(fx(T,R))}updateMetadata(S,T){return this.getMetadata(S).next(R=>(R.byteSize+=T,this.setMetadata(S,R)))}getEntry(S,T){let R=lO.newInvalidDocument(T);return fN(S).iterate({index:ap,range:IDBKeyRange.only(fO(T))},(S,N)=>{R=this.maybeDecodeDocument(T,N)}).next(()=>R)}getSizedEntry(S,T){let R={size:0,document:lO.newInvalidDocument(T)};return fN(S).iterate({index:ap,range:IDBKeyRange.only(fO(T))},(S,N)=>{R={document:this.maybeDecodeDocument(T,N),size:p3(N)}}).next(()=>R)}getEntries(S,T){let R=uW();return this.forEachDbEntry(S,T,(S,T)=>{let N=this.maybeDecodeDocument(S,T);R=R.insert(S,N)}).next(()=>R)}getSizedEntries(S,T){let R=uW(),N=new oo(sf.comparator);return this.forEachDbEntry(S,T,(S,T)=>{let O=this.maybeDecodeDocument(S,T);R=R.insert(S,O),N=N.insert(S,p3(T))}).next(()=>({documents:R,sizeMap:N}))}forEachDbEntry(S,T,R){if(T.isEmpty())return sx.resolve();let N=new oh(fM);T.forEach(S=>N=N.add(S));let O=IDBKeyRange.bound(fO(N.first()),fO(N.last())),P=N.getIterator(),M=P.getNext();return fN(S).iterate({index:ap,range:O},(S,T,N)=>{let O=sf.fromSegments([...T.prefixPath,T.collectionGroup,T.documentId]);for(;M&&0>fM(M,O);)R(M,null),M=P.getNext();M&&M.isEqual(O)&&(R(M,T),M=P.hasNext()?P.getNext():null),M?N.skip(fO(M)):N.done()}).next(()=>{for(;M;)R(M,null),M=P.hasNext()?P.getNext():null})}getDocumentsMatchingQuery(S,T,R,N,O){let P=T.path,M=[P.popLast().toArray(),P.lastSegment(),dA(R.readTime),R.documentKey.path.isEmpty()?"":R.documentKey.path.lastSegment()],L=[P.popLast().toArray(),P.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return fN(S).loadAll(IDBKeyRange.bound(M,L,!0)).next(S=>{null==O||O.incrementDocumentReadCount(S.length);let R=uW();for(let O of S){let S=this.maybeDecodeDocument(sf.fromSegments(O.prefixPath.concat(O.collectionGroup,O.documentId)),O);S.isFoundDocument()&&(uF(T,S)||N.has(S.key))&&(R=R.insert(S.key,S))}return R})}getAllFromCollectionGroup(S,T,R,N){let O=uW(),P=fP(T,R),M=fP(T,sR.max());return fN(S).iterate({index:ag,range:IDBKeyRange.bound(P,M,!0)},(S,T,R)=>{let P=this.maybeDecodeDocument(sf.fromSegments(T.prefixPath.concat(T.collectionGroup,T.documentId)),T);(O=O.insert(P.key,P)).size===N&&R.done()}).next(()=>O)}newChangeBuffer(S){return new fA(this,!!S&&S.trackRemovals)}getSize(S){return this.getMetadata(S).next(S=>S.byteSize)}getMetadata(S){return fD(S).get(av).next(S=>(iG(!!S),S))}setMetadata(S,T){return fD(S).put(av,T)}maybeDecodeDocument(S,T){if(T){let S=dk(this.serializer,T);if(!(S.isNoDocument()&&S.version.isEqual(sl.min())))return S}return lO.newInvalidDocument(S)}}function fR(S){return new fk(S)}class fA extends null{constructor(S,T){super(),this.documentCache=S,this.trackRemovals=T,this.documentStates=new uK(S=>S.toString(),(S,T)=>S.isEqual(T))}applyChanges(S){let T=[],R=0,N=new oh((S,T)=>i8(S.canonicalString(),T.canonicalString()));return this.changes.forEach((O,P)=>{let M=this.documentStates.get(O);if(T.push(this.documentCache.removeEntry(S,O,M.readTime)),P.isValidDocument()){let L=dR(this.documentCache.serializer,P);N=N.add(O.path.popLast());let U=p3(L);R+=U-M.size,T.push(this.documentCache.addEntry(S,O,L))}else if(R-=M.size,this.trackRemovals){let R=dR(this.documentCache.serializer,P.convertToNoDocument(sl.min()));T.push(this.documentCache.addEntry(S,O,R))}}),N.forEach(R=>{T.push(this.documentCache.indexManager.addToCollectionParentIndex(S,R))}),T.push(this.documentCache.updateMetadata(S,R)),sx.waitFor(T)}getFromCache(S,T){return this.documentCache.getSizedEntry(S,T).next(S=>(this.documentStates.set(T,{size:S.size,readTime:S.document.readTime}),S.document))}getAllFromCache(S,T){return this.documentCache.getSizedEntries(S,T).next(({documents:S,sizeMap:T})=>(T.forEach((T,R)=>{this.documentStates.set(T,{size:R,readTime:S.get(T).readTime})}),S))}}function fD(S){return or(S,ay)}function fN(S){return or(S,ah)}function fO(S){let T=S.path.toArray();return[T.slice(0,T.length-2),T[T.length-2],T[T.length-1]]}function fx(S,T){let R=S.path.toArray();return[R.slice(0,R.length-2),R[R.length-2],dA(T),R[R.length-1]]}function fP(S,T){let R=T.documentKey.path.toArray();return[S,dA(T.readTime),R.slice(0,R.length-2),R.length>0?R[R.length-1]:""]}function fM(S,T){let R=S.path.toArray(),N=T.path.toArray(),O=0;for(let S=0;S<R.length-2&&S<N.length-2;++S)if(O=i8(R[S],N[S]))return O;return(O=i8(R.length,N.length))||(O=i8(R[R.length-2],N[N.length-2]))?O:i8(R[R.length-1],N[N.length-1])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fL=17;/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fB{constructor(S,T){this.overlayedDocument=S,this.mutatedFields=T}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fF{constructor(S,T,R,N){this.remoteDocumentCache=S,this.mutationQueue=T,this.documentOverlayCache=R,this.indexManager=N}getDocument(S,T){let R=null;return this.documentOverlayCache.getOverlay(S,T).next(N=>(R=N,this.remoteDocumentCache.getEntry(S,T))).next(S=>(null!==R&&c_(R.mutation,S,om.empty(),so.now()),S))}getDocuments(S,T){return this.remoteDocumentCache.getEntries(S,T).next(T=>this.getLocalViewOfDocuments(S,T,u6()).next(()=>T))}getLocalViewOfDocuments(S,T,R=u6()){let N=uZ();return this.populateOverlays(S,N,T).next(()=>this.computeViews(S,T,N,R).next(S=>{let T=uY();return S.forEach((S,R)=>{T=T.insert(S,R.overlayedDocument)}),T}))}getOverlayedDocuments(S,T){let R=uZ();return this.populateOverlays(S,R,T).next(()=>this.computeViews(S,T,R,u6()))}populateOverlays(S,T,R){let N=[];return R.forEach(S=>{T.has(S)||N.push(S)}),this.documentOverlayCache.getOverlays(S,N).next(S=>{S.forEach((S,R)=>{T.set(S,R)})})}computeViews(S,T,R,N){let O=uW(),P=u1(),M=uJ();return T.forEach((S,T)=>{let M=R.get(T.key);N.has(T.key)&&(void 0===M||M.mutation instanceof cO)?O=O.insert(T.key,T):void 0!==M?(P.set(T.key,M.mutation.getFieldMask()),c_(M.mutation,T,M.mutation.getFieldMask(),so.now())):P.set(T.key,om.empty())}),this.recalculateAndSaveOverlays(S,O).next(S=>(S.forEach((S,T)=>P.set(S,T)),T.forEach((S,T)=>{var R;return M.set(S,new fB(T,null!==(R=P.get(S))&&void 0!==R?R:null))}),M))}recalculateAndSaveOverlays(S,T){let R=u1(),N=new oo((S,T)=>S-T),O=u6();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(S,T).next(S=>{for(let O of S)O.keys().forEach(S=>{let P=T.get(S);if(null===P)return;let M=R.get(S)||om.empty();M=O.applyToLocalView(P,M),R.set(S,M);let L=(N.get(O.batchId)||u6()).add(S);N=N.insert(O.batchId,L)})}).next(()=>{let P=[],M=N.getReverseIterator();for(;M.hasNext();){let N=M.getNext(),L=N.key,U=N.value,V=u0();U.forEach(S=>{if(!O.has(S)){let N=cE(T.get(S),R.get(S));null!==N&&V.set(S,N),O=O.add(S)}}),P.push(this.documentOverlayCache.saveOverlays(S,L,V))}return sx.waitFor(P)}).next(()=>R)}recalculateAndSaveOverlaysForDocumentKeys(S,T){return this.remoteDocumentCache.getEntries(S,T).next(T=>this.recalculateAndSaveOverlays(S,T))}getDocumentsMatchingQuery(S,T,R,N){return uE(T)?this.getDocumentsMatchingDocumentQuery(S,T.path):uI(T)?this.getDocumentsMatchingCollectionGroupQuery(S,T,R,N):this.getDocumentsMatchingCollectionQuery(S,T,R,N)}getNextDocuments(S,T,R,N){return this.remoteDocumentCache.getAllFromCollectionGroup(S,T,R,N).next(O=>{let P=N-O.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(S,T,R.largestBatchId,N-O.size):sx.resolve(uZ()),M=sg,L=O;return P.next(T=>sx.forEach(T,(T,R)=>(M<R.largestBatchId&&(M=R.largestBatchId),O.get(T))?sx.resolve():this.remoteDocumentCache.getEntry(S,T).next(S=>{L=L.insert(T,S)})).next(()=>this.populateOverlays(S,T,O)).next(()=>this.computeViews(S,L,T,u6())).next(S=>({batchId:M,changes:uX(S)})))})}getDocumentsMatchingDocumentQuery(S,T){return this.getDocument(S,new sf(T)).next(S=>{let T=uY();return S.isFoundDocument()&&(T=T.insert(S.key,S)),T})}getDocumentsMatchingCollectionGroupQuery(S,T,R,N){let O=T.collectionGroup,P=uY();return this.indexManager.getCollectionParents(S,O).next(M=>sx.forEach(M,M=>{let L=uT(T,M.child(O));return this.getDocumentsMatchingCollectionQuery(S,L,R,N).next(S=>{S.forEach((S,T)=>{P=P.insert(S,T)})})}).next(()=>P))}getDocumentsMatchingCollectionQuery(S,T,R,N){let O;return this.documentOverlayCache.getOverlaysForCollection(S,T.path,R.largestBatchId).next(P=>(O=P,this.remoteDocumentCache.getDocumentsMatchingQuery(S,T,R,O,N))).next(S=>{O.forEach((T,R)=>{let N=R.getKey();null===S.get(N)&&(S=S.insert(N,lO.newInvalidDocument(N)))});let R=uY();return S.forEach((S,N)=>{let P=O.get(S);void 0!==P&&c_(P.mutation,N,om.empty(),so.now()),uF(T,N)&&(R=R.insert(S,N))}),R})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fU{constructor(S){this.serializer=S,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(S,T){return sx.resolve(this.bundles.get(T))}saveBundleMetadata(S,T){return this.bundles.set(T.id,d$(T)),sx.resolve()}getNamedQuery(S,T){return sx.resolve(this.namedQueries.get(T))}saveNamedQuery(S,T){return this.namedQueries.set(T.name,dq(T)),sx.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fj{constructor(){this.overlays=new oo(sf.comparator),this.overlayByBatchId=new Map}getOverlay(S,T){return sx.resolve(this.overlays.get(T))}getOverlays(S,T){let R=uZ();return sx.forEach(T,T=>this.getOverlay(S,T).next(S=>{null!==S&&R.set(T,S)})).next(()=>R)}saveOverlays(S,T,R){return R.forEach((R,N)=>{this.saveOverlay(S,T,N)}),sx.resolve()}removeOverlaysForBatchId(S,T,R){let N=this.overlayByBatchId.get(R);return void 0!==N&&(N.forEach(S=>this.overlays=this.overlays.remove(S)),this.overlayByBatchId.delete(R)),sx.resolve()}getOverlaysForCollection(S,T,R){let N=uZ(),O=T.length+1,P=new sf(T.child("")),M=this.overlays.getIteratorFrom(P);for(;M.hasNext();){let S=M.getNext().value,P=S.getKey();if(!T.isPrefixOf(P.path))break;P.path.length===O&&S.largestBatchId>R&&N.set(S.getKey(),S)}return sx.resolve(N)}getOverlaysForCollectionGroup(S,T,R,N){let O=new oo((S,T)=>S-T),P=this.overlays.getIterator();for(;P.hasNext();){let S=P.getNext().value;if(S.getKey().getCollectionGroup()===T&&S.largestBatchId>R){let T=O.get(S.largestBatchId);null===T&&(T=uZ(),O=O.insert(S.largestBatchId,T)),T.set(S.getKey(),S)}}let M=uZ(),L=O.getIterator();for(;L.hasNext()&&(L.getNext().value.forEach((S,T)=>M.set(S,T)),!(M.size()>=N)););return sx.resolve(M)}saveOverlay(S,T,R){let N=this.overlays.get(R.key);if(null!==N){let S=this.overlayByBatchId.get(N.largestBatchId).delete(R.key);this.overlayByBatchId.set(N.largestBatchId,S)}this.overlays=this.overlays.insert(R.key,new c$(T,R));let O=this.overlayByBatchId.get(T);void 0===O&&(O=u6(),this.overlayByBatchId.set(T,O)),this.overlayByBatchId.set(T,O.add(R.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fV{constructor(){this.sessionToken=ob.EMPTY_BYTE_STRING}getSessionToken(S){return sx.resolve(this.sessionToken)}setSessionToken(S,T){return this.sessionToken=T,sx.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fz{constructor(){this.refsByKey=new oh(fq.compareByKey),this.refsByTarget=new oh(fq.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(S,T){let R=new fq(S,T);this.refsByKey=this.refsByKey.add(R),this.refsByTarget=this.refsByTarget.add(R)}addReferences(S,T){S.forEach(S=>this.addReference(S,T))}removeReference(S,T){this.removeRef(new fq(S,T))}removeReferences(S,T){S.forEach(S=>this.removeReference(S,T))}removeReferencesForId(S){let T=new sf(new sh([])),R=new fq(T,S),N=new fq(T,S+1),O=[];return this.refsByTarget.forEachInRange([R,N],S=>{this.removeRef(S),O.push(S.key)}),O}removeAllReferences(){this.refsByKey.forEach(S=>this.removeRef(S))}removeRef(S){this.refsByKey=this.refsByKey.delete(S),this.refsByTarget=this.refsByTarget.delete(S)}referencesForId(S){let T=new sf(new sh([])),R=new fq(T,S),N=new fq(T,S+1),O=u6();return this.refsByTarget.forEachInRange([R,N],S=>{O=O.add(S.key)}),O}containsKey(S){let T=new fq(S,0),R=this.refsByKey.firstAfterOrEqual(T);return null!==R&&S.isEqual(R.key)}}class fq{constructor(S,T){this.key=S,this.targetOrBatchId=T}static compareByKey(S,T){return sf.comparator(S.key,T.key)||i8(S.targetOrBatchId,T.targetOrBatchId)}static compareByTargetId(S,T){return i8(S.targetOrBatchId,T.targetOrBatchId)||sf.comparator(S.key,T.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f${constructor(S,T){this.indexManager=S,this.referenceDelegate=T,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new oh(fq.compareByKey)}checkEmpty(S){return sx.resolve(0===this.mutationQueue.length)}addMutationBatch(S,T,R,N){let O=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let P=new cz(O,T,R,N);for(let T of(this.mutationQueue.push(P),N))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new fq(T.key,O)),this.indexManager.addToCollectionParentIndex(S,T.key.path.popLast());return sx.resolve(P)}lookupMutationBatch(S,T){return sx.resolve(this.findMutationBatch(T))}getNextMutationBatchAfterBatchId(S,T){let R=T+1,N=this.indexOfBatchId(R),O=N<0?0:N;return sx.resolve(this.mutationQueue.length>O?this.mutationQueue[O]:null)}getHighestUnacknowledgedBatchId(){return sx.resolve(0===this.mutationQueue.length?oF:this.nextBatchId-1)}getAllMutationBatches(S){return sx.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(S,T){let R=new fq(T,0),N=new fq(T,Number.POSITIVE_INFINITY),O=[];return this.batchesByDocumentKey.forEachInRange([R,N],S=>{let T=this.findMutationBatch(S.targetOrBatchId);O.push(T)}),sx.resolve(O)}getAllMutationBatchesAffectingDocumentKeys(S,T){let R=new oh(i8);return T.forEach(S=>{let T=new fq(S,0),N=new fq(S,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([T,N],S=>{R=R.add(S.targetOrBatchId)})}),sx.resolve(this.findMutationBatches(R))}getAllMutationBatchesAffectingQuery(S,T){let R=T.path,N=R.length+1,O=R;sf.isDocumentKey(O)||(O=O.child(""));let P=new fq(new sf(O),0),M=new oh(i8);return this.batchesByDocumentKey.forEachWhile(S=>{let T=S.key.path;return!!R.isPrefixOf(T)&&(T.length===N&&(M=M.add(S.targetOrBatchId)),!0)},P),sx.resolve(this.findMutationBatches(M))}findMutationBatches(S){let T=[];return S.forEach(S=>{let R=this.findMutationBatch(S);null!==R&&T.push(R)}),T}removeMutationBatch(S,T){iG(0===this.indexOfExistingBatchId(T.batchId,"removed")),this.mutationQueue.shift();let R=this.batchesByDocumentKey;return sx.forEach(T.mutations,N=>{let O=new fq(N.key,T.batchId);return R=R.delete(O),this.referenceDelegate.markPotentiallyOrphaned(S,N.key)}).next(()=>{this.batchesByDocumentKey=R})}removeCachedMutationKeys(S){}containsKey(S,T){let R=new fq(T,0),N=this.batchesByDocumentKey.firstAfterOrEqual(R);return sx.resolve(T.isEqual(N&&N.key))}performConsistencyCheck(S){return this.mutationQueue.length,sx.resolve()}indexOfExistingBatchId(S,T){return this.indexOfBatchId(S)}indexOfBatchId(S){return 0===this.mutationQueue.length?0:S-this.mutationQueue[0].batchId}findMutationBatch(S){let T=this.indexOfBatchId(S);return T<0||T>=this.mutationQueue.length?null:this.mutationQueue[T]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fG="-9223372036854775808";function fK(){return new oo(sf.comparator)}class fH{constructor(S){this.sizer=S,this.docs=fK(),this.size=0}setIndexManager(S){this.indexManager=S}addEntry(S,T){let R=T.key,N=this.docs.get(R),O=N?N.size:0,P=this.sizer(T);return this.docs=this.docs.insert(R,{document:T.mutableCopy(),size:P}),this.size+=P-O,this.indexManager.addToCollectionParentIndex(S,R.path.popLast())}removeEntry(S){let T=this.docs.get(S);T&&(this.docs=this.docs.remove(S),this.size-=T.size)}getEntry(S,T){let R=this.docs.get(T);return sx.resolve(R?R.document.mutableCopy():lO.newInvalidDocument(T))}getEntries(S,T){let R=uW();return T.forEach(S=>{let T=this.docs.get(S);R=R.insert(S,T?T.document.mutableCopy():lO.newInvalidDocument(S))}),sx.resolve(R)}getDocumentsMatchingQuery(S,T,R,N){let O=uW(),P=T.path,M=new sf(P.child("__id"+fG+"__")),L=this.docs.getIteratorFrom(M);for(;L.hasNext();){let{key:S,value:{document:M}}=L.getNext();if(!P.isPrefixOf(S.path))break;!(S.path.length>P.length+1||0>=sA(sk(M),R))&&(N.has(M.key)||uF(T,M))&&(O=O.insert(M.key,M.mutableCopy()))}return sx.resolve(O)}getAllFromCollectionGroup(S,T,R,N){i$()}forEachDocumentKey(S,T){return sx.forEach(this.docs,S=>T(S))}newChangeBuffer(S){return new fQ(this)}getSize(S){return sx.resolve(this.size)}}function fW(S){return new fH(S)}class fQ extends f_{constructor(S){super(),this.documentCache=S}applyChanges(S){let T=[];return this.changes.forEach((R,N)=>{N.isValidDocument()?T.push(this.documentCache.addEntry(S,N)):this.documentCache.removeEntry(R)}),sx.waitFor(T)}getFromCache(S,T){return this.documentCache.getEntry(S,T)}getAllFromCache(S,T){return this.documentCache.getEntries(S,T)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fY{constructor(S){this.persistence=S,this.targets=new uK(S=>ui(S),uo),this.lastRemoteSnapshotVersion=sl.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new fz,this.targetCount=0,this.targetIdGenerator=fr.forTargetCache()}forEachTarget(S,T){return this.targets.forEach((S,R)=>T(R)),sx.resolve()}getLastRemoteSnapshotVersion(S){return sx.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(S){return sx.resolve(this.highestSequenceNumber)}allocateTargetId(S){return this.highestTargetId=this.targetIdGenerator.next(),sx.resolve(this.highestTargetId)}setTargetsMetadata(S,T,R){return R&&(this.lastRemoteSnapshotVersion=R),T>this.highestSequenceNumber&&(this.highestSequenceNumber=T),sx.resolve()}saveTargetData(S){this.targets.set(S.target,S);let T=S.targetId;T>this.highestTargetId&&(this.targetIdGenerator=new fr(T),this.highestTargetId=T),S.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=S.sequenceNumber)}addTargetData(S,T){return this.saveTargetData(T),this.targetCount+=1,sx.resolve()}updateTargetData(S,T){return this.saveTargetData(T),sx.resolve()}removeTargetData(S,T){return this.targets.delete(T.target),this.references.removeReferencesForId(T.targetId),this.targetCount-=1,sx.resolve()}removeTargets(S,T,R){let N=0,O=[];return this.targets.forEach((P,M)=>{M.sequenceNumber<=T&&null===R.get(M.targetId)&&(this.targets.delete(P),O.push(this.removeMatchingKeysForTargetId(S,M.targetId)),N++)}),sx.waitFor(O).next(()=>N)}getTargetCount(S){return sx.resolve(this.targetCount)}getTargetData(S,T){let R=this.targets.get(T)||null;return sx.resolve(R)}addMatchingKeys(S,T,R){return this.references.addReferences(T,R),sx.resolve()}removeMatchingKeys(S,T,R){this.references.removeReferences(T,R);let N=this.persistence.referenceDelegate,O=[];return N&&T.forEach(T=>{O.push(N.markPotentiallyOrphaned(S,T))}),sx.waitFor(O)}removeMatchingKeysForTargetId(S,T){return this.references.removeReferencesForId(T),sx.resolve()}getMatchingKeysForTargetId(S,T){let R=this.references.referencesForId(T);return sx.resolve(R)}containsKey(S,T){return sx.resolve(this.references.containsKey(T))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fJ="MemoryPersistence";class fX{constructor(S,T){this.mutationQueues={},this.overlays={},this.listenSequence=new sX(0),this._started=!1,this._started=!0,this.globalsCache=new fV,this.referenceDelegate=S(this),this.targetCache=new fY(this);let R=S=>this.referenceDelegate.documentSize(S);this.indexManager=new pG,this.remoteDocumentCache=fW(R),this.serializer=new d_(T),this.bundleCache=new fU(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(S){return this.indexManager}getDocumentOverlayCache(S){let T=this.overlays[S.toKey()];return T||(T=new fj,this.overlays[S.toKey()]=T),T}getMutationQueue(S,T){let R=this.mutationQueues[S.toKey()];return R||(R=new f$(T,this.referenceDelegate),this.mutationQueues[S.toKey()]=R),R}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(S,T,R){ij(fJ,"Starting transaction:",S);let N=new fZ(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),R(N).next(S=>this.referenceDelegate.onTransactionCommitted(N).next(()=>S)).toPromise().then(S=>(N.raiseOnCommittedEvent(),S))}mutationQueuesContainKey(S,T){return sx.or(Object.values(this.mutationQueues).map(R=>()=>R.containsKey(S,T)))}}class fZ extends sN{constructor(S){super(),this.currentSequenceNumber=S}}class f0{constructor(S){this.persistence=S,this.localViewReferences=new fz,this._orphanedDocuments=null}static factory(S){return new f0(S)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw i$()}addReference(S,T,R){return this.localViewReferences.addReference(R,T),this.orphanedDocuments.delete(R.toString()),sx.resolve()}removeReference(S,T,R){return this.localViewReferences.removeReference(R,T),this.orphanedDocuments.add(R.toString()),sx.resolve()}markPotentiallyOrphaned(S,T){return this.orphanedDocuments.add(T.toString()),sx.resolve()}removeTarget(S,T){this.localViewReferences.removeReferencesForId(T.targetId).forEach(S=>this.orphanedDocuments.add(S.toString()));let R=this.persistence.getTargetCache();return R.getMatchingKeysForTargetId(S,T.targetId).next(S=>{S.forEach(S=>this.orphanedDocuments.add(S.toString()))}).next(()=>R.removeTargetData(S,T))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(S){let T=this.persistence.getRemoteDocumentCache().newChangeBuffer();return sx.forEach(this.orphanedDocuments,R=>{let N=sf.fromPath(R);return this.isReferenced(S,N).next(S=>{S||T.removeEntry(N,sl.min())})}).next(()=>(this._orphanedDocuments=null,T.apply(S)))}updateLimboDocument(S,T){return this.isReferenced(S,T).next(S=>{S?this.orphanedDocuments.delete(T.toString()):this.orphanedDocuments.add(T.toString())})}documentSize(S){return 0}isReferenced(S,T){return sx.or([()=>sx.resolve(this.localViewReferences.containsKey(T)),()=>this.persistence.getTargetCache().containsKey(S,T),()=>this.persistence.mutationQueuesContainKey(S,T)])}}class f4{constructor(S,T){this.persistence=S,this.orphanedSequenceNumbers=new uK(S=>s4(S.path),(S,T)=>S.isEqual(T)),this.garbageCollector=fT(this,T)}static factory(S,T){return new f4(S,T)}onTransactionStarted(){}onTransactionCommitted(S){return sx.resolve()}forEachTarget(S,T){return this.persistence.getTargetCache().forEachTarget(S,T)}getSequenceNumberCount(S){let T=this.orphanedDocumentCount(S);return this.persistence.getTargetCache().getTargetCount(S).next(S=>T.next(T=>S+T))}orphanedDocumentCount(S){let T=0;return this.forEachOrphanedDocumentSequenceNumber(S,S=>{T++}).next(()=>T)}forEachOrphanedDocumentSequenceNumber(S,T){return sx.forEach(this.orphanedSequenceNumbers,(R,N)=>this.isPinned(S,R,N).next(S=>S?sx.resolve():T(N)))}removeTargets(S,T,R){return this.persistence.getTargetCache().removeTargets(S,T,R)}removeOrphanedDocuments(S,T){let R=0,N=this.persistence.getRemoteDocumentCache(),O=N.newChangeBuffer();return N.forEachDocumentKey(S,N=>this.isPinned(S,N,T).next(S=>{S||(R++,O.removeEntry(N,sl.min()))})).next(()=>O.apply(S)).next(()=>R)}markPotentiallyOrphaned(S,T){return this.orphanedSequenceNumbers.set(T,S.currentSequenceNumber),sx.resolve()}removeTarget(S,T){let R=T.withSequenceNumber(S.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(S,R)}addReference(S,T,R){return this.orphanedSequenceNumbers.set(R,S.currentSequenceNumber),sx.resolve()}removeReference(S,T,R){return this.orphanedSequenceNumbers.set(R,S.currentSequenceNumber),sx.resolve()}updateLimboDocument(S,T){return this.orphanedSequenceNumbers.set(T,S.currentSequenceNumber),sx.resolve()}documentSize(S){let T=S.key.toString().length;return S.isFoundDocument()&&(T+=lh(S.data.value)),T}isPinned(S,T,R){return sx.or([()=>this.persistence.mutationQueuesContainKey(S,T),()=>this.persistence.getTargetCache().containsKey(S,T),()=>{let S=this.orphanedSequenceNumbers.get(T);return sx.resolve(void 0!==S&&S>R)}])}getCacheSize(S){return this.persistence.getRemoteDocumentCache().getSize(S)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f3{constructor(S){this.serializer=S}createOrUpgrade(S,T,R,N){let O=new sL("createOrUpgrade",T);R<1&&N>=1&&(f9(S),f5(S),gr(S),f8(S));let P=sx.resolve();return R<3&&N>=3&&(0!==R&&(gn(S),gr(S)),P=P.next(()=>gs(O))),R<4&&N>=4&&(0!==R&&(P=P.next(()=>f7(S,O))),P=P.next(()=>{ga(S)})),R<5&&N>=5&&(P=P.next(()=>this.removeAcknowledgedMutations(O))),R<6&&N>=6&&(P=P.next(()=>(gt(S),this.addDocumentGlobal(O)))),R<7&&N>=7&&(P=P.next(()=>this.ensureSequenceNumbers(O))),R<8&&N>=8&&(P=P.next(()=>this.createCollectionParentIndex(S,O))),R<9&&N>=9&&(P=P.next(()=>{gi(S)})),R<10&&N>=10&&(P=P.next(()=>this.rewriteCanonicalIds(O))),R<11&&N>=11&&(P=P.next(()=>{go(S),gl(S)})),R<12&&N>=12&&(P=P.next(()=>{gc(S)})),R<13&&N>=13&&(P=P.next(()=>ge(S)).next(()=>this.rewriteRemoteDocumentCache(S,O)).next(()=>S.deleteObjectStore(s5))),R<14&&N>=14&&(P=P.next(()=>this.runOverlayMigration(S,O))),R<15&&N>=15&&(P=P.next(()=>gu(S))),R<16&&N>=16&&(P=P.next(()=>{T.objectStore(aV).clear()}).next(()=>{T.objectStore(aG).clear()})),R<17&&N>=17&&(P=P.next(()=>{gh(S)})),P}addDocumentGlobal(S){let T=0;return S.store(s5).iterate((S,R)=>{T+=p3(R)}).next(()=>{let R={byteSize:T};return S.store(ay).put(av,R)})}removeAcknowledgedMutations(S){let T=S.store(ae),R=S.store(ar);return T.loadAll().next(T=>sx.forEach(T,T=>{let N=IDBKeyRange.bound([T.userId,oF],[T.userId,T.lastAcknowledgedBatchId]);return R.loadAll(ai,N).next(R=>sx.forEach(R,R=>{iG(R.userId===T.userId);let N=dP(this.serializer,R);return p4(S,T.userId,N).next(()=>{})}))}))}ensureSequenceNumbers(S){let T=S.store(aC),R=S.store(s5);return S.store(aR).get(ak).next(S=>{let N=R=>T.put({targetId:0,path:s4(R),sequenceNumber:S.highestListenSequenceNumber}),O=[];return R.iterate((S,R)=>{let P=new sh(S),M=f6(P);O.push(T.get(M).next(S=>S?sx.resolve():N(P)))}).next(()=>sx.waitFor(O))})}createCollectionParentIndex(S,T){S.createObjectStore(aA,{keyPath:aD});let R=T.store(aA),N=new pK,O=S=>{if(N.add(S)){let T=S.lastSegment(),N=S.popLast();return R.put({collectionId:T,parent:s4(N)})}};return T.store(s5).iterate({keysOnly:!0},(S,T)=>O(new sh(S).popLast())).next(()=>T.store(ac).iterate({keysOnly:!0},([S,T,R],N)=>O(s9(T).popLast())))}rewriteCanonicalIds(S){let T=S.store(ab);return T.iterate((S,R)=>{let N=dM(R),O=dL(this.serializer,N);return T.put(O)})}rewriteRemoteDocumentCache(S,T){let R=T.store(s5),N=[];return R.iterate((S,R)=>{let O=T.store(ah),P=gd(R).path.toArray(),M={prefixPath:P.slice(0,P.length-2),collectionGroup:P[P.length-2],documentId:P[P.length-1],readTime:R.readTime||[0,0],unknownDocument:R.unknownDocument,noDocument:R.noDocument,document:R.document,hasCommittedMutations:!!R.hasCommittedMutations};N.push(O.put(M))}).next(()=>sx.waitFor(N))}runOverlayMigration(S,T){let R=T.store(ar),N=fR(this.serializer),O=new fX(f0.factory,this.serializer.remoteSerializer);return R.loadAll().next(S=>{let R=new Map;return S.forEach(S=>{var T;let N=null!==(T=R.get(S.userId))&&void 0!==T?T:u6();dP(this.serializer,S).keys().forEach(S=>N=N.add(S)),R.set(S.userId,N)}),sx.forEach(R,(S,R)=>{let P=new iP(R),M=d0.forUser(this.serializer,P),L=O.getIndexManager(P);return new fF(N,p6.forUser(P,this.serializer,L,O.referenceDelegate),M,L).recalculateAndSaveOverlaysForDocumentKeys(new ot(T,sX.INVALID),S).next()})})}}function f6(S){return[0,s4(S)]}function f9(S){S.createObjectStore(s7)}function f5(S){S.createObjectStore(ae,{keyPath:at}),S.createObjectStore(ar,{keyPath:an,autoIncrement:!0}).createIndex(ai,as,{unique:!0}),S.createObjectStore(ac)}function f7(S,T){return T.store(ar).loadAll().next(R=>{S.deleteObjectStore(ar),S.createObjectStore(ar,{keyPath:an,autoIncrement:!0}).createIndex(ai,as,{unique:!0});let N=T.store(ar),O=R.map(S=>N.put(S));return sx.waitFor(O)})}function f8(S){S.createObjectStore(s5)}function ge(S){let T=S.createObjectStore(ah,{keyPath:ad});T.createIndex(ap,af),T.createIndex(ag,am)}function gt(S){S.createObjectStore(ay)}function gr(S){S.createObjectStore(aC,{keyPath:aE}).createIndex(aI,a_,{unique:!0}),S.createObjectStore(ab,{keyPath:aS}).createIndex(aT,aw,{unique:!0}),S.createObjectStore(aR)}function gn(S){S.deleteObjectStore(aC),S.deleteObjectStore(ab),S.deleteObjectStore(aR)}function gi(S){S.objectStoreNames.contains("remoteDocumentChanges")&&S.deleteObjectStore("remoteDocumentChanges")}function gs(S){let T=S.store(aR),R={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:sl.min().toTimestamp(),targetCount:0};return T.put(ak,R)}function ga(S){S.createObjectStore(aN,{keyPath:aO})}function go(S){S.createObjectStore(ax,{keyPath:aP})}function gl(S){S.createObjectStore(aM,{keyPath:aL})}function gu(S){S.createObjectStore(aB,{keyPath:aF,autoIncrement:!0}).createIndex(aU,aj,{unique:!1}),S.createObjectStore(aV,{keyPath:az}).createIndex(aq,a$,{unique:!1}),S.createObjectStore(aG,{keyPath:aK}).createIndex(aH,aW,{unique:!1})}function gc(S){let T=S.createObjectStore(aQ,{keyPath:aY});T.createIndex(aJ,aX,{unique:!1}),T.createIndex(aZ,a0,{unique:!1})}function gh(S){S.createObjectStore(a1,{keyPath:a2})}function gd(S){return S.document?new sf(sh.fromString(S.document.name).popFirst(5)):S.noDocument?sf.fromSegments(S.noDocument.path):S.unknownDocument?sf.fromSegments(S.unknownDocument.path):i$()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gp="IndexedDbPersistence",gf=null,gg=5e3,gm=4e3,gy=null,gv=null,gb="firestore_zombie",gS="main";class gT{constructor(S,T,R,N,O,P,M,L,U,V,$=fL){if(this.allowTabSynchronization=S,this.persistenceKey=T,this.clientId=R,this.queue=O,this.window=P,this.document=M,this.sequenceNumberSyncer=U,this.forceOwningTab=V,this.schemaVersion=$,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=S=>Promise.resolve(),!gT.isAvailable())throw new iW(iH.UNIMPLEMENTED,gv);this.referenceDelegate=new fw(this,N),this.dbName=T+gS,this.serializer=new d_(L),this.simpleDb=new sB(this.dbName,this.schemaVersion,new f3(this.serializer)),this.globalsCache=new d3,this.targetCache=new fi(this.referenceDelegate,this.serializer),this.remoteDocumentCache=fR(this.serializer),this.bundleCache=new dJ,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===V&&iV(gp,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new iW(iH.FAILED_PRECONDITION,gy);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",S=>this.targetCache.getHighestSequenceNumber(S))}).then(S=>{this.listenSequence=new sX(S,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(S=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(S)))}setPrimaryStateListener(S){return this.primaryStateListener=async T=>{if(this.started)return S(T)},S(this.isPrimary)}setDatabaseDeletedListener(S){this.simpleDb.setVersionChangeListener(async T=>{null===T.newVersion&&await S()})}setNetworkEnabled(S){this.networkEnabled!==S&&(this.networkEnabled=S,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",S=>gC(S).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(S).next(S=>{S||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(S)).next(T=>this.isPrimary&&!T?this.releasePrimaryLeaseIfHeld(S).next(()=>!1):!!T&&this.acquireOrExtendPrimaryLease(S).next(()=>!0))).catch(S=>{if(sV(S))return ij(gp,"Failed to extend owner lease: ",S),this.isPrimary;if(!this.allowTabSynchronization)throw S;return ij(gp,"Releasing owner lease after error during lease refresh",S),!1}).then(S=>{this.isPrimary!==S&&this.queue.enqueueRetryable(()=>this.primaryStateListener(S)),this.isPrimary=S})}verifyPrimaryLease(S){return gw(S).get(s8).next(S=>sx.resolve(this.isLocalClient(S)))}removeClientMetadata(S){return gC(S).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,gf)){this.lastGarbageCollectionTime=Date.now();let S=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",S=>{let T=or(S,aN);return T.loadAll().next(S=>{let R=this.filterActiveClients(S,gf),N=S.filter(S=>-1===R.indexOf(S));return sx.forEach(N,S=>T.delete(S.clientId)).next(()=>N)})}).catch(()=>[]);if(this.webStorage)for(let T of S)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(T.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",gm,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(S){return!!S&&S.ownerId===this.clientId}canActAsPrimary(S){return this.forceOwningTab?sx.resolve(!0):gw(S).get(s8).next(T=>{if(null!==T&&this.isWithinAge(T.leaseTimestampMs,gg)&&!this.isClientZombied(T.ownerId)){if(this.isLocalClient(T)&&this.networkEnabled)return!0;if(!this.isLocalClient(T)){if(!T.allowTabSynchronization)throw new iW(iH.FAILED_PRECONDITION,gy);return!1}}return!!this.networkEnabled&&!!this.inForeground||gC(S).loadAll().next(S=>void 0===this.filterActiveClients(S,gg).find(S=>{if(this.clientId!==S.clientId){let T=!this.networkEnabled&&S.networkEnabled,R=!this.inForeground&&S.inForeground,N=this.networkEnabled===S.networkEnabled;if(T||R&&N)return!0}return!1}))}).next(S=>(this.isPrimary!==S&&ij(gp,`Client ${S?"is":"is not"} eligible for a primary lease.`),S))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[s7,aN],S=>{let T=new ot(S,sX.INVALID);return this.releasePrimaryLeaseIfHeld(T).next(()=>this.removeClientMetadata(T))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(S,T){return S.filter(S=>this.isWithinAge(S.updateTimeMs,T)&&!this.isClientZombied(S.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",S=>gC(S).loadAll().next(S=>this.filterActiveClients(S,gf).map(S=>S.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(S,T){return p6.forUser(S,this.serializer,T,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(S){return new pQ(S,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(S){return d0.forUser(this.serializer,S)}getBundleCache(){return this.bundleCache}runTransaction(S,T,R){let N;ij(gp,"Starting transaction:",S);let O="readonly"===T?"readonly":"readwrite",P=oe(this.schemaVersion);return this.simpleDb.runTransaction(S,O,P,O=>(N=new ot(O,this.listenSequence?this.listenSequence.next():sX.INVALID),"readwrite-primary"===T)?this.verifyPrimaryLease(N).next(S=>!!S||this.canActAsPrimary(N)).next(T=>{if(!T)throw iV(`Failed to obtain primary lease for action '${S}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new iW(iH.FAILED_PRECONDITION,sD);return R(N)}).next(S=>this.acquireOrExtendPrimaryLease(N).next(()=>S)):this.verifyAllowTabSynchronization(N).next(()=>R(N))).then(S=>(N.raiseOnCommittedEvent(),S))}verifyAllowTabSynchronization(S){return gw(S).get(s8).next(S=>{if(null!==S&&this.isWithinAge(S.leaseTimestampMs,gg)&&!this.isClientZombied(S.ownerId)&&!this.isLocalClient(S)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!S.allowTabSynchronization))throw new iW(iH.FAILED_PRECONDITION,gy)})}acquireOrExtendPrimaryLease(S){let T={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return gw(S).put(s8,T)}static isAvailable(){return sB.isAvailable()}releasePrimaryLeaseIfHeld(S){let T=gw(S);return T.get(s8).next(S=>this.isLocalClient(S)?(ij(gp,"Releasing primary lease."),T.delete(s8)):sx.resolve())}isWithinAge(S,T){let R=Date.now(),N=R-T,O=R;return!(S<N)&&(!(S>O)||(iV(`Detected an update time that is in the future: ${S} > ${O}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var S;"function"==typeof(null===(S=this.window)||void 0===S?void 0:S.addEventListener)&&(this.windowUnloadHandler=()=>{this.markClientZombied();let S=/(?:Version|Mobile)\/1[456]/;isSafari()&&(navigator.appVersion.match(S)||navigator.userAgent.match(S))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(S){var T;try{let R=(null===(T=this.webStorage)||void 0===T?void 0:T.getItem(this.zombiedClientLocalStorageKey(S)))!==null;return ij(gp,`Client '${S}' ${R?"is":"is not"} zombied in LocalStorage`),R}catch(S){return iV(gp,"Failed to get zombied client id.",S),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(S){iV("Failed to set zombie client id.",S)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(S){}}zombiedClientLocalStorageKey(S){return`${gb}_${this.persistenceKey}_${S}`}}function gw(S){return or(S,s7)}function gC(S){return or(S,aN)}function gE(S,T){let R=S.projectId;return S.isDefaultDatabase||(R+="."+S.database),"firestore/"+T+"/"+R+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gI(S,T,R,N,O){T=[...T],(S=[...S]).sort(R),T.sort(R);let P=S.length,M=T.length,L=0,U=0;for(;L<M&&U<P;){let P=R(S[U],T[L]);P<0?O(S[U++]):P>0?N(T[L++]):(L++,U++)}for(;L<M;)N(T[L++]);for(;U<P;)O(S[U++])}function g_(S,T){if(S.length!==T.length)return!1;for(let R=0;R<S.length;++R)if(S[R]!==T[R])return!1;return!0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gk="LocalStore",gR=null;class gA{constructor(S,T,R,N){this.persistence=S,this.queryEngine=T,this.serializer=N,this.targetDataByTarget=new oo(i8),this.targetIdByTarget=new uK(S=>ui(S),uo),this.collectionGroupReadTime=new Map,this.remoteDocuments=S.getRemoteDocumentCache(),this.targetCache=S.getTargetCache(),this.bundleCache=S.getBundleCache(),this.initializeUserComponents(R)}initializeUserComponents(S){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(S),this.indexManager=this.persistence.getIndexManager(S),this.mutationQueue=this.persistence.getMutationQueue(S,this.indexManager),this.localDocuments=new fF(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(S){return this.persistence.runTransaction("Collect garbage","readwrite-primary",T=>S.collect(T,this.targetDataByTarget))}}function gD(S,T,R,N){return new gA(S,T,R,N)}async function gN(S,T){let R=iK(S);return await R.persistence.runTransaction("Handle user change","readonly",S=>{let N;return R.mutationQueue.getAllMutationBatches(S).next(O=>(N=O,R.initializeUserComponents(T),R.mutationQueue.getAllMutationBatches(S))).next(T=>{let O=[],P=[],M=u6();for(let S of N)for(let T of(O.push(S.batchId),S.mutations))M=M.add(T.key);for(let S of T)for(let T of(P.push(S.batchId),S.mutations))M=M.add(T.key);return R.localDocuments.getDocuments(S,M).next(S=>({affectedDocuments:S,removedBatchIds:O,addedBatchIds:P}))})})}function gO(S,T){let R,N;let O=iK(S),P=so.now(),M=T.reduce((S,T)=>S.add(T.key),u6());return O.persistence.runTransaction("Locally write mutations","readwrite",S=>{let L=uW(),U=u6();return O.remoteDocuments.getEntries(S,M).next(S=>{(L=S).forEach((S,T)=>{T.isValidDocument()||(U=U.add(S))})}).next(()=>O.localDocuments.getOverlayedDocuments(S,L)).next(N=>{R=N;let M=[];for(let S of T){let T=ck(S,R.get(S.key).overlayedDocument);null!=T&&M.push(new cO(S.key,T,lN(T.value.mapValue),cT.exists(!0)))}return O.mutationQueue.addMutationBatch(S,P,M,T)}).next(T=>{N=T;let P=T.applyToLocalDocumentSet(R,U);return O.documentOverlayCache.saveOverlays(S,T.batchId,P)})}).then(()=>({batchId:N.batchId,changes:uX(R)}))}function gx(S,T){let R=iK(S);return R.persistence.runTransaction("Acknowledge batch","readwrite-primary",S=>{let N=T.batch.keys(),O=R.remoteDocuments.newChangeBuffer({trackRemovals:!0});return gW(R,S,T,O).next(()=>O.apply(S)).next(()=>R.mutationQueue.performConsistencyCheck(S)).next(()=>R.documentOverlayCache.removeOverlaysForBatchId(S,N,T.batch.batchId)).next(()=>R.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(S,gP(T))).next(()=>R.localDocuments.getDocuments(S,N))})}function gP(S){let T=u6();for(let R=0;R<S.mutationResults.length;++R)S.mutationResults[R].transformResults.length>0&&(T=T.add(S.batch.mutations[R].key));return T}function gM(S,T){let R=iK(S);return R.persistence.runTransaction("Reject batch","readwrite-primary",S=>{let N;return R.mutationQueue.lookupMutationBatch(S,T).next(T=>(iG(null!==T),N=T.keys(),R.mutationQueue.removeMutationBatch(S,T))).next(()=>R.mutationQueue.performConsistencyCheck(S)).next(()=>R.documentOverlayCache.removeOverlaysForBatchId(S,N,T)).next(()=>R.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(S,N)).next(()=>R.localDocuments.getDocuments(S,N))})}function gL(S){let T=iK(S);return T.persistence.runTransaction("Get highest unacknowledged batch id","readonly",S=>T.mutationQueue.getHighestUnacknowledgedBatchId(S))}function gB(S){let T=iK(S);return T.persistence.runTransaction("Get last remote snapshot version","readonly",S=>T.targetCache.getLastRemoteSnapshotVersion(S))}function gF(S,T){let R=iK(S),N=T.snapshotVersion,O=R.targetDataByTarget;return R.persistence.runTransaction("Apply remote event","readwrite-primary",S=>{let P=R.remoteDocuments.newChangeBuffer({trackRemovals:!0});O=R.targetDataByTarget;let M=[];T.targetChanges.forEach((P,L)=>{let U=O.get(L);if(!U)return;M.push(R.targetCache.removeMatchingKeys(S,P.removedDocuments,L).next(()=>R.targetCache.addMatchingKeys(S,P.addedDocuments,L)));let V=U.withSequenceNumber(S.currentSequenceNumber);null!==T.targetMismatches.get(L)?V=V.withResumeToken(ob.EMPTY_BYTE_STRING,sl.min()).withLastLimboFreeSnapshotVersion(sl.min()):P.resumeToken.approximateByteSize()>0&&(V=V.withResumeToken(P.resumeToken,N)),O=O.insert(L,V),gj(U,V,P)&&M.push(R.targetCache.updateTargetData(S,V))});let L=uW(),U=u6();if(T.documentUpdates.forEach(N=>{T.resolvedLimboDocuments.has(N)&&M.push(R.persistence.referenceDelegate.updateLimboDocument(S,N))}),M.push(gU(S,P,T.documentUpdates).next(S=>{L=S.changedDocuments,U=S.existenceChangedKeys})),!N.isEqual(sl.min())){let T=R.targetCache.getLastRemoteSnapshotVersion(S).next(T=>R.targetCache.setTargetsMetadata(S,S.currentSequenceNumber,N));M.push(T)}return sx.waitFor(M).next(()=>P.apply(S)).next(()=>R.localDocuments.getLocalViewOfDocuments(S,L,U)).next(()=>L)}).then(S=>(R.targetDataByTarget=O,S))}function gU(S,T,R){let N=u6(),O=u6();return R.forEach(S=>N=N.add(S)),T.getEntries(S,N).next(S=>{let N=uW();return R.forEach((R,P)=>{let M=S.get(R);P.isFoundDocument()!==M.isFoundDocument()&&(O=O.add(R)),P.isNoDocument()&&P.version.isEqual(sl.min())?(T.removeEntry(R,P.readTime),N=N.insert(R,P)):!M.isValidDocument()||P.version.compareTo(M.version)>0||0===P.version.compareTo(M.version)&&M.hasPendingWrites?(T.addEntry(P),N=N.insert(R,P)):ij(gk,"Ignoring outdated watch update for ",R,". Current version:",M.version," Watch version:",P.version)}),{changedDocuments:N,existenceChangedKeys:O}})}function gj(S,T,R){return!!(0===S.resumeToken.approximateByteSize()||T.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=gR)||R.addedDocuments.size+R.modifiedDocuments.size+R.removedDocuments.size>0}async function gV(S,T){let R=iK(S);try{await R.persistence.runTransaction("notifyLocalViewChanges","readwrite",S=>sx.forEach(T,T=>sx.forEach(T.addedKeys,N=>R.persistence.referenceDelegate.addReference(S,T.targetId,N)).next(()=>sx.forEach(T.removedKeys,N=>R.persistence.referenceDelegate.removeReference(S,T.targetId,N)))))}catch(S){if(sV(S))ij(gk,"Failed to update sequence numbers: "+S);else throw S}for(let S of T){let T=S.targetId;if(!S.fromCache){let S=R.targetDataByTarget.get(T),N=S.snapshotVersion,O=S.withLastLimboFreeSnapshotVersion(N);R.targetDataByTarget=R.targetDataByTarget.insert(T,O)}}}function gz(S,T){let R=iK(S);return R.persistence.runTransaction("Get next mutation batch","readonly",S=>(void 0===T&&(T=oF),R.mutationQueue.getNextMutationBatchAfterBatchId(S,T)))}function gq(S,T){let R=iK(S);return R.persistence.runTransaction("read document","readonly",S=>R.localDocuments.getDocument(S,T))}function g$(S,T){let R=iK(S);return R.persistence.runTransaction("Allocate target","readwrite",S=>{let N;return R.targetCache.getTargetData(S,T).next(O=>O?(N=O,sx.resolve(N)):R.targetCache.allocateTargetId(S).next(O=>(N=new dI(T,O,"TargetPurposeListen",S.currentSequenceNumber),R.targetCache.addTargetData(S,N).next(()=>N))))}).then(S=>{let N=R.targetDataByTarget.get(S.targetId);return(null===N||S.snapshotVersion.compareTo(N.snapshotVersion)>0)&&(R.targetDataByTarget=R.targetDataByTarget.insert(S.targetId,S),R.targetIdByTarget.set(T,S.targetId)),S})}function gG(S,T,R){let N=iK(S),O=N.targetIdByTarget.get(R);return void 0!==O?sx.resolve(N.targetDataByTarget.get(O)):N.targetCache.getTargetData(T,R)}async function gK(S,T,R){let N=iK(S),O=N.targetDataByTarget.get(T),P=R?"readwrite":"readwrite-primary";try{R||await N.persistence.runTransaction("Release target",P,S=>N.persistence.referenceDelegate.removeTarget(S,O))}catch(S){if(sV(S))ij(gk,`Failed to update sequence numbers for target ${T}: ${S}`);else throw S}N.targetDataByTarget=N.targetDataByTarget.remove(T),N.targetIdByTarget.delete(O.target)}function gH(S,T,R){let N=iK(S),O=sl.min(),P=u6();return N.persistence.runTransaction("Execute query","readwrite",S=>gG(N,S,uk(T)).next(T=>{if(T)return O=T.lastLimboFreeSnapshotVersion,N.targetCache.getMatchingKeysForTargetId(S,T.targetId).next(S=>{P=S})}).next(()=>N.queryEngine.getDocumentsMatchingQuery(S,T,R?O:sl.min(),R?P:u6())).next(S=>(g0(N,uq(T),S),{documents:S,remoteKeys:P})))}function gW(S,T,R,N){let O=R.batch,P=O.keys(),M=sx.resolve();return P.forEach(S=>{M=M.next(()=>N.getEntry(T,S)).next(T=>{let P=R.docVersions.get(S);iG(null!==P),0>T.version.compareTo(P)&&(O.applyToRemoteDocument(T,R),T.isValidDocument()&&(T.setReadTime(R.commitVersion),N.addEntry(T)))})}),M.next(()=>S.mutationQueue.removeMutationBatch(T,O))}function gQ(S,T){let R=iK(S),N=iK(R.mutationQueue);return R.persistence.runTransaction("Lookup mutation documents","readonly",S=>N.lookupMutationKeys(S,T).next(T=>T?R.localDocuments.getDocuments(S,T):sx.resolve(null)))}function gY(S,T){iK(iK(S,gA).mutationQueue).removeCachedMutationKeys(T)}function gJ(S){return iK(iK(S,gA).persistence).getActiveClients()}function gX(S,T){let R=iK(S),N=iK(R.targetCache),O=R.targetDataByTarget.get(T);return O?Promise.resolve(O.target):R.persistence.runTransaction("Get target data","readonly",S=>N.getTargetDataForTarget(S,T).next(S=>S?S.target:null))}function gZ(S,T){let R=iK(S),N=R.collectionGroupReadTime.get(T)||sl.min();return R.persistence.runTransaction("Get new document changes","readonly",S=>R.remoteDocuments.getAllFromCollectionGroup(S,T,s_(N,sg),Number.MAX_SAFE_INTEGER)).then(S=>(g0(R,T,S),S))}function g0(S,T,R){let N=S.collectionGroupReadTime.get(T)||sl.min();R.forEach((S,T)=>{T.readTime.compareTo(N)>0&&(N=T.readTime)}),S.collectionGroupReadTime.set(T,N)}function g1(S){return uk(uS(sh.fromString(`__bundle__/docs/${S}`)))}async function g2(S,T,R,N){let O=iK(S),P=u6(),M=uW();for(let S of R){let R=T.toDocumentKey(S.metadata.name);S.document&&(P=P.add(R));let N=T.toMutableDocument(S);N.setReadTime(T.toSnapshotVersion(S.metadata.readTime)),M=M.insert(R,N)}let L=O.remoteDocuments.newChangeBuffer({trackRemovals:!0}),U=await g$(O,g1(N));return O.persistence.runTransaction("Apply bundle documents","readwrite",S=>gU(S,L,M).next(T=>(L.apply(S),T)).next(T=>O.targetCache.removeMatchingKeysForTargetId(S,U.targetId).next(()=>O.targetCache.addMatchingKeys(S,P,U.targetId)).next(()=>O.localDocuments.getLocalViewOfDocuments(S,T.changedDocuments,T.existenceChangedKeys)).next(()=>T.changedDocuments)))}function g4(S,T){let R=iK(S),N=hT(T.createTime);return R.persistence.runTransaction("hasNewerBundle","readonly",S=>R.bundleCache.getBundleMetadata(S,T.id)).then(S=>!!S&&S.createTime.compareTo(N)>=0)}function g3(S,T){let R=iK(S);return R.persistence.runTransaction("Save bundle","readwrite",S=>R.bundleCache.saveBundleMetadata(S,T))}async function g6(S,T,R=u6()){let N=await g$(S,uk(dz(T.bundledQuery))),O=iK(S);return O.persistence.runTransaction("Save named query","readwrite",S=>{let P=hT(T.readTime);if(N.snapshotVersion.compareTo(P)>=0)return O.bundleCache.saveNamedQuery(S,T);let M=N.withResumeToken(ob.EMPTY_BYTE_STRING,P);return O.targetDataByTarget=O.targetDataByTarget.insert(M.targetId,M),O.targetCache.updateTargetData(S,M).next(()=>O.targetCache.removeMatchingKeysForTargetId(S,N.targetId)).next(()=>O.targetCache.addMatchingKeys(S,R,N.targetId)).next(()=>O.bundleCache.saveNamedQuery(S,T))})}function g9(S,T){iK(S).queryEngine.indexAutoCreationEnabled=T}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g5{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(S){this._documentReadCount+=S}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g7=100;function g8(){return e_()?8:sF(eS())>0?6:4}class me{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=g7,this.relativeIndexReadCostPerDocument=g8()}initialize(S,T){this.localDocumentsView=S,this.indexManager=T,this.initialized=!0}getDocumentsMatchingQuery(S,T,R,N){let O={result:null};return this.performQueryUsingIndex(S,T).next(S=>{O.result=S}).next(()=>{if(!O.result)return this.performQueryUsingRemoteKeys(S,T,N,R).next(S=>{O.result=S})}).next(()=>{if(O.result)return;let R=new g5;return this.executeFullCollectionScan(S,T,R).next(N=>{if(O.result=N,this.indexAutoCreationEnabled)return this.createCacheIndexes(S,T,R,N.size)})}).next(()=>O.result)}createCacheIndexes(S,T,R,N){return R.documentReadCount<this.indexAutoCreationMinCollectionSize?(iU()<=V.DEBUG&&ij("QueryEngine","SDK will not create cache indexes for query:",uB(T),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),sx.resolve()):(iU()<=V.DEBUG&&ij("QueryEngine","Query:",uB(T),"scans",R.documentReadCount,"local documents and returns",N,"documents as results."),R.documentReadCount>this.relativeIndexReadCostPerDocument*N)?(iU()<=V.DEBUG&&ij("QueryEngine","The SDK decides to create cache indexes for query:",uB(T),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(S,uk(T))):sx.resolve()}performQueryUsingIndex(S,T){if(uw(T))return sx.resolve(null);let R=uk(T);return this.indexManager.getIndexType(S,R).next(N=>0===N?null:(null!==T.limit&&1===N&&(R=uk(T=uO(T,null,"F"))),this.indexManager.getDocumentsMatchingTarget(S,R).next(N=>{let O=u6(...N);return this.localDocumentsView.getDocuments(S,O).next(N=>this.indexManager.getMinOffset(S,R).next(R=>{let P=this.applyQuery(T,N);return this.needsRefill(T,P,O,R.readTime)?this.performQueryUsingIndex(S,uO(T,null,"F")):this.appendRemainingResults(S,P,T,R)}))})))}performQueryUsingRemoteKeys(S,T,R,N){return uw(T)||N.isEqual(sl.min())?sx.resolve(null):this.localDocumentsView.getDocuments(S,R).next(O=>{let P=this.applyQuery(T,O);return this.needsRefill(T,P,R,N)?sx.resolve(null):(iU()<=V.DEBUG&&ij("QueryEngine","Re-using previous result from %s to execute query: %s",N.toString(),uB(T)),this.appendRemainingResults(S,P,T,s_(N,sg)).next(S=>S))})}applyQuery(S,T){let R=new oh(u$(S));return T.forEach((T,N)=>{uF(S,N)&&(R=R.add(N))}),R}needsRefill(S,T,R,N){if(null===S.limit)return!1;if(R.size!==T.size)return!0;let O="F"===S.limitType?T.last():T.first();return!!O&&(O.hasPendingWrites||O.version.compareTo(N)>0)}executeFullCollectionScan(S,T,R){return iU()<=V.DEBUG&&ij("QueryEngine","Using full collection scan to execute query:",uB(T)),this.localDocumentsView.getDocumentsMatchingQuery(S,T,sR.min(),R)}appendRemainingResults(S,T,R,N){return this.localDocumentsView.getDocumentsMatchingQuery(S,R,N).next(S=>(T.forEach(T=>{S=S.insert(T.key,T)}),S))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mt="firestore_clients";function mr(S,T){return`${mt}_${S}_${T}`}let mn="firestore_mutations";function mi(S,T,R){let N=`${mn}_${S}_${R}`;return T.isAuthenticated()&&(N+=`_${T.uid}`),N}let ma="firestore_targets";function mo(S,T){return`${ma}_${S}_${T}`}let ml="firestore_online_state";function mu(S){return`${ml}_${S}`}let mc="firestore_bundle_loaded_v2";function mh(S){return`${mc}_${S}`}let mp="firestore_sequence_number";function mf(S){return`${mp}_${S}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mg="SharedClientState";class mm{constructor(S,T,R,N){this.user=S,this.batchId=T,this.state=R,this.error=N}static fromWebStorageEntry(S,T,R){let N;let O=JSON.parse(R),P="object"==typeof O&&-1!==["pending","acknowledged","rejected"].indexOf(O.state)&&(void 0===O.error||"object"==typeof O.error);return(P&&O.error&&(P="string"==typeof O.error.message&&"string"==typeof O.error.code)&&(N=new iW(O.error.code,O.error.message)),P)?new mm(S,T,O.state,N):(iV(mg,`Failed to parse mutation state for ID '${T}': ${R}`),null)}toWebStorageJSON(){let S={state:this.state,updateTimeMs:Date.now()};return this.error&&(S.error={code:this.error.code,message:this.error.message}),JSON.stringify(S)}}class my{constructor(S,T,R){this.targetId=S,this.state=T,this.error=R}static fromWebStorageEntry(S,T){let R;let N=JSON.parse(T),O="object"==typeof N&&-1!==["not-current","current","rejected"].indexOf(N.state)&&(void 0===N.error||"object"==typeof N.error);return(O&&N.error&&(O="string"==typeof N.error.message&&"string"==typeof N.error.code)&&(R=new iW(N.error.code,N.error.message)),O)?new my(S,N.state,R):(iV(mg,`Failed to parse target state for ID '${S}': ${T}`),null)}toWebStorageJSON(){let S={state:this.state,updateTimeMs:Date.now()};return this.error&&(S.error={code:this.error.code,message:this.error.message}),JSON.stringify(S)}}class mv{constructor(S,T){this.clientId=S,this.activeTargetIds=T}static fromWebStorageEntry(S,T){let R=JSON.parse(T),N="object"==typeof R&&R.activeTargetIds instanceof Array,O=u5();for(let S=0;N&&S<R.activeTargetIds.length;++S)N=oV(R.activeTargetIds[S]),O=O.add(R.activeTargetIds[S]);return N?new mv(S,O):(iV(mg,`Failed to parse client data for instance '${S}': ${T}`),null)}}class mb{constructor(S,T){this.clientId=S,this.onlineState=T}static fromWebStorageEntry(S){let T=JSON.parse(S);return"object"==typeof T&&-1!==["Unknown","Online","Offline"].indexOf(T.onlineState)&&"string"==typeof T.clientId?new mb(T.clientId,T.onlineState):(iV(mg,`Failed to parse online state: ${S}`),null)}}class mS{constructor(){this.activeTargetIds=u5()}addQueryTarget(S){this.activeTargetIds=this.activeTargetIds.add(S)}removeQueryTarget(S){this.activeTargetIds=this.activeTargetIds.delete(S)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class mT{constructor(S,T,R,N,O){this.window=S,this.queue=T,this.persistenceKey=R,this.localClientId=N,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new oo(i8),this.started=!1,this.earlyEvents=[];let P=R.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=O,this.localClientStorageKey=mr(this.persistenceKey,this.localClientId),this.sequenceNumberKey=mf(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new mS),this.clientStateKeyRe=RegExp(`^${mt}_${P}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${mn}_${P}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${ma}_${P}_(\\d+)$`),this.onlineStateKey=mu(this.persistenceKey),this.bundleLoadedKey=mh(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(S){return!!(S&&S.localStorage)}async start(){for(let S of(await this.syncEngine.getActiveClients())){if(S===this.localClientId)continue;let T=this.getItem(mr(this.persistenceKey,S));if(T){let R=mv.fromWebStorageEntry(S,T);R&&(this.activeClients=this.activeClients.insert(R.clientId,R))}}this.persistClientState();let S=this.storage.getItem(this.onlineStateKey);if(S){let T=this.fromWebStorageOnlineState(S);T&&this.handleOnlineStateEvent(T)}for(let S of this.earlyEvents)this.handleWebStorageEvent(S);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(S){this.setItem(this.sequenceNumberKey,JSON.stringify(S))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(S){let T=!1;return this.activeClients.forEach((R,N)=>{N.activeTargetIds.has(S)&&(T=!0)}),T}addPendingMutation(S){this.persistMutationState(S,"pending")}updateMutationState(S,T,R){this.persistMutationState(S,T,R),this.removeMutationState(S)}addLocalQueryTarget(S,T=!0){let R="not-current";if(this.isActiveQueryTarget(S)){let T=this.storage.getItem(mo(this.persistenceKey,S));if(T){let N=my.fromWebStorageEntry(S,T);N&&(R=N.state)}}return T&&this.localClientState.addQueryTarget(S),this.persistClientState(),R}removeLocalQueryTarget(S){this.localClientState.removeQueryTarget(S),this.persistClientState()}isLocalQueryTarget(S){return this.localClientState.activeTargetIds.has(S)}clearQueryState(S){this.removeItem(mo(this.persistenceKey,S))}updateQueryState(S,T,R){this.persistQueryTargetState(S,T,R)}handleUserChange(S,T,R){T.forEach(S=>{this.removeMutationState(S)}),this.currentUser=S,R.forEach(S=>{this.addPendingMutation(S)})}setOnlineState(S){this.persistOnlineState(S)}notifyBundleLoaded(S){this.persistBundleLoadedState(S)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(S){let T=this.storage.getItem(S);return ij(mg,"READ",S,T),T}setItem(S,T){ij(mg,"SET",S,T),this.storage.setItem(S,T)}removeItem(S){ij(mg,"REMOVE",S),this.storage.removeItem(S)}handleWebStorageEvent(S){let T=S;if(T.storageArea===this.storage){if(ij(mg,"EVENT",T.key,T.newValue),T.key===this.localClientStorageKey){iV("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(async()=>{if(!this.started){this.earlyEvents.push(T);return}if(null!==T.key){if(this.clientStateKeyRe.test(T.key)){if(null!=T.newValue){let S=this.fromWebStorageClientState(T.key,T.newValue);if(S)return this.handleClientStateEvent(S.clientId,S)}else{let S=this.fromWebStorageClientStateKey(T.key);return this.handleClientStateEvent(S,null)}}else if(this.mutationBatchKeyRe.test(T.key)){if(null!==T.newValue){let S=this.fromWebStorageMutationMetadata(T.key,T.newValue);if(S)return this.handleMutationBatchEvent(S)}}else if(this.queryTargetKeyRe.test(T.key)){if(null!==T.newValue){let S=this.fromWebStorageQueryTargetMetadata(T.key,T.newValue);if(S)return this.handleQueryTargetEvent(S)}}else if(T.key===this.onlineStateKey){if(null!==T.newValue){let S=this.fromWebStorageOnlineState(T.newValue);if(S)return this.handleOnlineStateEvent(S)}}else if(T.key===this.sequenceNumberKey){let S=mw(T.newValue);S!==sX.INVALID&&this.sequenceNumberHandler(S)}else if(T.key===this.bundleLoadedKey){let S=this.fromWebStoreBundleLoadedState(T.newValue);await Promise.all(S.map(S=>this.syncEngine.synchronizeWithChangedDocuments(S)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(S,T,R){let N=new mm(this.currentUser,S,T,R),O=mi(this.persistenceKey,this.currentUser,S);this.setItem(O,N.toWebStorageJSON())}removeMutationState(S){let T=mi(this.persistenceKey,this.currentUser,S);this.removeItem(T)}persistOnlineState(S){let T={clientId:this.localClientId,onlineState:S};this.storage.setItem(this.onlineStateKey,JSON.stringify(T))}persistQueryTargetState(S,T,R){let N=mo(this.persistenceKey,S),O=new my(S,T,R);this.setItem(N,O.toWebStorageJSON())}persistBundleLoadedState(S){let T=JSON.stringify(Array.from(S));this.setItem(this.bundleLoadedKey,T)}fromWebStorageClientStateKey(S){let T=this.clientStateKeyRe.exec(S);return T?T[1]:null}fromWebStorageClientState(S,T){let R=this.fromWebStorageClientStateKey(S);return mv.fromWebStorageEntry(R,T)}fromWebStorageMutationMetadata(S,T){let R=this.mutationBatchKeyRe.exec(S),N=Number(R[1]),O=void 0!==R[2]?R[2]:null;return mm.fromWebStorageEntry(new iP(O),N,T)}fromWebStorageQueryTargetMetadata(S,T){let R=Number(this.queryTargetKeyRe.exec(S)[1]);return my.fromWebStorageEntry(R,T)}fromWebStorageOnlineState(S){return mb.fromWebStorageEntry(S)}fromWebStoreBundleLoadedState(S){return JSON.parse(S)}async handleMutationBatchEvent(S){if(S.user.uid!==this.currentUser.uid){ij(mg,`Ignoring mutation for non-active user ${S.user.uid}`);return}return this.syncEngine.applyBatchState(S.batchId,S.state,S.error)}handleQueryTargetEvent(S){return this.syncEngine.applyTargetState(S.targetId,S.state,S.error)}handleClientStateEvent(S,T){let R=T?this.activeClients.insert(S,T):this.activeClients.remove(S),N=this.extractActiveQueryTargets(this.activeClients),O=this.extractActiveQueryTargets(R),P=[],M=[];return O.forEach(S=>{N.has(S)||P.push(S)}),N.forEach(S=>{O.has(S)||M.push(S)}),this.syncEngine.applyActiveTargetsChange(P,M).then(()=>{this.activeClients=R})}handleOnlineStateEvent(S){this.activeClients.get(S.clientId)&&this.onlineStateHandler(S.onlineState)}extractActiveQueryTargets(S){let T=u5();return S.forEach((S,R)=>{T=T.unionWith(R.activeTargetIds)}),T}}function mw(S){let T=sX.INVALID;if(null!=S)try{let R=JSON.parse(S);iG("number"==typeof R),T=R}catch(S){iV(mg,"Failed to read sequence number from WebStorage",S)}return T}class mC{constructor(){this.localState=new mS,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(S){}updateMutationState(S,T,R){}addLocalQueryTarget(S,T=!0){return T&&this.localState.addQueryTarget(S),this.queryState[S]||"not-current"}updateQueryState(S,T,R){this.queryState[S]=T}removeLocalQueryTarget(S){this.localState.removeQueryTarget(S)}isLocalQueryTarget(S){return this.localState.activeTargetIds.has(S)}clearQueryState(S){delete this.queryState[S]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(S){return this.localState.activeTargetIds.has(S)}start(){return this.localState=new mS,Promise.resolve()}handleUserChange(S,T,R){}setOnlineState(S){}shutdown(){}writeSequenceNumber(S){}notifyBundleLoaded(S){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE{addCallback(S){}shutdown(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mI{constructor(S){this.sendFn=S.sendFn,this.closeFn=S.closeFn}onConnected(S){this.wrappedOnConnected=S}onOpen(S){this.wrappedOnOpen=S}onClose(S){this.wrappedOnClose=S}onMessage(S){this.wrappedOnMessage=S}close(){this.closeFn()}send(S){this.sendFn(S)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(S){this.wrappedOnClose(S)}callOnMessage(S){this.wrappedOnMessage(S)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m_=null;function mk(){return 268435456+Math.round(2147483648*Math.random())}function mR(){return null===m_?m_=mk():m_++,"0x"+m_.toString(16)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mA(S){return new Promise((T,R)=>{S((S,N)=>{S?R(S):T(N)})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mD="1.9.15",mN="GrpcConnection",mO=`gl-node/${process.versions.node} fire/${iM} grpc/${mD}`;function mx(S,T,R,N){iG(null===T||"OAuth"===T.type);let O=new iD.SF;return T&&T.headers.forEach((S,T)=>O.set(T,S)),R&&R.headers.forEach((S,T)=>O.set(T,S)),N&&O.set("X-Firebase-GMPID",N),O.set("X-Goog-Api-Client",mO),O.set("Google-Cloud-Resource-Prefix",S),O.set("x-goog-request-params",S),O}class mP{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(S,T){this.databaseInfo=T,this.cachedStub=null,this.firestore=S.google.firestore.v1,this.databasePath=`projects/${T.databaseId.projectId}/databases/${T.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){ij(mN,"Creating Firestore stub.");let S=this.databaseInfo.ssl?iD.K9.createSsl():iD.K9.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,S)}return this.cachedStub}invokeRPC(S,T,R,N,O){let P=mR(),M=this.ensureActiveStub(),L=mx(this.databasePath,N,O,this.databaseInfo.appId),U=Object.assign({database:this.databasePath},R);return mA(T=>(ij(mN,`RPC '${S}' ${P} invoked with request:`,R),M[S](U,L,(R,N)=>{R?(ij(mN,`RPC '${S}' ${P} failed with error:`,R),T(new iW(cW(R.code),R.message))):(ij(mN,`RPC '${S}' ${P} completed with response:`,N),T(void 0,N))})))}invokeStreamingRPC(S,T,R,N,O,P){let M=mR(),L=[],U=new iQ;ij(mN,`RPC '${S}' ${M} invoked (streaming) with request:`,R);let V=this.ensureActiveStub(),$=mx(this.databasePath,N,O,this.databaseInfo.appId),K=Object.assign(Object.assign({},R),{database:this.databasePath}),W=V[S](K,$),Q=!1;return W.on("data",T=>{ij(mN,`RPC ${S} ${M} received result:`,T),L.push(T),void 0!==P&&L.length===P&&(Q=!0,U.resolve(L))}),W.on("end",()=>{ij(mN,`RPC '${S}' ${M} completed.`),Q||(Q=!0,U.resolve(L))}),W.on("error",T=>{ij(mN,`RPC '${S}' ${M} failed with error:`,T);let R=cW(T.code);U.reject(new iW(R,T.message))}),U.promise}openStream(S,T,R){let N=mR(),O=this.ensureActiveStub(),P=mx(this.databasePath,T,R,this.databaseInfo.appId),M=O[S](P),L=!1,U=S=>{L||(L=!0,V.callOnClose(S),M.end())},V=new mI({sendFn:T=>{if(L)ij(mN,`RPC '${S}' stream ${N} not sending because gRPC stream is closed:`,T);else{ij(mN,`RPC '${S}' stream ${N} sending:`,T);try{M.write(T)}catch(S){throw iV("Failure sending:",T),iV("Error:",S),S}}},closeFn:()=>{ij(mN,`RPC '${S}' stream ${N} closed locally via close().`),U()}}),$=!1;return M.on("data",T=>{L||(ij(mN,`RPC '${S}' stream ${N} received:`,T),$||(V.callOnConnected(),$=!0),V.callOnMessage(T))}),M.on("end",()=>{ij(mN,`RPC '${S}' stream ${N} ended.`),U()}),M.on("error",T=>{L||(iz(mN,`RPC '${S}' stream ${N} error. Code:`,T.code,"Message:",T.message),U(new iW(cW(T.code),T.message)))}),ij(mN,`Opening RPC '${S}' stream ${N} to ${this.databaseInfo.host}`),setTimeout(()=>{V.callOnOpen()},0),V}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let mM={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var mL={nested:mM},mB=Object.freeze({__proto__:null,nested:mM,default:mL});/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mF={longs:String,enums:String,defaults:!0,oneofs:!1};function mU(){let S=iN.im(mB,mF);return iD.Rz(S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mj(S){return new mP(mU(),S)}function mV(){return new mE}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mz(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function mq(){return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m$(S){return new hh(S,!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mG="ExponentialBackoff",mK=1e3,mH=1.5,mW=6e4;class mQ{constructor(S,T,R=mK,N=mH,O=mW){this.queue=S,this.timerId=T,this.initialDelayMs=R,this.backoffFactor=N,this.maxDelayMs=O,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(S){this.cancel();let T=Math.floor(this.currentBaseMs+this.jitterDelayMs()),R=Math.max(0,Date.now()-this.lastAttemptTime),N=Math.max(0,T-R);N>0&&ij(mG,`Backing off for ${N} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${T} ms, last attempt: ${R} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,N,()=>(this.lastAttemptTime=Date.now(),S())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}class mY extends null{constructor(S,T,R,N,O,P){super(S,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",T,R,N,P),this.serializer=O}startRpc(S,T){return this.connection.openStream("Listen",S,T)}onFirst(S){return this.onNext(S)}onNext(S){this.backoff.reset();let T=hF(this.serializer,S),R=hj(S);return this.listener.onWatchChange(T,R)}watch(S){let T={};T.database=hA(this.serializer),T.addTarget=h4(this.serializer,S);let R=h1(this.serializer,S);R&&(T.labels=R),this.sendRequest(T)}unwatch(S){let T={};T.database=hA(this.serializer),T.removeTarget=S,this.sendRequest(T)}}class mJ extends null{constructor(S,T,R,N,O,P){super(S,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",T,R,N,P),this.serializer=O}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(S,T){return this.connection.openStream("Write",S,T)}onFirst(S){return iG(!!S.streamToken),this.lastStreamToken=S.streamToken,iG(!S.writeResults||0===S.writeResults.length),this.listener.onHandshakeComplete()}onNext(S){iG(!!S.streamToken),this.lastStreamToken=S.streamToken,this.backoff.reset();let T=hK(S.writeResults,S.commitTime),R=hT(S.commitTime);return this.listener.onMutationResult(R,T)}writeHandshake(){let S={};S.database=hA(this.serializer),this.sendRequest(S)}writeMutations(S){let T={streamToken:this.lastStreamToken,writes:S.map(S=>hV(this.serializer,S))};this.sendRequest(T)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mX{}class mZ extends mX{constructor(S,T,R,N){super(),this.authCredentials=S,this.appCheckCredentials=T,this.connection=R,this.serializer=N,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new iW(iH.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(S,T,R,N){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([O,P])=>this.connection.invokeRPC(S,hC(T,R),N,O,P)).catch(S=>{if("FirebaseError"===S.name)throw S.code===iH.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),S;throw new iW(iH.UNKNOWN,S.toString())})}invokeStreamingRPC(S,T,R,N,O){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([P,M])=>this.connection.invokeStreamingRPC(S,hC(T,R),N,P,M,O)).catch(S=>{if("FirebaseError"===S.name)throw S.code===iH.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),S;throw new iW(iH.UNKNOWN,S.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function m0(S,T,R,N){return new mZ(S,T,R,N)}async function m1(S,T){let R=iK(S),N={writes:T.map(S=>hV(R.serializer,S))};await R.invokeRPC("Commit",R.serializer.databaseId,sh.emptyPath(),N)}async function m2(S,T){let R=iK(S),N={documents:T.map(S=>hI(R.serializer,S))},O=await R.invokeStreamingRPC("BatchGetDocuments",R.serializer.databaseId,sh.emptyPath(),N,T.length),P=new Map;O.forEach(S=>{let T=hB(R.serializer,S);P.set(T.key.toString(),T)});let M=[];return T.forEach(S=>{let T=P.get(S.toString());iG(!!T),M.push(T)}),M}async function m4(S,T,R){var N;let O=iK(S),{request:P,aliasMap:M,parent:L}=hX(O.serializer,uR(T),R);O.connection.shouldResourcePathBeIncludedInRequest||delete P.parent;let U=(await O.invokeStreamingRPC("RunAggregationQuery",O.serializer.databaseId,L,P,1)).filter(S=>!!S.result);iG(1===U.length);let V=null===(N=U[0].result)||void 0===N?void 0:N.aggregateFields;return Object.keys(V).reduce((S,T)=>(S[M[T]]=V[T],S),{})}function m3(S,T,R){let N=iK(S);return N.verifyInitialized(),new mJ(T,N.connection,N.authCredentials,N.appCheckCredentials,N.serializer,R)}function m6(S,T,R){let N=iK(S);return N.verifyInitialized(),new mY(T,N.connection,N.authCredentials,N.appCheckCredentials,N.serializer,R)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let m9="OnlineStateTracker",m5=1,m7=1e4;class m8{constructor(S,T){this.asyncQueue=S,this.onlineStateHandler=T,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",m7,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${m7/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(S){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=m5&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${m5} times. Most recent error: ${S.toString()}`),this.setAndBroadcast("Offline")))}set(S){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===S&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(S)}setAndBroadcast(S){S!==this.state&&(this.state=S,this.onlineStateHandler(S))}logClientOfflineWarningIfNecessary(S){let T=`Could not reach Cloud Firestore backend. ${S}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(iV(T),this.shouldWarnClientIsOffline=!1):ij(m9,T)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ye="RemoteStore",yt=10;class yr{constructor(S,T,R,N,O){this.localStore=S,this.datastore=T,this.asyncQueue=R,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=O,this.connectivityMonitor.addCallback(S=>{R.enqueueAndForget(async()=>{yp(this)&&(ij(ye,"Restarting streams for network reachability change."),await yx(this))})}),this.onlineStateTracker=new m8(R,N)}}function yn(S,T,R,N,O){return new yr(S,T,R,N,O)}async function yi(S){if(yp(S))for(let T of S.onNetworkStatusChange)await T(!0)}async function ys(S){for(let T of S.onNetworkStatusChange)await T(!1)}async function ya(S){let T=iK(S);ij(ye,"RemoteStore shutting down."),T.offlineCauses.add(5),await ys(T),T.connectivityMonitor.shutdown(),T.onlineStateTracker.set("Unknown")}function yo(S,T){let R=iK(S);!R.listenTargets.has(T.targetId)&&(R.listenTargets.set(T.targetId,T),yd(R)?yh(R):yL(R).isOpen()&&yu(R,T))}function yl(S,T){let R=iK(S),N=yL(R);R.listenTargets.delete(T),N.isOpen()&&yc(R,T),0===R.listenTargets.size&&(N.isOpen()?N.markIdle():yp(R)&&R.onlineStateTracker.set("Unknown"))}function yu(S,T){if(S.watchChangeAggregator.recordPendingTargetRequest(T.targetId),T.resumeToken.approximateByteSize()>0||T.snapshotVersion.compareTo(sl.min())>0){let R=S.remoteSyncer.getRemoteKeysForTarget(T.targetId).size;T=T.withExpectedCount(R)}yL(S).watch(T)}function yc(S,T){S.watchChangeAggregator.recordPendingTargetRequest(T),yL(S).unwatch(T)}function yh(S){S.watchChangeAggregator=new hn({getRemoteKeysForTarget:T=>S.remoteSyncer.getRemoteKeysForTarget(T),getTargetDataForTarget:T=>S.listenTargets.get(T)||null,getDatabaseId:()=>S.datastore.serializer.databaseId}),yL(S).start(),S.onlineStateTracker.handleWatchStreamStart()}function yd(S){return yp(S)&&!yL(S).isStarted()&&S.listenTargets.size>0}function yp(S){return 0===iK(S).offlineCauses.size}function yf(S){S.watchChangeAggregator=void 0}async function yg(S){S.onlineStateTracker.set("Online")}async function ym(S){S.listenTargets.forEach((T,R)=>{yu(S,T)})}async function yy(S,T){yf(S),yd(S)?(S.onlineStateTracker.handleWatchStreamFailure(T),yh(S)):S.onlineStateTracker.set("Unknown")}async function yv(S,T,R){if(S.onlineStateTracker.set("Online"),T instanceof he&&2===T.state&&T.cause){try{await yw(S,T)}catch(R){ij(ye,"Failed to remove targets %s: %s ",T.targetIds.join(","),R),await yb(S,R)}return}if(T instanceof c7?S.watchChangeAggregator.handleDocumentChange(T):T instanceof c8?S.watchChangeAggregator.handleExistenceFilter(T):S.watchChangeAggregator.handleTargetChange(T),!R.isEqual(sl.min()))try{let T=await gB(S.localStore);R.compareTo(T)>=0&&await yT(S,R)}catch(T){ij(ye,"Failed to raise snapshot:",T),await yb(S,T)}}async function yb(S,T,R){if(sV(T))S.offlineCauses.add(1),await ys(S),S.onlineStateTracker.set("Offline"),R||(R=()=>gB(S.localStore)),S.asyncQueue.enqueueRetryable(async()=>{ij(ye,"Retrying IndexedDB access"),await R(),S.offlineCauses.delete(1),await yi(S)});else throw T}function yS(S,T){return T().catch(R=>yb(S,R,T))}function yT(S,T){let R=S.watchChangeAggregator.createRemoteEvent(T);return R.targetChanges.forEach((R,N)=>{if(R.resumeToken.approximateByteSize()>0){let O=S.listenTargets.get(N);O&&S.listenTargets.set(N,O.withResumeToken(R.resumeToken,T))}}),R.targetMismatches.forEach((T,R)=>{let N=S.listenTargets.get(T);N&&(S.listenTargets.set(T,N.withResumeToken(ob.EMPTY_BYTE_STRING,N.snapshotVersion)),yc(S,T),yu(S,new dI(N.target,T,R,N.sequenceNumber)))}),S.remoteSyncer.applyRemoteEvent(R)}async function yw(S,T){let R=T.cause;for(let N of T.targetIds)S.listenTargets.has(N)&&(await S.remoteSyncer.rejectListen(N,R),S.listenTargets.delete(N),S.watchChangeAggregator.removeTarget(N))}async function yC(S){let T=iK(S),R=yB(T),N=T.writePipeline.length>0?T.writePipeline[T.writePipeline.length-1].batchId:oF;for(;yE(T);)try{let S=await gz(T.localStore,N);if(null===S){0===T.writePipeline.length&&R.markIdle();break}N=S.batchId,yI(T,S)}catch(S){await yb(T,S)}y_(T)&&yk(T)}function yE(S){return yp(S)&&S.writePipeline.length<yt}function yI(S,T){S.writePipeline.push(T);let R=yB(S);R.isOpen()&&R.handshakeComplete&&R.writeMutations(T.mutations)}function y_(S){return yp(S)&&!yB(S).isStarted()&&S.writePipeline.length>0}function yk(S){yB(S).start()}async function yR(S){yB(S).writeHandshake()}async function yA(S){let T=yB(S);for(let R of S.writePipeline)T.writeMutations(R.mutations)}async function yD(S,T,R){let N=S.writePipeline.shift(),O=cq.from(N,T,R);await yS(S,()=>S.remoteSyncer.applySuccessfulWrite(O)),await yC(S)}async function yN(S,T){T&&yB(S).handshakeComplete&&await yO(S,T),y_(S)&&yk(S)}async function yO(S,T){if(cH(T.code)){let R=S.writePipeline.shift();yB(S).inhibitBackoff(),await yS(S,()=>S.remoteSyncer.rejectFailedWrite(R.batchId,T)),await yC(S)}}async function yx(S){let T=iK(S);T.offlineCauses.add(4),await ys(T),T.onlineStateTracker.set("Unknown"),T.offlineCauses.delete(4),await yi(T)}async function yP(S,T){let R=iK(S);R.asyncQueue.verifyOperationInProgress(),ij(ye,"RemoteStore received new credentials");let N=yp(R);R.offlineCauses.add(3),await ys(R),N&&R.onlineStateTracker.set("Unknown"),await R.remoteSyncer.handleCredentialChange(T),R.offlineCauses.delete(3),await yi(R)}async function yM(S,T){let R=iK(S);T?(R.offlineCauses.delete(2),await yi(R)):T||(R.offlineCauses.add(2),await ys(R),R.onlineStateTracker.set("Unknown"))}function yL(S){return S.watchStream||(S.watchStream=m6(S.datastore,S.asyncQueue,{onConnected:yg.bind(null,S),onOpen:ym.bind(null,S),onClose:yy.bind(null,S),onWatchChange:yv.bind(null,S)}),S.onNetworkStatusChange.push(async T=>{T?(S.watchStream.inhibitBackoff(),yd(S)?yh(S):S.onlineStateTracker.set("Unknown")):(await S.watchStream.stop(),yf(S))})),S.watchStream}function yB(S){return S.writeStream||(S.writeStream=m3(S.datastore,S.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:yR.bind(null,S),onClose:yN.bind(null,S),onHandshakeComplete:yA.bind(null,S),onMutationResult:yD.bind(null,S)}),S.onNetworkStatusChange.push(async T=>{T?(S.writeStream.inhibitBackoff(),await yC(S)):(await S.writeStream.stop(),S.writePipeline.length>0&&(ij(ye,`Stopping write stream with ${S.writePipeline.length} pending writes`),S.writePipeline=[]))})),S.writeStream}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yF="AsyncQueue";class yU{constructor(S,T,R,N,O){this.asyncQueue=S,this.timerId=T,this.targetTimeMs=R,this.op=N,this.removalCallback=O,this.deferred=new iQ,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(S=>{})}get promise(){return this.deferred.promise}static createAndSchedule(S,T,R,N,O){let P=new yU(S,T,Date.now()+R,N,O);return P.start(R),P}start(S){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),S)}skipDelay(){return this.handleDelayElapsed()}cancel(S){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new iW(iH.CANCELLED,"Operation cancelled"+(S?": "+S:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(S=>this.deferred.resolve(S))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function yj(S,T){if(iV(yF,`${T}: ${S}`),sV(S))return new iW(iH.UNAVAILABLE,`${T}: ${S}`);throw S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yV{static emptySet(S){return new yV(S.comparator)}constructor(S){S?this.comparator=(T,R)=>S(T,R)||sf.comparator(T.key,R.key):this.comparator=(S,T)=>sf.comparator(S.key,T.key),this.keyedMap=uY(),this.sortedSet=new oo(this.comparator)}has(S){return null!=this.keyedMap.get(S)}get(S){return this.keyedMap.get(S)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(S){let T=this.keyedMap.get(S);return T?this.sortedSet.indexOf(T):-1}get size(){return this.sortedSet.size}forEach(S){this.sortedSet.inorderTraversal((T,R)=>(S(T),!1))}add(S){let T=this.delete(S.key);return T.copy(T.keyedMap.insert(S.key,S),T.sortedSet.insert(S,null))}delete(S){let T=this.get(S);return T?this.copy(this.keyedMap.remove(S),this.sortedSet.remove(T)):this}isEqual(S){if(!(S instanceof yV)||this.size!==S.size)return!1;let T=this.sortedSet.getIterator(),R=S.sortedSet.getIterator();for(;T.hasNext();){let S=T.getNext().key,N=R.getNext().key;if(!S.isEqual(N))return!1}return!0}toString(){let S=[];return(this.forEach(T=>{S.push(T.toString())}),0===S.length)?"DocumentSet ()":"DocumentSet (\n  "+S.join("  \n")+"\n)"}copy(S,T){let R=new yV;return R.comparator=this.comparator,R.keyedMap=S,R.sortedSet=T,R}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yz{constructor(){this.changeMap=new oo(sf.comparator)}track(S){let T=S.doc.key,R=this.changeMap.get(T);if(!R){this.changeMap=this.changeMap.insert(T,S);return}0!==S.type&&3===R.type?this.changeMap=this.changeMap.insert(T,S):3===S.type&&1!==R.type?this.changeMap=this.changeMap.insert(T,{type:R.type,doc:S.doc}):2===S.type&&2===R.type?this.changeMap=this.changeMap.insert(T,{type:2,doc:S.doc}):2===S.type&&0===R.type?this.changeMap=this.changeMap.insert(T,{type:0,doc:S.doc}):1===S.type&&0===R.type?this.changeMap=this.changeMap.remove(T):1===S.type&&2===R.type?this.changeMap=this.changeMap.insert(T,{type:1,doc:R.doc}):0===S.type&&1===R.type?this.changeMap=this.changeMap.insert(T,{type:2,doc:S.doc}):i$()}getChanges(){let S=[];return this.changeMap.inorderTraversal((T,R)=>{S.push(R)}),S}}class yq{constructor(S,T,R,N,O,P,M,L,U){this.query=S,this.docs=T,this.oldDocs=R,this.docChanges=N,this.mutatedKeys=O,this.fromCache=P,this.syncStateChanged=M,this.excludesMetadataChanges=L,this.hasCachedResults=U}static fromInitialDocuments(S,T,R,N,O){let P=[];return T.forEach(S=>{P.push({type:0,doc:S})}),new yq(S,T,yV.emptySet(T),P,R,N,!0,!1,O)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(S){if(this.fromCache!==S.fromCache||this.hasCachedResults!==S.hasCachedResults||this.syncStateChanged!==S.syncStateChanged||!this.mutatedKeys.isEqual(S.mutatedKeys)||!uM(this.query,S.query)||!this.docs.isEqual(S.docs)||!this.oldDocs.isEqual(S.oldDocs))return!1;let T=this.docChanges,R=S.docChanges;if(T.length!==R.length)return!1;for(let S=0;S<T.length;S++)if(T[S].type!==R[S].type||!T[S].doc.isEqual(R[S].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y${constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(S=>S.listensToRemoteStore())}}function yG(){return new yK}class yK{constructor(){this.queries=yH(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){yZ(this,new iW(iH.ABORTED,"Firestore shutting down"))}}function yH(){return new uK(S=>uL(S),uM)}async function yW(S,T){let R=iK(S),N=3,O=T.query,P=R.queries.get(O);P?!P.hasRemoteListeners()&&T.listensToRemoteStore()&&(N=2):(P=new y$,N=T.listensToRemoteStore()?0:1);try{switch(N){case 0:P.viewSnap=await R.onListen(O,!0);break;case 1:P.viewSnap=await R.onListen(O,!1);break;case 2:await R.onFirstRemoteStoreListen(O)}}catch(R){let S=yj(R,`Initialization of query '${uB(T.query)}' failed`);T.onError(S);return}R.queries.set(O,P),P.listeners.push(T),T.applyOnlineStateChange(R.onlineState),P.viewSnap&&T.onViewSnapshot(P.viewSnap)&&y0(R)}async function yQ(S,T){let R=iK(S),N=T.query,O=3,P=R.queries.get(N);if(P){let S=P.listeners.indexOf(T);S>=0&&(P.listeners.splice(S,1),0===P.listeners.length?O=T.listensToRemoteStore()?0:1:!P.hasRemoteListeners()&&T.listensToRemoteStore()&&(O=2))}switch(O){case 0:return R.queries.delete(N),R.onUnlisten(N,!0);case 1:return R.queries.delete(N),R.onUnlisten(N,!1);case 2:return R.onLastRemoteStoreUnlisten(N);default:return}}function yY(S,T){let R=iK(S),N=!1;for(let S of T){let T=S.query,O=R.queries.get(T);if(O){for(let T of O.listeners)T.onViewSnapshot(S)&&(N=!0);O.viewSnap=S}}N&&y0(R)}function yJ(S,T,R){let N=iK(S),O=N.queries.get(T);if(O)for(let S of O.listeners)S.onError(R);N.queries.delete(T)}function yX(S,T){let R=iK(S);R.onlineState=T;let N=!1;R.queries.forEach((S,R)=>{for(let S of R.listeners)S.applyOnlineStateChange(T)&&(N=!0)}),N&&y0(R)}function yZ(S,T){let R=iK(S),N=R.queries;R.queries=yH(),N.forEach((S,R)=>{for(let S of R.listeners)S.onError(T)})}function y0(S){S.snapshotsInSyncListeners.forEach(S=>{S.next()})}!function(S){S.Default="default",S.Cache="cache"}(Q||(Q={}));class y1{constructor(S,T,R){this.query=S,this.queryObserver=T,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=R||{}}onViewSnapshot(S){if(!this.options.includeMetadataChanges){let T=[];for(let R of S.docChanges)3!==R.type&&T.push(R);S=new yq(S.query,S.docs,S.oldDocs,T,S.mutatedKeys,S.fromCache,S.syncStateChanged,!0,S.hasCachedResults)}let T=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(S)&&(this.queryObserver.next(S),T=!0):this.shouldRaiseInitialEvent(S,this.onlineState)&&(this.raiseInitialEvent(S),T=!0),this.snap=S,T}onError(S){this.queryObserver.error(S)}applyOnlineStateChange(S){this.onlineState=S;let T=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,S)&&(this.raiseInitialEvent(this.snap),T=!0),T}shouldRaiseInitialEvent(S,T){if(!S.fromCache||!this.listensToRemoteStore())return!0;let R="Offline"!==T;return(!this.options.waitForSyncWhenOnline||!R)&&(!S.docs.isEmpty()||S.hasCachedResults||"Offline"===T)}shouldRaiseEvent(S){if(S.docChanges.length>0)return!0;let T=this.snap&&this.snap.hasPendingWrites!==S.hasPendingWrites;return(!!S.syncStateChanged||!!T)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(S){S=yq.fromInitialDocuments(S.query,S.docs,S.mutatedKeys,S.fromCache,S.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(S)}listensToRemoteStore(){return this.options.source!==Q.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y2{constructor(S,T,R,N){this.targetId=S,this.fromCache=T,this.addedKeys=R,this.removedKeys=N}static fromSnapshot(S,T){let R=u6(),N=u6();for(let S of T.docChanges)switch(S.type){case 0:R=R.add(S.doc.key);break;case 1:N=N.add(S.doc.key)}return new y2(S,T.fromCache,R,N)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4{constructor(S){this.serializer=S}toDocumentKey(S){return h_(this.serializer,S)}toMutableDocument(S){return S.metadata.exists?hP(this.serializer,S.document,!1):lO.newNoDocument(this.toDocumentKey(S.metadata.name),this.toSnapshotVersion(S.metadata.readTime))}toSnapshotVersion(S){return hT(S)}}class y3{constructor(S,T,R){this.bundleMetadata=S,this.localStore=T,this.serializer=R,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=y6(S)}addSizedElement(S){this.progress.bytesLoaded+=S.byteLength;let T=this.progress.documentsLoaded;if(S.payload.namedQuery)this.queries.push(S.payload.namedQuery);else if(S.payload.documentMetadata){this.documents.push({metadata:S.payload.documentMetadata}),!S.payload.documentMetadata.exists&&++T;let R=sh.fromString(S.payload.documentMetadata.name);this.collectionGroups.add(R.get(R.length-2))}else S.payload.document&&(this.documents[this.documents.length-1].document=S.payload.document,++T);return T!==this.progress.documentsLoaded?(this.progress.documentsLoaded=T,Object.assign({},this.progress)):null}getQueryDocumentMapping(S){let T=new Map,R=new y4(this.serializer);for(let N of S)if(N.metadata.queries){let S=R.toDocumentKey(N.metadata.name);for(let R of N.metadata.queries){let N=(T.get(R)||u6()).add(S);T.set(R,N)}}return T}async complete(){let S=await g2(this.localStore,new y4(this.serializer),this.documents,this.bundleMetadata.id),T=this.getQueryDocumentMapping(this.documents);for(let S of this.queries)await g6(this.localStore,S,T.get(S.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:S}}}function y6(S){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:S.totalDocuments,totalBytes:S.totalBytes}}function y9(S){return{taskState:"Success",documentsLoaded:S.totalDocuments,bytesLoaded:S.totalBytes,totalDocuments:S.totalDocuments,totalBytes:S.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{constructor(S){this.key=S}}class y7{constructor(S){this.key=S}}class y8{constructor(S,T){this.query=S,this._syncedDocuments=T,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=u6(),this.mutatedKeys=u6(),this.docComparator=u$(S),this.documentSet=new yV(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(S,T){let R=T?T.changeSet:new yz,N=T?T.documentSet:this.documentSet,O=T?T.mutatedKeys:this.mutatedKeys,P=N,M=!1,L="F"===this.query.limitType&&N.size===this.query.limit?N.last():null,U="L"===this.query.limitType&&N.size===this.query.limit?N.first():null;if(S.inorderTraversal((S,T)=>{let V=N.get(S),$=uF(this.query,T)?T:null,K=!!V&&this.mutatedKeys.has(V.key),W=!!$&&($.hasLocalMutations||this.mutatedKeys.has($.key)&&$.hasCommittedMutations),Q=!1;V&&$?V.data.isEqual($.data)?K!==W&&(R.track({type:3,doc:$}),Q=!0):!this.shouldWaitForSyncedDocument(V,$)&&(R.track({type:2,doc:$}),Q=!0,(L&&this.docComparator($,L)>0||U&&0>this.docComparator($,U))&&(M=!0)):!V&&$?(R.track({type:0,doc:$}),Q=!0):V&&!$&&(R.track({type:1,doc:V}),Q=!0,(L||U)&&(M=!0)),Q&&($?(P=P.add($),O=W?O.add(S):O.delete(S)):(P=P.delete(S),O=O.delete(S)))}),null!==this.query.limit)for(;P.size>this.query.limit;){let S="F"===this.query.limitType?P.last():P.first();P=P.delete(S.key),O=O.delete(S.key),R.track({type:1,doc:S})}return{documentSet:P,changeSet:R,needsRefill:M,mutatedKeys:O}}shouldWaitForSyncedDocument(S,T){return S.hasLocalMutations&&T.hasCommittedMutations&&!T.hasLocalMutations}applyChanges(S,T,R,N){let O=this.documentSet;this.documentSet=S.documentSet,this.mutatedKeys=S.mutatedKeys;let P=S.changeSet.getChanges();P.sort((S,T)=>ve(S.type,T.type)||this.docComparator(S.doc,T.doc)),this.applyTargetChange(R),N=null!=N&&N;let M=T&&!N?this.updateLimboDocuments():[],L=0===this.limboDocuments.size&&this.current&&!N?1:0,U=L!==this.syncState;return(this.syncState=L,0!==P.length||U)?{snapshot:new yq(this.query,S.documentSet,O,P,S.mutatedKeys,0===L,U,!1,!!R&&R.resumeToken.approximateByteSize()>0),limboChanges:M}:{limboChanges:M}}applyOnlineStateChange(S){return this.current&&"Offline"===S?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new yz,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(S){return!this._syncedDocuments.has(S)&&!!this.documentSet.has(S)&&!this.documentSet.get(S).hasLocalMutations}applyTargetChange(S){S&&(S.addedDocuments.forEach(S=>this._syncedDocuments=this._syncedDocuments.add(S)),S.modifiedDocuments.forEach(S=>{}),S.removedDocuments.forEach(S=>this._syncedDocuments=this._syncedDocuments.delete(S)),this.current=S.current)}updateLimboDocuments(){if(!this.current)return[];let S=this.limboDocuments;this.limboDocuments=u6(),this.documentSet.forEach(S=>{this.shouldBeInLimbo(S.key)&&(this.limboDocuments=this.limboDocuments.add(S.key))});let T=[];return S.forEach(S=>{this.limboDocuments.has(S)||T.push(new y7(S))}),this.limboDocuments.forEach(R=>{S.has(R)||T.push(new y5(R))}),T}synchronizeWithPersistedState(S){this._syncedDocuments=S.remoteKeys,this.limboDocuments=u6();let T=this.computeDocChanges(S.documents);return this.applyChanges(T,!0)}computeInitialSnapshot(){return yq.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function ve(S,T){let R=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return i$()}};return R(S)-R(T)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vt="SyncEngine";class vr{constructor(S,T,R){this.query=S,this.targetId=T,this.view=R}}class vn{constructor(S){this.key=S,this.receivedDocument=!1}}class vi{constructor(S,T,R,N,O,P){this.localStore=S,this.remoteStore=T,this.eventManager=R,this.sharedClientState=N,this.currentUser=O,this.maxConcurrentLimboResolutions=P,this.syncEngineListener={},this.queryViewsByQuery=new uK(S=>uL(S),uM),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new oo(sf.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new fz,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=fr.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function vs(S,T,R,N,O,P,M){let L=new vi(S,T,R,N,O,P);return M&&(L._isPrimaryClient=!0),L}async function va(S,T,R=!0){let N;let O=vV(S),P=O.queryViewsByQuery.get(T);return P?(O.sharedClientState.addLocalQueryTarget(P.targetId),N=P.view.computeInitialSnapshot()):N=await vl(O,T,R,!0),N}async function vo(S,T){let R=vV(S);await vl(R,T,!0,!1)}async function vl(S,T,R,N){let O;let P=await g$(S.localStore,uk(T)),M=P.targetId,L=S.sharedClientState.addLocalQueryTarget(M,R);return N&&(O=await vu(S,T,M,"current"===L,P.resumeToken)),S.isPrimaryClient&&R&&yo(S.remoteStore,P),O}async function vu(S,T,R,N,O){S.applyDocChanges=(T,R,N)=>vR(S,T,R,N);let P=await gH(S.localStore,T,!0),M=new y8(T,P.remoteKeys),L=M.computeDocChanges(P.documents),U=c5.createSynthesizedTargetChangeForCurrentChange(R,N&&"Offline"!==S.onlineState,O),V=M.applyChanges(L,S.isPrimaryClient,U);vE(S,R,V.limboChanges);let $=new vr(T,R,M);return S.queryViewsByQuery.set(T,$),S.queriesByTarget.has(R)?S.queriesByTarget.get(R).push(T):S.queriesByTarget.set(R,[T]),V.snapshot}async function vc(S,T,R){let N=iK(S),O=N.queryViewsByQuery.get(T),P=N.queriesByTarget.get(O.targetId);if(P.length>1){N.queriesByTarget.set(O.targetId,P.filter(S=>!uM(S,T))),N.queryViewsByQuery.delete(T);return}N.isPrimaryClient?(N.sharedClientState.removeLocalQueryTarget(O.targetId),N.sharedClientState.isActiveQueryTarget(O.targetId)||await gK(N.localStore,O.targetId,!1).then(()=>{N.sharedClientState.clearQueryState(O.targetId),R&&yl(N.remoteStore,O.targetId),vw(N,O.targetId)}).catch(sO)):(vw(N,O.targetId),await gK(N.localStore,O.targetId,!0))}async function vh(S,T){let R=iK(S),N=R.queryViewsByQuery.get(T),O=R.queriesByTarget.get(N.targetId);R.isPrimaryClient&&1===O.length&&(R.sharedClientState.removeLocalQueryTarget(N.targetId),yl(R.remoteStore,N.targetId))}async function vd(S,T,R){let N=vz(S);try{let S=await gO(N.localStore,T);N.sharedClientState.addPendingMutation(S.batchId),vS(N,S.batchId,R),await vk(N,S.changes),await yC(N.remoteStore)}catch(T){let S=yj(T,"Failed to persist write");R.reject(S)}}async function vp(S,T){let R=iK(S);try{let S=await gF(R.localStore,T);T.targetChanges.forEach((S,T)=>{let N=R.activeLimboResolutionsByTarget.get(T);N&&(iG(S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size<=1),S.addedDocuments.size>0?N.receivedDocument=!0:S.modifiedDocuments.size>0?iG(N.receivedDocument):S.removedDocuments.size>0&&(iG(N.receivedDocument),N.receivedDocument=!1))}),await vk(R,S,T)}catch(S){await sO(S)}}function vf(S,T,R){let N=iK(S);if(N.isPrimaryClient&&0===R||!N.isPrimaryClient&&1===R){let S=[];N.queryViewsByQuery.forEach((R,N)=>{let O=N.view.applyOnlineStateChange(T);O.snapshot&&S.push(O.snapshot)}),yX(N.eventManager,T),S.length&&N.syncEngineListener.onWatchChange(S),N.onlineState=T,N.isPrimaryClient&&N.sharedClientState.setOnlineState(T)}}async function vg(S,T,R){let N=iK(S);N.sharedClientState.updateQueryState(T,"rejected",R);let O=N.activeLimboResolutionsByTarget.get(T),P=O&&O.key;if(P){let S=new oo(sf.comparator);S=S.insert(P,lO.newNoDocument(P,sl.min()));let R=u6().add(P),O=new c9(sl.min(),new Map,new oo(i8),S,R);await vp(N,O),N.activeLimboTargetsByKey=N.activeLimboTargetsByKey.remove(P),N.activeLimboResolutionsByTarget.delete(T),v_(N)}else await gK(N.localStore,T,!1).then(()=>vw(N,T,R)).catch(sO)}async function vm(S,T){let R=iK(S),N=T.batch.batchId;try{let S=await gx(R.localStore,T);vT(R,N,null),vv(R,N),R.sharedClientState.updateMutationState(N,"acknowledged"),await vk(R,S)}catch(S){await sO(S)}}async function vy(S,T,R){let N=iK(S);try{let S=await gM(N.localStore,T);vT(N,T,R),vv(N,T),N.sharedClientState.updateMutationState(T,"rejected",R),await vk(N,S)}catch(S){await sO(S)}}function vv(S,T){(S.pendingWritesCallbacks.get(T)||[]).forEach(S=>{S.resolve()}),S.pendingWritesCallbacks.delete(T)}function vb(S,T){S.pendingWritesCallbacks.forEach(S=>{S.forEach(S=>{S.reject(new iW(iH.CANCELLED,T))})}),S.pendingWritesCallbacks.clear()}function vS(S,T,R){let N=S.mutationUserCallbacks[S.currentUser.toKey()];N||(N=new oo(i8)),N=N.insert(T,R),S.mutationUserCallbacks[S.currentUser.toKey()]=N}function vT(S,T,R){let N=iK(S),O=N.mutationUserCallbacks[N.currentUser.toKey()];if(O){let S=O.get(T);S&&(R?S.reject(R):S.resolve(),O=O.remove(T)),N.mutationUserCallbacks[N.currentUser.toKey()]=O}}function vw(S,T,R=null){for(let N of(S.sharedClientState.removeLocalQueryTarget(T),S.queriesByTarget.get(T)))S.queryViewsByQuery.delete(N),R&&S.syncEngineListener.onWatchError(N,R);S.queriesByTarget.delete(T),S.isPrimaryClient&&S.limboDocumentRefs.removeReferencesForId(T).forEach(T=>{S.limboDocumentRefs.containsKey(T)||vC(S,T)})}function vC(S,T){S.enqueuedLimboResolutions.delete(T.path.canonicalString());let R=S.activeLimboTargetsByKey.get(T);null!==R&&(yl(S.remoteStore,R),S.activeLimboTargetsByKey=S.activeLimboTargetsByKey.remove(T),S.activeLimboResolutionsByTarget.delete(R),v_(S))}function vE(S,T,R){for(let N of R)N instanceof y5?(S.limboDocumentRefs.addReference(N.key,T),vI(S,N)):N instanceof y7?(ij(vt,"Document no longer in limbo: "+N.key),S.limboDocumentRefs.removeReference(N.key,T),S.limboDocumentRefs.containsKey(N.key)||vC(S,N.key)):i$()}function vI(S,T){let R=T.key,N=R.path.canonicalString();S.activeLimboTargetsByKey.get(R)||S.enqueuedLimboResolutions.has(N)||(ij(vt,"New document in limbo: "+R),S.enqueuedLimboResolutions.add(N),v_(S))}function v_(S){for(;S.enqueuedLimboResolutions.size>0&&S.activeLimboTargetsByKey.size<S.maxConcurrentLimboResolutions;){let T=S.enqueuedLimboResolutions.values().next().value;S.enqueuedLimboResolutions.delete(T);let R=new sf(sh.fromString(T)),N=S.limboTargetIdGenerator.next();S.activeLimboResolutionsByTarget.set(N,new vn(R)),S.activeLimboTargetsByKey=S.activeLimboTargetsByKey.insert(R,N),yo(S.remoteStore,new dI(uk(uS(R.path)),N,"TargetPurposeLimboResolution",sX.INVALID))}}async function vk(S,T,R){let N=iK(S),O=[],P=[],M=[];N.queryViewsByQuery.isEmpty()||(N.queryViewsByQuery.forEach((S,L)=>{M.push(N.applyDocChanges(L,T,R).then(S=>{var T;if((S||R)&&N.isPrimaryClient){let O=S?!S.fromCache:null===(T=null==R?void 0:R.targetChanges.get(L.targetId))||void 0===T?void 0:T.current;N.sharedClientState.updateQueryState(L.targetId,O?"current":"not-current")}if(S){O.push(S);let T=y2.fromSnapshot(L.targetId,S);P.push(T)}}))}),await Promise.all(M),N.syncEngineListener.onWatchChange(O),await gV(N.localStore,P))}async function vR(S,T,R,N){let O=T.view.computeDocChanges(R);O.needsRefill&&(O=await gH(S.localStore,T.query,!1).then(({documents:S})=>T.view.computeDocChanges(S,O)));let P=N&&N.targetChanges.get(T.targetId),M=N&&null!=N.targetMismatches.get(T.targetId),L=T.view.applyChanges(O,S.isPrimaryClient,P,M);return vE(S,T.targetId,L.limboChanges),L.snapshot}async function vA(S,T){let R=iK(S);if(!R.currentUser.isEqual(T)){ij(vt,"User change. New user:",T.toKey());let S=await gN(R.localStore,T);R.currentUser=T,vb(R,"'waitForPendingWrites' promise is rejected due to a user change."),R.sharedClientState.handleUserChange(T,S.removedBatchIds,S.addedBatchIds),await vk(R,S.affectedDocuments)}}function vD(S,T){let R=iK(S),N=R.activeLimboResolutionsByTarget.get(T);if(N&&N.receivedDocument)return u6().add(N.key);{let S=u6(),N=R.queriesByTarget.get(T);if(!N)return S;for(let T of N){let N=R.queryViewsByQuery.get(T);S=S.unionWith(N.view.syncedDocuments)}return S}}async function vN(S,T){let R=iK(S),N=await gH(R.localStore,T.query,!0),O=T.view.synchronizeWithPersistedState(N);return R.isPrimaryClient&&vE(R,T.targetId,O.limboChanges),O}async function vO(S,T){let R=iK(S);return gZ(R.localStore,T).then(S=>vk(R,S))}async function vx(S,T,R,N){let O=iK(S),P=await gQ(O.localStore,T);if(null===P){ij(vt,"Cannot apply mutation batch with id: "+T);return}"pending"===R?await yC(O.remoteStore):"acknowledged"===R||"rejected"===R?(vT(O,T,N||null),vv(O,T),gY(O.localStore,T)):i$(),await vk(O,P)}async function vP(S,T){let R=iK(S);if(vV(R),vz(R),!0===T&&!0!==R._isPrimaryClient){let S=R.sharedClientState.getAllActiveQueryTargets(),T=await vL(R,S.toArray());for(let S of(R._isPrimaryClient=!0,await yM(R.remoteStore,!0),T))yo(R.remoteStore,S)}else if(!1===T&&!1!==R._isPrimaryClient){let S=[],T=Promise.resolve();R.queriesByTarget.forEach((N,O)=>{R.sharedClientState.isLocalQueryTarget(O)?S.push(O):T=T.then(()=>(vw(R,O),gK(R.localStore,O,!0))),yl(R.remoteStore,O)}),await T,await vL(R,S),vM(R),R._isPrimaryClient=!1,await yM(R.remoteStore,!1)}}function vM(S){let T=iK(S);T.activeLimboResolutionsByTarget.forEach((S,R)=>{yl(T.remoteStore,R)}),T.limboDocumentRefs.removeAllReferences(),T.activeLimboResolutionsByTarget=new Map,T.activeLimboTargetsByKey=new oo(sf.comparator)}async function vL(S,T,R){let N=iK(S),O=[],P=[];for(let S of T){let T;let R=N.queriesByTarget.get(S);if(R&&0!==R.length)for(let S of(T=await g$(N.localStore,uk(R[0])),R)){let T=N.queryViewsByQuery.get(S),R=await vN(N,T);R.snapshot&&P.push(R.snapshot)}else{let R=await gX(N.localStore,S);T=await g$(N.localStore,R),await vu(N,vB(R),S,!1,T.resumeToken)}O.push(T)}return N.syncEngineListener.onWatchChange(P),O}function vB(S){return ub(S.path,S.collectionGroup,S.orderBy,S.filters,S.limit,"F",S.startAt,S.endAt)}function vF(S){return gJ(iK(S).localStore)}async function vU(S,T,R,N){let O=iK(S);if(O._isPrimaryClient){ij(vt,"Ignoring unexpected query state notification.");return}let P=O.queriesByTarget.get(T);if(P&&P.length>0)switch(R){case"current":case"not-current":{let S=await gZ(O.localStore,uq(P[0])),N=c9.createSynthesizedRemoteEventForCurrentChange(T,"current"===R,ob.EMPTY_BYTE_STRING);await vk(O,S,N);break}case"rejected":await gK(O.localStore,T,!0),vw(O,T,N);break;default:i$()}}async function vj(S,T,R){let N=vV(S);if(N._isPrimaryClient){for(let S of T){if(N.queriesByTarget.has(S)&&N.sharedClientState.isActiveQueryTarget(S)){ij(vt,"Adding an already active target "+S);continue}let T=await gX(N.localStore,S),R=await g$(N.localStore,T);await vu(N,vB(T),R.targetId,!1,R.resumeToken),yo(N.remoteStore,R)}for(let S of R)N.queriesByTarget.has(S)&&await gK(N.localStore,S,!1).then(()=>{yl(N.remoteStore,S),vw(N,S)}).catch(sO)}}function vV(S){let T=iK(S);return T.remoteStore.remoteSyncer.applyRemoteEvent=vp.bind(null,T),T.remoteStore.remoteSyncer.getRemoteKeysForTarget=vD.bind(null,T),T.remoteStore.remoteSyncer.rejectListen=vg.bind(null,T),T.syncEngineListener.onWatchChange=yY.bind(null,T.eventManager),T.syncEngineListener.onWatchError=yJ.bind(null,T.eventManager),T}function vz(S){let T=iK(S);return T.remoteStore.remoteSyncer.applySuccessfulWrite=vm.bind(null,T),T.remoteStore.remoteSyncer.rejectFailedWrite=vy.bind(null,T),T}async function vq(S,T,R){try{let N=await T.getMetadata();if(await g4(S.localStore,N))return await T.close(),R._completeWith(y9(N)),Promise.resolve(new Set);R._updateProgress(y6(N));let O=new y3(N,S.localStore,T.serializer),P=await T.nextElement();for(;P;){let S=await O.addSizedElement(P);S&&R._updateProgress(S),P=await T.nextElement()}let M=await O.complete();return await vk(S,M.changedDocs,void 0),await g3(S.localStore,N),R._completeWith(M.progress),Promise.resolve(M.changedCollectionGroups)}catch(S){return iz(vt,`Loading bundle failed with ${S}`),R._failWith(S),Promise.resolve(new Set)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v${constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(S){this.serializer=m$(S.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(S),this.persistence=this.createPersistence(S),await this.persistence.start(),this.localStore=this.createLocalStore(S),this.gcScheduler=this.createGarbageCollectionScheduler(S,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(S,this.localStore)}createGarbageCollectionScheduler(S,T){return null}createIndexBackfillerScheduler(S,T){return null}createLocalStore(S){return gD(this.persistence,new me,S.initialUser,this.serializer)}createPersistence(S){return new fX(f0.factory,this.serializer)}createSharedClientState(S){return new mC}async terminate(){var S,T;null===(S=this.gcScheduler)||void 0===S||S.stop(),null===(T=this.indexBackfillerScheduler)||void 0===T||T.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}v$.provider={build:()=>new v$};class vG extends null{constructor(S){super(),this.cacheSizeBytes=S}createGarbageCollectionScheduler(S,T){return iG(this.persistence.referenceDelegate instanceof f4),new fb(this.persistence.referenceDelegate.garbageCollector,S.asyncQueue,T)}createPersistence(S){let T=void 0!==this.cacheSizeBytes?fd.withCacheSize(this.cacheSizeBytes):fd.DEFAULT;return new fX(S=>f4.factory(S,T),this.serializer)}}class vK extends null{constructor(S,T,R){super(),this.onlineComponentProvider=S,this.cacheSizeBytes=T,this.forceOwnership=R,this.kind="persistent",this.synchronizeTabs=!1}async initialize(S){await super.initialize(S),await this.onlineComponentProvider.initialize(this,S),await vz(this.onlineComponentProvider.syncEngine),await yC(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(S){return gD(this.persistence,new me,S.initialUser,this.serializer)}createGarbageCollectionScheduler(S,T){return new fb(this.persistence.referenceDelegate.garbageCollector,S.asyncQueue,T)}createIndexBackfillerScheduler(S,T){let R=new sJ(T,this.persistence);return new sY(S.asyncQueue,R)}createPersistence(S){let T=gE(S.databaseInfo.databaseId,S.databaseInfo.persistenceKey),R=void 0!==this.cacheSizeBytes?fd.withCacheSize(this.cacheSizeBytes):fd.DEFAULT;return new gT(this.synchronizeTabs,T,S.clientId,R,S.asyncQueue,mz(),mq(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(S){return new mC}}class vH{async initialize(S,T){this.localStore||(this.localStore=S.localStore,this.sharedClientState=S.sharedClientState,this.datastore=this.createDatastore(T),this.remoteStore=this.createRemoteStore(T),this.eventManager=this.createEventManager(T),this.syncEngine=this.createSyncEngine(T,!S.synchronizeTabs),this.sharedClientState.onlineStateHandler=S=>vf(this.syncEngine,S,1),this.remoteStore.remoteSyncer.handleCredentialChange=vA.bind(null,this.syncEngine),await yM(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(S){return yG()}createDatastore(S){let T=m$(S.databaseInfo.databaseId),R=mj(S.databaseInfo);return m0(S.authCredentials,S.appCheckCredentials,R,T)}createRemoteStore(S){return yn(this.localStore,this.datastore,S.asyncQueue,S=>vf(this.syncEngine,S,0),mV())}createSyncEngine(S,T){return vs(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,S.initialUser,S.maxConcurrentLimboResolutions,T)}async terminate(){var S,T;await ya(this.remoteStore),null===(S=this.datastore)||void 0===S||S.terminate(),null===(T=this.eventManager)||void 0===T||T.terminate()}}vH.provider={build:()=>new vH};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vW=10240;function vQ(S,T=vW){let R=0;return{async read(){if(R<S.byteLength){let N={value:S.slice(R,R+T),done:!1};return R+=T,N}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function vY(S,T,R,N){if(!0===T&&!0===N)throw new iW(iH.INVALID_ARGUMENT,`${S} and ${R} cannot be used together.`)}function vJ(S){return"object"==typeof S&&null!==S&&(Object.getPrototypeOf(S)===Object.prototype||null===Object.getPrototypeOf(S))}function vX(S){if(void 0===S)return"undefined";if(null===S)return"null";if("string"==typeof S)return S.length>20&&(S=`${S.substring(0,20)}...`),JSON.stringify(S);if("number"==typeof S||"boolean"==typeof S)return""+S;if("object"==typeof S){if(S instanceof Array)return"an array";{let T=vZ(S);return T?`a custom ${T} object`:"an object"}}if("function"==typeof S)return"a function";return i$()}function vZ(S){return S.constructor?S.constructor.name:null}function v0(S,T){if("_delegate"in S&&(S=S._delegate),!(S instanceof T)){if(T.name===S.constructor.name)throw new iW(iH.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let R=vX(S);throw new iW(iH.INVALID_ARGUMENT,`Expected type '${T.name}', but it was: ${R}`)}}return S}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v4(S,T){if(!(S instanceof Uint8Array))throw new iW(iH.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${vX(S)}`);return vQ(S,T)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v3{constructor(S){this.observer=S,this.muted=!1}next(S){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,S)}error(S){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,S):iV("Uncaught Error in snapshot listener:",S.toString()))}mute(){this.muted=!0}scheduleEvent(S,T){setTimeout(()=>{this.muted||S(T)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v6{constructor(S,T){this.payload=S,this.byteLength=T}isBundleMetadata(){return"metadata"in this.payload}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v9{constructor(S,T){this.reader=S,this.serializer=T,this.metadata=new iQ,this.buffer=new Uint8Array,this.textDecoder=i5(),this.nextElementImpl().then(S=>{S&&S.isBundleMetadata()?this.metadata.resolve(S.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==S?void 0:S.payload)}`))},S=>this.metadata.reject(S))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let S=await this.readLength();if(null===S)return null;let T=this.textDecoder.decode(S),R=Number(T);return isNaN(R)&&this.raiseError(`length string (${T}) is not valid number`),new v6(JSON.parse(await this.readJsonString(R)),S.length+R)}indexOfOpenBracket(){return this.buffer.findIndex(S=>123===S)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let S=this.indexOfOpenBracket();S<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let T=this.buffer.slice(0,S);return this.buffer=this.buffer.slice(S),T}async readJsonString(S){for(;this.buffer.length<S;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let T=this.textDecoder.decode(this.buffer.slice(0,S));return this.buffer=this.buffer.slice(S),T}raiseError(S){throw this.reader.cancel(),Error(`Invalid bundle format: ${S}`)}async pullMoreDataToBuffer(){let S=await this.reader.read();if(!S.done){let T=new Uint8Array(this.buffer.length+S.value.length);T.set(this.buffer),T.set(S.value,this.buffer.length),this.buffer=T}return S.done}}function v5(S,T){return new v9(S,T)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v7{constructor(S){this.datastore=S,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(S){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new iW(iH.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let T=await m2(this.datastore,S);return T.forEach(S=>this.recordVersion(S)),T}set(S,T){this.write(T.toMutation(S,this.precondition(S))),this.writtenDocs.add(S.toString())}update(S,T){try{this.write(T.toMutation(S,this.preconditionForUpdate(S)))}catch(S){this.lastTransactionError=S}this.writtenDocs.add(S.toString())}delete(S){this.write(new cF(S,this.precondition(S))),this.writtenDocs.add(S.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let S=this.readVersions;this.mutations.forEach(T=>{S.delete(T.key.toString())}),S.forEach((S,T)=>{let R=sf.fromPath(T);this.mutations.push(new cV(R,this.precondition(R)))}),await m1(this.datastore,this.mutations),this.committed=!0}recordVersion(S){let T;if(S.isFoundDocument())T=S.version;else if(S.isNoDocument())T=sl.min();else throw i$();let R=this.readVersions.get(S.key.toString());if(R){if(!T.isEqual(R))throw new iW(iH.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(S.key.toString(),T)}precondition(S){let T=this.readVersions.get(S.toString());return this.writtenDocs.has(S.toString())||!T?cT.none():T.isEqual(sl.min())?cT.exists(!1):cT.updateTime(T)}preconditionForUpdate(S){let T=this.readVersions.get(S.toString());if(this.writtenDocs.has(S.toString())||!T)return cT.exists(!0);if(T.isEqual(sl.min()))throw new iW(iH.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return cT.updateTime(T)}write(S){this.ensureCommitNotCalled(),this.mutations.push(S)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let v8="FirestoreClient",be=100,bt=11,br=20,bn=22;class bi{constructor(S,T,R,N,O){this.authCredentials=S,this.appCheckCredentials=T,this.asyncQueue=R,this.databaseInfo=N,this.user=iP.UNAUTHENTICATED,this.clientId=i7.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=O,this.authCredentials.start(R,async S=>{ij(v8,"Received user=",S.uid),await this.authCredentialListener(S),this.user=S}),this.appCheckCredentials.start(R,S=>(ij(v8,"Received new app check token=",S),this.appCheckCredentialListener(S,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:be}}setCredentialChangeListener(S){this.authCredentialListener=S}setAppCheckTokenChangeListener(S){this.appCheckCredentialListener=S}terminate(){this.asyncQueue.enterRestrictedMode();let S=new iQ;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),S.resolve()}catch(R){let T=yj(R,"Failed to shutdown persistence");S.reject(T)}}),S.promise}}async function bs(S,T){S.asyncQueue.verifyOperationInProgress(),ij(v8,"Initializing OfflineComponentProvider");let R=S.configuration;await T.initialize(R);let N=R.initialUser;S.setCredentialChangeListener(async S=>{N.isEqual(S)||(await gN(T.localStore,S),N=S)}),T.persistence.setDatabaseDeletedListener(()=>S.terminate()),S._offlineComponents=T}async function ba(S,T){S.asyncQueue.verifyOperationInProgress();let R=await bl(S);ij(v8,"Initializing OnlineComponentProvider"),await T.initialize(R,S.configuration),S.setCredentialChangeListener(S=>yP(T.remoteStore,S)),S.setAppCheckTokenChangeListener((S,R)=>yP(T.remoteStore,R)),S._onlineComponents=T}function bo(S){return"FirebaseError"===S.name?S.code===iH.FAILED_PRECONDITION||S.code===iH.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&S instanceof DOMException)||S.code===bn||S.code===br||S.code===bt}async function bl(S){if(!S._offlineComponents){if(S._uninitializedComponentsProvider){ij(v8,"Using user provided OfflineComponentProvider");try{await bs(S,S._uninitializedComponentsProvider._offline)}catch(R){let T=R;if(!bo(T))throw T;iz("Error using user provided cache. Falling back to memory cache: "+T),await bs(S,new v$)}}else ij(v8,"Using default OfflineComponentProvider"),await bs(S,new vG(void 0))}return S._offlineComponents}async function bu(S){return S._onlineComponents||(S._uninitializedComponentsProvider?(ij(v8,"Using user provided OnlineComponentProvider"),await ba(S,S._uninitializedComponentsProvider._online)):(ij(v8,"Using default OnlineComponentProvider"),await ba(S,new vH))),S._onlineComponents}function bc(S){return bl(S).then(S=>S.localStore)}function bh(S){return bu(S).then(S=>S.syncEngine)}function bd(S){return bu(S).then(S=>S.datastore)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bp(S,T){return S.timeoutSeconds===T.timeoutSeconds}function bf(S){let T={};return void 0!==S.timeoutSeconds&&(T.timeoutSeconds=S.timeoutSeconds),T}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bg="ComponentProvider",bm=new Map;function by(S){let T=bm.get(S);T&&(ij(bg,"Removing Datastore"),bm.delete(S),T.terminate())}function bv(S,T,R,N){return new oP(S,T,R,N.host,N.ssl,N.experimentalForceLongPolling,N.experimentalAutoDetectLongPolling,bf(N.experimentalLongPollingOptions),N.useFetchStreams)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bb="firestore.googleapis.com",bS=!0,bT=5,bw=30,bC=!0;class bE{constructor(S){var T,R;if(void 0===S.host){if(void 0!==S.ssl)throw new iW(iH.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=bb,this.ssl=bS}else this.host=S.host,this.ssl=null!==(T=S.ssl)&&void 0!==T?T:bS;if(this.credentials=S.credentials,this.ignoreUndefinedProperties=!!S.ignoreUndefinedProperties,this.localCache=S.localCache,void 0===S.cacheSizeBytes)this.cacheSizeBytes=fh;else{if(S.cacheSizeBytes!==fc&&S.cacheSizeBytes<ff)throw new iW(iH.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${ff}`);this.cacheSizeBytes=S.cacheSizeBytes}vY("experimentalForceLongPolling",S.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",S.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!S.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===S.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=bC:this.experimentalAutoDetectLongPolling=!!S.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bf(null!==(R=S.experimentalLongPollingOptions)&&void 0!==R?R:{}),bI(this.experimentalLongPollingOptions),this.useFetchStreams=!!S.useFetchStreams}isEqual(S){return this.host===S.host&&this.ssl===S.ssl&&this.credentials===S.credentials&&this.cacheSizeBytes===S.cacheSizeBytes&&this.experimentalForceLongPolling===S.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===S.experimentalAutoDetectLongPolling&&bp(this.experimentalLongPollingOptions,S.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===S.ignoreUndefinedProperties&&this.useFetchStreams===S.useFetchStreams}}function bI(S){if(void 0!==S.timeoutSeconds){if(isNaN(S.timeoutSeconds))throw new iW(iH.INVALID_ARGUMENT,`invalid long polling timeout: ${S.timeoutSeconds} (must not be NaN)`);if(S.timeoutSeconds<bT)throw new iW(iH.INVALID_ARGUMENT,`invalid long polling timeout: ${S.timeoutSeconds} (minimum allowed value is ${bT})`);if(S.timeoutSeconds>bw)throw new iW(iH.INVALID_ARGUMENT,`invalid long polling timeout: ${S.timeoutSeconds} (maximum allowed value is ${bw})`)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b_{constructor(S,T,R,N){this._authCredentials=S,this._appCheckCredentials=T,this._databaseId=R,this._app=N,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new iW(iH.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(S){if(this._settingsFrozen)throw new iW(iH.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bE(S),this._emulatorOptions=S.emulatorOptions||{},void 0!==S.credentials&&(this._authCredentials=i3(S.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return by(this),Promise.resolve()}}function bk(S,T,R,N={}){var O;let P=(S=v0(S,b_))._getSettings(),M=Object.assign(Object.assign({},P),{emulatorOptions:S._getEmulatorOptions()}),L=`${T}:${R}`;P.host!==bb&&P.host!==L&&iz("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let U=Object.assign(Object.assign({},P),{host:L,ssl:!1,emulatorOptions:N});if(!eM(U,M)&&(S._setSettings(U),N.mockUserToken)){let T,R;if("string"==typeof N.mockUserToken)T=N.mockUserToken,R=iP.MOCK_USER;else{T=eb(N.mockUserToken,null===(O=S._app)||void 0===O?void 0:O.options.projectId);let P=N.mockUserToken.sub||N.mockUserToken.user_id;if(!P)throw new iW(iH.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");R=new iP(P)}S._authCredentials=new iX(new iY(T,R))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR{constructor(S,T,R){this.converter=T,this._query=R,this.type="query",this.firestore=S}withConverter(S){return new bR(this.firestore,S,this._query)}}class bA{constructor(S,T,R){this.converter=T,this._key=R,this.type="document",this.firestore=S}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bD(this.firestore,this.converter,this._key.path.popLast())}withConverter(S){return new bA(this.firestore,S,this._key)}}class bD extends null{constructor(S,T,R){super(S,T,uS(R)),this._path=R,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let S=this._path.popLast();return S.isEmpty()?null:new bA(this.firestore,null,new sf(S))}withConverter(S){return new bD(this.firestore,S,this._path)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bN="AsyncQueue";class bO{constructor(S=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new mQ(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=S}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(S){this.enqueue(S)}enqueueAndForgetEvenWhileRestricted(S){this.verifyNotFailed(),this.enqueueInternal(S)}enterRestrictedMode(S){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=S||!1)}enqueue(S){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let T=new iQ;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(S().then(T.resolve,T.reject),T.promise)).then(()=>T.promise)}enqueueRetryable(S){this.enqueueAndForget(()=>(this.retryableOps.push(S),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(S){if(sV(S))ij(bN,"Operation failed with retryable error: "+S);else throw S}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(S){let T=this.tail.then(()=>(this.operationInProgress=!0,S().catch(S=>{throw this.failure=S,this.operationInProgress=!1,iV("INTERNAL UNHANDLED ERROR: ",bx(S)),S}).then(S=>(this.operationInProgress=!1,S))));return this.tail=T,T}enqueueAfterDelay(S,T,R){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(S)>-1&&(T=0);let N=yU.createAndSchedule(this,S,T,R,S=>this.removeDelayedOperation(S));return this.delayedOperations.push(N),N}verifyNotFailed(){this.failure&&i$()}verifyOperationInProgress(){}async drain(){let S;do S=this.tail,await S;while(S!==this.tail)}containsDelayedOperation(S){for(let T of this.delayedOperations)if(T.timerId===S)return!0;return!1}runAllDelayedOperationsUntil(S){return this.drain().then(()=>{for(let T of(this.delayedOperations.sort((S,T)=>S.targetTimeMs-T.targetTimeMs),this.delayedOperations))if(T.skipDelay(),"all"!==S&&T.timerId===S)break;return this.drain()})}skipDelaysForTimerId(S){this.timerIdsToSkip.push(S)}removeDelayedOperation(S){let T=this.delayedOperations.indexOf(S);this.delayedOperations.splice(T,1)}}function bx(S){let T=S.message||"";return S.stack&&(T=S.stack.includes(S.message)?S.stack:S.message+"\n"+S.stack),T}class bP extends b_{constructor(S,T,R,N){super(S,T,R,N),this.type="firestore",this._queue=new bO,this._persistenceKey=(null==N?void 0:N.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let S=this._firestoreClient.terminate();this._queue=new bO(S),this._firestoreClient=void 0,await S}}}function bM(S,T){let R="object"==typeof S?S:tV(),N="string"==typeof S?S:T||oM,O=tM(R,"firestore").getImmediate({identifier:N});if(!O._initialized){let S=em("firestore");S&&bk(O,...S)}return O}function bL(S){var T,R,N;let O=S._freezeSettings(),P=bv(S._databaseId,(null===(T=S._app)||void 0===T?void 0:T.options.appId)||"",S._persistenceKey,O);!S._componentsProvider&&(null===(R=O.localCache)||void 0===R?void 0:R._offlineComponentProvider)&&(null===(N=O.localCache)||void 0===N?void 0:N._onlineComponentProvider)&&(S._componentsProvider={_offline:O.localCache._offlineComponentProvider,_online:O.localCache._onlineComponentProvider}),S._firestoreClient=new bi(S._authCredentials,S._appCheckCredentials,S._queue,P,S._componentsProvider&&bB(S._componentsProvider))}function bB(S){let T=null==S?void 0:S._online.build();return{_offline:null==S?void 0:S._offline.build(T),_online:T}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bF(S,T=!0){iL(tU),tP(new eY("firestore",(S,{instanceIdentifier:R,options:N})=>{let O=S.getProvider("app").getImmediate(),P=new bP(new iZ(S.getProvider("auth-internal")),new i4(O,S.getProvider("app-check-internal")),oB(O,R),O);return N=Object.assign({useFetchStreams:T},N),P._setSettings(N),P},"PUBLIC").setMultipleInstances(!0)),tz(iO,ix,S),tz(iO,ix,"esm2017")}class bU{constructor(S,T,R){this._userDataWriter=T,this._data=R,this.type="AggregateQuerySnapshot",this.query=S}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bj{constructor(S){this._byteString=S}static fromBase64String(S){try{return new bj(ob.fromBase64String(S))}catch(S){throw new iW(iH.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+S)}}static fromUint8Array(S){return new bj(ob.fromUint8Array(S))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(S){return this._byteString.isEqual(S._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bV{constructor(...S){for(let T=0;T<S.length;++T)if(0===S[T].length)throw new iW(iH.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new sp(S)}isEqual(S){return this._internalPath.isEqual(S._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bz{constructor(S){this._methodName=S}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bq{constructor(S,T){if(!isFinite(S)||S<-90||S>90)throw new iW(iH.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+S);if(!isFinite(T)||T<-180||T>180)throw new iW(iH.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+T);this._lat=S,this._long=T}get latitude(){return this._lat}get longitude(){return this._long}isEqual(S){return this._lat===S._lat&&this._long===S._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(S){return i8(this._lat,S._lat)||i8(this._long,S._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b${constructor(S){this._values=(S||[]).map(S=>S)}toArray(){return this._values.map(S=>S)}isEqual(S){return g_(this._values,S._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bG=/^__.*__$/;class bK{constructor(S,T,R){this.data=S,this.fieldMask=T,this.fieldTransforms=R}toMutation(S,T){return null!==this.fieldMask?new cO(S,this.data,this.fieldMask,T,this.fieldTransforms):new cA(S,this.data,T,this.fieldTransforms)}}class bH{constructor(S,T,R){this.data=S,this.fieldMask=T,this.fieldTransforms=R}toMutation(S,T){return new cO(S,this.data,this.fieldMask,T,this.fieldTransforms)}}function bW(S){switch(S){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw i$()}}class bQ{constructor(S,T,R,N,O,P){this.settings=S,this.databaseId=T,this.serializer=R,this.ignoreUndefinedProperties=N,void 0===O&&this.validatePath(),this.fieldTransforms=O||[],this.fieldMask=P||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(S){return new bQ(Object.assign(Object.assign({},this.settings),S),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(S){var T;let R=null===(T=this.path)||void 0===T?void 0:T.child(S),N=this.contextWith({path:R,arrayElement:!1});return N.validatePathSegment(S),N}childContextForFieldPath(S){var T;let R=null===(T=this.path)||void 0===T?void 0:T.child(S),N=this.contextWith({path:R,arrayElement:!1});return N.validatePath(),N}childContextForArray(S){return this.contextWith({path:void 0,arrayElement:!0})}createError(S){return Sa(S,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(S){return void 0!==this.fieldMask.find(T=>S.isPrefixOf(T))||void 0!==this.fieldTransforms.find(T=>S.isPrefixOf(T.field))}validatePath(){if(this.path)for(let S=0;S<this.path.length;S++)this.validatePathSegment(this.path.get(S))}validatePathSegment(S){if(0===S.length)throw this.createError("Document fields must not be empty");if(bW(this.dataSource)&&bG.test(S))throw this.createError('Document fields cannot begin and end with "__"')}}class bY{constructor(S,T,R){this.databaseId=S,this.ignoreUndefinedProperties=T,this.serializer=R||m$(S)}createContext(S,T,R,N=!1){return new bQ({dataSource:S,methodName:T,targetDoc:R,path:sp.emptyPath(),arrayElement:!1,hasConverter:N},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function bJ(S){let T=S._freezeSettings(),R=m$(S._databaseId);return new bY(S._databaseId,!!T.ignoreUndefinedProperties,R)}class bX extends null{_toFieldTransform(S){if(2===S.dataSource)S.fieldMask.push(S.path);else if(1===S.dataSource)throw S.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw S.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(S){return S instanceof bX}}function bZ(S,T,R){return new bQ({dataSource:3,targetDoc:T.settings.targetDoc,methodName:S._methodName,arrayElement:R},T.databaseId,T.serializer,T.ignoreUndefinedProperties)}class b0 extends null{_toFieldTransform(S){return new cm(S.path,new ca)}isEqual(S){return S instanceof b0}}class b1 extends null{constructor(S,T){super(S),this._elements=T}_toFieldTransform(S){let T=bZ(this,S,!0),R=new co(this._elements.map(S=>b6(S,T)));return new cm(S.path,R)}isEqual(S){return S instanceof b1&&deepEqual(this._elements,S._elements)}}class b2 extends null{constructor(S,T){super(S),this._elements=T}_toFieldTransform(S){let T=bZ(this,S,!0),R=new cu(this._elements.map(S=>b6(S,T)));return new cm(S.path,R)}isEqual(S){return S instanceof b2&&deepEqual(this._elements,S._elements)}}class b4 extends null{constructor(S,T){super(S),this._operand=T}_toFieldTransform(S){let T=new ch(S.serializer,ce(S.serializer,this._operand));return new cm(S.path,T)}isEqual(S){return S instanceof b4&&this._operand===S._operand}}function b3(S,T,R,N=!1){return b6(R,S.createContext(N?4:3,T))}function b6(S,T){if(St(S=getModularInstance(S)))return Sr("Unsupported field value:",T,S),b9(S,T);if(S instanceof bz)return b7(S,T),null;if(void 0===S&&T.ignoreUndefinedProperties)return null;if(T.path&&T.fieldMask.push(T.path),!(S instanceof Array))return b8(S,T);if(T.settings.arrayElement&&4!==T.dataSource)throw T.createError("Nested arrays are not supported");return b5(S,T)}function b9(S,T){let R={};return oa(S)?T.path&&T.path.length>0&&T.fieldMask.push(T.path):oi(S,(S,N)=>{let O=b6(N,T.childContextForField(S));null!=O&&(R[S]=O)}),{mapValue:{fields:R}}}function b5(S,T){let R=[],N=0;for(let O of S){let S=b6(O,T.childContextForArray(N));null==S&&(S={nullValue:"NULL_VALUE"}),R.push(S),N++}return{arrayValue:{values:R}}}function b7(S,T){if(!bW(T.dataSource))throw T.createError(`${S._methodName}() can only be used with update() and set()`);if(!T.path)throw T.createError(`${S._methodName}() is not currently supported inside arrays`);let R=S._toFieldTransform(T);R&&T.fieldTransforms.push(R)}function b8(S,T){if(null===(S=getModularInstance(S)))return{nullValue:"NULL_VALUE"};if("number"==typeof S)return ce(T.serializer,S);if("boolean"==typeof S)return{booleanValue:S};if("string"==typeof S)return{stringValue:S};if(S instanceof Date){let R=so.fromDate(S);return{timestampValue:hg(T.serializer,R)}}if(S instanceof so){let R=new so(S.seconds,1e3*Math.floor(S.nanoseconds/1e3));return{timestampValue:hg(T.serializer,R)}}if(S instanceof bq)return{geoPointValue:{latitude:S.latitude,longitude:S.longitude}};else if(S instanceof bj)return{bytesValue:hy(T.serializer,S._byteString)};else if(S instanceof bA){let R=T.databaseId,N=S.firestore._databaseId;if(!N.isEqual(R))throw T.createError(`Document reference is for database ${N.projectId}/${N.database} but should be for database ${R.projectId}/${R.database}`);return{referenceValue:hw(S.firestore._databaseId||T.databaseId,S._key.path)}}else if(S instanceof b$)return Se(S,T);else throw T.createError(`Unsupported field value: ${vX(S)}`)}function Se(S,T){return{mapValue:{fields:{[oz]:{stringValue:oG},[oK]:{arrayValue:{values:S.toArray().map(S=>{if("number"!=typeof S)throw T.createError("VectorValues must only contain numeric values.");return u7(T.serializer,S)})}}}}}}function St(S){return"object"==typeof S&&null!==S&&!(S instanceof Array)&&!(S instanceof Date)&&!(S instanceof so)&&!(S instanceof bq)&&!(S instanceof bj)&&!(S instanceof bA)&&!(S instanceof bz)&&!(S instanceof b$)}function Sr(S,T,R){if(!St(R)||!vJ(R)){let N=vX(R);if("an object"===N)throw T.createError(S+" a custom object");throw T.createError(S+" "+N)}}function Sn(S,T,R){if((T=getModularInstance(T))instanceof bV)return T._internalPath;if("string"==typeof T)return Ss(S,T);throw Sa("Field path arguments must be of type string or ",S,!1,void 0,R)}let Si=null;function Ss(S,T,R){if(T.search(Si)>=0)throw Sa(`Invalid field path (${T}). Paths must not contain '~', '*', '/', '[', or ']'`,S,!1,void 0,R);try{return new bV(...T.split("."))._internalPath}catch(N){throw Sa(`Invalid field path (${T}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,S,!1,void 0,R)}}function Sa(S,T,R,N,O){let P=N&&!N.isEmpty(),M=void 0!==O,L=`Function ${T}() called with invalid data`;R&&(L+=" (via `toFirestore()`)"),L+=". ";let U="";return(P||M)&&(U+=" (found",P&&(U+=` in field ${N}`),M&&(U+=` in document ${O}`),U+=")"),new iW(iH.INVALID_ARGUMENT,L+S+U)}function So(S,T){return S.some(S=>S.isEqual(T))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(S,T,R,N,O){this._firestore=S,this._userDataWriter=T,this._key=R,this._document=N,this._converter=O}get id(){return this._key.path.lastSegment()}get ref(){return new bA(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let S=new Su(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(S)}}}get(S){if(this._document){let T=this._document.data.field(Sc("DocumentSnapshot.get",S));if(null!==T)return this._userDataWriter.convertValue(T)}}}class Su extends null{data(){return super.data()}}function Sc(S,T){return"string"==typeof T?Ss(S,T):T instanceof bV?T._internalPath:T._delegate._internalPath}class Sh extends null{constructor(S,T,R){super(),this._field=S,this._op=T,this._value=R,this.type="where"}static _create(S,T,R){return new Sh(S,T,R)}_apply(S){let T=this._parse(S);return SI(S._query,T),new bR(S.firestore,S.converter,uD(S._query,T))}_parse(S){let T=bJ(S.firestore);return Sv(S._query,"where",T,S.firestore._databaseId,this._field,this._op,this._value)}}class Sd extends null{constructor(S,T){super(),this.type=S,this._queryConstraints=T}static _create(S,T){return new Sd(S,T)}_parse(S){let T=this._queryConstraints.map(T=>T._parse(S)).filter(S=>S.getFilters().length>0);return 1===T.length?T[0]:lG.create(T,this._getOperator())}_apply(S){let T=this._parse(S);return 0===T.getFilters().length?S:(S_(S._query,T),new bR(S.firestore,S.converter,uD(S._query,T)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Sp extends null{constructor(S,T){super(),this._field=S,this._direction=T,this.type="orderBy"}static _create(S,T){return new Sp(S,T)}_apply(S){let T=Sb(S._query,this._field,this._direction);return new bR(S.firestore,S.converter,uN(S._query,T))}}class Sf extends null{constructor(S,T,R){super(),this.type=S,this._limit=T,this._limitType=R}static _create(S,T,R){return new Sf(S,T,R)}_apply(S){return new bR(S.firestore,S.converter,uO(S._query,this._limit,this._limitType))}}class Sg extends null{constructor(S,T,R){super(),this.type=S,this._docOrFields=T,this._inclusive=R}static _create(S,T,R){return new Sg(S,T,R)}_apply(S){let T=Sy(S,this.type,this._docOrFields,this._inclusive);return new bR(S.firestore,S.converter,ux(S._query,T))}}class Sm extends null{constructor(S,T,R){super(),this.type=S,this._docOrFields=T,this._inclusive=R}static _create(S,T,R){return new Sm(S,T,R)}_apply(S){let T=Sy(S,this.type,this._docOrFields,this._inclusive);return new bR(S.firestore,S.converter,uP(S._query,T))}}function Sy(S,T,R,N){if(R[0]=getModularInstance(R[0]),R[0]instanceof Sl)return SS(S._query,S.firestore._databaseId,T,R[0]._document,N);{let O=bJ(S.firestore);return ST(S._query,S.firestore._databaseId,O,T,R,N)}}function Sv(S,T,R,N,O,P,M){let L;if(O.isKeyField()){if("array-contains"===P||"array-contains-any"===P)throw new iW(iH.INVALID_ARGUMENT,`Invalid Query. You can't perform '${P}' queries on documentId().`);if("in"===P||"not-in"===P){SC(M,P);let T=[];for(let R of M)T.push(Sw(N,S,R));L={arrayValue:{values:T}}}else L=Sw(N,S,M)}else("in"===P||"not-in"===P||"array-contains-any"===P)&&SC(M,P),L=b3(R,T,M,"in"===P||"not-in"===P);return l$.create(O,P,L)}function Sb(S,T,R){if(null!==S.startAt)throw new iW(iH.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==S.endAt)throw new iW(iH.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new lU(T,R)}function SS(S,T,R,N,O){if(!N)throw new iW(iH.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${R}().`);let P=[];for(let R of u_(S))if(R.field.isKeyField())P.push(lf(T,N.key));else{let S=N.data.field(R.field);if(oD(S))throw new iW(iH.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+R.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==S)P.push(S);else{let S=R.field.canonicalString();throw new iW(iH.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${S}' (used as the orderBy) does not exist.`)}}return new lP(P,O)}function ST(S,T,R,N,O,P){let M=S.explicitOrderBy;if(O.length>M.length)throw new iW(iH.INVALID_ARGUMENT,`Too many arguments provided to ${N}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let L=[];for(let P=0;P<O.length;P++){let U=O[P];if(M[P].field.isKeyField()){if("string"!=typeof U)throw new iW(iH.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${N}(), but got a ${typeof U}`);if(!uI(S)&&-1!==U.indexOf("/"))throw new iW(iH.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${N}() must be a plain document ID, but '${U}' contains a slash.`);let R=S.path.child(sh.fromString(U));if(!sf.isDocumentKey(R))throw new iW(iH.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${N}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);let O=new sf(R);L.push(lf(T,O))}else{let S=b3(R,N,U);L.push(S)}}return new lP(L,P)}function Sw(S,T,R){if("string"==typeof(R=getModularInstance(R))){if(""===R)throw new iW(iH.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!uI(T)&&-1!==R.indexOf("/"))throw new iW(iH.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${R}' contains a '/' character.`);let N=T.path.child(sh.fromString(R));if(!sf.isDocumentKey(N))throw new iW(iH.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${N}' is not because it has an odd number of segments (${N.length}).`);return lf(S,new sf(N))}if(R instanceof bA)return lf(S,R._key);throw new iW(iH.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${vX(R)}.`)}function SC(S,T){if(!Array.isArray(S)||0===S.length)throw new iW(iH.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${T.toString()}' filters.`)}function SE(S){switch(S){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function SI(S,T){let R=Sk(S.filters,SE(T.op));if(null!==R){if(R===T.op)throw new iW(iH.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${T.op.toString()}' filter.`);throw new iW(iH.INVALID_ARGUMENT,`Invalid query. You cannot use '${T.op.toString()}' filters with '${R.toString()}' filters.`)}}function S_(S,T){let R=S;for(let S of T.getFlattenedFilters())SI(R,S),R=uD(R,S)}function Sk(S,T){for(let R of S)for(let S of R.getFlattenedFilters())if(T.indexOf(S.op)>=0)return S.op;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(S,T){this.hasPendingWrites=S,this.fromCache=T}isEqual(S){return this.hasPendingWrites===S.hasPendingWrites&&this.fromCache===S.fromCache}}class SA extends null{data(S={}){return super.data(S)}}function SD(S){switch(S){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return i$()}}class SN extends null{constructor(S){super(),this.firestore=S}convertBytes(S){return new bj(S)}convertReference(S){let T=this.convertDocumentKey(S,this.firestore._databaseId);return new bA(this.firestore,null,T)}}class SO{constructor(S){this.forceOwnership=S,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(S){this._onlineComponentProvider=vH.provider,this._offlineComponentProvider={build:T=>new vK(T,null==S?void 0:S.cacheSizeBytes,this.forceOwnership)}}}new WeakMap;class Sx{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return SP||cJ(SP=new Sx),SP}notifyOnExistenceFilterMismatch(S){this.existenceFilterMismatchCallbacksById.forEach(T=>T(S))}onExistenceFilterMismatch(S){let T=Symbol(),R=this.existenceFilterMismatchCallbacksById;return R.set(T,S),()=>R.delete(T)}}let SP=null;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */bF("node");let SM="@firebase/installations",SL="0.6.13",SB=1e4,SF=`w:${SL}`,SU="FIS_v2",Sj="https://firebaseinstallations.googleapis.com/v1",SV=36e5,Sz=new eO("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Sq(S){return S instanceof eN&&S.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S$({projectId:S}){return`${Sj}/projects/${S}/installations`}function SG(S){return{token:S.token,requestStatus:2,expiresIn:SY(S.expiresIn),creationTime:Date.now()}}async function SK(S,T){let R=(await T.json()).error;return Sz.create("request-failed",{requestName:S,serverCode:R.code,serverMessage:R.message,serverStatus:R.status})}function SH({apiKey:S}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":S})}function SW(S,{refreshToken:T}){let R=SH(S);return R.append("Authorization",SJ(T)),R}async function SQ(S){let T=await S();return T.status>=500&&T.status<600?S():T}function SY(S){return Number(S.replace("s","000"))}function SJ(S){return`${SU} ${S}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SX({appConfig:S,heartbeatServiceProvider:T},{fid:R}){let N=S$(S),O=SH(S),P=T.getImmediate({optional:!0});if(P){let S=await P.getHeartbeatsHeader();S&&O.append("x-firebase-client",S)}let M={method:"POST",headers:O,body:JSON.stringify({fid:R,authVersion:SU,appId:S.appId,sdkVersion:SF})},L=await SQ(()=>fetch(N,M));if(L.ok){let S=await L.json();return{fid:S.fid||R,registrationStatus:2,refreshToken:S.refreshToken,authToken:SG(S.authToken)}}throw await SK("Create Installation",L)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SZ(S){return new Promise(T=>{setTimeout(T,S)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S0(S){return btoa(String.fromCharCode(...S)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S1=/^[cdef][\w-]{21}$/,S2="";function S4(){try{let S=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(S),S[0]=112+S[0]%16;let T=S3(S);return S1.test(T)?T:S2}catch(S){return S2}}function S3(S){return S0(S).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S6(S){return`${S.appName}!${S.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S9=new Map;function S5(S,T){let R=S6(S);S7(R,T),S8(R,T)}function S7(S,T){let R=S9.get(S);if(R)for(let S of R)S(T)}function S8(S,T){let R=Tt();R&&R.postMessage({key:S,fid:T}),Tr()}let Te=null;function Tt(){return!Te&&"BroadcastChannel"in self&&((Te=new BroadcastChannel("[Firebase] FID Change")).onmessage=S=>{S7(S.data.key,S.data.fid)}),Te}function Tr(){0===S9.size&&Te&&(Te.close(),Te=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tn="firebase-installations-database",Ti=1,Ts="firebase-installations-store",Ta=null;function To(){return Ta||(Ta=tm(Tn,Ti,{upgrade:(S,T)=>{0===T&&S.createObjectStore(Ts)}})),Ta}async function Tl(S,T){let R=S6(S),N=(await To()).transaction(Ts,"readwrite"),O=N.objectStore(Ts),P=await O.get(R);return await O.put(T,R),await N.done,P&&P.fid===T.fid||S5(S,T.fid),T}async function Tu(S){let T=S6(S),R=(await To()).transaction(Ts,"readwrite");await R.objectStore(Ts).delete(T),await R.done}async function Tc(S,T){let R=S6(S),N=(await To()).transaction(Ts,"readwrite"),O=N.objectStore(Ts),P=await O.get(R),M=T(P);return void 0===M?await O.delete(R):await O.put(M,R),await N.done,M&&(!P||P.fid!==M.fid)&&S5(S,M.fid),M}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Th(S){let T;let R=await Tc(S.appConfig,R=>{let N=Tp(S,Td(R));return T=N.registrationPromise,N.installationEntry});return R.fid===S2?{installationEntry:await T}:{installationEntry:R,registrationPromise:T}}function Td(S){return Ty(S||{fid:S4(),registrationStatus:0})}function Tp(S,T){if(0===T.registrationStatus){if(!navigator.onLine)return{installationEntry:T,registrationPromise:Promise.reject(Sz.create("app-offline"))};let R={fid:T.fid,registrationStatus:1,registrationTime:Date.now()},N=Tf(S,R);return{installationEntry:R,registrationPromise:N}}return 1===T.registrationStatus?{installationEntry:T,registrationPromise:Tg(S)}:{installationEntry:T}}async function Tf(S,T){try{let R=await SX(S,T);return Tl(S.appConfig,R)}catch(R){throw Sq(R)&&409===R.customData.serverCode?await Tu(S.appConfig):await Tl(S.appConfig,{fid:T.fid,registrationStatus:0}),R}}async function Tg(S){let T=await Tm(S.appConfig);for(;1===T.registrationStatus;)await SZ(100),T=await Tm(S.appConfig);if(0===T.registrationStatus){let{installationEntry:T,registrationPromise:R}=await Th(S);return R||T}return T}function Tm(S){return Tc(S,S=>{if(!S)throw Sz.create("installation-not-found");return Ty(S)})}function Ty(S){return Tv(S)?{fid:S.fid,registrationStatus:0}:S}function Tv(S){return 1===S.registrationStatus&&S.registrationTime+SB<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tb({appConfig:S,heartbeatServiceProvider:T},R){let N=TS(S,R),O=SW(S,R),P=T.getImmediate({optional:!0});if(P){let S=await P.getHeartbeatsHeader();S&&O.append("x-firebase-client",S)}let M={method:"POST",headers:O,body:JSON.stringify({installation:{sdkVersion:SF,appId:S.appId}})},L=await SQ(()=>fetch(N,M));if(L.ok)return SG(await L.json());throw await SK("Generate Auth Token",L)}function TS(S,{fid:T}){return`${S$(S)}/${T}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TT(S,T=!1){let R;let N=await Tc(S.appConfig,N=>{if(!TI(N))throw Sz.create("not-registered");let O=N.authToken;if(!T&&T_(O))return N;if(1===O.requestStatus)return R=Tw(S,T),N;{if(!navigator.onLine)throw Sz.create("app-offline");let T=TR(N);return R=TE(S,T),T}});return R?await R:N.authToken}async function Tw(S,T){let R=await TC(S.appConfig);for(;1===R.authToken.requestStatus;)await SZ(100),R=await TC(S.appConfig);let N=R.authToken;return 0===N.requestStatus?TT(S,T):N}function TC(S){return Tc(S,S=>{if(!TI(S))throw Sz.create("not-registered");return TA(S.authToken)?Object.assign(Object.assign({},S),{authToken:{requestStatus:0}}):S})}async function TE(S,T){try{let R=await Tb(S,T),N=Object.assign(Object.assign({},T),{authToken:R});return await Tl(S.appConfig,N),R}catch(R){if(Sq(R)&&(401===R.customData.serverCode||404===R.customData.serverCode))await Tu(S.appConfig);else{let R=Object.assign(Object.assign({},T),{authToken:{requestStatus:0}});await Tl(S.appConfig,R)}throw R}}function TI(S){return void 0!==S&&2===S.registrationStatus}function T_(S){return 2===S.requestStatus&&!Tk(S)}function Tk(S){let T=Date.now();return T<S.creationTime||S.creationTime+S.expiresIn<T+SV}function TR(S){let T={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},S),{authToken:T})}function TA(S){return 1===S.requestStatus&&S.requestTime+SB<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TD(S){let T=S,{installationEntry:R,registrationPromise:N}=await Th(T);return N?N.catch(console.error):TT(T).catch(console.error),R.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TN(S,T=!1){let R=S;return await TO(R),(await TT(R,T)).token}async function TO(S){let{registrationPromise:T}=await Th(S);T&&await T}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tx(S){if(!S||!S.options)throw TP("App Configuration");if(!S.name)throw TP("App Name");for(let T of["projectId","apiKey","appId"])if(!S.options[T])throw TP(T);return{appName:S.name,projectId:S.options.projectId,apiKey:S.options.apiKey,appId:S.options.appId}}function TP(S){return Sz.create("missing-app-config-values",{valueName:S})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TM="installations",TL="installations-internal",TB=S=>{let T=S.getProvider("app").getImmediate(),R=Tx(T),N=tM(T,"heartbeat");return{app:T,appConfig:R,heartbeatServiceProvider:N,_delete:()=>Promise.resolve()}},TF=S=>{let T=tM(S.getProvider("app").getImmediate(),TM).getImmediate();return{getId:()=>TD(T),getToken:S=>TN(T,S)}};(function(){tP(new eY(TM,TB,"PUBLIC")),tP(new eY(TL,TF,"PRIVATE"))})(),tz(SM,SL),tz(SM,SL,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TU="analytics",Tj="firebase_id",TV="origin",Tz=6e4,Tq="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",T$="https://www.googletagmanager.com/gtag/js",TG=new e5("@firebase/analytics"),TK=new eO("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TH(S){if(!S.startsWith(T$)){let T=TK.create("invalid-gtag-resource",{gtagURL:S});return TG.warn(T.message),""}return S}function TW(S){return Promise.all(S.map(S=>S.catch(S=>S)))}function TQ(S,T){let R;return window.trustedTypes&&(R=window.trustedTypes.createPolicy(S,T)),R}function TY(S,T){let R=TQ("firebase-js-sdk-policy",{createScriptURL:TH}),N=document.createElement("script"),O=`${T$}?l=${S}&id=${T}`;N.src=R?null==R?void 0:R.createScriptURL(O):O,N.async=!0,document.head.appendChild(N)}function TJ(S){let T=[];return Array.isArray(window[S])?T=window[S]:window[S]=T,T}async function TX(S,T,R,N,O,P){let M=N[O];try{if(M)await T[M];else{let S=(await TW(R)).find(S=>S.measurementId===O);S&&await T[S.appId]}}catch(S){TG.error(S)}S("config",O,P)}async function TZ(S,T,R,N,O){try{let P=[];if(O&&O.send_to){let S=O.send_to;Array.isArray(S)||(S=[S]);let N=await TW(R);for(let R of S){let S=N.find(S=>S.measurementId===R),O=S&&T[S.appId];if(O)P.push(O);else{P=[];break}}}0===P.length&&(P=Object.values(T)),await Promise.all(P),S("event",N,O||{})}catch(S){TG.error(S)}}function T0(S,T,R,N){return async function(O,...P){try{if("event"===O){let[N,O]=P;await TZ(S,T,R,N,O)}else if("config"===O){let[O,M]=P;await TX(S,T,R,N,O,M)}else if("consent"===O){let[T,R]=P;S("consent",T,R)}else if("get"===O){let[T,R,N]=P;S("get",T,R,N)}else if("set"===O){let[T]=P;S("set",T)}else S(O,...P)}catch(S){TG.error(S)}}}function T1(S,T,R,N,O){let P=function(...S){window[N].push(arguments)};return window[O]&&"function"==typeof window[O]&&(P=window[O]),window[O]=T0(P,S,T,R),{gtagCore:P,wrappedGtag:window[O]}}function T2(S){for(let T of Object.values(window.document.getElementsByTagName("script")))if(T.src&&T.src.includes(T$)&&T.src.includes(S))return T;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let T4=30,T3=1e3;class T6{constructor(S={},T=T3){this.throttleMetadata=S,this.intervalMillis=T}getThrottleMetadata(S){return this.throttleMetadata[S]}setThrottleMetadata(S,T){this.throttleMetadata[S]=T}deleteThrottleMetadata(S){delete this.throttleMetadata[S]}}let T9=new T6;function T5(S){return new Headers({Accept:"application/json","x-goog-api-key":S})}async function T7(S){var T;let{appId:R,apiKey:N}=S,O={method:"GET",headers:T5(N)},P=Tq.replace("{app-id}",R),M=await fetch(P,O);if(200!==M.status&&304!==M.status){let S="";try{let R=await M.json();(null===(T=R.error)||void 0===T?void 0:T.message)&&(S=R.error.message)}catch(S){}throw TK.create("config-fetch-failed",{httpStatus:M.status,responseMessage:S})}return M.json()}async function T8(S,T=T9,R){let{appId:N,apiKey:O,measurementId:P}=S.options;if(!N)throw TK.create("no-app-id");if(!O){if(P)return{measurementId:P,appId:N};throw TK.create("no-api-key")}let M=T.getThrottleMetadata(N)||{backoffCount:0,throttleEndTimeMillis:Date.now()},L=new wn;return setTimeout(async()=>{L.abort()},void 0!==R?R:Tz),we({appId:N,apiKey:O,measurementId:P},M,L,T)}async function we(S,{throttleEndTimeMillis:T,backoffCount:R},N,O=T9){var P;let{appId:M,measurementId:L}=S;try{await wt(N,T)}catch(S){if(L)return TG.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${L} provided in the "measurementId" field in the local Firebase config. [${null==S?void 0:S.message}]`),{appId:M,measurementId:L};throw S}try{let T=await T7(S);return O.deleteThrottleMetadata(M),T}catch($){let T=$;if(!wr(T)){if(O.deleteThrottleMetadata(M),L)return TG.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${L} provided in the "measurementId" field in the local Firebase config. [${null==T?void 0:T.message}]`),{appId:M,measurementId:L};throw $}let U=503===Number(null===(P=null==T?void 0:T.customData)||void 0===P?void 0:P.httpStatus)?eW(R,O.intervalMillis,T4):eW(R,O.intervalMillis),V={throttleEndTimeMillis:Date.now()+U,backoffCount:R+1};return O.setThrottleMetadata(M,V),TG.debug(`Calling attemptFetch again in ${U} millis`),we(S,V,N,O)}}function wt(S,T){return new Promise((R,N)=>{let O=setTimeout(R,Math.max(T-Date.now(),0));S.addEventListener(()=>{clearTimeout(O),N(TK.create("fetch-throttle",{throttleEndTimeMillis:T}))})})}function wr(S){if(!(S instanceof eN)||!S.customData)return!1;let T=Number(S.customData.httpStatus);return 429===T||500===T||503===T||504===T}class wn{constructor(){this.listeners=[]}addEventListener(S){this.listeners.push(S)}abort(){this.listeners.forEach(S=>S())}}async function wi(S,T,R,N,O){if(O&&O.global){S("event",R,N);return}{let O=await T;S("event",R,Object.assign(Object.assign({},N),{send_to:O}))}}function ws(S){M=S}function wa(S){P=S}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wo(){if(!ek())return TG.warn(TK.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await eR()}catch(S){return TG.warn(TK.create("indexeddb-unavailable",{errorInfo:null==S?void 0:S.toString()}).message),!1}return!0}async function wl(S,T,R,N,O,L,U){var V;let $=T8(S);$.then(T=>{R[T.measurementId]=T.appId,S.options.measurementId&&T.measurementId!==S.options.measurementId&&TG.warn(`The measurement ID in the local Firebase config (${S.options.measurementId}) does not match the measurement ID fetched from the server (${T.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(S=>TG.error(S)),T.push($);let K=wo().then(S=>S?N.getId():void 0),[W,Q]=await Promise.all([$,K]);T2(L)||TY(L,W.measurementId),M&&(O("consent","default",M),ws(void 0)),O("js",new Date);let Y=null!==(V=null==U?void 0:U.config)&&void 0!==V?V:{};return Y[TV]="firebase",Y.update=!0,null!=Q&&(Y[Tj]=Q),O("config",W.measurementId,Y),P&&(O("set",P),wa(void 0)),W.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(S){this.app=S}_delete(){return delete wc[this.app.options.appId],Promise.resolve()}}let wc={},wh=[],wd={},wp="dataLayer",wf="gtag",wg=!1;function wm(){let S=[];if(eE()&&S.push("This is a browser extension environment."),eA()||S.push("Cookies are not available."),S.length>0){let T=S.map((S,T)=>`(${T+1}) ${S}`).join(" "),R=TK.create("invalid-analytics-context",{errorInfo:T});TG.warn(R.message)}}function wy(S,T,R){wm();let N=S.options.appId;if(!N)throw TK.create("no-app-id");if(!S.options.apiKey){if(S.options.measurementId)TG.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${S.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw TK.create("no-api-key")}if(null!=wc[N])throw TK.create("already-exists",{id:N});if(!wg){TJ(wp);let{wrappedGtag:S,gtagCore:T}=T1(wc,wh,wd,wp,wf);U=S,L=T,wg=!0}return wc[N]=wl(S,wh,wd,T,L,wp,R),new wu(S)}function wv(S,T,R,N){S=eQ(S),wi(U,wc[S.app.options.appId],T,R,N).catch(S=>TG.error(S))}let wb="@firebase/analytics",wS="0.10.12";(function(){function S(S){try{let T=S.getProvider(TU).getImmediate();return{logEvent:(S,R,N)=>wv(T,S,R,N)}}catch(S){throw TK.create("interop-component-reg-failed",{reason:S})}}tP(new eY(TU,(S,{options:T})=>wy(S.getProvider("app").getImmediate(),S.getProvider("installations-internal").getImmediate(),T),"PUBLIC")),tP(new eY("analytics-internal",S,"PRIVATE")),tz(wb,wS),tz(wb,wS,"esm2017")})();let wT=tj({apiKey:"AIzaSyCdY_iCkdup6lcmdl6v5ltPQEAGIhcBIiU",authDomain:"bdc-tournament.firebaseapp.com",projectId:"bdc-tournament",storageBucket:"bdc-tournament.firebasestorage.app",messagingSenderId:"244860054565",appId:"1:244860054565:web:955b83e62b26ea3afd63cc",measurementId:"G-KX4GT5SC5G"}),ww=iS(wT);bM(wT);var wC=R(1223),wE=R.n(wC);function wI(){let[S,T]=(0,X.useState)(""),[R,N]=(0,X.useState)(""),[O,P]=(0,X.useState)(""),M=(0,Z.useRouter)(),L=async T=>{T.preventDefault(),P("");try{await ia(ww,S,R),M.push("/")}catch(S){P(S.message)}};return Y.jsx("div",{className:"mb-4 items-center justify-center",children:(0,Y.jsxs)("div",{children:[Y.jsx(wE(),{src:"/BDC_logo.svg",alt:"Logo",width:94,height:94,className:"mb-4"}),Y.jsx("h2",{className:"text-3xl font-extrabold mb-2 text-red-700",children:"Welcome Back"}),Y.jsx("p",{className:"mb-6 text-gray-500",children:"Sign in to your account"}),O&&Y.jsx("div",{className:"mb-4 text-red-600",children:O}),(0,Y.jsxs)("form",{onSubmit:L,className:"w-full",children:[Y.jsx("input",{type:"email",className:"w-full mb-4 p-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Email",value:S,onChange:S=>T(S.target.value),required:!0}),Y.jsx("input",{type:"password",className:"w-full mb-2 p-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Password",value:R,onChange:S=>N(S.target.value),required:!0}),(0,Y.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[Y.jsx("a",{href:"#",className:"text-sm text-blue-500 hover:underline",children:"Forgot password?"}),Y.jsx("a",{href:"/register",className:"text-sm text-blue-500 hover:underline",children:"Register"})]}),Y.jsx("button",{type:"submit",className:"w-full bg-red-600 text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition",children:"Login"})]})]})})}},9601:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.addAdminServicesToServer=T.registerAdminService=void 0;let R=[];function N(S,T){R.push({getServiceDefinition:S,getHandlers:T})}function O(S){for(let{getServiceDefinition:T,getHandlers:N}of R)S.addService(T(),N())}T.registerAdminService=N,T.addAdminServicesToServer=O},4934:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.BackoffTimeout=void 0;let R=1e3,N=1.6,O=12e4,P=.2;function M(S,T){return Math.random()*(T-S)+S}class L{constructor(S,T){this.callback=S,this.initialDelay=R,this.multiplier=N,this.maxDelay=O,this.jitter=P,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,T&&(T.initialDelay&&(this.initialDelay=T.initialDelay),T.multiplier&&(this.multiplier=T.multiplier),T.jitter&&(this.jitter=T.jitter),T.maxDelay&&(this.maxDelay=T.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(S){var T,R;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},S),this.hasRef||null===(R=(T=this.timerId).unref)||void 0===R||R.call(T)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let S=Math.min(this.nextDelay*this.multiplier,this.maxDelay),T=S*this.jitter;this.nextDelay=S+M(-T,T)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let S=new Date,T=this.startTime;T.setMilliseconds(T.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),S<T?this.runTimer(T.getTime()-S.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var S,T;this.hasRef=!0,null===(T=(S=this.timerId).ref)||void 0===T||T.call(S)}unref(){var S,T;this.hasRef=!1,null===(T=(S=this.timerId).unref)||void 0===T||T.call(S)}getEndTime(){return this.endTime}}T.BackoffTimeout=L},8931:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.CallCredentials=void 0;let N=R(2252);function O(S){return"getRequestHeaders"in S&&"function"==typeof S.getRequestHeaders}class P{static createFromMetadataGenerator(S){return new L(S)}static createFromGoogleCredential(S){return P.createFromMetadataGenerator((T,R)=>{let P;(P=O(S)?S.getRequestHeaders(T.service_url):new Promise((R,N)=>{S.getRequestMetadata(T.service_url,(S,T)=>{if(S){N(S);return}if(!T){N(Error("Headers not set by metadata plugin"));return}R(T)})})).then(S=>{let T=new N.Metadata;for(let R of Object.keys(S))T.add(R,S[R]);R(null,T)},S=>{R(S)})})}static createEmpty(){return new U}}T.CallCredentials=P;class M extends P{constructor(S){super(),this.creds=S}async generateMetadata(S){let T=new N.Metadata;for(let R of(await Promise.all(this.creds.map(T=>T.generateMetadata(S)))))T.merge(R);return T}compose(S){return new M(this.creds.concat([S]))}_equals(S){return this===S||S instanceof M&&this.creds.every((T,R)=>T._equals(S.creds[R]))}}class L extends P{constructor(S){super(),this.metadataGenerator=S}generateMetadata(S){return new Promise((T,R)=>{this.metadataGenerator(S,(S,N)=>{void 0!==N?T(N):R(S)})})}compose(S){return new M([this,S])}_equals(S){return this===S||S instanceof L&&this.metadataGenerator===S.metadataGenerator}}class U extends P{generateMetadata(S){return Promise.resolve(new N.Metadata)}compose(S){return S}_equals(S){return S instanceof U}}},6749:(S,T)=>{"use strict";function R(S){return void 0!==S.onReceiveMetadata&&1===S.onReceiveMetadata.length}Object.defineProperty(T,"__esModule",{value:!0}),T.InterceptingListenerImpl=T.isInterceptingListener=void 0,T.isInterceptingListener=R;class N{constructor(S,T){this.listener=S,this.nextListener=T,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(S){this.processingMetadata=!0,this.listener.onReceiveMetadata(S,S=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(S),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(S){this.processingMessage=!0,this.listener.onReceiveMessage(S,S=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=S,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(S),this.processPendingStatus())})}onReceiveStatus(S){this.listener.onReceiveStatus(S,S=>{this.processingMetadata||this.processingMessage?this.pendingStatus=S:this.nextListener.onReceiveStatus(S)})}}T.InterceptingListenerImpl=N},8445:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getNextCallNumber=void 0;let R=0;function N(){return R++}T.getNextCallNumber=N},8439:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ClientDuplexStreamImpl=T.ClientWritableStreamImpl=T.ClientReadableStreamImpl=T.ClientUnaryCallImpl=T.callErrorFromStatus=void 0;let N=R(2361),O=R(2781),P=R(2678);function M(S,T){let R=`${S.code} ${P.Status[S.code]}: ${S.details}`,N=Error(R),O=`${N.stack}
for call at
${T}`;return Object.assign(Error(R),S,{stack:O})}T.callErrorFromStatus=M;class L extends N.EventEmitter{constructor(){super()}cancel(){var S;null===(S=this.call)||void 0===S||S.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var S,T;return null!==(T=null===(S=this.call)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:"unknown"}}T.ClientUnaryCallImpl=L;class U extends O.Readable{constructor(S){super({objectMode:!0}),this.deserialize=S}cancel(){var S;null===(S=this.call)||void 0===S||S.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var S,T;return null!==(T=null===(S=this.call)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:"unknown"}_read(S){var T;null===(T=this.call)||void 0===T||T.startRead()}}T.ClientReadableStreamImpl=U;class V extends O.Writable{constructor(S){super({objectMode:!0}),this.serialize=S}cancel(){var S;null===(S=this.call)||void 0===S||S.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var S,T;return null!==(T=null===(S=this.call)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:"unknown"}_write(S,T,R){var N;let O={callback:R},P=Number(T);Number.isNaN(P)||(O.flags=P),null===(N=this.call)||void 0===N||N.sendMessageWithContext(O,S)}_final(S){var T;null===(T=this.call)||void 0===T||T.halfClose(),S()}}T.ClientWritableStreamImpl=V;class $ extends O.Duplex{constructor(S,T){super({objectMode:!0}),this.serialize=S,this.deserialize=T}cancel(){var S;null===(S=this.call)||void 0===S||S.cancelWithStatus(P.Status.CANCELLED,"Cancelled on client")}getPeer(){var S,T;return null!==(T=null===(S=this.call)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:"unknown"}_read(S){var T;null===(T=this.call)||void 0===T||T.startRead()}_write(S,T,R){var N;let O={callback:R},P=Number(T);Number.isNaN(P)||(O.flags=P),null===(N=this.call)||void 0===N||N.sendMessageWithContext(O,S)}_final(S){var T;null===(T=this.call)||void 0===T||T.halfClose(),S()}}T.ClientDuplexStreamImpl=$},2528:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ChannelCredentials=void 0;let N=R(4404),O=R(8931),P=R(3009);function M(S,T){if(S&&!(S instanceof Buffer))throw TypeError(`${T}, if provided, must be a Buffer.`)}class L{constructor(S){this.callCredentials=S||O.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(S,T,R,O){var L;if(M(S,"Root certificate"),M(T,"Private key"),M(R,"Certificate chain"),T&&!R)throw Error("Private key must be given with accompanying certificate chain");if(!T&&R)throw Error("Certificate chain must be given with accompanying private key");return new V((0,N.createSecureContext)({ca:null!==(L=null!=S?S:(0,P.getDefaultRootsData)())&&void 0!==L?L:void 0,key:null!=T?T:void 0,cert:null!=R?R:void 0,ciphers:P.CIPHER_SUITES}),null!=O?O:{})}static createFromSecureContext(S,T){return new V(S,null!=T?T:{})}static createInsecure(){return new U}}T.ChannelCredentials=L;class U extends L{constructor(S){super(S)}compose(S){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(S){return S instanceof U}}class V extends L{constructor(S,T){super(),this.secureContext=S,this.verifyOptions=T,this.connectionOptions={secureContext:S},(null==T?void 0:T.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=T.checkServerIdentity)}compose(S){return new $(this,this.callCredentials.compose(S))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(S){return this===S||S instanceof V&&this.secureContext===S.secureContext&&this.verifyOptions.checkServerIdentity===S.verifyOptions.checkServerIdentity}}class $ extends L{constructor(S,T){super(T),this.channelCredentials=S}compose(S){let T=this.callCredentials.compose(S);return new $(this.channelCredentials,T)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(S){return this===S||S instanceof $&&this.channelCredentials._equals(S.channelCredentials)&&this.callCredentials._equals(S.callCredentials)}}},9387:(S,T)=>{"use strict";function R(S,T){let R=Object.keys(S).sort(),N=Object.keys(T).sort();if(R.length!==N.length)return!1;for(let O=0;O<R.length;O+=1)if(R[O]!==N[O]||S[R[O]]!==T[N[O]])return!1;return!0}Object.defineProperty(T,"__esModule",{value:!0}),T.channelOptionsEqual=T.recognizedOptions=void 0,T.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},T.channelOptionsEqual=R},6261:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ChannelImplementation=void 0;let N=R(2528),O=R(1118);class P{constructor(S,T,R){if("string"!=typeof S)throw TypeError("Channel target must be a string");if(!(T instanceof N.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(R&&"object"!=typeof R)throw TypeError("Channel options must be an object");this.internalChannel=new O.InternalChannel(S,T,R)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(S){return this.internalChannel.getConnectivityState(S)}watchConnectivityState(S,T,R){this.internalChannel.watchConnectivityState(S,T,R)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(S,T,R,N,O){if("string"!=typeof S)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof T||T instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(S,T,R,N,O)}}T.ChannelImplementation=P},5993:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=T.getChannelzServiceDefinition=T.getChannelzHandlers=T.unregisterChannelzRef=T.registerChannelzSocket=T.registerChannelzServer=T.registerChannelzSubchannel=T.registerChannelzChannel=T.ChannelzCallTracker=T.ChannelzChildrenTracker=T.ChannelzTrace=void 0;let N=R(1808),O=R(3955),P=R(2678),M=R(3906),L=R(9601),U=R(5085);function V(S){return{channel_id:S.id,name:S.name}}function $(S){return{subchannel_id:S.id,name:S.name}}function K(S){return{server_id:S.id}}function W(S){return{socket_id:S.id,name:S.name}}let Q=32;class Y{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(S,T,R){let N=new Date;this.events.push({description:T,severity:S,timestamp:N,childChannel:(null==R?void 0:R.kind)==="channel"?R:void 0,childSubchannel:(null==R?void 0:R.kind)==="subchannel"?R:void 0}),this.events.length>=2*Q&&(this.events=this.events.slice(Q)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:em(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(S=>({description:S.description,severity:S.severity,timestamp:em(S.timestamp),channel_ref:S.childChannel?V(S.childChannel):null,subchannel_ref:S.childSubchannel?$(S.childSubchannel):null}))}}}T.ChannelzTrace=Y;class X{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(S){var T,R,N;switch(S.kind){case"channel":{let R=null!==(T=this.channelChildren.get(S.id))&&void 0!==T?T:{ref:S,count:0};R.count+=1,this.channelChildren.set(S.id,R);break}case"subchannel":{let T=null!==(R=this.subchannelChildren.get(S.id))&&void 0!==R?R:{ref:S,count:0};T.count+=1,this.subchannelChildren.set(S.id,T);break}case"socket":{let T=null!==(N=this.socketChildren.get(S.id))&&void 0!==N?N:{ref:S,count:0};T.count+=1,this.socketChildren.set(S.id,T)}}}unrefChild(S){switch(S.kind){case"channel":{let T=this.channelChildren.get(S.id);void 0!==T&&(T.count-=1,0===T.count?this.channelChildren.delete(S.id):this.channelChildren.set(S.id,T));break}case"subchannel":{let T=this.subchannelChildren.get(S.id);void 0!==T&&(T.count-=1,0===T.count?this.subchannelChildren.delete(S.id):this.subchannelChildren.set(S.id,T));break}case"socket":{let T=this.socketChildren.get(S.id);void 0!==T&&(T.count-=1,0===T.count?this.socketChildren.delete(S.id):this.socketChildren.set(S.id,T))}}}getChildLists(){let S=[];for(let{ref:T}of this.channelChildren.values())S.push(T);let T=[];for(let{ref:S}of this.subchannelChildren.values())T.push(S);let R=[];for(let{ref:S}of this.socketChildren.values())R.push(S);return{channels:S,subchannels:T,sockets:R}}}T.ChannelzChildrenTracker=X;class Z{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}T.ChannelzCallTracker=Z;let ee=1;function et(){return ee++}let er=[],en=[],ei=[],es=[];function ea(S,T,R){let N=et(),O={id:N,name:S,kind:"channel"};return R&&(er[N]={ref:O,getInfo:T}),O}function eo(S,T,R){let N=et(),O={id:N,name:S,kind:"subchannel"};return R&&(en[N]={ref:O,getInfo:T}),O}function eu(S,T){let R=et(),N={id:R,kind:"server"};return T&&(ei[R]={ref:N,getInfo:S}),N}function ec(S,T,R){let N=et(),O={id:N,name:S,kind:"socket"};return R&&(es[N]={ref:O,getInfo:T}),O}function eh(S){switch(S.kind){case"channel":delete er[S.id];return;case"subchannel":delete en[S.id];return;case"server":delete ei[S.id];return;case"socket":delete es[S.id];return}}function ed(S){let T=Number.parseInt(S,16);return[T/256|0,T%256]}function ep(S){return""===S?[]:[].concat(...S.split(":").map(S=>ed(S)))}function ef(S){if((0,N.isIPv4)(S))return Buffer.from(Uint8Array.from(S.split(".").map(S=>Number.parseInt(S))));if(!(0,N.isIPv6)(S))return null;{let T,R;let N=S.indexOf("::");-1===N?(T=S,R=""):(T=S.substring(0,N),R=S.substring(N+2));let O=Buffer.from(ep(T)),P=Buffer.from(ep(R)),M=Buffer.alloc(16-O.length-P.length,0);return Buffer.concat([O,M,P])}}function eg(S){switch(S){case O.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case O.ConnectivityState.IDLE:return{state:"IDLE"};case O.ConnectivityState.READY:return{state:"READY"};case O.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case O.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function em(S){if(!S)return null;let T=S.getTime();return{seconds:T/1e3|0,nanos:T%1e3*1e6}}function ey(S){let T=S.getInfo();return{ref:V(S.ref),data:{target:T.target,state:eg(T.state),calls_started:T.callTracker.callsStarted,calls_succeeded:T.callTracker.callsSucceeded,calls_failed:T.callTracker.callsFailed,last_call_started_timestamp:em(T.callTracker.lastCallStartedTimestamp),trace:T.trace.getTraceMessage()},channel_ref:T.children.channels.map(S=>V(S)),subchannel_ref:T.children.subchannels.map(S=>$(S))}}function ev(S,T){let R=Number.parseInt(S.request.channel_id),N=er[R];if(void 0===N){T({code:P.Status.NOT_FOUND,details:"No channel data found for id "+R});return}T(null,{channel:ey(N)})}function eb(S,T){let R=Number.parseInt(S.request.max_results),N=[],O=Number.parseInt(S.request.start_channel_id);for(;O<er.length;O++){let S=er[O];if(void 0!==S&&(N.push(ey(S)),N.length>=R))break}T(null,{channel:N,end:O>=ei.length})}function eS(S){let T=S.getInfo();return{ref:K(S.ref),data:{calls_started:T.callTracker.callsStarted,calls_succeeded:T.callTracker.callsSucceeded,calls_failed:T.callTracker.callsFailed,last_call_started_timestamp:em(T.callTracker.lastCallStartedTimestamp),trace:T.trace.getTraceMessage()},listen_socket:T.listenerChildren.sockets.map(S=>W(S))}}function eT(S,T){let R=Number.parseInt(S.request.server_id),N=ei[R];if(void 0===N){T({code:P.Status.NOT_FOUND,details:"No server data found for id "+R});return}T(null,{server:eS(N)})}function ew(S,T){let R=Number.parseInt(S.request.max_results),N=[],O=Number.parseInt(S.request.start_server_id);for(;O<ei.length;O++){let S=ei[O];if(void 0!==S&&(N.push(eS(S)),N.length>=R))break}T(null,{server:N,end:O>=ei.length})}function eC(S,T){let R=Number.parseInt(S.request.subchannel_id),N=en[R];if(void 0===N){T({code:P.Status.NOT_FOUND,details:"No subchannel data found for id "+R});return}let O=N.getInfo();T(null,{subchannel:{ref:$(N.ref),data:{target:O.target,state:eg(O.state),calls_started:O.callTracker.callsStarted,calls_succeeded:O.callTracker.callsSucceeded,calls_failed:O.callTracker.callsFailed,last_call_started_timestamp:em(O.callTracker.lastCallStartedTimestamp),trace:O.trace.getTraceMessage()},socket_ref:O.children.sockets.map(S=>W(S))}})}function eE(S){var T;return(0,M.isTcpSubchannelAddress)(S)?{address:"tcpip_address",tcpip_address:{ip_address:null!==(T=ef(S.host))&&void 0!==T?T:void 0,port:S.port}}:{address:"uds_address",uds_address:{filename:S.path}}}function eI(S,T){var R,N,O,M,L;let U=Number.parseInt(S.request.socket_id),V=es[U];if(void 0===V){T({code:P.Status.NOT_FOUND,details:"No socket data found for id "+U});return}let $=V.getInfo(),K=$.security?{model:"tls",tls:{cipher_suite:$.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!==(R=$.security.cipherSuiteStandardName)&&void 0!==R?R:void 0,other_name:null!==(N=$.security.cipherSuiteOtherName)&&void 0!==N?N:void 0,local_certificate:null!==(O=$.security.localCertificate)&&void 0!==O?O:void 0,remote_certificate:null!==(M=$.security.remoteCertificate)&&void 0!==M?M:void 0}}:null;T(null,{socket:{ref:W(V.ref),local:$.localAddress?eE($.localAddress):null,remote:$.remoteAddress?eE($.remoteAddress):null,remote_name:null!==(L=$.remoteName)&&void 0!==L?L:void 0,security:K,data:{keep_alives_sent:$.keepAlivesSent,streams_started:$.streamsStarted,streams_succeeded:$.streamsSucceeded,streams_failed:$.streamsFailed,last_local_stream_created_timestamp:em($.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:em($.lastRemoteStreamCreatedTimestamp),messages_received:$.messagesReceived,messages_sent:$.messagesSent,last_message_received_timestamp:em($.lastMessageReceivedTimestamp),last_message_sent_timestamp:em($.lastMessageSentTimestamp),local_flow_control_window:$.localFlowControlWindow?{value:$.localFlowControlWindow}:null,remote_flow_control_window:$.remoteFlowControlWindow?{value:$.remoteFlowControlWindow}:null}}})}function e_(S,T){let R=Number.parseInt(S.request.server_id),N=ei[R];if(void 0===N){T({code:P.Status.NOT_FOUND,details:"No server data found for id "+R});return}let O=Number.parseInt(S.request.start_socket_id),M=Number.parseInt(S.request.max_results),L=N.getInfo().sessionChildren.sockets.sort((S,T)=>S.id-T.id),U=[],V=0;for(;V<L.length&&(!(L[V].id>=O)||(U.push(W(L[V])),!(U.length>=M)));V++);T(null,{socket_ref:U,end:V>=L.length})}function ek(){return{GetChannel:ev,GetTopChannels:eb,GetServer:eT,GetServers:ew,GetSubchannel:eC,GetSocket:eI,GetServerSockets:e_}}T.registerChannelzChannel=ea,T.registerChannelzSubchannel=eo,T.registerChannelzServer=eu,T.registerChannelzSocket=ec,T.unregisterChannelzRef=eh,T.getChannelzHandlers=ek;let eR=null;function eA(){if(eR)return eR;let S=(0,R(8715).J_)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return eR=(0,U.loadPackageDefinition)(S).grpc.channelz.v1.Channelz.service}function eD(){(0,L.registerAdminService)(eA,ek)}T.getChannelzServiceDefinition=eA,T.setup=eD},8601:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getInterceptingCall=T.InterceptingCall=T.RequesterBuilder=T.ListenerBuilder=T.InterceptorConfigurationError=void 0;let N=R(2252),O=R(6749),P=R(2678),M=R(5437);class L extends Error{constructor(S){super(S),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,L)}}T.InterceptorConfigurationError=L;class U{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(S){return this.metadata=S,this}withOnReceiveMessage(S){return this.message=S,this}withOnReceiveStatus(S){return this.status=S,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}T.ListenerBuilder=U;class V{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(S){return this.start=S,this}withSendMessage(S){return this.message=S,this}withHalfClose(S){return this.halfClose=S,this}withCancel(S){return this.cancel=S,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}T.RequesterBuilder=V;let $={onReceiveMetadata:(S,T)=>{T(S)},onReceiveMessage:(S,T)=>{T(S)},onReceiveStatus:(S,T)=>{T(S)}},K={start:(S,T,R)=>{R(S,T)},sendMessage:(S,T)=>{T(S)},halfClose:S=>{S()},cancel:S=>{S()}};class W{constructor(S,T){var R,N,O,P;this.nextCall=S,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,T?this.requester={start:null!==(R=T.start)&&void 0!==R?R:K.start,sendMessage:null!==(N=T.sendMessage)&&void 0!==N?N:K.sendMessage,halfClose:null!==(O=T.halfClose)&&void 0!==O?O:K.halfClose,cancel:null!==(P=T.cancel)&&void 0!==P?P:K.cancel}:this.requester=K}cancelWithStatus(S,T){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(S,T)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(S,T){var R,N,P,M,L,U;let V={onReceiveMetadata:null!==(N=null===(R=null==T?void 0:T.onReceiveMetadata)||void 0===R?void 0:R.bind(T))&&void 0!==N?N:S=>{},onReceiveMessage:null!==(M=null===(P=null==T?void 0:T.onReceiveMessage)||void 0===P?void 0:P.bind(T))&&void 0!==M?M:S=>{},onReceiveStatus:null!==(U=null===(L=null==T?void 0:T.onReceiveStatus)||void 0===L?void 0:L.bind(T))&&void 0!==U?U:S=>{}};this.processingMetadata=!0,this.requester.start(S,V,(S,T)=>{var R,N,P;let M;if(this.processingMetadata=!1,(0,O.isInterceptingListener)(T))M=T;else{let S={onReceiveMetadata:null!==(R=T.onReceiveMetadata)&&void 0!==R?R:$.onReceiveMetadata,onReceiveMessage:null!==(N=T.onReceiveMessage)&&void 0!==N?N:$.onReceiveMessage,onReceiveStatus:null!==(P=T.onReceiveStatus)&&void 0!==P?P:$.onReceiveStatus};M=new O.InterceptingListenerImpl(S,V)}this.nextCall.start(S,M),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(S,T){this.processingMessage=!0,this.requester.sendMessage(T,R=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=S,this.pendingMessage=T):(this.nextCall.sendMessageWithContext(S,R),this.processPendingHalfClose())})}sendMessage(S){this.sendMessageWithContext({},S)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function Q(S,T,R){var N,O;let P=null!==(N=R.deadline)&&void 0!==N?N:1/0,M=R.host,L=null!==(O=R.parent)&&void 0!==O?O:null,U=R.propagate_flags,V=R.credentials,$=S.createCall(T,P,M,L,U);return V&&$.setCredentials(V),$}T.InterceptingCall=W;class Y{constructor(S,T){this.call=S,this.methodDefinition=T}cancelWithStatus(S,T){this.call.cancelWithStatus(S,T)}getPeer(){return this.call.getPeer()}sendMessageWithContext(S,T){let R;try{R=this.methodDefinition.requestSerialize(T)}catch(S){this.call.cancelWithStatus(P.Status.INTERNAL,`Request message serialization failure: ${(0,M.getErrorMessage)(S)}`);return}this.call.sendMessageWithContext(S,R)}sendMessage(S){this.sendMessageWithContext({},S)}start(S,T){let R=null;this.call.start(S,{onReceiveMetadata:S=>{var R;null===(R=null==T?void 0:T.onReceiveMetadata)||void 0===R||R.call(T,S)},onReceiveMessage:S=>{var O;let L;try{L=this.methodDefinition.responseDeserialize(S)}catch(S){R={code:P.Status.INTERNAL,details:`Response message parsing error: ${(0,M.getErrorMessage)(S)}`,metadata:new N.Metadata},this.call.cancelWithStatus(R.code,R.details);return}null===(O=null==T?void 0:T.onReceiveMessage)||void 0===O||O.call(T,L)},onReceiveStatus:S=>{var N,O;R?null===(N=null==T?void 0:T.onReceiveStatus)||void 0===N||N.call(T,R):null===(O=null==T?void 0:T.onReceiveStatus)||void 0===O||O.call(T,S)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class X extends Y{constructor(S,T){super(S,T)}start(S,T){var R,N;let O=!1,P={onReceiveMetadata:null!==(N=null===(R=null==T?void 0:T.onReceiveMetadata)||void 0===R?void 0:R.bind(T))&&void 0!==N?N:S=>{},onReceiveMessage:S=>{var R;O=!0,null===(R=null==T?void 0:T.onReceiveMessage)||void 0===R||R.call(T,S)},onReceiveStatus:S=>{var R,N;O||null===(R=null==T?void 0:T.onReceiveMessage)||void 0===R||R.call(T,null),null===(N=null==T?void 0:T.onReceiveStatus)||void 0===N||N.call(T,S)}};super.start(S,P),this.call.startRead()}}class Z extends Y{}function ee(S,T,R){let N=Q(S,R.path,T);return R.responseStream?new Z(N,R):new X(N,R)}function et(S,T,R,N){if(S.clientInterceptors.length>0&&S.clientInterceptorProviders.length>0)throw new L("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(S.callInterceptors.length>0&&S.callInterceptorProviders.length>0)throw new L("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let O=[];O=S.callInterceptors.length>0||S.callInterceptorProviders.length>0?[].concat(S.callInterceptors,S.callInterceptorProviders.map(S=>S(T))).filter(S=>S):[].concat(S.clientInterceptors,S.clientInterceptorProviders.map(S=>S(T))).filter(S=>S);let P=Object.assign({},R,{method_definition:T});return O.reduceRight((S,T)=>R=>T(R,S),S=>ee(N,S,T))(P)}T.getInterceptingCall=et},9800:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Client=void 0;let N=R(8439),O=R(6261),P=R(3955),M=R(2678),L=R(2252),U=R(8601),V=Symbol(),$=Symbol(),K=Symbol(),W=Symbol();function Q(S){return"function"==typeof S}function Y(S){return S.stack.split("\n").slice(1).join("\n")}class X{constructor(S,T,R={}){var N,P;if(R=Object.assign({},R),this[$]=null!==(N=R.interceptors)&&void 0!==N?N:[],delete R.interceptors,this[K]=null!==(P=R.interceptor_providers)&&void 0!==P?P:[],delete R.interceptor_providers,this[$].length>0&&this[K].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[W]=R.callInvocationTransformer,delete R.callInvocationTransformer,R.channelOverride)this[V]=R.channelOverride;else if(R.channelFactoryOverride){let N=R.channelFactoryOverride;delete R.channelFactoryOverride,this[V]=N(S,T,R)}else this[V]=new O.ChannelImplementation(S,T,R)}close(){this[V].close()}getChannel(){return this[V]}waitForReady(S,T){let R=N=>{let O;if(N){T(Error("Failed to connect before the deadline"));return}try{O=this[V].getConnectivityState(!0)}catch(S){T(Error("The channel has been closed"));return}if(O===P.ConnectivityState.READY)T();else try{this[V].watchConnectivityState(O,S,R)}catch(S){T(Error("The channel has been closed"))}};setImmediate(R)}checkOptionalUnaryResponseArguments(S,T,R){if(Q(S))return{metadata:new L.Metadata,options:{},callback:S};if(Q(T))return S instanceof L.Metadata?{metadata:S,options:{},callback:T}:{metadata:new L.Metadata,options:S,callback:T};if(!(S instanceof L.Metadata&&T instanceof Object&&Q(R)))throw Error("Incorrect arguments passed");return{metadata:S,options:T,callback:R}}makeUnaryRequest(S,T,R,O,P,L,Q){var X,Z;let ee=this.checkOptionalUnaryResponseArguments(P,L,Q),et={path:S,requestStream:!1,responseStream:!1,requestSerialize:T,responseDeserialize:R},er={argument:O,metadata:ee.metadata,call:new N.ClientUnaryCallImpl,channel:this[V],methodDefinition:et,callOptions:ee.options,callback:ee.callback};this[W]&&(er=this[W](er));let en=er.call,ei={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(X=er.callOptions.interceptors)&&void 0!==X?X:[],callInterceptorProviders:null!==(Z=er.callOptions.interceptor_providers)&&void 0!==Z?Z:[]},es=(0,U.getInterceptingCall)(ei,er.methodDefinition,er.callOptions,er.channel);en.call=es;let ea=null,eo=!1,eu=Error();return es.start(er.metadata,{onReceiveMetadata:S=>{en.emit("metadata",S)},onReceiveMessage(S){null!==ea&&es.cancelWithStatus(M.Status.INTERNAL,"Too many responses received"),ea=S},onReceiveStatus(S){if(!eo){if(eo=!0,S.code===M.Status.OK){if(null===ea){let T=Y(eu);er.callback((0,N.callErrorFromStatus)({code:M.Status.INTERNAL,details:"No message received",metadata:S.metadata},T))}else er.callback(null,ea)}else{let T=Y(eu);er.callback((0,N.callErrorFromStatus)(S,T))}eu=null,en.emit("status",S)}}}),es.sendMessage(O),es.halfClose(),en}makeClientStreamRequest(S,T,R,O,P,L){var Q,X;let Z=this.checkOptionalUnaryResponseArguments(O,P,L),ee={path:S,requestStream:!0,responseStream:!1,requestSerialize:T,responseDeserialize:R},et={metadata:Z.metadata,call:new N.ClientWritableStreamImpl(T),channel:this[V],methodDefinition:ee,callOptions:Z.options,callback:Z.callback};this[W]&&(et=this[W](et));let er=et.call,en={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(Q=et.callOptions.interceptors)&&void 0!==Q?Q:[],callInterceptorProviders:null!==(X=et.callOptions.interceptor_providers)&&void 0!==X?X:[]},ei=(0,U.getInterceptingCall)(en,et.methodDefinition,et.callOptions,et.channel);er.call=ei;let es=null,ea=!1,eo=Error();return ei.start(et.metadata,{onReceiveMetadata:S=>{er.emit("metadata",S)},onReceiveMessage(S){null!==es&&ei.cancelWithStatus(M.Status.INTERNAL,"Too many responses received"),es=S},onReceiveStatus(S){if(!ea){if(ea=!0,S.code===M.Status.OK){if(null===es){let T=Y(eo);et.callback((0,N.callErrorFromStatus)({code:M.Status.INTERNAL,details:"No message received",metadata:S.metadata},T))}else et.callback(null,es)}else{let T=Y(eo);et.callback((0,N.callErrorFromStatus)(S,T))}eo=null,er.emit("status",S)}}}),er}checkMetadataAndOptions(S,T){let R,N;return S instanceof L.Metadata?(R=S,N=T||{}):(N=S||{},R=new L.Metadata),{metadata:R,options:N}}makeServerStreamRequest(S,T,R,O,P,L){var Q,X;let Z=this.checkMetadataAndOptions(P,L),ee={path:S,requestStream:!1,responseStream:!0,requestSerialize:T,responseDeserialize:R},et={argument:O,metadata:Z.metadata,call:new N.ClientReadableStreamImpl(R),channel:this[V],methodDefinition:ee,callOptions:Z.options};this[W]&&(et=this[W](et));let er=et.call,en={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(Q=et.callOptions.interceptors)&&void 0!==Q?Q:[],callInterceptorProviders:null!==(X=et.callOptions.interceptor_providers)&&void 0!==X?X:[]},ei=(0,U.getInterceptingCall)(en,et.methodDefinition,et.callOptions,et.channel);er.call=ei;let es=!1,ea=Error();return ei.start(et.metadata,{onReceiveMetadata(S){er.emit("metadata",S)},onReceiveMessage(S){er.push(S)},onReceiveStatus(S){if(!es){if(es=!0,er.push(null),S.code!==M.Status.OK){let T=Y(ea);er.emit("error",(0,N.callErrorFromStatus)(S,T))}ea=null,er.emit("status",S)}}}),ei.sendMessage(O),ei.halfClose(),er}makeBidiStreamRequest(S,T,R,O,P){var L,Q;let X=this.checkMetadataAndOptions(O,P),Z={path:S,requestStream:!0,responseStream:!0,requestSerialize:T,responseDeserialize:R},ee={metadata:X.metadata,call:new N.ClientDuplexStreamImpl(T,R),channel:this[V],methodDefinition:Z,callOptions:X.options};this[W]&&(ee=this[W](ee));let et=ee.call,er={clientInterceptors:this[$],clientInterceptorProviders:this[K],callInterceptors:null!==(L=ee.callOptions.interceptors)&&void 0!==L?L:[],callInterceptorProviders:null!==(Q=ee.callOptions.interceptor_providers)&&void 0!==Q?Q:[]},en=(0,U.getInterceptingCall)(er,ee.methodDefinition,ee.callOptions,ee.channel);et.call=en;let ei=!1,es=Error();return en.start(ee.metadata,{onReceiveMetadata(S){et.emit("metadata",S)},onReceiveMessage(S){et.push(S)},onReceiveStatus(S){if(!ei){if(ei=!0,et.push(null),S.code!==M.Status.OK){let T=Y(es);et.emit("error",(0,N.callErrorFromStatus)(S,T))}es=null,et.emit("status",S)}}}),et}}T.Client=X},9284:(S,T)=>{"use strict";var R;Object.defineProperty(T,"__esModule",{value:!0}),T.CompressionAlgorithms=void 0,function(S){S[S.identity=0]="identity",S[S.deflate=1]="deflate",S[S.gzip=2]="gzip"}(R||(T.CompressionAlgorithms=R={}))},4299:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.CompressionFilterFactory=T.CompressionFilter=void 0;let N=R(9796),O=R(9284),P=R(2678),M=R(8152),L=R(7504),U=S=>"number"==typeof S&&"string"==typeof O.CompressionAlgorithms[S];class V{async writeMessage(S,T){let R=S;T&&(R=await this.compressMessage(R));let N=Buffer.allocUnsafe(R.length+5);return N.writeUInt8(T?1:0,0),N.writeUInt32BE(R.length,1),R.copy(N,5),N}async readMessage(S){let T=1===S.readUInt8(0),R=S.slice(5);return T&&(R=await this.decompressMessage(R)),R}}class $ extends V{async compressMessage(S){return S}async writeMessage(S,T){let R=Buffer.allocUnsafe(S.length+5);return R.writeUInt8(0,0),R.writeUInt32BE(S.length,1),S.copy(R,5),R}decompressMessage(S){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class K extends V{constructor(S){super(),this.maxRecvMessageLength=S}compressMessage(S){return new Promise((T,R)=>{N.deflate(S,(S,N)=>{S?R(S):T(N)})})}decompressMessage(S){return new Promise((T,R)=>{let O=0,M=[],L=N.createInflate();L.on("data",S=>{M.push(S),O+=S.byteLength,-1!==this.maxRecvMessageLength&&O>this.maxRecvMessageLength&&(L.destroy(),R({code:P.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),L.on("end",()=>{T(Buffer.concat(M))}),L.write(S),L.end()})}}class W extends V{constructor(S){super(),this.maxRecvMessageLength=S}compressMessage(S){return new Promise((T,R)=>{N.gzip(S,(S,N)=>{S?R(S):T(N)})})}decompressMessage(S){return new Promise((T,R)=>{let O=0,M=[],L=N.createGunzip();L.on("data",S=>{M.push(S),O+=S.byteLength,-1!==this.maxRecvMessageLength&&O>this.maxRecvMessageLength&&(L.destroy(),R({code:P.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),L.on("end",()=>{T(Buffer.concat(M))}),L.write(S),L.end()})}}class Q extends V{constructor(S){super(),this.compressionName=S}compressMessage(S){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(S){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function Y(S,T){switch(S){case"identity":return new $;case"deflate":return new K(T);case"gzip":return new W(T);default:return new Q(S)}}class X extends M.BaseFilter{constructor(S,T){var R,N;super(),this.sharedFilterConfig=T,this.sendCompression=new $,this.receiveCompression=new $,this.currentCompressionAlgorithm="identity";let M=S["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!==(R=S["grpc.max_receive_message_length"])&&void 0!==R?R:P.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==M){if(U(M)){let S=O.CompressionAlgorithms[M],R=null===(N=T.serverSupportedEncodingHeader)||void 0===N?void 0:N.split(",");(!R||R.includes(S))&&(this.currentCompressionAlgorithm=S,this.sendCompression=Y(this.currentCompressionAlgorithm,-1))}else L.log(P.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${M}`)}}async sendMetadata(S){let T=await S;return T.set("grpc-accept-encoding","identity,deflate,gzip"),T.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?T.remove("grpc-encoding"):T.set("grpc-encoding",this.currentCompressionAlgorithm),T}receiveMetadata(S){let T=S.get("grpc-encoding");if(T.length>0){let S=T[0];"string"==typeof S&&(this.receiveCompression=Y(S,this.maxReceiveMessageLength))}S.remove("grpc-encoding");let R=S.get("grpc-accept-encoding")[0];return R&&(this.sharedFilterConfig.serverSupportedEncodingHeader=R,R.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new $,this.currentCompressionAlgorithm="identity")),S.remove("grpc-accept-encoding"),S}async sendMessage(S){var T;let R;let N=await S;return R=!(this.sendCompression instanceof $)&&((null!==(T=N.flags)&&void 0!==T?T:0)&2)==0,{message:await this.sendCompression.writeMessage(N.message,R),flags:N.flags}}async receiveMessage(S){return this.receiveCompression.readMessage(await S)}}T.CompressionFilter=X;class Z{constructor(S,T){this.options=T,this.sharedFilterConfig={}}createFilter(){return new X(this.options,this.sharedFilterConfig)}}T.CompressionFilterFactory=Z},3955:(S,T)=>{"use strict";var R;Object.defineProperty(T,"__esModule",{value:!0}),T.ConnectivityState=void 0,function(S){S[S.IDLE=0]="IDLE",S[S.CONNECTING=1]="CONNECTING",S[S.READY=2]="READY",S[S.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",S[S.SHUTDOWN=4]="SHUTDOWN"}(R||(T.ConnectivityState=R={}))},2678:(S,T)=>{"use strict";var R,N,O;Object.defineProperty(T,"__esModule",{value:!0}),T.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=T.DEFAULT_MAX_SEND_MESSAGE_LENGTH=T.Propagate=T.LogVerbosity=T.Status=void 0,function(S){S[S.OK=0]="OK",S[S.CANCELLED=1]="CANCELLED",S[S.UNKNOWN=2]="UNKNOWN",S[S.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",S[S.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",S[S.NOT_FOUND=5]="NOT_FOUND",S[S.ALREADY_EXISTS=6]="ALREADY_EXISTS",S[S.PERMISSION_DENIED=7]="PERMISSION_DENIED",S[S.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",S[S.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",S[S.ABORTED=10]="ABORTED",S[S.OUT_OF_RANGE=11]="OUT_OF_RANGE",S[S.UNIMPLEMENTED=12]="UNIMPLEMENTED",S[S.INTERNAL=13]="INTERNAL",S[S.UNAVAILABLE=14]="UNAVAILABLE",S[S.DATA_LOSS=15]="DATA_LOSS",S[S.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(R||(T.Status=R={})),function(S){S[S.DEBUG=0]="DEBUG",S[S.INFO=1]="INFO",S[S.ERROR=2]="ERROR",S[S.NONE=3]="NONE"}(N||(T.LogVerbosity=N={})),function(S){S[S.DEADLINE=1]="DEADLINE",S[S.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",S[S.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",S[S.CANCELLATION=8]="CANCELLATION",S[S.DEFAULTS=65535]="DEFAULTS"}(O||(T.Propagate=O={})),T.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,T.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},2155:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.restrictControlPlaneStatusCode=void 0;let N=R(2678),O=[N.Status.OK,N.Status.INVALID_ARGUMENT,N.Status.NOT_FOUND,N.Status.ALREADY_EXISTS,N.Status.FAILED_PRECONDITION,N.Status.ABORTED,N.Status.OUT_OF_RANGE,N.Status.DATA_LOSS];function P(S,T){return O.includes(S)?{code:N.Status.INTERNAL,details:`Invalid status from control plane: ${S} ${N.Status[S]} ${T}`}:{code:S,details:T}}T.restrictControlPlaneStatusCode=P},7931:(S,T)=>{"use strict";function R(...S){let T=1/0;for(let R of S){let S=R instanceof Date?R.getTime():R;S<T&&(T=S)}return T}Object.defineProperty(T,"__esModule",{value:!0}),T.deadlineToString=T.getRelativeTimeout=T.getDeadlineTimeoutString=T.minDeadline=void 0,T.minDeadline=R;let N=[["m",1],["S",1e3],["M",6e4],["H",36e5]];function O(S){let T=new Date().getTime();S instanceof Date&&(S=S.getTime());let R=Math.max(S-T,0);for(let[S,T]of N){let N=R/T;if(N<1e8)return String(Math.ceil(N))+S}throw Error("Deadline is too far in the future")}T.getDeadlineTimeoutString=O;let P=2147483647;function M(S){let T=(S instanceof Date?S.getTime():S)-new Date().getTime();return T<0?0:T>P?1/0:T}function L(S){if(S instanceof Date)return S.toISOString();{let T=new Date(S);return Number.isNaN(T.getTime())?""+S:T.toISOString()}}T.getRelativeTimeout=M,T.deadlineToString=L},5330:(S,T)=>{"use strict";function R(S){return{seconds:S/1e3|0,nanos:S%1e3*1e6|0}}function N(S){return 1e3*S.seconds+S.nanos/1e6|0}function O(S){return"number"==typeof S.seconds&&"number"==typeof S.nanos}Object.defineProperty(T,"__esModule",{value:!0}),T.isDuration=T.durationToMs=T.msToDuration=void 0,T.msToDuration=R,T.durationToMs=N,T.isDuration=O},5437:(S,T)=>{"use strict";function R(S){return S instanceof Error?S.message:String(S)}function N(S){return"object"==typeof S&&null!==S&&"code"in S&&"number"==typeof S.code?S.code:null}Object.defineProperty(T,"__esModule",{value:!0}),T.getErrorCode=T.getErrorMessage=void 0,T.getErrorMessage=R,T.getErrorCode=N},345:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.OutlierDetectionLoadBalancingConfig=T.BaseSubchannelWrapper=T.registerAdminService=T.FilterStackFactory=T.BaseFilter=T.PickResultType=T.QueuePicker=T.UnavailablePicker=T.ChildLoadBalancerHandler=T.subchannelAddressToString=T.validateLoadBalancingConfig=T.getFirstUsableConfig=T.registerLoadBalancerType=T.createChildChannelControlHelper=T.BackoffTimeout=T.durationToMs=T.uriToString=T.createResolver=T.registerResolver=T.log=T.trace=void 0;var N=R(7504);Object.defineProperty(T,"trace",{enumerable:!0,get:function(){return N.trace}}),Object.defineProperty(T,"log",{enumerable:!0,get:function(){return N.log}});var O=R(492);Object.defineProperty(T,"registerResolver",{enumerable:!0,get:function(){return O.registerResolver}}),Object.defineProperty(T,"createResolver",{enumerable:!0,get:function(){return O.createResolver}});var P=R(8429);Object.defineProperty(T,"uriToString",{enumerable:!0,get:function(){return P.uriToString}});var M=R(5330);Object.defineProperty(T,"durationToMs",{enumerable:!0,get:function(){return M.durationToMs}});var L=R(4934);Object.defineProperty(T,"BackoffTimeout",{enumerable:!0,get:function(){return L.BackoffTimeout}});var U=R(7176);Object.defineProperty(T,"createChildChannelControlHelper",{enumerable:!0,get:function(){return U.createChildChannelControlHelper}}),Object.defineProperty(T,"registerLoadBalancerType",{enumerable:!0,get:function(){return U.registerLoadBalancerType}}),Object.defineProperty(T,"getFirstUsableConfig",{enumerable:!0,get:function(){return U.getFirstUsableConfig}}),Object.defineProperty(T,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return U.validateLoadBalancingConfig}});var V=R(3906);Object.defineProperty(T,"subchannelAddressToString",{enumerable:!0,get:function(){return V.subchannelAddressToString}});var $=R(982);Object.defineProperty(T,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return $.ChildLoadBalancerHandler}});var K=R(7064);Object.defineProperty(T,"UnavailablePicker",{enumerable:!0,get:function(){return K.UnavailablePicker}}),Object.defineProperty(T,"QueuePicker",{enumerable:!0,get:function(){return K.QueuePicker}}),Object.defineProperty(T,"PickResultType",{enumerable:!0,get:function(){return K.PickResultType}});var W=R(8152);Object.defineProperty(T,"BaseFilter",{enumerable:!0,get:function(){return W.BaseFilter}});var Q=R(2472);Object.defineProperty(T,"FilterStackFactory",{enumerable:!0,get:function(){return Q.FilterStackFactory}});var Y=R(9601);Object.defineProperty(T,"registerAdminService",{enumerable:!0,get:function(){return Y.registerAdminService}});var X=R(1407);Object.defineProperty(T,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return X.BaseSubchannelWrapper}});var Z=R(1433);Object.defineProperty(T,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return Z.OutlierDetectionLoadBalancingConfig}})},2472:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.FilterStackFactory=T.FilterStack=void 0;class R{constructor(S){this.filters=S}sendMetadata(S){let T=S;for(let S=0;S<this.filters.length;S++)T=this.filters[S].sendMetadata(T);return T}receiveMetadata(S){let T=S;for(let S=this.filters.length-1;S>=0;S--)T=this.filters[S].receiveMetadata(T);return T}sendMessage(S){let T=S;for(let S=0;S<this.filters.length;S++)T=this.filters[S].sendMessage(T);return T}receiveMessage(S){let T=S;for(let S=this.filters.length-1;S>=0;S--)T=this.filters[S].receiveMessage(T);return T}receiveTrailers(S){let T=S;for(let S=this.filters.length-1;S>=0;S--)T=this.filters[S].receiveTrailers(T);return T}push(S){this.filters.unshift(...S)}getFilters(){return this.filters}}T.FilterStack=R;class N{constructor(S){this.factories=S}push(S){this.factories.unshift(...S)}clone(){return new N([...this.factories])}createFilter(){return new R(this.factories.map(S=>S.createFilter()))}}T.FilterStackFactory=N},8152:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.BaseFilter=void 0;class R{async sendMetadata(S){return S}receiveMetadata(S){return S}async sendMessage(S){return S}async receiveMessage(S){return S}receiveTrailers(S){return S}}T.BaseFilter=R},2039:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getProxiedConnection=T.mapProxyName=void 0;let N=R(7504),O=R(2678),P=R(492),M=R(3685),L=R(4404),U=R(7504),V=R(3906),$=R(8429),K=R(7310),W=R(4605),Q="proxy";function Y(S){U.trace(O.LogVerbosity.DEBUG,Q,S)}function X(){let S,T="",R="";if(process.env.grpc_proxy)R="grpc_proxy",T=process.env.grpc_proxy;else if(process.env.https_proxy)R="https_proxy",T=process.env.https_proxy;else{if(!process.env.http_proxy)return{};R="http_proxy",T=process.env.http_proxy}try{S=new K.URL(T)}catch(S){return(0,N.log)(O.LogVerbosity.ERROR,`cannot parse value of "${R}" env var`),{}}if("http:"!==S.protocol)return(0,N.log)(O.LogVerbosity.ERROR,`"${S.protocol}" scheme not supported in proxy URI`),{};let P=null;S.username&&(S.password?((0,N.log)(O.LogVerbosity.INFO,"userinfo found in proxy URI"),P=`${S.username}:${S.password}`):P=S.username);let M=S.hostname,L=S.port;""===L&&(L="80");let U={address:`${M}:${L}`};return P&&(U.creds=P),Y("Proxy server "+U.address+" set by environment variable "+R),U}function Z(){let S=process.env.no_grpc_proxy,T="no_grpc_proxy";return(S||(S=process.env.no_proxy,T="no_proxy"),S)?(Y("No proxy server list set by environment variable "+T),S.split(",")):[]}function ee(S,T){var R;let N={target:S,extraOptions:{}};if((null!==(R=T["grpc.enable_http_proxy"])&&void 0!==R?R:1)===0||"unix"===S.scheme)return N;let O=X();if(!O.address)return N;let P=(0,$.splitHostPort)(S.path);if(!P)return N;let M=P.host;for(let T of Z())if(T===M)return Y("Not using proxy for target in no_proxy list: "+(0,$.uriToString)(S)),N;let L={"grpc.http_connect_target":(0,$.uriToString)(S)};return O.creds&&(L["grpc.http_connect_creds"]=O.creds),{target:{scheme:"dns",path:O.address},extraOptions:L}}function et(S,T,R){var U;if(!("grpc.http_connect_target"in T))return Promise.resolve({});let K=T["grpc.http_connect_target"],Q=(0,$.parseUri)(K);if(null===Q)return Promise.resolve({});let X=(0,$.splitHostPort)(Q.path);if(null===X)return Promise.resolve({});let Z=`${X.host}:${null!==(U=X.port)&&void 0!==U?U:W.DEFAULT_PORT}`,ee={method:"CONNECT",path:Z},et={Host:Z};(0,V.isTcpSubchannelAddress)(S)?(ee.host=S.host,ee.port=S.port):ee.socketPath=S.path,"grpc.http_connect_creds"in T&&(et["Proxy-Authorization"]="Basic "+Buffer.from(T["grpc.http_connect_creds"]).toString("base64")),ee.headers=et;let er=(0,V.subchannelAddressToString)(S);return Y("Using proxy "+er+" to connect to "+ee.path),new Promise((S,T)=>{let U=M.request(ee);U.once("connect",(M,V,K)=>{var W;if(U.removeAllListeners(),V.removeAllListeners(),200===M.statusCode){if(Y("Successfully connected to "+ee.path+" through proxy "+er),"secureContext"in R){let N=(0,P.getDefaultAuthority)(Q),O=(0,$.splitHostPort)(N),M=null!==(W=null==O?void 0:O.host)&&void 0!==W?W:N,U=L.connect(Object.assign({host:M,servername:M,socket:V},R),()=>{Y("Successfully established a TLS connection to "+ee.path+" through proxy "+er),S({socket:U,realTarget:Q})});U.on("error",S=>{Y("Failed to establish a TLS connection to "+ee.path+" through proxy "+er+" with error "+S.message),T()})}else Y("Successfully established a plaintext connection to "+ee.path+" through proxy "+er),S({socket:V,realTarget:Q})}else(0,N.log)(O.LogVerbosity.ERROR,"Failed to connect to "+ee.path+" through proxy "+er+" with status "+M.statusCode),T()}),U.once("error",S=>{U.removeAllListeners(),(0,N.log)(O.LogVerbosity.ERROR,"Failed to connect to proxy "+er+" with error "+S.message),T()}),U.end()})}T.mapProxyName=ee,T.getProxiedConnection=et},2165:(S,T,R)=>{"use strict";Z={value:!0},Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=Z=T.Rz=Z=Z=Z=Z=Z=Z=T.SF=T.K9=void 0;let N=R(8931);Z={enumerable:!0,get:function(){return N.CallCredentials}};let O=R(6261);Z={enumerable:!0,get:function(){return O.ChannelImplementation}};let P=R(9284);Z={enumerable:!0,get:function(){return P.CompressionAlgorithms}};let M=R(3955);Z={enumerable:!0,get:function(){return M.ConnectivityState}};let L=R(2528);Z={enumerable:!0,get:function(){return L.ChannelCredentials}};let U=R(9800);Z={enumerable:!0,get:function(){return U.Client}};let V=R(2678);Z={enumerable:!0,get:function(){return V.LogVerbosity}},Z={enumerable:!0,get:function(){return V.Status}},Z={enumerable:!0,get:function(){return V.Propagate}};let $=R(7504),K=R(5085);Object.defineProperty(T,"Rz",{enumerable:!0,get:function(){return K.loadPackageDefinition}}),Z={enumerable:!0,get:function(){return K.makeClientConstructor}},Z={enumerable:!0,get:function(){return K.makeClientConstructor}};let W=R(2252);Object.defineProperty(T,"SF",{enumerable:!0,get:function(){return W.Metadata}});let Q=R(7691);Z={enumerable:!0,get:function(){return Q.Server}};let Y=R(4181);Z={enumerable:!0,get:function(){return Y.ServerCredentials}};let X=R(9932);Z={enumerable:!0,get:function(){return X.StatusBuilder}},T.K9={combineChannelCredentials:(S,...T)=>T.reduce((S,T)=>S.compose(T),S),combineCallCredentials:(S,...T)=>T.reduce((S,T)=>S.compose(T),S),createInsecure:L.ChannelCredentials.createInsecure,createSsl:L.ChannelCredentials.createSsl,createFromSecureContext:L.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:N.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:N.CallCredentials.createFromGoogleCredential,createEmpty:N.CallCredentials.createEmpty},Z=S=>S.close(),Z=(S,T,R)=>S.waitForReady(T,R),Z=(S,T)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},Z=(S,T,R)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},Z=S=>{$.setLogger(S)},Z=S=>{$.setLoggerVerbosity(S)},Z=S=>U.Client.prototype.getChannel.call(S);var Z,ee=R(8601);Z={enumerable:!0,get:function(){return ee.ListenerBuilder}},Z={enumerable:!0,get:function(){return ee.RequesterBuilder}},Z={enumerable:!0,get:function(){return ee.InterceptingCall}},Z={enumerable:!0,get:function(){return ee.InterceptorConfigurationError}};var et=R(5993);Z={enumerable:!0,get:function(){return et.getChannelzServiceDefinition}},Z={enumerable:!0,get:function(){return et.getChannelzHandlers}};var er=R(9601);Z={enumerable:!0,get:function(){return er.addAdminServicesToServer}},Z=R(345);let en=R(4605),ei=R(5862),es=R(3562),ea=R(6170),eo=R(2255),eu=R(1433),ec=R(5993);(()=>{en.setup(),ei.setup(),es.setup(),ea.setup(),eo.setup(),eu.setup(),ec.setup()})()},1118:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.InternalChannel=void 0;let N=R(2528),O=R(2380),P=R(2328),M=R(7064),L=R(2678),U=R(2472),V=R(4299),$=R(492),K=R(7504),W=R(2039),Q=R(8429),Y=R(3955),X=R(5993),Z=R(980),ee=R(7931),et=R(3003),er=R(8445),en=R(2155),ei=R(4398),es=R(1407),ea=2147483647,eo=1e3,eu=18e5,ec=new Map,eh=16777216,ed=1048576;class ep extends es.BaseSubchannelWrapper{constructor(S,T){super(S),this.channel=T,this.refCount=0,this.subchannelStateListener=(S,R,N,O)=>{T.throttleKeepalive(O)},S.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class ef{constructor(S,T,R){var Z,ee,et,er,es,ef,eg,em;if(this.credentials=T,this.options=R,this.connectivityState=Y.ConnectivityState.IDLE,this.currentPicker=new M.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new X.ChannelzCallTracker,this.childrenTracker=new X.ChannelzChildrenTracker,"string"!=typeof S)throw TypeError("Channel target must be a string");if(!(T instanceof N.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(R&&"object"!=typeof R)throw TypeError("Channel options must be an object");this.originalTarget=S;let ey=(0,Q.parseUri)(S);if(null===ey)throw Error(`Could not parse target name "${S}"`);let ev=(0,$.mapUriDefaultScheme)(ey);if(null===ev)throw Error(`Could not find a default scheme for target name "${S}"`);this.callRefTimer=setInterval(()=>{},ea),null===(ee=(Z=this.callRefTimer).unref)||void 0===ee||ee.call(Z),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new X.ChannelzTrace,this.channelzRef=(0,X.registerChannelzChannel)(S,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,$.getDefaultAuthority)(ev);let eb=(0,W.mapProxyName)(ev,R);this.target=eb.target,this.options=Object.assign({},this.options,eb.extraOptions),this.subchannelPool=(0,P.getSubchannelPool)((null!==(et=R["grpc.use_local_subchannel_pool"])&&void 0!==et?et:0)===0),this.retryBufferTracker=new ei.MessageBufferTracker(null!==(er=R["grpc.retry_buffer_size"])&&void 0!==er?er:eh,null!==(es=R["grpc.per_rpc_retry_buffer_size"])&&void 0!==es?es:ed),this.keepaliveTime=null!==(ef=R["grpc.keepalive_time_ms"])&&void 0!==ef?ef:-1,this.idleTimeoutMs=Math.max(null!==(eg=R["grpc.client_idle_timeout_ms"])&&void 0!==eg?eg:eu,eo);let eS={createSubchannel:(S,T)=>{let R=this.subchannelPool.getOrCreateSubchannel(this.target,S,Object.assign({},this.options,T),this.credentials);R.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",R.getChannelzRef());let N=new ep(R,this);return this.wrappedSubchannels.add(N),N},updateState:(S,T)=>{this.currentPicker=T;let R=this.pickQueue.slice();for(let S of(this.pickQueue=[],R.length>0&&this.callRefTimerUnref(),R))S.doPick();this.updateState(S)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:S=>{this.channelzEnabled&&this.childrenTracker.refChild(S)},removeChannelzChild:S=>{this.channelzEnabled&&this.childrenTracker.unrefChild(S)}};this.resolvingLoadBalancer=new O.ResolvingLoadBalancer(this.target,eS,R,(S,T)=>{S.retryThrottling?ec.set(this.getTarget(),new ei.RetryThrottler(S.retryThrottling.maxTokens,S.retryThrottling.tokenRatio,ec.get(this.getTarget()))):ec.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=T,this.currentResolutionError=null,process.nextTick(()=>{let S=this.configSelectionQueue;for(let T of(this.configSelectionQueue=[],S.length>0&&this.callRefTimerUnref(),S))T.getConfig()})},S=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+S.code+' and details "'+S.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,en.restrictControlPlaneStatusCode)(S.code,S.details)),{metadata:S.metadata}));let T=this.configSelectionQueue;for(let R of(this.configSelectionQueue=[],T.length>0&&this.callRefTimerUnref(),T))R.reportResolverError(S)}),this.filterStackFactory=new U.FilterStackFactory([new V.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(R,void 0,2));let eT=Error();(0,K.trace)(L.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null===(em=eT.stack)||void 0===em?void 0:em.substring(eT.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(S,T){(0,K.trace)(null!=T?T:L.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Q.uriToString)(this.target)+" "+S)}callRefTimerRef(){var S,T,R,N;(null===(T=(S=this.callRefTimer).hasRef)||void 0===T?void 0:T.call(S))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(N=(R=this.callRefTimer).ref)||void 0===N||N.call(R))}callRefTimerUnref(){var S,T;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(T=(S=this.callRefTimer).unref)||void 0===T||T.call(S))}removeConnectivityStateWatcher(S){let T=this.connectivityStateWatchers.findIndex(T=>T===S);T>=0&&this.connectivityStateWatchers.splice(T,1)}updateState(S){for(let T of((0,K.trace)(L.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Q.uriToString)(this.target)+" "+Y.ConnectivityState[this.connectivityState]+" -> "+Y.ConnectivityState[S]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Y.ConnectivityState[S]),this.connectivityState=S,this.connectivityStateWatchers.slice()))S!==T.currentState&&(T.timer&&clearTimeout(T.timer),this.removeConnectivityStateWatcher(T),T.callback());S!==Y.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(S){if(S>this.keepaliveTime)for(let T of(this.keepaliveTime=S,this.wrappedSubchannels))T.throttleKeepalive(S)}removeWrappedSubchannel(S){this.wrappedSubchannels.delete(S)}doPick(S,T){return this.currentPicker.pick({metadata:S,extraPickInfo:T})}queueCallForPick(S){this.pickQueue.push(S),this.callRefTimerRef()}getConfig(S,T){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(S,T)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(S){this.configSelectionQueue.push(S),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Y.ConnectivityState.IDLE),this.currentPicker=new M.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(S){var T,R;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let S=new Date().valueOf()-this.lastActivityTimestamp.valueOf();S>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-S)},S),null===(R=(T=this.idleTimer).unref)||void 0===R||R.call(T)}maybeStartIdleTimer(){this.connectivityState===Y.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(S){this.channelzEnabled&&(S.code===L.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(S,T,R,N,O){let P=(0,er.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+P+'] method="'+T+'"'),new Z.LoadBalancingCall(this,S,T,R,N,O,P)}createRetryingCall(S,T,R,N,O){let P=(0,er.getNextCallNumber)();return this.trace("createRetryingCall ["+P+'] method="'+T+'"'),new ei.RetryingCall(this,S,T,R,N,O,P,this.retryBufferTracker,ec.get(this.getTarget()))}createInnerCall(S,T,R,N,O){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(S,T,R,N,O):this.createRetryingCall(S,T,R,N,O)}createResolvingCall(S,T,R,N,O){let P=(0,er.getNextCallNumber)();this.trace("createResolvingCall ["+P+'] method="'+S+'", deadline='+(0,ee.deadlineToString)(T));let M={deadline:T,flags:null!=O?O:L.Propagate.DEFAULTS,host:null!=R?R:this.defaultAuthority,parentCall:N},U=new et.ResolvingCall(this,S,M,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),P);return this.onCallStart(),U.addStatusWatcher(S=>{this.onCallEnd(S)}),U}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Y.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,X.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Q.uriToString)(this.target)}getConnectivityState(S){let T=this.connectivityState;return S&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),T}watchConnectivityState(S,T,R){if(this.connectivityState===Y.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let N=null;if(T!==1/0){let S=T instanceof Date?T:new Date(T),P=new Date;if(T===-1/0||S<=P){process.nextTick(R,Error("Deadline passed without connectivity state change"));return}N=setTimeout(()=>{this.removeConnectivityStateWatcher(O),R(Error("Deadline passed without connectivity state change"))},S.getTime()-P.getTime())}let O={currentState:S,callback:R,timer:N};this.connectivityStateWatchers.push(O)}getChannelzRef(){return this.channelzRef}createCall(S,T,R,N,O){if("string"!=typeof S)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof T||T instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Y.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(S,T,R,N,O)}}T.InternalChannel=ef},982:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ChildLoadBalancerHandler=void 0;let N=R(7176),O=R(3955),P="child_load_balancer_helper";class M{constructor(S){this.channelControlHelper=S,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(S){this.parent=S,this.child=null}createSubchannel(S,T){return this.parent.channelControlHelper.createSubchannel(S,T)}updateState(S,T){var R;if(this.calledByPendingChild()){if(S===O.ConnectivityState.CONNECTING)return;null===(R=this.parent.currentChild)||void 0===R||R.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(S,T)}requestReresolution(){var S;let T=null!==(S=this.parent.pendingChild)&&void 0!==S?S:this.parent.currentChild;this.child===T&&this.parent.channelControlHelper.requestReresolution()}setChild(S){this.child=S}addChannelzChild(S){this.parent.channelControlHelper.addChannelzChild(S)}removeChannelzChild(S){this.parent.channelControlHelper.removeChannelzChild(S)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(S,T){return S.getLoadBalancerName()!==T.getLoadBalancerName()}updateAddressList(S,T,R){let O;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,T)){let S=new this.ChildPolicyHelper(this),R=(0,N.createLoadBalancer)(T,S);S.setChild(R),null===this.currentChild?(this.currentChild=R,O=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=R,O=this.pendingChild)}else O=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=T,O.updateAddressList(S,T,R)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return P}}T.ChildLoadBalancerHandler=M},1433:(S,T,R)=>{"use strict";var N;Object.defineProperty(T,"__esModule",{value:!0}),T.setup=T.OutlierDetectionLoadBalancer=T.OutlierDetectionLoadBalancingConfig=void 0;let O=R(3955),P=R(2678),M=R(5330),L=R(345),U=R(7176),V=R(982),$=R(7064),K=R(3906),W=R(1407),Q=R(7504),Y="outlier_detection";function X(S){Q.trace(P.LogVerbosity.DEBUG,Y,S)}let Z="outlier_detection",ee=(null!==(N=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)&&void 0!==N?N:"true")==="true",et={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},er={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function en(S,T,R,N){if(T in S&&typeof S[T]!==R){let O=N?`${N}.${T}`:T;throw Error(`outlier detection config ${O} parse error: expected ${R}, got ${typeof S[T]}`)}}function ei(S,T,R){let N=R?`${R}.${T}`:T;if(T in S){if(!(0,M.isDuration)(S[T]))throw Error(`outlier detection config ${N} parse error: expected Duration, got ${typeof S[T]}`);if(!(S[T].seconds>=0&&S[T].seconds<=315576e6&&S[T].nanos>=0&&S[T].nanos<=999999999))throw Error(`outlier detection config ${N} parse error: values out of range for non-negative Duaration`)}}function es(S,T,R){let N=R?`${R}.${T}`:T;if(en(S,T,"number",R),T in S&&!(S[T]>=0&&S[T]<=100))throw Error(`outlier detection config ${N} parse error: value out of range for percentage (0-100)`)}class ea{constructor(S,T,R,N,O,P,M){if(this.childPolicy=M,M.length>0&&"pick_first"===M[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=S?S:1e4,this.baseEjectionTimeMs=null!=T?T:3e4,this.maxEjectionTimeMs=null!=R?R:3e5,this.maxEjectionPercent=null!=N?N:10,this.successRateEjection=O?Object.assign(Object.assign({},et),O):null,this.failurePercentageEjection=P?Object.assign(Object.assign({},er),P):null}getLoadBalancerName(){return Z}toJsonObject(){return{interval:(0,M.msToDuration)(this.intervalMs),base_ejection_time:(0,M.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,M.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(S=>S.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(S){return new ea(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,S)}static createFromJson(S){var T;if(ei(S,"interval"),ei(S,"base_ejection_time"),ei(S,"max_ejection_time"),es(S,"max_ejection_percent"),"success_rate_ejection"in S){if("object"!=typeof S.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");en(S.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),es(S.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),en(S.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),en(S.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in S){if("object"!=typeof S.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");es(S.failure_percentage_ejection,"threshold","failure_percentage_ejection"),es(S.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),en(S.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),en(S.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new ea(S.interval?(0,M.durationToMs)(S.interval):null,S.base_ejection_time?(0,M.durationToMs)(S.base_ejection_time):null,S.max_ejection_time?(0,M.durationToMs)(S.max_ejection_time):null,null!==(T=S.max_ejection_percent)&&void 0!==T?T:null,S.success_rate_ejection,S.failure_percentage_ejection,S.child_policy.map(U.validateLoadBalancingConfig))}}T.OutlierDetectionLoadBalancingConfig=ea;class eo extends W.BaseSubchannelWrapper{constructor(S,T){super(S),this.mapEntry=T,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=S.getConnectivityState(),S.addConnectivityStateListener((S,T,R,N)=>{if(this.childSubchannelState=R,!this.ejected)for(let S of this.stateListeners)S(this,T,R,N)})}getConnectivityState(){return this.ejected?O.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(S){this.stateListeners.push(S)}removeConnectivityStateListener(S){let T=this.stateListeners.indexOf(S);T>-1&&this.stateListeners.splice(T,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let S=this.mapEntry.subchannelWrappers.indexOf(this);S>=0&&this.mapEntry.subchannelWrappers.splice(S,1)}}eject(){for(let S of(this.ejected=!0,this.stateListeners))S(this,this.childSubchannelState,O.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let S of(this.ejected=!1,this.stateListeners))S(this,O.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function eu(){return{success:0,failure:0}}class ec{constructor(){this.activeBucket=eu(),this.inactiveBucket=eu()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=eu()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class eh{constructor(S,T){this.wrappedPicker=S,this.countCalls=T}pick(S){let T=this.wrappedPicker.pick(S);if(T.pickResultType!==$.PickResultType.COMPLETE)return T;{let S=T.subchannel,R=S.getMapEntry();if(!R)return Object.assign(Object.assign({},T),{subchannel:S.getWrappedSubchannel()});{let N=T.onCallEnded;return this.countCalls&&(N=S=>{var N;S===P.Status.OK?R.counter.addSuccess():R.counter.addFailure(),null===(N=T.onCallEnded)||void 0===N||N.call(T,S)}),Object.assign(Object.assign({},T),{subchannel:S.getWrappedSubchannel(),onCallEnded:N})}}}}class ed{constructor(S){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new V.ChildLoadBalancerHandler((0,L.createChildChannelControlHelper)(S,{createSubchannel:(T,R)=>{let N=S.createSubchannel(T,R),O=this.addressMap.get((0,K.subchannelAddressToString)(T)),P=new eo(N,O);return(null==O?void 0:O.currentEjectionTimestamp)!==null&&P.eject(),null==O||O.subchannelWrappers.push(P),P},updateState:(T,R)=>{T===O.ConnectivityState.READY?S.updateState(T,new eh(R,this.isCountingEnabled())):S.updateState(T,R)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let S=0;for(let T of this.addressMap.values())null!==T.currentEjectionTimestamp&&(S+=1);return 100*S/this.addressMap.size}runSuccessRateCheck(S){if(!this.latestConfig)return;let T=this.latestConfig.getSuccessRateEjectionConfig();if(!T)return;X("Running success rate check");let R=T.request_volume,N=0,O=[];for(let[S,T]of this.addressMap){let P=T.counter.getLastSuccesses(),M=T.counter.getLastFailures();X("Stats for "+S+": successes="+P+" failures="+M+" targetRequestVolume="+R),P+M>=R&&(N+=1,O.push(P/(P+M)))}if(X("Found "+N+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+O+"]"),N<T.minimum_hosts)return;let P=O.reduce((S,T)=>S+T)/O.length,M=0;for(let S of O){let T=S-P;M+=T*T}let L=Math.sqrt(M/O.length),U=P-T.stdev_factor/1e3*L;for(let[N,O]of(X("stdev="+L+" ejectionThreshold="+U),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let P=O.counter.getLastSuccesses(),M=O.counter.getLastFailures();if(P+M<R)continue;let L=P/(P+M);if(X("Checking candidate "+N+" successRate="+L),L<U){let R=100*Math.random();X("Candidate "+N+" randomNumber="+R+" enforcement_percentage="+T.enforcement_percentage),R<T.enforcement_percentage&&(X("Ejecting candidate "+N),this.eject(O,S))}}}runFailurePercentageCheck(S){if(!this.latestConfig)return;let T=this.latestConfig.getFailurePercentageEjectionConfig();if(!T)return;X("Running failure percentage check. threshold="+T.threshold+" request volume threshold="+T.request_volume);let R=0;for(let S of this.addressMap.values())S.counter.getLastSuccesses()+S.counter.getLastFailures()>=T.request_volume&&(R+=1);if(!(R<T.minimum_hosts))for(let[R,N]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let O=N.counter.getLastSuccesses(),P=N.counter.getLastFailures();if(X("Candidate successes="+O+" failures="+P),!(O+P<T.request_volume)&&100*P/(P+O)>T.threshold){let O=100*Math.random();X("Candidate "+R+" randomNumber="+O+" enforcement_percentage="+T.enforcement_percentage),O<T.enforcement_percentage&&(X("Ejecting candidate "+R),this.eject(N,S))}}}eject(S,T){for(let T of(S.currentEjectionTimestamp=new Date,S.ejectionTimeMultiplier+=1,S.subchannelWrappers))T.eject()}uneject(S){for(let T of(S.currentEjectionTimestamp=null,S.subchannelWrappers))T.uneject()}switchAllBuckets(){for(let S of this.addressMap.values())S.counter.switchBuckets()}startTimer(S){var T,R;this.ejectionTimer=setTimeout(()=>this.runChecks(),S),null===(R=(T=this.ejectionTimer).unref)||void 0===R||R.call(T)}runChecks(){let S=new Date;if(X("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[T,R]of(this.timerStartTime=S,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(S),this.runFailurePercentageCheck(S),this.addressMap.entries()))if(null===R.currentEjectionTimestamp)R.ejectionTimeMultiplier>0&&(R.ejectionTimeMultiplier-=1);else{let S=this.latestConfig.getBaseEjectionTimeMs(),N=this.latestConfig.getMaxEjectionTimeMs(),O=new Date(R.currentEjectionTimestamp.getTime());O.setMilliseconds(O.getMilliseconds()+Math.min(S*R.ejectionTimeMultiplier,Math.max(S,N))),O<new Date&&(X("Unejecting "+T),this.uneject(R))}}updateAddressList(S,T,R){if(!(T instanceof ea))return;let N=new Set;for(let T of S)N.add((0,K.subchannelAddressToString)(T));for(let S of N)this.addressMap.has(S)||(X("Adding map entry for "+S),this.addressMap.set(S,{counter:new ec,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let S of this.addressMap.keys())N.has(S)||(X("Removing map entry for "+S),this.addressMap.delete(S));let O=(0,U.getFirstUsableConfig)(T.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(S,O,R),T.getSuccessRateEjectionConfig()||T.getFailurePercentageEjectionConfig()){if(this.timerStartTime){X("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let S=T.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(S)}else X("Starting new timer"),this.timerStartTime=new Date,this.startTimer(T.getIntervalMs()),this.switchAllBuckets()}else for(let S of(X("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(S),S.ejectionTimeMultiplier=0;this.latestConfig=T}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Z}}function ep(){ee&&(0,L.registerLoadBalancerType)(Z,ed,ea)}T.OutlierDetectionLoadBalancer=ed,T.setup=ep},6170:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=T.PickFirstLoadBalancer=T.shuffled=T.PickFirstLoadBalancingConfig=void 0;let N=R(7176),O=R(3955),P=R(7064),M=R(7504),L=R(2678),U="pick_first";function V(S){M.trace(L.LogVerbosity.DEBUG,U,S)}let $="pick_first",K=250;class W{constructor(S){this.shuffleAddressList=S}getLoadBalancerName(){return $}toJsonObject(){return{[$]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(S){if("shuffleAddressList"in S&&"boolean"!=typeof S.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new W(!0===S.shuffleAddressList)}}T.PickFirstLoadBalancingConfig=W;class Q{constructor(S){this.subchannel=S}pick(S){return{pickResultType:P.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function Y(S){let T=S.slice();for(let S=T.length-1;S>1;S--){let R=Math.floor(Math.random()*(S+1)),N=T[S];T[S]=T[R],T[R]=N}return T}T.shuffled=Y;class X{constructor(S){this.channelControlHelper=S,this.children=[],this.currentState=O.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(S,T,R,N,O)=>{this.onSubchannelStateUpdate(S,T,R,O)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(S=>S.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(O.ConnectivityState.READY,new Q(this.currentPick)):0===this.children.length?this.updateState(O.ConnectivityState.IDLE,new P.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(O.ConnectivityState.TRANSIENT_FAILURE,new P.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(O.ConnectivityState.CONNECTING,new P.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:S}of(this.stickyTransientFailureMode=!0,this.children))S.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let S=this.currentPick;this.currentPick=null,S.unref(),S.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(S.getChannelzRef())}}onSubchannelStateUpdate(S,T,R,N){var P;if(null===(P=this.currentPick)||void 0===P?void 0:P.realSubchannelEquals(S)){R!==O.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[T,P]of this.children.entries())if(S.realSubchannelEquals(P.subchannel)){R===O.ConnectivityState.READY&&this.pickSubchannel(P.subchannel),R===O.ConnectivityState.TRANSIENT_FAILURE&&(P.hasReportedTransientFailure=!0,N&&(this.lastError=N),this.maybeEnterStickyTransientFailureMode(),T===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(T+1)),P.subchannel.startConnecting();return}}startNextSubchannelConnecting(S){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[T,R]of this.children.entries())if(T>=S){let S=R.subchannel.getConnectivityState();if(S===O.ConnectivityState.IDLE||S===O.ConnectivityState.CONNECTING){this.startConnecting(T);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(S){var T,R;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=S,this.children[S].subchannel.getConnectivityState()===O.ConnectivityState.IDLE&&(V("Start connecting to subchannel with address "+this.children[S].subchannel.getAddress()),process.nextTick(()=>{var T;null===(T=this.children[S])||void 0===T||T.subchannel.startConnecting()})),this.connectionDelayTimeout=null===(R=(T=setTimeout(()=>{this.startNextSubchannelConnecting(S+1)},K)).unref)||void 0===R?void 0:R.call(T)}pickSubchannel(S){this.currentPick&&S.realSubchannelEquals(this.currentPick)||(V("Pick subchannel with address "+S.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=S,S.ref(),this.channelControlHelper.addChannelzChild(S.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(S,T){V(O.ConnectivityState[this.currentState]+" -> "+O.ConnectivityState[S]),this.currentState=S,this.channelControlHelper.updateState(S,T)}resetSubchannelList(){for(let S of this.children)this.currentPick&&S.subchannel.realSubchannelEquals(this.currentPick)||S.subchannel.removeConnectivityStateListener(this.subchannelStateListener),S.subchannel.unref(),this.channelControlHelper.removeChannelzChild(S.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(S){let T=S.map(S=>({subchannel:this.channelControlHelper.createSubchannel(S,{}),hasReportedTransientFailure:!1}));for(let{subchannel:S}of T)S.ref(),this.channelControlHelper.addChannelzChild(S.getChannelzRef());for(let{subchannel:S}of(this.resetSubchannelList(),this.children=T,this.children))if(S.addConnectivityStateListener(this.subchannelStateListener),S.getConnectivityState()===O.ConnectivityState.READY){this.pickSubchannel(S);return}for(let S of this.children)S.subchannel.getConnectivityState()===O.ConnectivityState.TRANSIENT_FAILURE&&(S.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(S,T){T instanceof W&&(T.getShuffleAddressList()&&(S=Y(S)),this.latestAddressList=S,this.connectToAddressList(S))}exitIdle(){this.currentState===O.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return $}}function Z(){(0,N.registerLoadBalancerType)($,X,W),(0,N.registerDefaultLoadBalancerType)($)}T.PickFirstLoadBalancer=X,T.setup=Z},2255:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=T.RoundRobinLoadBalancer=void 0;let N=R(7176),O=R(3955),P=R(7064),M=R(3906),L=R(7504),U=R(2678),V="round_robin";function $(S){L.trace(U.LogVerbosity.DEBUG,V,S)}let K="round_robin";class W{getLoadBalancerName(){return K}constructor(){}toJsonObject(){return{[K]:{}}}static createFromJson(S){return new W}}class Q{constructor(S,T=0){this.subchannelList=S,this.nextIndex=T}pick(S){let T=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:P.PickResultType.COMPLETE,subchannel:T,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class Y{constructor(S){this.channelControlHelper=S,this.subchannels=[],this.currentState=O.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(S,T,R,N,P)=>{this.calculateAndUpdateState(),(R===O.ConnectivityState.TRANSIENT_FAILURE||R===O.ConnectivityState.IDLE)&&(P&&(this.lastError=P),this.channelControlHelper.requestReresolution(),S.startConnecting())}}countSubchannelsWithState(S){return this.subchannels.filter(T=>T.getConnectivityState()===S).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(O.ConnectivityState.READY)>0){let S=this.subchannels.filter(S=>S.getConnectivityState()===O.ConnectivityState.READY),T=0;null!==this.currentReadyPicker&&(T=S.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(T=0),this.updateState(O.ConnectivityState.READY,new Q(S,T))}else this.countSubchannelsWithState(O.ConnectivityState.CONNECTING)>0?this.updateState(O.ConnectivityState.CONNECTING,new P.QueuePicker(this)):this.countSubchannelsWithState(O.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(O.ConnectivityState.TRANSIENT_FAILURE,new P.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(O.ConnectivityState.IDLE,new P.QueuePicker(this))}updateState(S,T){$(O.ConnectivityState[this.currentState]+" -> "+O.ConnectivityState[S]),S===O.ConnectivityState.READY?this.currentReadyPicker=T:this.currentReadyPicker=null,this.currentState=S,this.channelControlHelper.updateState(S,T)}resetSubchannelList(){for(let S of this.subchannels)S.removeConnectivityStateListener(this.subchannelStateListener),S.unref(),this.channelControlHelper.removeChannelzChild(S.getChannelzRef());this.subchannels=[]}updateAddressList(S,T){for(let T of(this.resetSubchannelList(),$("Connect to address list "+S.map(S=>(0,M.subchannelAddressToString)(S))),this.subchannels=S.map(S=>this.channelControlHelper.createSubchannel(S,{})),this.subchannels)){T.ref(),T.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(T.getChannelzRef());let S=T.getConnectivityState();(S===O.ConnectivityState.IDLE||S===O.ConnectivityState.TRANSIENT_FAILURE)&&T.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let S of this.subchannels)S.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return K}}function X(){(0,N.registerLoadBalancerType)(K,Y,W)}T.RoundRobinLoadBalancer=Y,T.setup=X},7176:(S,T)=>{"use strict";function R(S,T){var R,N,O,P,M,L,U,V,$,K;return{createSubchannel:null!==(N=null===(R=T.createSubchannel)||void 0===R?void 0:R.bind(T))&&void 0!==N?N:S.createSubchannel.bind(S),updateState:null!==(P=null===(O=T.updateState)||void 0===O?void 0:O.bind(T))&&void 0!==P?P:S.updateState.bind(S),requestReresolution:null!==(L=null===(M=T.requestReresolution)||void 0===M?void 0:M.bind(T))&&void 0!==L?L:S.requestReresolution.bind(S),addChannelzChild:null!==(V=null===(U=T.addChannelzChild)||void 0===U?void 0:U.bind(T))&&void 0!==V?V:S.addChannelzChild.bind(S),removeChannelzChild:null!==(K=null===($=T.removeChannelzChild)||void 0===$?void 0:$.bind(T))&&void 0!==K?K:S.removeChannelzChild.bind(S)}}Object.defineProperty(T,"__esModule",{value:!0}),T.validateLoadBalancingConfig=T.getFirstUsableConfig=T.isLoadBalancerNameRegistered=T.createLoadBalancer=T.registerDefaultLoadBalancerType=T.registerLoadBalancerType=T.createChildChannelControlHelper=void 0,T.createChildChannelControlHelper=R;let N={},O=null;function P(S,T,R){N[S]={LoadBalancer:T,LoadBalancingConfig:R}}function M(S){O=S}function L(S,T){let R=S.getLoadBalancerName();return R in N?new N[R].LoadBalancer(T):null}function U(S){return S in N}function V(S,T=!1){for(let T of S)if(T.getLoadBalancerName() in N)return T;return T&&O?new N[O].LoadBalancingConfig:null}function $(S){if(!(null!==S&&"object"==typeof S))throw Error("Load balancing config must be an object");let T=Object.keys(S);if(1!==T.length)throw Error("Provided load balancing config has multiple conflicting entries");let R=T[0];if(R in N)return N[R].LoadBalancingConfig.createFromJson(S[R]);throw Error(`Unrecognized load balancing config name ${R}`)}T.registerLoadBalancerType=P,T.registerDefaultLoadBalancerType=M,T.createLoadBalancer=L,T.isLoadBalancerNameRegistered=U,T.getFirstUsableConfig=V,T.validateLoadBalancingConfig=$},980:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.LoadBalancingCall=void 0;let N=R(3955),O=R(2678),P=R(7931),M=R(2252),L=R(7064),U=R(8429),V=R(7504),$=R(2155),K=R(5158),W="load_balancing_call";class Q{constructor(S,T,R,N,O,P,M){var L,V;this.channel=S,this.callConfig=T,this.methodName=R,this.host=N,this.credentials=O,this.deadline=P,this.callNumber=M,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let $=this.methodName.split("/"),K="";$.length>=2&&(K=$[1]);let W=null!==(V=null===(L=(0,U.splitHostPort)(this.host))||void 0===L?void 0:L.host)&&void 0!==V?V:"localhost";this.serviceUrl=`https://${W}/${K}`}trace(S){V.trace(O.LogVerbosity.DEBUG,W,"["+this.callNumber+"] "+S)}outputStatus(S,T){var R,N;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+S.code+' details="'+S.details+'"');let O=Object.assign(Object.assign({},S),{progress:T});null===(R=this.listener)||void 0===R||R.onReceiveStatus(O),null===(N=this.onCallEnded)||void 0===N||N.call(this,O.code)}}doPick(){var S,T;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let R=this.channel.doPick(this.metadata,this.callConfig.pickInformation),U=R.subchannel?"("+R.subchannel.getChannelzRef().id+") "+R.subchannel.getAddress():""+R.subchannel;switch(this.trace("Pick result: "+L.PickResultType[R.pickResultType]+" subchannel: "+U+" status: "+(null===(S=R.status)||void 0===S?void 0:S.code)+" "+(null===(T=R.status)||void 0===T?void 0:T.details)),R.pickResultType){case L.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(S=>{var T,L,V;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let $=this.metadata.clone();if($.merge(S),$.get("authorization").length>1&&this.outputStatus({code:O.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new M.Metadata},"PROCESSED"),R.subchannel.getConnectivityState()!==N.ConnectivityState.READY){this.trace("Picked subchannel "+U+" has state "+N.ConnectivityState[R.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&$.set("grpc-timeout",(0,P.getDeadlineTimeoutString)(this.deadline));try{this.child=R.subchannel.getRealSubchannel().createCall($,this.host,this.methodName,{onReceiveMetadata:S=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(S)},onReceiveMessage:S=>{this.trace("Received message"),this.listener.onReceiveMessage(S)},onReceiveStatus:S=>{this.trace("Received status"),S.rstCode===K.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(S,"REFUSED"):this.outputStatus(S,"PROCESSED")}})}catch(S){this.trace("Failed to start call on picked subchannel "+U+" with error "+S.message),this.outputStatus({code:O.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+S.message,metadata:new M.Metadata},"NOT_STARTED");return}null===(L=(T=this.callConfig).onCommitted)||void 0===L||L.call(T),null===(V=R.onCallStarted)||void 0===V||V.call(R),this.onCallEnded=R.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},S=>{let{code:T,details:R}=(0,$.restrictControlPlaneStatusCode)("number"==typeof S.code?S.code:O.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${S.message}`);this.outputStatus({code:T,details:R,metadata:new M.Metadata},"PROCESSED")});break;case L.PickResultType.DROP:let{code:V,details:W}=(0,$.restrictControlPlaneStatusCode)(R.status.code,R.status.details);setImmediate(()=>{this.outputStatus({code:V,details:W,metadata:R.status.metadata},"DROP")});break;case L.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:S,details:T}=(0,$.restrictControlPlaneStatusCode)(R.status.code,R.status.details);setImmediate(()=>{this.outputStatus({code:S,details:T,metadata:R.status.metadata},"PROCESSED")})}break;case L.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(S,T){var R;this.trace("cancelWithStatus code: "+S+' details: "'+T+'"'),null===(R=this.child)||void 0===R||R.cancelWithStatus(S,T),this.outputStatus({code:S,details:T,metadata:new M.Metadata},"PROCESSED")}getPeer(){var S,T;return null!==(T=null===(S=this.child)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:this.channel.getTarget()}start(S,T){this.trace("start called"),this.listener=T,this.metadata=S,this.doPick()}sendMessageWithContext(S,T){this.trace("write() called with message of length "+T.length),this.child?this.child.sendMessageWithContext(S,T):this.pendingMessage={context:S,message:T}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(S){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}T.LoadBalancingCall=Q},7504:(S,T,R)=>{"use strict";var N,O,P,M;Object.defineProperty(T,"__esModule",{value:!0}),T.isTracerEnabled=T.trace=T.log=T.setLoggerVerbosity=T.setLogger=T.getLogger=void 0;let L=R(2678),U=R(7282),V=R(7231).i8,$={error:(S,...T)=>{console.error("E "+S,...T)},info:(S,...T)=>{console.error("I "+S,...T)},debug:(S,...T)=>{console.error("D "+S,...T)}},K=L.LogVerbosity.ERROR;switch((null!==(O=null!==(N=process.env.GRPC_NODE_VERBOSITY)&&void 0!==N?N:process.env.GRPC_VERBOSITY)&&void 0!==O?O:"").toUpperCase()){case"DEBUG":K=L.LogVerbosity.DEBUG;break;case"INFO":K=L.LogVerbosity.INFO;break;case"ERROR":K=L.LogVerbosity.ERROR;break;case"NONE":K=L.LogVerbosity.NONE}let W=()=>$;T.getLogger=W;let Q=S=>{$=S};T.setLogger=Q;let Y=S=>{K=S};T.setLoggerVerbosity=Y;let X=(S,...T)=>{let R;if(S>=K){switch(S){case L.LogVerbosity.DEBUG:R=$.debug;break;case L.LogVerbosity.INFO:R=$.info;break;case L.LogVerbosity.ERROR:R=$.error}R||(R=$.error),R&&R.bind($)(...T)}};T.log=X;let Z=null!==(M=null!==(P=process.env.GRPC_NODE_TRACE)&&void 0!==P?P:process.env.GRPC_TRACE)&&void 0!==M?M:"",ee=new Set,et=new Set;for(let S of Z.split(","))S.startsWith("-")?et.add(S.substring(1)):ee.add(S);let er=ee.has("all");function en(S,R,N){ei(R)&&(0,T.log)(S,new Date().toISOString()+" | v"+V+" "+U.pid+" | "+R+" | "+N)}function ei(S){return!et.has(S)&&(er||ee.has(S))}T.trace=en,T.isTracerEnabled=ei},5085:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.loadPackageDefinition=T.makeClientConstructor=void 0;let N=R(9800),O={unary:N.Client.prototype.makeUnaryRequest,server_stream:N.Client.prototype.makeServerStreamRequest,client_stream:N.Client.prototype.makeClientStreamRequest,bidi:N.Client.prototype.makeBidiStreamRequest};function P(S){return["__proto__","prototype","constructor"].includes(S)}function M(S,T,R){R||(R={});class M extends N.Client{}return Object.keys(S).forEach(T=>{let R;if(P(T))return;let N=S[T];if("string"==typeof T&&"$"===T.charAt(0))throw Error("Method names cannot start with $");R=N.requestStream?N.responseStream?"bidi":"client_stream":N.responseStream?"server_stream":"unary";let U=N.requestSerialize,V=N.responseDeserialize,$=L(O[R],N.path,U,V);M.prototype[T]=$,Object.assign(M.prototype[T],N),N.originalName&&!P(N.originalName)&&(M.prototype[N.originalName]=M.prototype[T])}),M.service=S,M.serviceName=T,M}function L(S,T,R,N){return function(...O){return S.call(this,T,R,N,...O)}}function U(S){return"format"in S}function V(S){let T={};for(let R in S)if(Object.prototype.hasOwnProperty.call(S,R)){let N=S[R],O=R.split(".");if(O.some(S=>P(S)))continue;let L=O[O.length-1],V=T;for(let S of O.slice(0,-1))V[S]||(V[S]={}),V=V[S];U(N)?V[L]=N:V[L]=M(N,L,{})}return T}T.makeClientConstructor=M,T.loadPackageDefinition=V},2252:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Metadata=void 0;let N=R(7504),O=R(2678),P=R(5437),M=/^[0-9a-z_.-]+$/,L=/^[ -~]*$/;function U(S){return M.test(S)}function V(S){return L.test(S)}function $(S){return S.endsWith("-bin")}function K(S){return!S.startsWith("grpc-")}function W(S){return S.toLowerCase()}function Q(S,T){if(!U(S))throw Error('Metadata key "'+S+'" contains illegal characters');if(null!=T){if($(S)){if(!Buffer.isBuffer(T))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(T))throw Error("keys that don't end with '-bin' must have String values");if(!V(T))throw Error('Metadata string value "'+T+'" contains illegal characters')}}}class Y{constructor(S={}){this.internalRepr=new Map,this.options=S}set(S,T){Q(S=W(S),T),this.internalRepr.set(S,[T])}add(S,T){Q(S=W(S),T);let R=this.internalRepr.get(S);void 0===R?this.internalRepr.set(S,[T]):R.push(T)}remove(S){S=W(S),this.internalRepr.delete(S)}get(S){return S=W(S),this.internalRepr.get(S)||[]}getMap(){let S={};for(let[T,R]of this.internalRepr)if(R.length>0){let N=R[0];S[T]=Buffer.isBuffer(N)?Buffer.from(N):N}return S}clone(){let S=new Y(this.options),T=S.internalRepr;for(let[S,R]of this.internalRepr){let N=R.map(S=>Buffer.isBuffer(S)?Buffer.from(S):S);T.set(S,N)}return S}merge(S){for(let[T,R]of S.internalRepr){let S=(this.internalRepr.get(T)||[]).concat(R);this.internalRepr.set(T,S)}}setOptions(S){this.options=S}getOptions(){return this.options}toHttp2Headers(){let S={};for(let[T,R]of this.internalRepr)S[T]=R.map(X);return S}toJSON(){let S={};for(let[T,R]of this.internalRepr)S[T]=R;return S}static fromHttp2Headers(S){let T=new Y;for(let R of Object.keys(S)){if(":"===R.charAt(0))continue;let M=S[R];try{$(R)?Array.isArray(M)?M.forEach(S=>{T.add(R,Buffer.from(S,"base64"))}):void 0!==M&&(K(R)?M.split(",").forEach(S=>{T.add(R,Buffer.from(S.trim(),"base64"))}):T.add(R,Buffer.from(M,"base64"))):Array.isArray(M)?M.forEach(S=>{T.add(R,S)}):void 0!==M&&T.add(R,M)}catch(T){let S=`Failed to add metadata entry ${R}: ${M}. ${(0,P.getErrorMessage)(T)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,N.log)(O.LogVerbosity.ERROR,S)}}return T}}T.Metadata=Y;let X=S=>Buffer.isBuffer(S)?S.toString("base64"):S},7064:(S,T,R)=>{"use strict";var N;Object.defineProperty(T,"__esModule",{value:!0}),T.QueuePicker=T.UnavailablePicker=T.PickResultType=void 0;let O=R(2252),P=R(2678);!function(S){S[S.COMPLETE=0]="COMPLETE",S[S.QUEUE=1]="QUEUE",S[S.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",S[S.DROP=3]="DROP"}(N||(T.PickResultType=N={}));class M{constructor(S){this.status=Object.assign({code:P.Status.UNAVAILABLE,details:"No connection established",metadata:new O.Metadata},S)}pick(S){return{pickResultType:N.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}T.UnavailablePicker=M;class L{constructor(S){this.loadBalancer=S,this.calledExitIdle=!1}pick(S){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:N.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}T.QueuePicker=L},4605:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=T.DEFAULT_PORT=void 0;let N=R(492),O=R(9523),P=R(3837),M=R(6262),L=R(2678),U=R(2252),V=R(7504),$=R(2678),K=R(8429),W=R(1808),Q=R(4934),Y="dns_resolver";function X(S){V.trace($.LogVerbosity.DEBUG,Y,S)}T.DEFAULT_PORT=443;let Z=3e4,ee=P.promisify(O.resolveTxt),et=P.promisify(O.lookup);function er(...S){let T=[];for(let R=0;R<Math.max.apply(null,S.map(S=>S.length));R++)for(let N of S)R<N.length&&T.push(N[R]);return T}class en{constructor(S,R,N){var O,P,M;this.target=S,this.listener=R,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,X("Resolver constructed for target "+(0,K.uriToString)(S));let V=(0,K.splitHostPort)(S.path);null===V?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,W.isIPv4)(V.host)||(0,W.isIPv6)(V.host)?(this.ipResult=[{host:V.host,port:null!==(O=V.port)&&void 0!==O?O:T.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=V.host,this.port=null!==(P=V.port)&&void 0!==P?P:T.DEFAULT_PORT),this.percentage=100*Math.random(),1===N["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:L.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,K.uriToString)(this.target)}`,metadata:new U.Metadata};let $={initialDelay:N["grpc.initial_reconnect_backoff_ms"],maxDelay:N["grpc.max_reconnect_backoff_ms"]};this.backoff=new Q.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},$),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!==(M=N["grpc.dns_min_time_between_resolutions_ms"])&&void 0!==M?M:Z,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(X("Returning IP address for target "+(0,K.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)X("Failed to parse DNS address "+(0,K.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:L.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,K.uriToString)(this.target)}`,metadata:new U.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;X("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let S=this.dnsHostname;this.pendingLookupPromise=et(S,{all:!0}),this.pendingLookupPromise.then(S=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let T=S.filter(S=>4===S.family),R=S.filter(S=>6===S.family);this.latestLookupResult=er(R,T).map(S=>({host:S.address,port:+this.port}));let N="["+this.latestLookupResult.map(S=>S.host+":"+S.port).join(",")+"]";if(X("Resolved addresses for target "+(0,K.uriToString)(this.target)+": "+N),0===this.latestLookupResult.length){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},S=>{null!==this.pendingLookupPromise&&(X("Resolution error for target "+(0,K.uriToString)(this.target)+": "+S.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=ee(S),this.pendingTxtPromise.then(S=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,M.extractAndSelectServiceConfig)(S,this.percentage)}catch(S){this.latestServiceConfigError={code:L.Status.UNAVAILABLE,details:`Parsing service config failed with error ${S.message}`,metadata:new U.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},S=>{}))}}startNextResolutionTimer(){var S,T;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null===(T=(S=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)||void 0===T?void 0:T.call(S),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?X('resolution update delayed by "min time between resolutions" rate limit'):X("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(S){return S.path}}function ei(){(0,N.registerResolver)("dns",en),(0,N.registerDefaultScheme)("dns")}T.setup=ei},3562:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=void 0;let N=R(1808),O=R(2678),P=R(2252),M=R(492),L=R(8429),U=R(7504),V="ip_resolver";function $(S){U.trace(O.LogVerbosity.DEBUG,V,S)}let K="ipv4",W="ipv6",Q=443;class Y{constructor(S,T,R){var M;this.listener=T,this.addresses=[],this.error=null,this.hasReturnedResult=!1,$("Resolver constructed for target "+(0,L.uriToString)(S));let U=[];if(!(S.scheme===K||S.scheme===W)){this.error={code:O.Status.UNAVAILABLE,details:`Unrecognized scheme ${S.scheme} in IP resolver`,metadata:new P.Metadata};return}for(let T of S.path.split(",")){let R=(0,L.splitHostPort)(T);if(null===R||S.scheme===K&&!(0,N.isIPv4)(R.host)||S.scheme===W&&!(0,N.isIPv6)(R.host)){this.error={code:O.Status.UNAVAILABLE,details:`Failed to parse ${S.scheme} address ${T}`,metadata:new P.Metadata};return}U.push({host:R.host,port:null!==(M=R.port)&&void 0!==M?M:Q})}this.addresses=U,$("Parsed "+S.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(S){return S.path.split(",")[0]}}function X(){(0,M.registerResolver)(K,Y),(0,M.registerResolver)(W,Y)}T.setup=X},5862:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.setup=void 0;let N=R(492);class O{constructor(S,T,R){let N;this.listener=T,this.addresses=[],this.hasReturnedResult=!1,N=""===S.authority?"/"+S.path:S.path,this.addresses=[{path:N}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(S){return"localhost"}}function P(){(0,N.registerResolver)("unix",O)}T.setup=P},492:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.mapUriDefaultScheme=T.getDefaultAuthority=T.createResolver=T.registerDefaultScheme=T.registerResolver=void 0;let N=R(8429),O={},P=null;function M(S,T){O[S]=T}function L(S){P=S}function U(S,T,R){if(void 0!==S.scheme&&S.scheme in O)return new O[S.scheme](S,T,R);throw Error(`No resolver could be created for target ${(0,N.uriToString)(S)}`)}function V(S){if(void 0!==S.scheme&&S.scheme in O)return O[S.scheme].getDefaultAuthority(S);throw Error(`Invalid target ${(0,N.uriToString)(S)}`)}function $(S){return void 0!==S.scheme&&S.scheme in O?S:null!==P?{scheme:P,authority:void 0,path:(0,N.uriToString)(S)}:null}T.registerResolver=M,T.registerDefaultScheme=L,T.createResolver=U,T.getDefaultAuthority=V,T.mapUriDefaultScheme=$},3003:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ResolvingCall=void 0;let N=R(2678),O=R(7931),P=R(2252),M=R(7504),L=R(2155),U="resolving_call";class V{constructor(S,T,R,P,M,L){this.channel=S,this.method=T,this.filterStackFactory=P,this.credentials=M,this.callNumber=L,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=R.deadline,this.host=R.host,R.parentCall&&(R.flags&N.Propagate.CANCELLATION&&R.parentCall.on("cancelled",()=>{this.cancelWithStatus(N.Status.CANCELLED,"Cancelled by parent call")}),R.flags&N.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+R.parentCall.getDeadline()),this.deadline=(0,O.minDeadline)(this.deadline,R.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(S){M.trace(N.LogVerbosity.DEBUG,U,"["+this.callNumber+"] "+S)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,O.deadlineToString)(this.deadline));let S=(0,O.getRelativeTimeout)(this.deadline);if(S!==1/0){this.trace("Deadline will be reached in "+S+"ms");let T=()=>{this.cancelWithStatus(N.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};S<=0?process.nextTick(T):this.deadlineTimer=setTimeout(T,S)}}outputStatus(S){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let T=this.filterStack.receiveTrailers(S);this.trace("ended with status: code="+T.code+' details="'+T.details+'"'),this.statusWatchers.forEach(S=>S(T)),process.nextTick(()=>{var S;null===(S=this.listener)||void 0===S||S.onReceiveStatus(T)})}}sendMessageOnChild(S,T){if(!this.child)throw Error("sendMessageonChild called with child not populated");let R=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:T,flags:S.flags})).then(T=>{this.writeFilterPending=!1,R.sendMessageWithContext(S,T.message),this.pendingHalfClose&&R.halfClose()},S=>{this.cancelWithStatus(S.code,S.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let S=this.channel.getConfig(this.method,this.metadata);if("NONE"===S.type){this.channel.queueCallForConfig(this);return}if("ERROR"===S.type){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(S.error);return}let T=S.config;if(T.status!==N.Status.OK){let{code:S,details:R}=(0,L.restrictControlPlaneStatusCode)(T.status,"Failed to route call to method "+this.method);this.outputStatus({code:S,details:R,metadata:new P.Metadata});return}if(T.methodConfig.timeout){let S=new Date;S.setSeconds(S.getSeconds()+T.methodConfig.timeout.seconds),S.setMilliseconds(S.getMilliseconds()+T.methodConfig.timeout.nanos/1e6),this.deadline=(0,O.minDeadline)(this.deadline,S),this.runDeadlineTimer()}this.filterStackFactory.push(T.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(S=>{this.child=this.channel.createInnerCall(T,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(S,{onReceiveMetadata:S=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(S))},onReceiveMessage:S=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(S).then(S=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(S),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},S=>{this.cancelWithStatus(S.code,S.details)})},onReceiveStatus:S=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=S:this.outputStatus(S)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},S=>{this.outputStatus(S)})}reportResolverError(S){var T;(null===(T=this.metadata)||void 0===T?void 0:T.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(S)}cancelWithStatus(S,T){var R;this.trace("cancelWithStatus code: "+S+' details: "'+T+'"'),null===(R=this.child)||void 0===R||R.cancelWithStatus(S,T),this.outputStatus({code:S,details:T,metadata:new P.Metadata})}getPeer(){var S,T;return null!==(T=null===(S=this.child)||void 0===S?void 0:S.getPeer())&&void 0!==T?T:this.channel.getTarget()}start(S,T){this.trace("start called"),this.metadata=S.clone(),this.listener=T,this.getConfig()}sendMessageWithContext(S,T){this.trace("write() called with message of length "+T.length),this.child?this.sendMessageOnChild(S,T):this.pendingMessage={context:S,message:T}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(S){this.credentials=this.credentials.compose(S)}addStatusWatcher(S){this.statusWatchers.push(S)}getCallNumber(){return this.callNumber}}T.ResolvingCall=V},2380:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ResolvingLoadBalancer=void 0;let N=R(7176),O=R(6262),P=R(3955),M=R(492),L=R(7064),U=R(4934),V=R(2678),$=R(2252),K=R(7504),W=R(2678),Q=R(8429),Y=R(982),X="resolving_load_balancer";function Z(S){K.trace(W.LogVerbosity.DEBUG,X,S)}let ee=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function et(S,T,R,N){for(let O of R.name)switch(N){case"EMPTY":if(!O.service&&!O.method)return!0;break;case"SERVICE":if(O.service===S&&!O.method)return!0;break;case"SERVICE_AND_METHOD":if(O.service===S&&O.method===T)return!0}return!1}function er(S,T,R,N){for(let O of R)if(et(S,T,O,N))return O;return null}function en(S){return function(T,R){var N,O;let P=T.split("/").filter(S=>S.length>0),M=null!==(N=P[0])&&void 0!==N?N:"",L=null!==(O=P[1])&&void 0!==O?O:"";if(S&&S.methodConfig)for(let T of ee){let R=er(M,L,S.methodConfig,T);if(R)return{methodConfig:R,pickInformation:{},status:V.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:V.Status.OK,dynamicFilterFactories:[]}}}class ei{constructor(S,T,R,K,W){this.target=S,this.channelControlHelper=T,this.onSuccessfulResolution=K,this.onFailedResolution=W,this.latestChildState=P.ConnectivityState.IDLE,this.latestChildPicker=new L.QueuePicker(this),this.currentState=P.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,R["grpc.service_config"]?this.defaultServiceConfig=(0,O.validateServiceConfig)(JSON.parse(R["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(P.ConnectivityState.IDLE,new L.QueuePicker(this)),this.childLoadBalancer=new Y.ChildLoadBalancerHandler({createSubchannel:T.createSubchannel.bind(T),requestReresolution:()=>{this.backoffTimeout.isRunning()?(Z("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(S,T)=>{this.latestChildState=S,this.latestChildPicker=T,this.updateState(S,T)},addChannelzChild:T.addChannelzChild.bind(T),removeChannelzChild:T.removeChannelzChild.bind(T)}),this.innerResolver=(0,M.createResolver)(S,{onSuccessfulResolution:(S,T,R,O,P)=>{var M;this.backoffTimeout.stop(),this.backoffTimeout.reset();let L=null;null===T?null===R?(this.previousServiceConfig=null,L=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(R):L=this.previousServiceConfig:(L=T,this.previousServiceConfig=T);let U=null!==(M=null==L?void 0:L.loadBalancingConfig)&&void 0!==M?M:[],K=(0,N.getFirstUsableConfig)(U,!0);if(null===K){this.handleResolutionFailure({code:V.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new $.Metadata});return}this.childLoadBalancer.updateAddressList(S,K,P);let W=null!=L?L:this.defaultServiceConfig;this.onSuccessfulResolution(W,null!=O?O:en(W))},onError:S=>{this.handleResolutionFailure(S)}},R);let Q={initialDelay:R["grpc.initial_reconnect_backoff_ms"],maxDelay:R["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new U.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},Q),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===P.ConnectivityState.IDLE&&this.updateState(P.ConnectivityState.CONNECTING,new L.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(S,T){Z((0,Q.uriToString)(this.target)+" "+P.ConnectivityState[this.currentState]+" -> "+P.ConnectivityState[S]),S===P.ConnectivityState.IDLE&&(T=new L.QueuePicker(this)),this.currentState=S,this.channelControlHelper.updateState(S,T)}handleResolutionFailure(S){this.latestChildState===P.ConnectivityState.IDLE&&(this.updateState(P.ConnectivityState.TRANSIENT_FAILURE,new L.UnavailablePicker(S)),this.onFailedResolution(S))}exitIdle(){(this.currentState===P.ConnectivityState.IDLE||this.currentState===P.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(S,T){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=P.ConnectivityState.IDLE,this.latestChildPicker=new L.QueuePicker(this),this.currentState=P.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}T.ResolvingLoadBalancer=ei},4398:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.RetryingCall=T.MessageBufferTracker=T.RetryThrottler=void 0;let N=R(2678),O=R(2252),P=R(7504),M="retrying_call";class L{constructor(S,T,R){this.maxTokens=S,this.tokenRatio=T,R?this.tokens=R.tokens*(S/R.maxTokens):this.tokens=S}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}T.RetryThrottler=L;class U{constructor(S,T){this.totalLimit=S,this.limitPerCall=T,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(S,T){var R;let N=null!==(R=this.allocatedPerCall.get(T))&&void 0!==R?R:0;return!(this.limitPerCall-N<S)&&!(this.totalLimit-this.totalAllocated<S)&&(this.allocatedPerCall.set(T,N+S),this.totalAllocated+=S,!0)}free(S,T){var R;if(this.totalAllocated<S)throw Error(`Invalid buffer allocation state: call ${T} freed ${S} > total allocated ${this.totalAllocated}`);this.totalAllocated-=S;let N=null!==(R=this.allocatedPerCall.get(T))&&void 0!==R?R:0;if(N<S)throw Error(`Invalid buffer allocation state: call ${T} freed ${S} > allocated for call ${N}`);this.allocatedPerCall.set(T,N-S)}freeAll(S){var T;let R=null!==(T=this.allocatedPerCall.get(S))&&void 0!==T?T:0;if(this.totalAllocated<R)throw Error(`Invalid buffer allocation state: call ${S} allocated ${R} > total allocated ${this.totalAllocated}`);this.totalAllocated-=R,this.allocatedPerCall.delete(S)}}T.MessageBufferTracker=U;let V="grpc-previous-rpc-attempts";class ${constructor(S,T,R,N,O,P,M,L,U){if(this.channel=S,this.callConfig=T,this.methodName=R,this.host=N,this.credentials=O,this.deadline=P,this.callNumber=M,this.bufferTracker=L,this.retryThrottler=U,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,T.methodConfig.retryPolicy){this.state="RETRY";let S=T.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(S.initialBackoff.substring(0,S.initialBackoff.length-1))}else T.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(S){P.trace(N.LogVerbosity.DEBUG,M,"["+this.callNumber+"] "+S)}reportStatus(S){this.trace("ended with status: code="+S.code+' details="'+S.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var T;null===(T=this.listener)||void 0===T||T.onReceiveStatus({code:S.code,details:S.details,metadata:S.metadata})})}cancelWithStatus(S,T){for(let{call:R}of(this.trace("cancelWithStatus code: "+S+' details: "'+T+'"'),this.reportStatus({code:S,details:T,metadata:new O.Metadata}),this.underlyingCalls))R.cancelWithStatus(S,T)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(S){var T;return null!==(T=this.writeBuffer[S-this.writeBufferOffset])&&void 0!==T?T:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let S=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let T=this.writeBufferOffset;T<S;T++){let S=this.getBufferEntry(T);S.allocated&&this.bufferTracker.free(S.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(S-this.writeBufferOffset),this.writeBufferOffset=S}commitCall(S){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[S].state){this.trace("Committing call ["+this.underlyingCalls[S].call.getCallNumber()+"] at index "+S),this.state="COMMITTED",this.committedCallIndex=S;for(let T=0;T<this.underlyingCalls.length;T++)T!==S&&"COMPLETED"!==this.underlyingCalls[T].state&&(this.underlyingCalls[T].state="COMPLETED",this.underlyingCalls[T].call.cancelWithStatus(N.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let S=-1,T=-1;for(let[R,N]of this.underlyingCalls.entries())"ACTIVE"===N.state&&N.nextMessageToSend>S&&(S=N.nextMessageToSend,T=R);-1===T?this.state="TRANSPARENT_ONLY":this.commitCall(T)}isStatusCodeInList(S,T){return S.some(S=>S===T||S.toString().toLowerCase()===N.Status[T].toLowerCase())}getNextRetryBackoffMs(){var S;let T=null===(S=this.callConfig)||void 0===S?void 0:S.methodConfig.retryPolicy;if(!T)return 0;let R=Math.random()*this.nextRetryBackoffSec*1e3,N=Number(T.maxBackoff.substring(0,T.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*T.backoffMultiplier,N),R}maybeRetryCall(S,T){let R;if("RETRY"!==this.state){T(!1);return}let N=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(N.maxAttempts,5)){T(!1);return}if(null===S)R=this.getNextRetryBackoffMs();else if(S<0){this.state="TRANSPARENT_ONLY",T(!1);return}else R=S,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var S,R;if("RETRY"!==this.state){T(!1);return}(null===(R=null===(S=this.retryThrottler)||void 0===S?void 0:S.canRetryCall())||void 0===R||R)&&(T(!0),this.attempts+=1,this.startNewAttempt())},R)}countActiveCalls(){let S=0;for(let T of this.underlyingCalls)(null==T?void 0:T.state)==="ACTIVE"&&(S+=1);return S}handleProcessedStatus(S,T,R){var N,O,P;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(T),this.reportStatus(S);break;case"HEDGING":if(this.isStatusCodeInList(null!==(N=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)&&void 0!==N?N:[],S.code)){let N;if(null===(O=this.retryThrottler)||void 0===O||O.addCallFailed(),null===R)N=0;else if(R<0){this.state="TRANSPARENT_ONLY",this.commitCall(T),this.reportStatus(S);return}else N=R;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(T),this.reportStatus(S))},N)}else this.commitCall(T),this.reportStatus(S);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,S.code)?(null===(P=this.retryThrottler)||void 0===P||P.addCallFailed(),this.maybeRetryCall(R,R=>{R||(this.commitCall(T),this.reportStatus(S))})):(this.commitCall(T),this.reportStatus(S))}}getPushback(S){let T=S.get("grpc-retry-pushback-ms");if(0===T.length)return null;try{return parseInt(T[0])}catch(S){return -1}}handleChildStatus(S,T){var R;if("COMPLETED"===this.underlyingCalls[T].state)return;if(this.trace("state="+this.state+" handling status with progress "+S.progress+" from child ["+this.underlyingCalls[T].call.getCallNumber()+"] in state "+this.underlyingCalls[T].state),this.underlyingCalls[T].state="COMPLETED",S.code===N.Status.OK){null===(R=this.retryThrottler)||void 0===R||R.addCallSucceeded(),this.commitCall(T),this.reportStatus(S);return}if("COMMITTED"===this.state){this.reportStatus(S);return}let O=this.getPushback(S.metadata);switch(S.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(S,T,O):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(T),this.reportStatus(S);break;case"PROCESSED":this.handleProcessedStatus(S,T,O)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let S=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(S.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var S,T,R;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let N=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(N.maxAttempts,5))return;let O=null!==(S=N.hedgingDelay)&&void 0!==S?S:"0s",P=Number(O.substring(0,O.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*P),null===(R=(T=this.hedgingTimer).unref)||void 0===R||R.call(T)}startNewAttempt(){let S=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+S.getCallNumber()+"] for attempt "+this.attempts);let T=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:S,nextMessageToSend:0});let R=this.attempts-1,N=this.initialMetadata.clone();R>0&&N.set(V,`${R}`);let O=!1;S.start(N,{onReceiveMetadata:N=>{this.trace("Received metadata from child ["+S.getCallNumber()+"]"),this.commitCall(T),O=!0,R>0&&N.set(V,`${R}`),"ACTIVE"===this.underlyingCalls[T].state&&this.listener.onReceiveMetadata(N)},onReceiveMessage:R=>{this.trace("Received message from child ["+S.getCallNumber()+"]"),this.commitCall(T),"ACTIVE"===this.underlyingCalls[T].state&&this.listener.onReceiveMessage(R)},onReceiveStatus:N=>{this.trace("Received status from child ["+S.getCallNumber()+"]"),!O&&R>0&&N.metadata.set(V,`${R}`),this.handleChildStatus(N,T)}}),this.sendNextChildMessage(T),this.readStarted&&S.startRead()}start(S,T){this.trace("start called"),this.listener=T,this.initialMetadata=S,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(S){var T,R;let N=this.underlyingCalls[S],O=N.nextMessageToSend;null===(R=(T=this.getBufferEntry(O)).callback)||void 0===R||R.call(T),this.clearSentMessages(),N.nextMessageToSend+=1,this.sendNextChildMessage(S)}sendNextChildMessage(S){let T=this.underlyingCalls[S];if("COMPLETED"!==T.state&&this.getBufferEntry(T.nextMessageToSend)){let R=this.getBufferEntry(T.nextMessageToSend);switch(R.entryType){case"MESSAGE":T.call.sendMessageWithContext({callback:T=>{this.handleChildWriteCompleted(S)}},R.message.message);break;case"HALF_CLOSE":T.nextMessageToSend+=1,T.call.halfClose()}}}sendMessageWithContext(S,T){var R;this.trace("write() called with message of length "+T.length);let N={message:T,flags:S.flags},O=this.getNextBufferIndex(),P={entryType:"MESSAGE",message:N,allocated:this.bufferTracker.allocate(T.length,this.callNumber)};if(this.writeBuffer.push(P),P.allocated)for(let[N,P]of(null===(R=S.callback)||void 0===R||R.call(S),this.underlyingCalls.entries()))"ACTIVE"===P.state&&P.nextMessageToSend===O&&P.call.sendMessageWithContext({callback:S=>{this.handleChildWriteCompleted(N)}},T);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let R=this.underlyingCalls[this.committedCallIndex];P.callback=S.callback,"ACTIVE"===R.state&&R.nextMessageToSend===O&&R.call.sendMessageWithContext({callback:S=>{this.handleChildWriteCompleted(this.committedCallIndex)}},T)}}startRead(){for(let S of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==S?void 0:S.state)==="ACTIVE"&&S.call.startRead()}halfClose(){this.trace("halfClose called");let S=this.getNextBufferIndex();for(let T of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==T?void 0:T.state)==="ACTIVE"&&T.nextMessageToSend===S&&(T.nextMessageToSend+=1,T.call.halfClose())}setCredentials(S){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}T.RetryingCall=$},7061:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Http2ServerCallStream=T.ServerDuplexStreamImpl=T.ServerWritableStreamImpl=T.ServerReadableStreamImpl=T.ServerUnaryCallImpl=void 0;let N=R(2361),O=R(5158),P=R(2781),M=R(9796),L=R(2678),U=R(2252),V=R(8326),$=R(7504),K=R(5437),W="server_call";function Q(S){$.trace(L.LogVerbosity.DEBUG,W,S)}let Y="grpc-message",X="grpc-status",Z="grpc-timeout",ee=/(\d{1,8})\s*([HMSmun])/,et={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},er={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},en={[O.constants.HTTP2_HEADER_STATUS]:O.constants.HTTP_STATUS_OK,[O.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},ei={waitForTrailers:!0};class es extends N.EventEmitter{constructor(S,T,R){super(),this.call=S,this.metadata=T,this.request=R,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(S){this.call.sendMetadata(S)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}T.ServerUnaryCallImpl=es;class ea extends P.Readable{constructor(S,T,R,N){super({objectMode:!0}),this.call=S,this.metadata=T,this.deserialize=R,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,N)}_read(S){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(S){this.call.sendMetadata(S)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}T.ServerReadableStreamImpl=ea;class eo extends P.Writable{constructor(S,T,R,N){super({objectMode:!0}),this.call=S,this.metadata=T,this.serialize=R,this.request=N,this.cancelled=!1,this.trailingMetadata=new U.Metadata,this.call.setupSurfaceCall(this),this.on("error",S=>{this.call.sendError(S),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(S){this.call.sendMetadata(S)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(S,T,R){try{let T=this.call.serializeMessage(S);if(!this.call.write(T)){this.call.once("drain",R);return}}catch(S){this.emit("error",{details:(0,K.getErrorMessage)(S),code:L.Status.INTERNAL})}R()}_final(S){this.call.sendStatus({code:L.Status.OK,details:"OK",metadata:this.trailingMetadata}),S(null)}end(S){return S&&(this.trailingMetadata=S),super.end()}}T.ServerWritableStreamImpl=eo;class eu extends P.Duplex{constructor(S,T,R,N,O){super({objectMode:!0}),this.call=S,this.metadata=T,this.serialize=R,this.deserialize=N,this.cancelled=!1,this.trailingMetadata=new U.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,O),this.on("error",S=>{this.call.sendError(S),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(S){this.call.sendMetadata(S)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(S){return S&&(this.trailingMetadata=S),super.end()}}T.ServerDuplexStreamImpl=eu,eu.prototype._read=ea.prototype._read,eu.prototype._write=eo.prototype._write,eu.prototype._final=eo.prototype._final;class ec extends N.EventEmitter{constructor(S,T,R){super(),this.stream=S,this.handler=T,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=L.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=L.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",S=>{}),this.stream.once("close",()=>{var S;Q("Request to method "+(null===(S=this.handler)||void 0===S?void 0:S.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:L.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in R&&(this.maxSendMessageSize=R["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in R&&(this.maxReceiveMessageSize=R["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(S,T){let R=S.subarray(5);if("identity"===T)return R;if("deflate"!==T&&"gzip"!==T)return Promise.reject({code:L.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${T}"`});{let S;return S="deflate"===T?M.createInflate():M.createGunzip(),new Promise((T,N)=>{let O=0,P=[];S.on("data",T=>{P.push(T),O+=T.byteLength,-1!==this.maxReceiveMessageSize&&O>this.maxReceiveMessageSize&&(S.destroy(),N({code:L.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),S.on("end",()=>{T(Buffer.concat(P))}),S.write(R),S.end()})}}sendMetadata(S){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let T=S?S.toHttp2Headers():null,R=Object.assign(Object.assign(Object.assign({},en),er),T);this.stream.respond(R,ei)}receiveMetadata(S){let T=U.Metadata.fromHttp2Headers(S);$.isTracerEnabled(W)&&Q("Request to "+this.handler.path+" received headers "+JSON.stringify(T.toJSON()));let R=T.get(Z);if(R.length>0){let S=R[0].toString().match(ee);if(null===S){let S=Error("Invalid deadline");return S.code=L.Status.OUT_OF_RANGE,this.sendError(S),T}let N=+S[1]*et[S[2]]|0,O=new Date;this.deadline=O.setMilliseconds(O.getMilliseconds()+N),this.deadlineTimer=setTimeout(eh,N,this),T.remove(Z)}return T.remove(O.constants.HTTP2_HEADER_ACCEPT_ENCODING),T.remove(O.constants.HTTP2_HEADER_TE),T.remove(O.constants.HTTP2_HEADER_CONTENT_TYPE),T.remove("grpc-accept-encoding"),T}receiveUnaryMessage(S){return new Promise((T,R)=>{let{stream:N}=this,O=0,P=this,M=[],U=this.maxReceiveMessageSize;function V(S){if(O+=S.byteLength,-1!==U&&O>U){N.removeListener("data",V),N.removeListener("end",$),N.removeListener("error",$),R({code:L.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${O} vs. ${U})`});return}M.push(S)}function $(U){if(N.removeListener("data",V),N.removeListener("end",$),N.removeListener("error",$),void 0!==U){R({code:L.Status.INTERNAL,details:U.message});return}if(0===O){R({code:L.Status.INTERNAL,details:"received empty unary message"});return}P.emit("receiveMessage");let K=Buffer.concat(M,O),W=1===K.readUInt8(0)?S:"identity",Q=P.getDecompressedMessage(K,W);if(Buffer.isBuffer(Q)){T(P.deserializeMessageWithInternalError(Q));return}Q.then(S=>T(P.deserializeMessageWithInternalError(S)),T=>R(T.code?T:{code:L.Status.INTERNAL,details:`Received "grpc-encoding" header "${S}" but ${S} decompression failed`}))}this.stream.on("data",V),this.stream.on("end",$),this.stream.on("error",$)})}async deserializeMessageWithInternalError(S){try{return this.deserializeMessage(S)}catch(S){throw{details:(0,K.getErrorMessage)(S),code:L.Status.INTERNAL}}}serializeMessage(S){let T=this.handler.serialize(S),R=T.byteLength,N=Buffer.allocUnsafe(R+5);return N.writeUInt8(0,0),N.writeUInt32BE(R,1),T.copy(N,5),N}deserializeMessage(S){return this.handler.deserialize(S)}async sendUnaryMessage(S,T,R,N){if(!this.checkCancelled()){if(void 0===R&&(R=null),S){!Object.prototype.hasOwnProperty.call(S,"metadata")&&R&&(S.metadata=R),this.sendError(S);return}try{let S=this.serializeMessage(T);this.write(S),this.sendStatus({code:L.Status.OK,details:"OK",metadata:R})}catch(S){this.sendError({details:(0,K.getErrorMessage)(S),code:L.Status.INTERNAL})}}}sendStatus(S){var T,R;if(this.emit("callEnd",S.code),this.emit("streamEnd",S.code===L.Status.OK),!this.checkCancelled()){if(Q("Request to method "+(null===(T=this.handler)||void 0===T?void 0:T.path)+" ended with status code: "+L.Status[S.code]+" details: "+S.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var T;let R=Object.assign({[X]:S.code,[Y]:encodeURI(S.details)},null===(T=S.metadata)||void 0===T?void 0:T.toHttp2Headers());this.stream.sendTrailers(R),this.statusSent=!0}),this.stream.end());else{let T=Object.assign(Object.assign({[X]:S.code,[Y]:encodeURI(S.details)},en),null===(R=S.metadata)||void 0===R?void 0:R.toHttp2Headers());this.stream.respond(T,{endStream:!0}),this.statusSent=!0}}}sendError(S){let T={code:L.Status.UNKNOWN,details:"message"in S?S.message:"Unknown Error",metadata:"metadata"in S&&void 0!==S.metadata?S.metadata:null};"code"in S&&"number"==typeof S.code&&Number.isInteger(S.code)&&(T.code=S.code,"details"in S&&"string"==typeof S.details&&(T.details=S.details)),this.sendStatus(T)}write(S){if(!this.checkCancelled()){if(-1!==this.maxSendMessageSize&&S.length>this.maxSendMessageSize){this.sendError({code:L.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${S.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(S)}}resume(){this.stream.resume()}setupSurfaceCall(S){this.once("cancelled",T=>{S.cancelled=!0,S.emit("cancelled",T)}),this.once("callEnd",T=>S.emit("callEnd",T))}setupReadable(S,T){let R=new V.StreamDecoder(this.maxReceiveMessageSize),N=!1,O=!1,P=!1,M=async()=>{P||!N||O||(P=!0,await this.pushOrBufferMessage(S,null))};this.stream.on("data",async N=>{let P;try{P=R.write(N)}catch(S){this.sendError({code:L.Status.RESOURCE_EXHAUSTED,details:S.message});return}for(let R of(O=!0,this.stream.pause(),P)){let N;this.emit("receiveMessage");let O=1===R.readUInt8(0)?T:"identity";try{N=await this.getDecompressedMessage(R,O)}catch(S){this.sendError(S);return}if(!N)return;await this.pushOrBufferMessage(S,N)}O=!1,this.stream.resume(),await M()}),this.stream.once("end",async()=>{N=!0,await M()})}consumeUnpushedMessages(S){for(this.canPush=!0;this.messagesToPush.length>0;){let T=this.messagesToPush.shift(),R=S.push(T);if(null===T||!1===R){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(S,T){this.isPushPending?this.bufferedMessages.push(T):await this.pushMessage(S,T)}async pushMessage(S,T){if(null===T){Q("Received end of stream"),this.canPush?S.push(null):this.messagesToPush.push(null);return}Q("Received message of length "+T.length),this.isPushPending=!0;try{let R=await this.deserializeMessage(T);this.canPush?S.push(R)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(R)}catch(R){this.bufferedMessages.length=0;let T=(0,K.getErrorCode)(R);(null===T||T<L.Status.OK||T>L.Status.UNAUTHENTICATED)&&(T=L.Status.INTERNAL),S.emit("error",{details:(0,K.getErrorMessage)(R),code:T})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(S,this.bufferedMessages.shift())}getPeer(){var S;let T=null===(S=this.stream.session)||void 0===S?void 0:S.socket;return null!=T&&T.remoteAddress?T.remotePort?`${T.remoteAddress}:${T.remotePort}`:T.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function eh(S){let T=Error("Deadline exceeded");T.code=L.Status.DEADLINE_EXCEEDED,S.sendError(T),S.cancelled=!0,S.emit("cancelled","deadline")}T.Http2ServerCallStream=ec},4181:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.ServerCredentials=void 0;let N=R(3009);class O{static createInsecure(){return new P}static createSsl(S,T,R=!1){if(null!==S&&!Buffer.isBuffer(S))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(T))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof R)throw TypeError("checkClientCertificate must be a boolean");let O=[],P=[];for(let S=0;S<T.length;S++){let R=T[S];if(null===R||"object"!=typeof R)throw TypeError(`keyCertPair[${S}] must be an object`);if(!Buffer.isBuffer(R.private_key))throw TypeError(`keyCertPair[${S}].private_key must be a Buffer`);if(!Buffer.isBuffer(R.cert_chain))throw TypeError(`keyCertPair[${S}].cert_chain must be a Buffer`);O.push(R.cert_chain),P.push(R.private_key)}return new M({ca:S||(0,N.getDefaultRootsData)()||void 0,cert:O,key:P,requestCert:R,ciphers:N.CIPHER_SUITES})}}T.ServerCredentials=O;class P extends O{_isSecure(){return!1}_getSettings(){return null}}class M extends O{constructor(S){super(),this.options=S}_isSecure(){return!0}_getSettings(){return this.options}}},7691:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Server=void 0;let N=R(5158),O=R(2678),P=R(7061),M=R(4181),L=R(492),U=R(7504),V=R(3906),$=R(8429),K=R(5993),W=2147483647,Q=2147483647,Y=2e4,{HTTP2_HEADER_PATH:X}=N.constants,Z="server";function ee(){}function et(S){return{code:O.Status.UNIMPLEMENTED,details:`The server does not implement the method ${S}`}}function er(S,T){let R=et(T);switch(S){case"unary":return(S,T)=>{T(R,null)};case"clientStream":return(S,T)=>{T(R,null)};case"serverStream":return S=>{S.emit("error",R)};case"bidi":return S=>{S.emit("error",R)};default:throw Error(`Invalid handlerType ${S}`)}}class en{constructor(S){var T,R,N,O;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new K.ChannelzTrace,this.callTracker=new K.ChannelzCallTracker,this.listenerChildrenTracker=new K.ChannelzChildrenTracker,this.sessionChildrenTracker=new K.ChannelzChildrenTracker,this.options=null!=S?S:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,K.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!==(T=this.options["grpc.max_connection_age_ms"])&&void 0!==T?T:W,this.maxConnectionAgeGraceMs=null!==(R=this.options["grpc.max_connection_age_grace_ms"])&&void 0!==R?R:W,this.keepaliveTimeMs=null!==(N=this.options["grpc.keepalive_time_ms"])&&void 0!==N?N:Q,this.keepaliveTimeoutMs=null!==(O=this.options["grpc.keepalive_timeout_ms"])&&void 0!==O?O:Y,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(S){return()=>{var T,R,N;let O;let P=this.sessions.get(S),M=S.socket,L=M.remoteAddress?(0,V.stringToSubchannelAddress)(M.remoteAddress,M.remotePort):null,U=M.localAddress?(0,V.stringToSubchannelAddress)(M.localAddress,M.localPort):null;if(S.encrypted){let S=M,R=S.getCipher(),N=S.getCertificate(),P=S.getPeerCertificate();O={cipherSuiteStandardName:null!==(T=R.standardName)&&void 0!==T?T:null,cipherSuiteOtherName:R.standardName?null:R.name,localCertificate:N&&"raw"in N?N.raw:null,remoteCertificate:P&&"raw"in P?P.raw:null}}else O=null;return{remoteAddress:L,localAddress:U,security:O,remoteName:null,streamsStarted:P.streamTracker.callsStarted,streamsSucceeded:P.streamTracker.callsSucceeded,streamsFailed:P.streamTracker.callsFailed,messagesSent:P.messagesSent,messagesReceived:P.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:P.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:P.lastMessageSentTimestamp,lastMessageReceivedTimestamp:P.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(R=S.state.localWindowSize)&&void 0!==R?R:null,remoteFlowControlWindow:null!==(N=S.state.remoteWindowSize)&&void 0!==N?N:null}}}trace(S){U.trace(O.LogVerbosity.DEBUG,Z,"("+this.channelzRef.id+") "+S)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(S,T){if(null===S||"object"!=typeof S||null===T||"object"!=typeof T)throw Error("addService() requires two objects as arguments");let R=Object.keys(S);if(0===R.length)throw Error("Cannot add an empty service to a server");R.forEach(R=>{let N,O;let P=S[R];N=P.requestStream?P.responseStream?"bidi":"clientStream":P.responseStream?"serverStream":"unary";let M=T[R];if(void 0===M&&"string"==typeof P.originalName&&(M=T[P.originalName]),O=void 0!==M?M.bind(T):er(N,R),!1===this.register(P.path,O,P.responseSerialize,P.requestDeserialize,N))throw Error(`Method handler for ${P.path} already provided.`)})}removeService(S){if(null===S||"object"!=typeof S)throw Error("removeService() requires object as argument");Object.keys(S).forEach(T=>{let R=S[T];this.unregister(R.path)})}bind(S,T){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(S,T,R){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof S)throw TypeError("port must be a string");if(null===T||!(T instanceof M.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof R)throw TypeError("callback must be a function");let P=(0,$.parseUri)(S);if(null===P)throw Error(`Could not parse port "${S}"`);let W=(0,L.mapUriDefaultScheme)(P);if(null===W)throw Error(`Could not get a default scheme for port "${S}"`);let Q={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?Q.maxSessionMemory=this.options["grpc-node.max_session_memory"]:Q.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(Q.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let Y=(S,T)=>{process.nextTick(()=>R(S,T))},X=()=>{let S;if(T._isSecure()){let R=Object.assign(Q,T._getSettings());R.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(S=N.createSecureServer(R)).on("secureConnection",S=>{S.on("error",S=>{this.trace("An incoming TLS connection closed with error: "+S.message)})})}else S=N.createServer(Q);return S.setTimeout(0,ee),this._setupHandlers(S),S},Z=(S,T,R)=>0===S.length?Promise.resolve({port:T,count:R}):Promise.all(S.map(S=>{let R;this.trace("Attempting to bind "+(0,V.subchannelAddressToString)(S)),R=(0,V.isTcpSubchannelAddress)(S)?{host:S.host,port:T}:S;let N=X();return new Promise((O,P)=>{let M=T=>{this.trace("Failed to bind "+(0,V.subchannelAddressToString)(S)+" with error "+T.message),O(T)};N.once("error",M),N.listen(R,()=>{let S;if(this.shutdown){N.close(),O(Error("bindAsync failed because server is shutdown"));return}let R=N.address();S="string"==typeof R?{path:R}:{host:R.address,port:R.port};let P=(0,K.registerChannelzSocket)((0,V.subchannelAddressToString)(S),()=>({localAddress:S,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(P),this.http2ServerList.push({server:N,channelzRef:P}),this.trace("Successfully bound "+(0,V.subchannelAddressToString)(S)),O("port"in S?S.port:T),N.removeListener("error",M)})})})).then(S=>{let N=0;for(let R of S)if("number"==typeof R&&(N+=1,R!==T))throw Error("Invalid state: multiple port numbers added from single address");return{port:T,count:N+R}}),et=S=>{if(0===S.length)return Promise.resolve({port:0,count:0});let T=S[0],R=X();return new Promise((N,O)=>{let P=R=>{this.trace("Failed to bind "+(0,V.subchannelAddressToString)(T)+" with error "+R.message),N(et(S.slice(1)))};R.once("error",P),R.listen(T,()=>{if(this.shutdown){R.close(),N({port:0,count:0});return}let T=R.address(),O={host:T.address,port:T.port},M=(0,K.registerChannelzSocket)((0,V.subchannelAddressToString)(O),()=>({localAddress:O,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(M),this.http2ServerList.push({server:R,channelzRef:M}),this.trace("Successfully bound "+(0,V.subchannelAddressToString)(O)),N(Z(S.slice(1),T.port,1)),R.removeListener("error",P)})})},er={onSuccessfulResolution:(T,R,N)=>{let P;if(er.onSuccessfulResolution=()=>{},this.shutdown&&Y(Error("bindAsync failed because server is shutdown"),0),0===T.length){Y(Error(`No addresses resolved for port ${S}`),0);return}(P=(0,V.isTcpSubchannelAddress)(T[0])?0===T[0].port?et(T):Z(T,T[0].port,0):Z(T,1,0)).then(S=>{if(0===S.count){let S=`No address added out of total ${T.length} resolved`;U.log(O.LogVerbosity.ERROR,S),Y(Error(S),0)}else S.count<T.length&&U.log(O.LogVerbosity.INFO,`WARNING Only ${S.count} addresses added out of total ${T.length} resolved`),Y(null,S.port)},S=>{let R=`No address added out of total ${T.length} resolved`;U.log(O.LogVerbosity.ERROR,R),Y(Error(R),0)})},onError:S=>{Y(Error(S.details),0)}};(0,L.createResolver)(W,er,this.options).updateResolution()}forceShutdown(){for(let{server:S,channelzRef:T}of this.http2ServerList)S.listening&&S.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(T),(0,K.unregisterChannelzRef)(T))});this.started=!1,this.shutdown=!0,this.sessions.forEach((S,T)=>{T.destroy(N.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,K.unregisterChannelzRef)(this.channelzRef)}register(S,T,R,N,O){return!this.handlers.has(S)&&(this.handlers.set(S,{func:T,serialize:R,deserialize:N,type:O,path:S}),!0)}unregister(S){return this.handlers.delete(S)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:S})=>!0!==S.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(S){let T=T=>{this.channelzEnabled&&(0,K.unregisterChannelzRef)(this.channelzRef),S(T)},R=0;function N(){0==--R&&T()}for(let{server:S,channelzRef:T}of(this.started=!1,this.shutdown=!0,this.http2ServerList))S.listening&&(R++,S.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(T),(0,K.unregisterChannelzRef)(T)),N()}));this.sessions.forEach((S,T)=>{T.closed||(R+=1,T.close(N))}),0===R&&T()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(S,T){let R=T[N.constants.HTTP2_HEADER_CONTENT_TYPE];return!!("string"==typeof R&&R.startsWith("application/grpc"))||(S.respond({[N.constants.HTTP2_HEADER_STATUS]:N.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(S){this.trace("Received call to method "+S+" at address "+this.serverAddressString);let T=this.handlers.get(S);return void 0===T?(this.trace("No handler registered for method "+S+". Sending UNIMPLEMENTED status."),null):T}_respondWithError(S,T,R=null){let N=new P.Http2ServerCallStream(T,null,this.options);void 0===S.code&&(S.code=O.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==R||R.streamTracker.addCallFailed()),N.sendError(S)}_channelzHandler(S,T){let R=this.sessions.get(S.session);if(this.callTracker.addCallStarted(),null==R||R.streamTracker.addCallStarted(),!this._verifyContentType(S,T)){this.callTracker.addCallFailed(),null==R||R.streamTracker.addCallFailed();return}let N=T[X],M=this._retrieveHandler(N);if(!M){this._respondWithError(et(N),S,R);return}let L=new P.Http2ServerCallStream(S,M,this.options);L.once("callEnd",S=>{S===O.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),R&&(L.once("streamEnd",S=>{S?R.streamTracker.addCallSucceeded():R.streamTracker.addCallFailed()}),L.on("sendMessage",()=>{R.messagesSent+=1,R.lastMessageSentTimestamp=new Date}),L.on("receiveMessage",()=>{R.messagesReceived+=1,R.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(L,M,T)||(this.callTracker.addCallFailed(),null==R||R.streamTracker.addCallFailed(),L.sendError({code:O.Status.INTERNAL,details:`Unknown handler type: ${M.type}`}))}_streamHandler(S,T){if(!0!==this._verifyContentType(S,T))return;let R=T[X],N=this._retrieveHandler(R);if(!N){this._respondWithError(et(R),S,null);return}let M=new P.Http2ServerCallStream(S,N,this.options);this._runHandlerForCall(M,N,T)||M.sendError({code:O.Status.INTERNAL,details:`Unknown handler type: ${N.type}`})}_runHandlerForCall(S,T,R){var N;let O=S.receiveMetadata(R),P=null!==(N=O.get("grpc-encoding")[0])&&void 0!==N?N:"identity";O.remove("grpc-encoding");let{type:M}=T;if("unary"===M)ei(S,T,O,P);else if("clientStream"===M)es(S,T,O,P);else if("serverStream"===M)ea(S,T,O,P);else{if("bidi"!==M)return!1;eo(S,T,O,P)}return!0}_setupHandlers(S){if(null===S)return;let T=S.address(),R="null";T&&(R="string"==typeof T?T:T.address+":"+T.port),this.serverAddressString=R;let O=this.channelzEnabled?this._channelzHandler:this._streamHandler;S.on("stream",O.bind(this)),S.on("session",S=>{var T,R,O,P,M;if(!this.started){S.destroy();return}let L=(0,K.registerChannelzSocket)(null!==(T=S.socket.remoteAddress)&&void 0!==T?T:"unknown",this.getChannelzSessionInfoGetter(S),this.channelzEnabled),U={ref:L,streamTracker:new K.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(S,U);let V=S.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+V),this.sessionChildrenTracker.refChild(L));let $=null,Q=null,Y=!1;if(this.maxConnectionAgeMs!==W){let T=this.maxConnectionAgeMs/10,P=Math.random()*T*2-T;$=null===(O=(R=setTimeout(()=>{var T,R;Y=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+V);try{S.goaway(N.constants.NGHTTP2_NO_ERROR,2147483647,Buffer.from("max_age"))}catch(T){S.destroy();return}S.close(),this.maxConnectionAgeGraceMs!==W&&(Q=null===(R=(T=setTimeout(()=>{S.destroy()},this.maxConnectionAgeGraceMs)).unref)||void 0===R?void 0:R.call(T))},this.maxConnectionAgeMs+P)).unref)||void 0===O?void 0:O.call(R)}let X=null===(M=(P=setInterval(()=>{var T,R;let N=null===(R=(T=setTimeout(()=>{Y=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+V),S.close()},this.keepaliveTimeoutMs)).unref)||void 0===R?void 0:R.call(T);try{S.ping((S,T,R)=>{clearTimeout(N)})}catch(T){S.destroy()}},this.keepaliveTimeMs)).unref)||void 0===M?void 0:M.call(P);S.on("close",()=>{this.channelzEnabled&&(Y||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+V),this.sessionChildrenTracker.unrefChild(L),(0,K.unregisterChannelzRef)(L)),$&&clearTimeout($),Q&&clearTimeout(Q),X&&clearTimeout(X),this.sessions.delete(S)})})}}async function ei(S,T,R,N){try{let O=await S.receiveUnaryMessage(N);if(void 0===O||S.cancelled)return;let M=new P.ServerUnaryCallImpl(S,R,O);T.func(M,(T,R,N,O)=>{S.sendUnaryMessage(T,R,N,O)})}catch(T){S.sendError(T)}}function es(S,T,R,N){let O=new P.ServerReadableStreamImpl(S,R,T.deserialize,N);function M(T,R,N,P){O.destroy(),S.sendUnaryMessage(T,R,N,P)}S.cancelled||(O.on("error",M),T.func(O,M))}async function ea(S,T,R,N){try{let O=await S.receiveUnaryMessage(N);if(void 0===O||S.cancelled)return;let M=new P.ServerWritableStreamImpl(S,R,T.serialize,O);T.func(M)}catch(T){S.sendError(T)}}function eo(S,T,R,N){let O=new P.ServerDuplexStreamImpl(S,R,T.serialize,T.deserialize,N);S.cancelled||T.func(O)}T.Server=en},6262:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.extractAndSelectServiceConfig=T.validateServiceConfig=T.validateRetryThrottling=void 0;let N=R(2037),O=R(2678),P=R(7176),M=/^\d+(\.\d{1,9})?s$/,L="node";function U(S){if("service"in S&&""!==S.service){if("string"!=typeof S.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof S.service}`);if(!("method"in S)||""===S.method)return{service:S.service};if("string"!=typeof S.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof S.service}`);return{service:S.service,method:S.method}}if("method"in S&&void 0!==S.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function V(S){if(!("maxAttempts"in S)||!Number.isInteger(S.maxAttempts)||S.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in S)||"string"!=typeof S.initialBackoff||!M.test(S.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in S)||"string"!=typeof S.maxBackoff||!M.test(S.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in S)||"number"!=typeof S.backoffMultiplier||S.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in S&&Array.isArray(S.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===S.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let T of S.retryableStatusCodes)if("number"==typeof T){if(!Object.values(O.Status).includes(T))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof T){if(!Object.values(O.Status).includes(T.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:S.maxAttempts,initialBackoff:S.initialBackoff,maxBackoff:S.maxBackoff,backoffMultiplier:S.backoffMultiplier,retryableStatusCodes:S.retryableStatusCodes}}function $(S){if(!("maxAttempts"in S)||!Number.isInteger(S.maxAttempts)||S.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in S&&("string"!=typeof S.hedgingDelay||!M.test(S.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in S&&Array.isArray(S.nonFatalStatusCodes))for(let T of S.nonFatalStatusCodes)if("number"==typeof T){if(!Object.values(O.Status).includes(T))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof T){if(!Object.values(O.Status).includes(T.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let T={maxAttempts:S.maxAttempts};return S.hedgingDelay&&(T.hedgingDelay=S.hedgingDelay),S.nonFatalStatusCodes&&(T.nonFatalStatusCodes=S.nonFatalStatusCodes),T}function K(S){var T;let R={name:[]};if(!("name"in S)||!Array.isArray(S.name))throw Error("Invalid method config: invalid name array");for(let T of S.name)R.name.push(U(T));if("waitForReady"in S){if("boolean"!=typeof S.waitForReady)throw Error("Invalid method config: invalid waitForReady");R.waitForReady=S.waitForReady}if("timeout"in S){if("object"==typeof S.timeout){if(!("seconds"in S.timeout)||"number"!=typeof S.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in S.timeout)||"number"!=typeof S.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");R.timeout=S.timeout}else if("string"==typeof S.timeout&&M.test(S.timeout)){let N=S.timeout.substring(0,S.timeout.length-1).split(".");R.timeout={seconds:0|N[0],nanos:(null!==(T=N[1])&&void 0!==T?T:0)|0}}else throw Error("Invalid method config: invalid timeout")}if("maxRequestBytes"in S){if("number"!=typeof S.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");R.maxRequestBytes=S.maxRequestBytes}if("maxResponseBytes"in S){if("number"!=typeof S.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");R.maxResponseBytes=S.maxResponseBytes}if("retryPolicy"in S){if("hedgingPolicy"in S)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");R.retryPolicy=V(S.retryPolicy)}else"hedgingPolicy"in S&&(R.hedgingPolicy=$(S.hedgingPolicy));return R}function W(S){if(!("maxTokens"in S)||"number"!=typeof S.maxTokens||S.maxTokens<=0||S.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in S)||"number"!=typeof S.tokenRatio||S.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+S.maxTokens.toFixed(3),tokenRatio:+S.tokenRatio.toFixed(3)}}function Q(S){let T={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in S){if("string"==typeof S.loadBalancingPolicy)T.loadBalancingPolicy=S.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy")}if("loadBalancingConfig"in S){if(Array.isArray(S.loadBalancingConfig))for(let R of S.loadBalancingConfig)T.loadBalancingConfig.push((0,P.validateLoadBalancingConfig)(R));else throw Error("Invalid service config: invalid loadBalancingConfig")}if("methodConfig"in S&&Array.isArray(S.methodConfig))for(let R of S.methodConfig)T.methodConfig.push(K(R));"retryThrottling"in S&&(T.retryThrottling=W(S.retryThrottling));let R=[];for(let S of T.methodConfig)for(let T of S.name){for(let S of R)if(T.service===S.service&&T.method===S.method)throw Error(`Invalid service config: duplicate name ${T.service}/${T.method}`);R.push(T)}return T}function Y(S){if(!("serviceConfig"in S))throw Error("Invalid service config choice: missing service config");let T={serviceConfig:Q(S.serviceConfig)};if("clientLanguage"in S){if(Array.isArray(S.clientLanguage))for(let R of(T.clientLanguage=[],S.clientLanguage))if("string"==typeof R)T.clientLanguage.push(R);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage")}if("clientHostname"in S){if(Array.isArray(S.clientHostname))for(let R of(T.clientHostname=[],S.clientHostname))if("string"==typeof R)T.clientHostname.push(R);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname")}if("percentage"in S){if("number"==typeof S.percentage&&0<=S.percentage&&S.percentage<=100)T.percentage=S.percentage;else throw Error("Invalid service config choice: invalid percentage")}let R=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let T in S)if(!R.includes(T))throw Error(`Invalid service config choice: unexpected field ${T}`);return T}function X(S,T){if(!Array.isArray(S))throw Error("Invalid service config list");for(let R of S){let S=Y(R);if("number"!=typeof S.percentage||!(T>S.percentage)){if(Array.isArray(S.clientHostname)){let T=!1;for(let R of S.clientHostname)R===N.hostname()&&(T=!0);if(!T)continue}if(Array.isArray(S.clientLanguage)){let T=!1;for(let R of S.clientLanguage)R===L&&(T=!0);if(!T)continue}return S.serviceConfig}}throw Error("No matching service config found")}function Z(S,T){for(let R of S)if(R.length>0&&R[0].startsWith("grpc_config="))return X(JSON.parse(R.join("").substring(12)),T);return null}T.validateRetryThrottling=W,T.validateServiceConfig=Q,T.extractAndSelectServiceConfig=Z},9932:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.StatusBuilder=void 0;class R{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(S){return this.code=S,this}withDetails(S){return this.details=S,this}withMetadata(S){return this.metadata=S,this}build(){let S={};return null!==this.code&&(S.code=this.code),null!==this.details&&(S.details=this.details),null!==this.metadata&&(S.metadata=this.metadata),S}}T.StatusBuilder=R},8326:(S,T)=>{"use strict";var R;Object.defineProperty(T,"__esModule",{value:!0}),T.StreamDecoder=void 0,function(S){S[S.NO_DATA=0]="NO_DATA",S[S.READING_SIZE=1]="READING_SIZE",S[S.READING_MESSAGE=2]="READING_MESSAGE"}(R||(R={}));class N{constructor(S){this.maxReadMessageLength=S,this.readState=R.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(S){let T,N=0,O=[];for(;N<S.length;)switch(this.readState){case R.NO_DATA:this.readCompressFlag=S.slice(N,N+1),N+=1,this.readState=R.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case R.READING_SIZE:if(T=Math.min(S.length-N,this.readSizeRemaining),S.copy(this.readPartialSize,4-this.readSizeRemaining,N,N+T),this.readSizeRemaining-=T,N+=T,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=R.READING_MESSAGE;else{let S=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=R.NO_DATA,O.push(S)}}break;case R.READING_MESSAGE:if(T=Math.min(S.length-N,this.readMessageRemaining),this.readPartialMessage.push(S.slice(N,N+T)),this.readMessageRemaining-=T,N+=T,0===this.readMessageRemaining){let S=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),T=Buffer.concat(S,this.readMessageSize+5);this.readState=R.NO_DATA,O.push(T)}break;default:throw Error("Unexpected read state")}return O}}T.StreamDecoder=N},3906:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.stringToSubchannelAddress=T.subchannelAddressToString=T.subchannelAddressEqual=T.isTcpSubchannelAddress=void 0;let N=R(1808);function O(S){return"port"in S}function P(S,T){return!S&&!T||!!S&&!!T&&(O(S)?O(T)&&S.host===T.host&&S.port===T.port:!O(T)&&S.path===T.path)}function M(S){return O(S)?S.host+":"+S.port:S.path}T.isTcpSubchannelAddress=O,T.subchannelAddressEqual=P,T.subchannelAddressToString=M;let L=443;function U(S,T){return(0,N.isIP)(S)?{host:S,port:null!=T?T:L}:{path:S}}T.stringToSubchannelAddress=U},7060:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Http2SubchannelCall=void 0;let N=R(5158),O=R(2037),P=R(2678),M=R(2252),L=R(8326),U=R(7504),V=R(2678),$="subchannel_call";function K(S){for(let[T,R]of Object.entries(O.constants.errno))if(R===S)return T;return"Unknown system error "+S}class W{constructor(S,T,R,O,U){var V;this.http2Stream=S,this.callEventTracker=T,this.listener=R,this.transport=O,this.callId=U,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=P.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let $=null!==(V=O.getOptions()["grpc.max_receive_message_length"])&&void 0!==V?V:P.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new L.StreamDecoder($),S.on("response",(S,T)=>{let R="";for(let T of Object.keys(S))R+="		"+T+": "+S[T]+"\n";switch(this.trace("Received server headers:\n"+R),S[":status"]){case 400:this.mappedStatusCode=P.Status.INTERNAL;break;case 401:this.mappedStatusCode=P.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=P.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=P.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=P.Status.UNAVAILABLE;break;default:this.mappedStatusCode=P.Status.UNKNOWN}if(T&N.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(S);else{let T;try{T=M.Metadata.fromHttp2Headers(S)}catch(S){this.endCall({code:P.Status.UNKNOWN,details:S.message,metadata:new M.Metadata});return}this.listener.onReceiveMetadata(T)}}),S.on("trailers",S=>{this.handleTrailers(S)}),S.on("data",S=>{let T;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+S.length);try{T=this.decoder.write(S)}catch(S){this.cancelWithStatus(P.Status.RESOURCE_EXHAUSTED,S.message);return}for(let S of T)this.trace("parsed message of length "+S.length),this.callEventTracker.addMessageReceived(),this.tryPush(S)}}),S.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),S.on("close",()=>{process.nextTick(()=>{var T;let R;if(this.trace("HTTP/2 stream closed with code "+S.rstCode),(null===(T=this.finalStatus)||void 0===T?void 0:T.code)===P.Status.OK)return;let O="";switch(S.rstCode){case N.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;R=P.Status.INTERNAL,O=`Received RST_STREAM with code ${S.rstCode}`;break;case N.constants.NGHTTP2_REFUSED_STREAM:R=P.Status.UNAVAILABLE,O="Stream refused by server";break;case N.constants.NGHTTP2_CANCEL:R=P.Status.CANCELLED,O="Call cancelled";break;case N.constants.NGHTTP2_ENHANCE_YOUR_CALM:R=P.Status.RESOURCE_EXHAUSTED,O="Bandwidth exhausted or memory limit exceeded";break;case N.constants.NGHTTP2_INADEQUATE_SECURITY:R=P.Status.PERMISSION_DENIED,O="Protocol not secure enough";break;case N.constants.NGHTTP2_INTERNAL_ERROR:R=P.Status.INTERNAL,null===this.internalError?O=`Received RST_STREAM with code ${S.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(R=P.Status.UNAVAILABLE,O=this.internalError.message):O=`Received RST_STREAM with code ${S.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:R=P.Status.INTERNAL,O=`Received RST_STREAM with code ${S.rstCode}`}this.endCall({code:R,details:O,metadata:new M.Metadata,rstCode:S.rstCode})})}),S.on("error",S=>{"ERR_HTTP2_STREAM_ERROR"!==S.code&&(this.trace("Node error event: message="+S.message+" code="+S.code+" errno="+K(S.errno)+" syscall="+S.syscall),this.internalError=S),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:P.Status.UNAVAILABLE,details:"Connection dropped",metadata:new M.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(S){U.trace(V.LogVerbosity.DEBUG,$,"["+this.callId+"] "+S)}endCall(S){(null===this.finalStatus||this.finalStatus.code===P.Status.OK)&&(this.finalStatus=S,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===P.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(S){this.trace("pushing to reader message of length "+(S instanceof Buffer?S.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(S),this.maybeOutputStatus())})}tryPush(S){this.canPush?(this.http2Stream.pause(),this.push(S)):(this.trace("unpushedReadMessages.push message of length "+S.length),this.unpushedReadMessages.push(S))}handleTrailers(S){let T;this.callEventTracker.onStreamEnd(!0);let R="";for(let T of Object.keys(S))R+="		"+T+": "+S[T]+"\n";this.trace("Received server trailers:\n"+R);try{T=M.Metadata.fromHttp2Headers(S)}catch(S){T=new M.Metadata}let N=T.getMap(),O=this.mappedStatusCode;if(O===P.Status.UNKNOWN&&"string"==typeof N["grpc-status"]){let S=Number(N["grpc-status"]);S in P.Status&&(O=S,this.trace("received status code "+S+" from server")),T.remove("grpc-status")}let L="";if("string"==typeof N["grpc-message"]){try{L=decodeURI(N["grpc-message"])}catch(S){L=N["grpc-message"]}T.remove("grpc-message"),this.trace('received status details string "'+L+'" from server')}let U={code:O,details:L,metadata:T};this.endCall(U)}destroyHttp2Stream(){var S;if(!this.http2Stream.destroyed){let T;T=(null===(S=this.finalStatus)||void 0===S?void 0:S.code)===P.Status.OK?N.constants.NGHTTP2_NO_ERROR:N.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+T),this.http2Stream.close(T)}}cancelWithStatus(S,T){this.trace("cancelWithStatus code: "+S+' details: "'+T+'"'),this.endCall({code:S,details:T,metadata:new M.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==P.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let S=this.unpushedReadMessages.shift();this.push(S);return}this.http2Stream.resume()}sendMessageWithContext(S,T){this.trace("write() called with message of length "+T.length);let R=T=>{process.nextTick(()=>{var R;let N=P.Status.UNAVAILABLE;(null==T?void 0:T.code)==="ERR_STREAM_WRITE_AFTER_END"&&(N=P.Status.INTERNAL),T&&this.cancelWithStatus(N,`Write error: ${T.message}`),null===(R=S.callback)||void 0===R||R.call(S)})};this.trace("sending data chunk of length "+T.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(T,R)}catch(S){this.endCall({code:P.Status.UNAVAILABLE,details:`Write failed with error ${S.message}`,metadata:new M.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}T.Http2SubchannelCall=W},1407:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.BaseSubchannelWrapper=void 0;class R{constructor(S){this.child=S}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(S){this.child.addConnectivityStateListener(S)}removeConnectivityStateListener(S){this.child.removeConnectivityStateListener(S)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(S){this.child.throttleKeepalive(S)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(S){return this.getRealSubchannel()===S.getRealSubchannel()}}T.BaseSubchannelWrapper=R},2328:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getSubchannelPool=T.SubchannelPool=void 0;let N=R(9387),O=R(1727),P=R(3906),M=R(8429),L=R(2869),U=1e4;class V{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let S=!0;for(let T in this.pool){let R=this.pool[T].filter(S=>!S.subchannel.unrefIfOneRef());R.length>0&&(S=!1),this.pool[T]=R}S&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var S,T;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},U),null===(T=(S=this.cleanupTimer).unref)||void 0===T||T.call(S))}getOrCreateSubchannel(S,T,R,U){this.ensureCleanupTask();let V=(0,M.uriToString)(S);if(V in this.pool){for(let S of this.pool[V])if((0,P.subchannelAddressEqual)(T,S.subchannelAddress)&&(0,N.channelOptionsEqual)(R,S.channelArguments)&&U._equals(S.channelCredentials))return S.subchannel}let $=new O.Subchannel(S,T,R,U,new L.Http2SubchannelConnector(S));return V in this.pool||(this.pool[V]=[]),this.pool[V].push({subchannelAddress:T,channelArguments:R,channelCredentials:U,subchannel:$}),$.ref(),$}}T.SubchannelPool=V;let $=new V;function K(S){return S?$:new V}T.getSubchannelPool=K},1727:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Subchannel=void 0;let N=R(3955),O=R(4934),P=R(7504),M=R(2678),L=R(8429),U=R(3906),V=R(5993),$="subchannel",K=2147483647;class W{constructor(S,T,R,P,M){var L;this.channelTarget=S,this.subchannelAddress=T,this.options=R,this.credentials=P,this.connector=M,this.connectivityState=N.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new V.ChannelzCallTracker,this.childrenTracker=new V.ChannelzChildrenTracker,this.streamTracker=new V.ChannelzCallTracker;let $={initialDelay:R["grpc.initial_reconnect_backoff_ms"],maxDelay:R["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new O.BackoffTimeout(()=>{this.handleBackoffTimer()},$),this.backoffTimeout.unref(),this.subchannelAddressString=(0,U.subchannelAddressToString)(T),this.keepaliveTime=null!==(L=R["grpc.keepalive_time_ms"])&&void 0!==L?L:-1,0===R["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new V.ChannelzTrace,this.channelzRef=(0,V.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(R,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(S){P.trace(M.LogVerbosity.DEBUG,$,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}refTrace(S){P.trace(M.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([N.ConnectivityState.TRANSIENT_FAILURE],N.ConnectivityState.CONNECTING):this.transitionToState([N.ConnectivityState.TRANSIENT_FAILURE],N.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let S=this.options;if(S["grpc.keepalive_time_ms"]){let T=Math.min(this.keepaliveTime,K);S=Object.assign(Object.assign({},S),{"grpc.keepalive_time_ms":T})}this.connector.connect(this.subchannelAddress,this.credentials,S).then(S=>{this.transitionToState([N.ConnectivityState.CONNECTING],N.ConnectivityState.READY)?(this.transport=S,this.channelzEnabled&&this.childrenTracker.refChild(S.getChannelzRef()),S.addDisconnectListener(S=>{this.transitionToState([N.ConnectivityState.READY],N.ConnectivityState.IDLE),S&&this.keepaliveTime>0&&(this.keepaliveTime*=2,P.log(M.LogVerbosity.ERROR,`Connection to ${(0,L.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):S.shutdown()},S=>{this.transitionToState([N.ConnectivityState.CONNECTING],N.ConnectivityState.TRANSIENT_FAILURE,`${S}`)})}transitionToState(S,T,R){var O,P;if(-1===S.indexOf(this.connectivityState))return!1;this.trace(N.ConnectivityState[this.connectivityState]+" -> "+N.ConnectivityState[T]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+N.ConnectivityState[T]);let M=this.connectivityState;switch(this.connectivityState=T,T){case N.ConnectivityState.READY:this.stopBackoff();break;case N.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case N.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(O=this.transport)||void 0===O||O.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case N.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(P=this.transport)||void 0===P||P.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${T}`)}for(let S of this.stateListeners)S(this,M,T,this.keepaliveTime,R);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,V.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([N.ConnectivityState.CONNECTING,N.ConnectivityState.READY],N.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(S,T,R,N){let O;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),O={onCallEnd:S=>{S.code===M.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):O={},this.transport.createCall(S,T,R,N,O)}startConnecting(){process.nextTick(()=>{this.transitionToState([N.ConnectivityState.IDLE],N.ConnectivityState.CONNECTING)||this.connectivityState!==N.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(S){this.stateListeners.add(S)}removeConnectivityStateListener(S){this.stateListeners.delete(S)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([N.ConnectivityState.TRANSIENT_FAILURE],N.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(S){return S.getRealSubchannel()===this}throttleKeepalive(S){S>this.keepaliveTime&&(this.keepaliveTime=S)}}T.Subchannel=W},3009:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.getDefaultRootsData=T.CIPHER_SUITES=void 0;let N=R(7147);T.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let O=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,P=null;function M(){return O?(null===P&&(P=N.readFileSync(O)),P):null}T.getDefaultRootsData=M},2869:(S,T,R)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.Http2SubchannelConnector=void 0;let N=R(5158),O=R(4404),P=R(5993),M=R(2678),L=R(2039),U=R(7504),V=R(492),$=R(3906),K=R(8429),W=R(1808),Q=R(7060),Y=R(8445),X="transport",Z="transport_flowctrl",ee=R(7231).i8,{HTTP2_HEADER_AUTHORITY:et,HTTP2_HEADER_CONTENT_TYPE:er,HTTP2_HEADER_METHOD:en,HTTP2_HEADER_PATH:ei,HTTP2_HEADER_TE:es,HTTP2_HEADER_USER_AGENT:ea}=N.constants,eo=2e4,eu=Buffer.from("too_many_pings","ascii");class ec{constructor(S,T,R,O){this.session=S,this.options=R,this.remoteName=O,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=eo,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new P.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,$.subchannelAddressToString)(T),0===R["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,P.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[R["grpc.primary_user_agent"],`grpc-node-js/${ee}`,R["grpc.secondary_user_agent"]].filter(S=>S).join(" "),"grpc.keepalive_time_ms"in R&&(this.keepaliveTimeMs=R["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in R&&(this.keepaliveTimeoutMs=R["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in R?this.keepaliveWithoutCalls=1===R["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,S.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),S.once("goaway",(S,T,R)=>{let O=!1;S===N.constants.NGHTTP2_ENHANCE_YOUR_CALM&&R&&R.equals(eu)&&(O=!0),this.trace("connection closed by GOAWAY with code "+S+" and data "+(null==R?void 0:R.toString())),this.reportDisconnectToOwner(O)}),S.once("error",S=>{this.trace("connection closed with error "+S.message)}),U.isTracerEnabled(X)&&(S.on("remoteSettings",T=>{this.trace("new settings received"+(this.session!==S?" on the old connection":"")+": "+JSON.stringify(T))}),S.on("localSettings",T=>{this.trace("local settings acknowledged by remote"+(this.session!==S?" on the old connection":"")+": "+JSON.stringify(T))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var S,T,R;let N;let O=this.session.socket,P=O.remoteAddress?(0,$.stringToSubchannelAddress)(O.remoteAddress,O.remotePort):null,M=O.localAddress?(0,$.stringToSubchannelAddress)(O.localAddress,O.localPort):null;if(this.session.encrypted){let T=O,R=T.getCipher(),P=T.getCertificate(),M=T.getPeerCertificate();N={cipherSuiteStandardName:null!==(S=R.standardName)&&void 0!==S?S:null,cipherSuiteOtherName:R.standardName?null:R.name,localCertificate:P&&"raw"in P?P.raw:null,remoteCertificate:M&&"raw"in M?M.raw:null}}else N=null;return{remoteAddress:P,localAddress:M,security:N,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(T=this.session.state.localWindowSize)&&void 0!==T?T:null,remoteFlowControlWindow:null!==(R=this.session.state.remoteWindowSize)&&void 0!==R?R:null}}trace(S){U.trace(M.LogVerbosity.DEBUG,X,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}keepaliveTrace(S){U.trace(M.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}flowControlTrace(S){U.trace(M.LogVerbosity.DEBUG,Z,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}internalsTrace(S){U.trace(M.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+S)}reportDisconnectToOwner(S){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(T=>T(S)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let S of this.activeCalls)S.onDisconnect()})}addDisconnectListener(S){this.disconnectListeners.push(S)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var S,T;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null===(T=(S=this.keepaliveTimeoutId).unref)||void 0===T||T.call(S));try{this.session.ping((S,T,R)=>{S&&(this.keepaliveTrace("Ping failed with error "+S.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(S){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var S,T;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null===(T=(S=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)||void 0===T?void 0:T.call(S)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(S){this.activeCalls.delete(S),0===this.activeCalls.size&&this.session.unref()}addActiveCall(S){this.activeCalls.add(S),1!==this.activeCalls.size||(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(S,T,R,N,O){let P,M,L;let U=S.toHttp2Headers();U[et]=T,U[ea]=this.userAgent,U[er]="application/grpc",U[en]="POST",U[ei]=R,U[es]="trailers";try{P=this.session.request(U)}catch(S){throw this.handleDisconnect(),S}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),M={addMessageSent:()=>{var S;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null===(S=O.addMessageSent)||void 0===S||S.call(O)},addMessageReceived:()=>{var S;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null===(S=O.addMessageReceived)||void 0===S||S.call(O)},onCallEnd:S=>{var T;null===(T=O.onCallEnd)||void 0===T||T.call(O,S),this.removeActiveCall(L)},onStreamEnd:S=>{var T;S?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null===(T=O.onStreamEnd)||void 0===T||T.call(O,S)}}):M={addMessageSent:()=>{var S;null===(S=O.addMessageSent)||void 0===S||S.call(O)},addMessageReceived:()=>{var S;null===(S=O.addMessageReceived)||void 0===S||S.call(O)},onCallEnd:S=>{var T;null===(T=O.onCallEnd)||void 0===T||T.call(O,S),this.removeActiveCall(L)},onStreamEnd:S=>{var T;null===(T=O.onStreamEnd)||void 0===T||T.call(O,S)}},L=new Q.Http2SubchannelCall(P,M,N,this,(0,Y.getNextCallNumber)()),this.addActiveCall(L),L}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,P.unregisterChannelzRef)(this.channelzRef)}}class eh{constructor(S){this.channelTarget=S,this.session=null,this.isShutdown=!1}trace(S){U.trace(M.LogVerbosity.DEBUG,X,(0,K.uriToString)(this.channelTarget)+" "+S)}createSession(S,T,R,P){return this.isShutdown?Promise.reject():new Promise((M,L)=>{var U,Q,Y;let X;P.realTarget?(X=(0,K.uriToString)(P.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,K.uriToString)(P.realTarget))):(X=null,this.trace("creating HTTP/2 session to "+(0,$.subchannelAddressToString)(S)));let Z=(0,V.getDefaultAuthority)(null!==(U=P.realTarget)&&void 0!==U?U:this.channelTarget),ee=T._getConnectionOptions()||{};ee.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in R?ee.maxSessionMemory=R["grpc-node.max_session_memory"]:ee.maxSessionMemory=Number.MAX_SAFE_INTEGER;let et="http://";if("secureContext"in ee){if(et="https://",R["grpc.ssl_target_name_override"]){let S=R["grpc.ssl_target_name_override"];ee.checkServerIdentity=(T,R)=>(0,O.checkServerIdentity)(S,R),ee.servername=S}else{let S=null!==(Y=null===(Q=(0,K.splitHostPort)(Z))||void 0===Q?void 0:Q.host)&&void 0!==Y?Y:"localhost";ee.servername=S}P.socket&&(ee.createConnection=(S,T)=>P.socket)}else ee.createConnection=(T,R)=>P.socket?P.socket:W.connect(S);ee=Object.assign(Object.assign(Object.assign({},ee),S),{enableTrace:1===R["grpc-node.tls_enable_trace"]});let er=N.connect(et+Z,ee);this.session=er;let en="Failed to connect";er.unref(),er.once("connect",()=>{er.removeAllListeners(),M(new ec(er,S,R,X)),this.session=null}),er.once("close",()=>{this.session=null,setImmediate(()=>{L(`${en} (${new Date().toISOString()})`)})}),er.once("error",S=>{en=S.message,this.trace("connection failed with error "+en)})})}connect(S,T,R){var N,P;if(this.isShutdown)return Promise.reject();let M=T._getConnectionOptions()||{};if("secureContext"in M){if(M.ALPNProtocols=["h2"],R["grpc.ssl_target_name_override"]){let S=R["grpc.ssl_target_name_override"];M.checkServerIdentity=(T,R)=>(0,O.checkServerIdentity)(S,R),M.servername=S}else if("grpc.http_connect_target"in R){let S=(0,V.getDefaultAuthority)(null!==(N=(0,K.parseUri)(R["grpc.http_connect_target"]))&&void 0!==N?N:{path:"localhost"}),T=(0,K.splitHostPort)(S);M.servername=null!==(P=null==T?void 0:T.host)&&void 0!==P?P:S}R["grpc-node.tls_enable_trace"]&&(M.enableTrace=!0)}return(0,L.getProxiedConnection)(S,R,M).then(N=>this.createSession(S,T,R,N))}shutdown(){var S;this.isShutdown=!0,null===(S=this.session)||void 0===S||S.close(),this.session=null}}T.Http2SubchannelConnector=eh},8429:(S,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.uriToString=T.splitHostPort=T.parseUri=void 0;let R=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function N(S){let T=R.exec(S);return null===T?null:{scheme:T[1],authority:T[2],path:T[3]}}T.parseUri=N;let O=/^\d+$/;function P(S){if(S.startsWith("[")){let T=S.indexOf("]");if(-1===T)return null;let R=S.substring(1,T);if(-1===R.indexOf(":"))return null;if(!(S.length>T+1))return{host:R};if(":"!==S[T+1])return null;{let N=S.substring(T+2);return O.test(N)?{host:R,port:+N}:null}}{let T=S.split(":");return 2!==T.length?{host:S}:O.test(T[1])?{host:T[0],port:+T[1]}:null}}function M(S){let T="";return void 0!==S.scheme&&(T+=S.scheme+":"),void 0!==S.authority&&(T+="//"+S.authority+"/"),T+=S.path}T.splitHostPort=P,T.uriToString=M},8715:(S,T,R)=>{"use strict";var N,O;/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */N={value:!0},N=N=T.im=T.J_=N=T.Cp=N=N=void 0;let P=R(1382),M=R(5269),L=R(1725),U=R(2916);N=R(1468),N=function(S){return"@type"in S&&"string"==typeof S["@type"]},function(S){S.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",S.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",S.IDEMPOTENT="IDEMPOTENT"}(O=T.Cp||(T.Cp={}));let V={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function $(S,T){return""===S?T:S+"."+T}function K(S){return S instanceof M.Service||S instanceof M.Type||S instanceof M.Enum}function W(S){return S instanceof M.Namespace||S instanceof M.Root}function Q(S,T){let R=$(T,S.name);return K(S)?[[R,S]]:W(S)&&void 0!==S.nested?Object.keys(S.nested).map(T=>Q(S.nested[T],R)).reduce((S,T)=>S.concat(T),[]):[]}function Y(S,T){return function(R){return S.toObject(S.decode(R),T)}}function X(S){return function(T){if(Array.isArray(T))throw Error(`Failed to serialize message: expected object with ${S.name} structure, got array instead`);let R=S.fromObject(T);return S.encode(R).finish()}}function Z(S){return(S||[]).reduce((S,T)=>{for(let[R,N]of Object.entries(T))"uninterpreted_option"===R?S.uninterpreted_option.push(T.uninterpreted_option):S[R]=N;return S},{deprecated:!1,idempotency_level:O.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function ee(S,T,R,N){let O=S.resolvedRequestType,M=S.resolvedResponseType;return{path:"/"+T+"/"+S.name,requestStream:!!S.requestStream,responseStream:!!S.responseStream,requestSerialize:X(O),requestDeserialize:Y(O,R),responseSerialize:X(M),responseDeserialize:Y(M,R),originalName:P(S.name),requestType:er(O,N),responseType:er(M,N),options:Z(S.parsedOptions)}}function et(S,T,R,N){let O={};for(let P of S.methodsArray)O[P.name]=ee(P,T,R,N);return O}function er(S,T){let R=S.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:R.$type.toObject(R,V),fileDescriptorProtos:T}}function en(S,T){let R=S.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:R.$type.toObject(R,V),fileDescriptorProtos:T}}function ei(S,T,R,N){if(S instanceof M.Service)return et(S,T,R,N);if(S instanceof M.Type)return er(S,N);if(S instanceof M.Enum)return en(S,N);throw Error("Type mismatch in reflection object handling")}function es(S,T){let R={};S.resolveAll();let N=S.toDescriptor("proto3").file.map(S=>Buffer.from(L.FileDescriptorProto.encode(S).finish()));for(let[O,P]of Q(S,""))R[O]=ei(P,O,T,N);return R}function ea(S,T){T=T||{};let R=M.Root.fromDescriptor(S);return R.resolveAll(),es(R,T)}function eo(S,T){return es((0,U.loadProtosWithOptionsSync)(S,T),T)}function eu(S,T){T=T||{};let R=M.Root.fromJSON(S);return R.resolveAll(),es(R,T)}N=function(S,T){return(0,U.loadProtosWithOptions)(S,T).then(S=>es(S,T))},T.J_=eo,T.im=eu,N=function(S,T){return ea(L.FileDescriptorSet.decode(S),T)},N=function(S,T){return ea(L.FileDescriptorSet.fromObject(S),T)},(0,U.addCommonProtos)()},2916:(S,T,R)=>{"use strict";/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */Object.defineProperty(T,"__esModule",{value:!0}),T.addCommonProtos=T.loadProtosWithOptionsSync=T.loadProtosWithOptions=void 0;let N=R(7147),O=R(1017),P=R(5269);function M(S,T){let R=S.resolvePath;S.resolvePath=(S,P)=>{if(O.isAbsolute(P))return P;for(let S of T){let T=O.join(S,P);try{return N.accessSync(T,N.constants.R_OK),T}catch(S){continue}}return process.emitWarning(`${P} not found in any of the include paths ${T}`),R(S,P)}}async function L(S,T){let R=new P.Root;if((T=T||{}).includeDirs){if(!Array.isArray(T.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));M(R,T.includeDirs)}let N=await R.load(S,T);return N.resolveAll(),N}function U(S,T){let R=new P.Root;if((T=T||{}).includeDirs){if(!Array.isArray(T.includeDirs))throw Error("The includeDirs option must be an array");M(R,T.includeDirs)}let N=R.loadSync(S,T);return N.resolveAll(),N}function V(){let S=R(6541),T=R(9987),N=R(9827),O=R(3795);P.common("api",S.nested.google.nested.protobuf.nested),P.common("descriptor",T.nested.google.nested.protobuf.nested),P.common("source_context",N.nested.google.nested.protobuf.nested),P.common("type",O.nested.google.nested.protobuf.nested)}T.loadProtosWithOptions=L,T.loadProtosWithOptionsSync=U,T.addCommonProtos=V},799:S=>{"use strict";function T(S,T){for(var R=Array(arguments.length-1),N=0,O=2,P=!0;O<arguments.length;)R[N++]=arguments[O++];return new Promise(function(O,M){R[N]=function(S){if(P){if(P=!1,S)M(S);else{for(var T=Array(arguments.length-1),R=0;R<T.length;)T[R++]=arguments[R];O.apply(null,T)}}};try{S.apply(T||null,R)}catch(S){P&&(P=!1,M(S))}})}S.exports=T},2130:(S,T)=>{"use strict";var R=T;R.length=function(S){var T=S.length;if(!T)return 0;for(var R=0;--T%4>1&&"="===S.charAt(T);)++R;return Math.ceil(3*S.length)/4-R};for(var N=Array(64),O=Array(123),P=0;P<64;)O[N[P]=P<26?P+65:P<52?P+71:P<62?P-4:P-59|43]=P++;R.encode=function(S,T,R){for(var O,P=null,M=[],L=0,U=0;T<R;){var V=S[T++];switch(U){case 0:M[L++]=N[V>>2],O=(3&V)<<4,U=1;break;case 1:M[L++]=N[O|V>>4],O=(15&V)<<2,U=2;break;case 2:M[L++]=N[O|V>>6],M[L++]=N[63&V],U=0}L>8191&&((P||(P=[])).push(String.fromCharCode.apply(String,M)),L=0)}return(U&&(M[L++]=N[O],M[L++]=61,1===U&&(M[L++]=61)),P)?(L&&P.push(String.fromCharCode.apply(String,M.slice(0,L))),P.join("")):String.fromCharCode.apply(String,M.slice(0,L))};var M="invalid encoding";R.decode=function(S,T,R){for(var N,P=R,L=0,U=0;U<S.length;){var V=S.charCodeAt(U++);if(61===V&&L>1)break;if(void 0===(V=O[V]))throw Error(M);switch(L){case 0:N=V,L=1;break;case 1:T[R++]=N<<2|(48&V)>>4,N=V,L=2;break;case 2:T[R++]=(15&N)<<4|(60&V)>>2,N=V,L=3;break;case 3:T[R++]=(3&N)<<6|V,L=0}}if(1===L)throw Error(M);return R-P},R.test=function(S){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(S)}},2012:S=>{"use strict";function T(S,R){"string"==typeof S&&(R=S,S=void 0);var N=[];function O(S){if("string"!=typeof S){var R=P();if(T.verbose&&console.log("codegen: "+R),R="return "+R,S){for(var M=Object.keys(S),L=Array(M.length+1),U=Array(M.length),V=0;V<M.length;)L[V]=M[V],U[V]=S[M[V++]];return L[V]=R,Function.apply(null,L).apply(null,U)}return Function(R)()}for(var $=Array(arguments.length-1),K=0;K<$.length;)$[K]=arguments[++K];if(K=0,S=S.replace(/%([%dfijs])/g,function(S,T){var R=$[K++];switch(T){case"d":case"f":return String(Number(R));case"i":return String(Math.floor(R));case"j":return JSON.stringify(R);case"s":return String(R)}return"%"}),K!==$.length)throw Error("parameter count mismatch");return N.push(S),O}function P(T){return"function "+(T||R||"")+"("+(S&&S.join(",")||"")+"){\n  "+N.join("\n  ")+"\n}"}return O.toString=P,O}S.exports=T,T.verbose=!1},854:S=>{"use strict";function T(){this._listeners={}}S.exports=T,T.prototype.on=function(S,T,R){return(this._listeners[S]||(this._listeners[S]=[])).push({fn:T,ctx:R||this}),this},T.prototype.off=function(S,T){if(void 0===S)this._listeners={};else if(void 0===T)this._listeners[S]=[];else for(var R=this._listeners[S],N=0;N<R.length;)R[N].fn===T?R.splice(N,1):++N;return this},T.prototype.emit=function(S){var T=this._listeners[S];if(T){for(var R=[],N=1;N<arguments.length;)R.push(arguments[N++]);for(N=0;N<T.length;)T[N].fn.apply(T[N++].ctx,R)}return this}},3035:(S,T,R)=>{"use strict";S.exports=P;var N=R(799),O=R(449)("fs");function P(S,T,R){return("function"==typeof T?(R=T,T={}):T||(T={}),R)?!T.xhr&&O&&O.readFile?O.readFile(S,function(N,O){return N&&"undefined"!=typeof XMLHttpRequest?P.xhr(S,T,R):N?R(N):R(null,T.binary?O:O.toString("utf8"))}):P.xhr(S,T,R):N(P,this,S,T)}P.xhr=function(S,T,R){var N=new XMLHttpRequest;N.onreadystatechange=function(){if(4===N.readyState){if(0!==N.status&&200!==N.status)return R(Error("status "+N.status));if(T.binary){var S=N.response;if(!S){S=[];for(var O=0;O<N.responseText.length;++O)S.push(255&N.responseText.charCodeAt(O))}return R(null,"undefined"!=typeof Uint8Array?new Uint8Array(S):S)}return R(null,N.responseText)}},T.binary&&("overrideMimeType"in N&&N.overrideMimeType("text/plain; charset=x-user-defined"),N.responseType="arraybuffer"),N.open("GET",S),N.send()}},4324:S=>{"use strict";function T(S){return"undefined"!=typeof Float32Array?function(){var T=new Float32Array([-0]),R=new Uint8Array(T.buffer),N=128===R[3];function O(S,N,O){T[0]=S,N[O]=R[0],N[O+1]=R[1],N[O+2]=R[2],N[O+3]=R[3]}function P(S,N,O){T[0]=S,N[O]=R[3],N[O+1]=R[2],N[O+2]=R[1],N[O+3]=R[0]}function M(S,N){return R[0]=S[N],R[1]=S[N+1],R[2]=S[N+2],R[3]=S[N+3],T[0]}function L(S,N){return R[3]=S[N],R[2]=S[N+1],R[1]=S[N+2],R[0]=S[N+3],T[0]}S.writeFloatLE=N?O:P,S.writeFloatBE=N?P:O,S.readFloatLE=N?M:L,S.readFloatBE=N?L:M}():function(){function T(S,T,R,N){var O=T<0?1:0;if(O&&(T=-T),0===T)S(1/T>0?0:2147483648,R,N);else if(isNaN(T))S(2143289344,R,N);else if(T>34028234663852886e22)S((O<<31|2139095040)>>>0,R,N);else if(T<11754943508222875e-54)S((O<<31|Math.round(T/1401298464324817e-60))>>>0,R,N);else{var P=Math.floor(Math.log(T)/Math.LN2),M=8388607&Math.round(T*Math.pow(2,-P)*8388608);S((O<<31|P+127<<23|M)>>>0,R,N)}}function M(S,T,R){var N=S(T,R),O=(N>>31)*2+1,P=N>>>23&255,M=8388607&N;return 255===P?M?NaN:1/0*O:0===P?1401298464324817e-60*O*M:O*Math.pow(2,P-150)*(M+8388608)}S.writeFloatLE=T.bind(null,R),S.writeFloatBE=T.bind(null,N),S.readFloatLE=M.bind(null,O),S.readFloatBE=M.bind(null,P)}(),"undefined"!=typeof Float64Array?function(){var T=new Float64Array([-0]),R=new Uint8Array(T.buffer),N=128===R[7];function O(S,N,O){T[0]=S,N[O]=R[0],N[O+1]=R[1],N[O+2]=R[2],N[O+3]=R[3],N[O+4]=R[4],N[O+5]=R[5],N[O+6]=R[6],N[O+7]=R[7]}function P(S,N,O){T[0]=S,N[O]=R[7],N[O+1]=R[6],N[O+2]=R[5],N[O+3]=R[4],N[O+4]=R[3],N[O+5]=R[2],N[O+6]=R[1],N[O+7]=R[0]}function M(S,N){return R[0]=S[N],R[1]=S[N+1],R[2]=S[N+2],R[3]=S[N+3],R[4]=S[N+4],R[5]=S[N+5],R[6]=S[N+6],R[7]=S[N+7],T[0]}function L(S,N){return R[7]=S[N],R[6]=S[N+1],R[5]=S[N+2],R[4]=S[N+3],R[3]=S[N+4],R[2]=S[N+5],R[1]=S[N+6],R[0]=S[N+7],T[0]}S.writeDoubleLE=N?O:P,S.writeDoubleBE=N?P:O,S.readDoubleLE=N?M:L,S.readDoubleBE=N?L:M}():function(){function T(S,T,R,N,O,P){var M,L=N<0?1:0;if(L&&(N=-N),0===N)S(0,O,P+T),S(1/N>0?0:2147483648,O,P+R);else if(isNaN(N))S(0,O,P+T),S(2146959360,O,P+R);else if(N>17976931348623157e292)S(0,O,P+T),S((L<<31|2146435072)>>>0,O,P+R);else if(N<22250738585072014e-324)S((M=N/5e-324)>>>0,O,P+T),S((L<<31|M/4294967296)>>>0,O,P+R);else{var U=Math.floor(Math.log(N)/Math.LN2);1024===U&&(U=1023),S(4503599627370496*(M=N*Math.pow(2,-U))>>>0,O,P+T),S((L<<31|U+1023<<20|1048576*M&1048575)>>>0,O,P+R)}}function M(S,T,R,N,O){var P=S(N,O+T),M=S(N,O+R),L=(M>>31)*2+1,U=M>>>20&2047,V=4294967296*(1048575&M)+P;return 2047===U?V?NaN:1/0*L:0===U?5e-324*L*V:L*Math.pow(2,U-1075)*(V+4503599627370496)}S.writeDoubleLE=T.bind(null,R,0,4),S.writeDoubleBE=T.bind(null,N,4,0),S.readDoubleLE=M.bind(null,O,0,4),S.readDoubleBE=M.bind(null,P,4,0)}(),S}function R(S,T,R){T[R]=255&S,T[R+1]=S>>>8&255,T[R+2]=S>>>16&255,T[R+3]=S>>>24}function N(S,T,R){T[R]=S>>>24,T[R+1]=S>>>16&255,T[R+2]=S>>>8&255,T[R+3]=255&S}function O(S,T){return(S[T]|S[T+1]<<8|S[T+2]<<16|S[T+3]<<24)>>>0}function P(S,T){return(S[T]<<24|S[T+1]<<16|S[T+2]<<8|S[T+3])>>>0}S.exports=T(T)},449:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},9986:(S,T)=>{"use strict";var R=T,N=R.isAbsolute=function(S){return/^(?:\/|\w+:)/.test(S)},O=R.normalize=function(S){var T=(S=S.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),R=N(S),O="";R&&(O=T.shift()+"/");for(var P=0;P<T.length;)".."===T[P]?P>0&&".."!==T[P-1]?T.splice(--P,2):R?T.splice(P,1):++P:"."===T[P]?T.splice(P,1):++P;return O+T.join("/")};R.resolve=function(S,T,R){return(R||(T=O(T)),N(T))?T:(R||(S=O(S)),(S=S.replace(/(?:\/|^)[^/]+$/,"")).length?O(S+"/"+T):T)}},6035:S=>{"use strict";function T(S,T,R){var N=R||8192,O=N>>>1,P=null,M=N;return function(R){if(R<1||R>O)return S(R);M+R>N&&(P=S(N),M=0);var L=T.call(P,M,M+=R);return 7&M&&(M=(7|M)+1),L}}S.exports=T},8131:(S,T)=>{"use strict";var R=T;R.length=function(S){for(var T=0,R=0,N=0;N<S.length;++N)(R=S.charCodeAt(N))<128?T+=1:R<2048?T+=2:(64512&R)==55296&&(64512&S.charCodeAt(N+1))==56320?(++N,T+=4):T+=3;return T},R.read=function(S,T,R){if(R-T<1)return"";for(var N,O=null,P=[],M=0;T<R;)(N=S[T++])<128?P[M++]=N:N>191&&N<224?P[M++]=(31&N)<<6|63&S[T++]:N>239&&N<365?(N=((7&N)<<18|(63&S[T++])<<12|(63&S[T++])<<6|63&S[T++])-65536,P[M++]=55296+(N>>10),P[M++]=56320+(1023&N)):P[M++]=(15&N)<<12|(63&S[T++])<<6|63&S[T++],M>8191&&((O||(O=[])).push(String.fromCharCode.apply(String,P)),M=0);return O?(M&&O.push(String.fromCharCode.apply(String,P.slice(0,M))),O.join("")):String.fromCharCode.apply(String,P.slice(0,M))},R.write=function(S,T,R){for(var N,O,P=R,M=0;M<S.length;++M)(N=S.charCodeAt(M))<128?T[R++]=N:(N<2048?T[R++]=N>>6|192:((64512&N)==55296&&(64512&(O=S.charCodeAt(M+1)))==56320?(N=65536+((1023&N)<<10)+(1023&O),++M,T[R++]=N>>18|240,T[R++]=N>>12&63|128):T[R++]=N>>12|224,T[R++]=N>>6&63|128),T[R++]=63&N|128);return R-P}},1382:S=>{var T=1/0,R="[object Symbol]",N=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,O=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,P="\ud800-\udfff",M="\\u0300-\\u036f\\ufe20-\\ufe23",L="\\u20d0-\\u20f0",U="\\u2700-\\u27bf",V="a-z\\xdf-\\xf6\\xf8-\\xff",$="A-Z\\xc0-\\xd6\\xd8-\\xde",K="\\ufe0e\\ufe0f",W="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Q="['’]",Y="["+P+"]",X="["+W+"]",Z="["+M+L+"]",ee="\\d+",et="["+U+"]",er="["+V+"]",en="[^"+P+W+ee+U+V+$+"]",ei="\ud83c[\udffb-\udfff]",es="[^"+P+"]",ea="(?:\ud83c[\udde6-\uddff]){2}",eo="[\ud800-\udbff][\udc00-\udfff]",eu="["+$+"]",ec="\\u200d",eh="(?:"+er+"|"+en+")",ed="(?:"+eu+"|"+en+")",ep="(?:"+Q+"(?:d|ll|m|re|s|t|ve))?",ef="(?:"+Q+"(?:D|LL|M|RE|S|T|VE))?",eg="(?:"+Z+"|"+ei+")?",em="["+K+"]?",ey="(?:"+ec+"(?:"+[es,ea,eo].join("|")+")"+em+eg+")*",ev=em+eg+ey,eb="(?:"+[et,ea,eo].join("|")+")"+ev,eS="(?:"+[es+Z+"?",Z,ea,eo,Y].join("|")+")",eT=RegExp(Q,"g"),ew=RegExp(Z,"g"),eC=RegExp(ei+"(?="+ei+")|"+eS+ev,"g"),eE=RegExp([eu+"?"+er+"+"+ep+"(?="+[X,eu,"$"].join("|")+")",ed+"+"+ef+"(?="+[X,eu+eh,"$"].join("|")+")",eu+"?"+eh+"+"+ep,eu+"+"+ef,ee,eb].join("|"),"g"),eI=RegExp("["+ec+P+M+L+K+"]"),e_=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ek={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"ss"},eR="object"==typeof global&&global&&global.Object===Object&&global,eA="object"==typeof self&&self&&self.Object===Object&&self,eD=eR||eA||Function("return this")();function eN(S,T,R,N){var O=-1,P=S?S.length:0;for(N&&P&&(R=S[++O]);++O<P;)R=T(R,S[O],O,S);return R}function eO(S){return S.split("")}function ex(S){return S.match(N)||[]}var eP=function(S){return function(T){return null==S?void 0:S[T]}}(ek);function eM(S){return eI.test(S)}function eL(S){return e_.test(S)}function eB(S){return eM(S)?eF(S):eO(S)}function eF(S){return S.match(eC)||[]}function eU(S){return S.match(eE)||[]}var ej=Object.prototype.toString,eV=eD.Symbol,ez=eV?eV.prototype:void 0,eq=ez?ez.toString:void 0;function e$(S,T,R){var N=-1,O=S.length;T<0&&(T=-T>O?0:O+T),(R=R>O?O:R)<0&&(R+=O),O=T>R?0:R-T>>>0,T>>>=0;for(var P=Array(O);++N<O;)P[N]=S[N+T];return P}function eG(S){if("string"==typeof S)return S;if(eQ(S))return eq?eq.call(S):"";var R=S+"";return"0"==R&&1/S==-T?"-0":R}function eK(S,T,R){var N=S.length;return R=void 0===R?N:R,!T&&R>=N?S:e$(S,T,R)}function eH(S){return function(T){var R=eM(T=eY(T))?eB(T):void 0,N=R?R[0]:T.charAt(0),O=R?eK(R,1).join(""):T.slice(1);return N[S]()+O}}function eW(S){return!!S&&"object"==typeof S}function eQ(S){return"symbol"==typeof S||eW(S)&&ej.call(S)==R}function eY(S){return null==S?"":eG(S)}var eJ=function(S){return function(T){return eN(e1(eZ(T).replace(eT,"")),S,"")}}(function(S,T,R){return T=T.toLowerCase(),S+(R?eX(T):T)});function eX(S){return e0(eY(S).toLowerCase())}function eZ(S){return(S=eY(S))&&S.replace(O,eP).replace(ew,"")}var e0=eH("toUpperCase");function e1(S,T,R){return(S=eY(S),void 0===(T=R?void 0:T))?eL(S)?eU(S):ex(S):S.match(T)||[]}S.exports=eJ},1725:(S,T,R)=>{"use strict";var N=R(5269);S.exports=T=N.descriptor=N.Root.fromJSON(R(9987)).lookup(".google.protobuf");var O=N.Namespace,P=N.Root,M=N.Enum,L=N.Type,U=N.Field,V=N.MapField,$=N.OneOf,K=N.Service,W=N.Method;function Q(S,R,N){var V=T.FileDescriptorProto.create({name:S.filename||(S.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});N&&(V.syntax=N),S instanceof P||(V.package=S.fullName.substring(1));for(var $,W=0;W<S.nestedArray.length;++W)($=S._nestedArray[W])instanceof L?V.messageType.push($.toDescriptor(N)):$ instanceof M?V.enumType.push($.toDescriptor()):$ instanceof U?V.extension.push($.toDescriptor(N)):$ instanceof K?V.service.push($.toDescriptor()):$ instanceof O&&Q($,R,N);V.options=eo(S.options,T.FileOptions),V.messageType.length+V.enumType.length+V.extension.length+V.service.length&&R.push(V)}P.fromDescriptor=function(S){"number"==typeof S.length&&(S=T.FileDescriptorSet.decode(S));var R=new P;if(S.file)for(var N,O,V,$=0;$<S.file.length;++$){if(O=R,(N=S.file[$]).package&&N.package.length&&(O=R.define(N.package)),N.name&&N.name.length&&R.files.push(O.filename=N.name),N.messageType)for(V=0;V<N.messageType.length;++V)O.add(L.fromDescriptor(N.messageType[V],N.syntax));if(N.enumType)for(V=0;V<N.enumType.length;++V)O.add(M.fromDescriptor(N.enumType[V]));if(N.extension)for(V=0;V<N.extension.length;++V)O.add(U.fromDescriptor(N.extension[V]));if(N.service)for(V=0;V<N.service.length;++V)O.add(K.fromDescriptor(N.service[V]));var W=ea(N.options,T.FileOptions);if(W){var Q=Object.keys(W);for(V=0;V<Q.length;++V)O.setOption(Q[V],W[Q[V]])}}return R},P.prototype.toDescriptor=function(S){var R=T.FileDescriptorSet.create();return Q(this,R.file,S),R};var Y=0;L.fromDescriptor=function(S,R){"number"==typeof S.length&&(S=T.DescriptorProto.decode(S));var N,O=new L(S.name.length?S.name:"Type"+Y++,ea(S.options,T.MessageOptions));if(S.oneofDecl)for(N=0;N<S.oneofDecl.length;++N)O.add($.fromDescriptor(S.oneofDecl[N]));if(S.field)for(N=0;N<S.field.length;++N){var P=U.fromDescriptor(S.field[N],R);O.add(P),S.field[N].hasOwnProperty("oneofIndex")&&O.oneofsArray[S.field[N].oneofIndex].add(P)}if(S.extension)for(N=0;N<S.extension.length;++N)O.add(U.fromDescriptor(S.extension[N],R));if(S.nestedType)for(N=0;N<S.nestedType.length;++N)O.add(L.fromDescriptor(S.nestedType[N],R)),S.nestedType[N].options&&S.nestedType[N].options.mapEntry&&O.setOption("map_entry",!0);if(S.enumType)for(N=0;N<S.enumType.length;++N)O.add(M.fromDescriptor(S.enumType[N]));if(S.extensionRange&&S.extensionRange.length)for(N=0,O.extensions=[];N<S.extensionRange.length;++N)O.extensions.push([S.extensionRange[N].start,S.extensionRange[N].end]);if(S.reservedRange&&S.reservedRange.length||S.reservedName&&S.reservedName.length){if(O.reserved=[],S.reservedRange)for(N=0;N<S.reservedRange.length;++N)O.reserved.push([S.reservedRange[N].start,S.reservedRange[N].end]);if(S.reservedName)for(N=0;N<S.reservedName.length;++N)O.reserved.push(S.reservedName[N])}return O},L.prototype.toDescriptor=function(S){var R,N,O=T.DescriptorProto.create({name:this.name});for(N=0;N<this.fieldsArray.length;++N)if(O.field.push(R=this._fieldsArray[N].toDescriptor(S)),this._fieldsArray[N]instanceof V){var P=es(this._fieldsArray[N].keyType,this._fieldsArray[N].resolvedKeyType),$=es(this._fieldsArray[N].type,this._fieldsArray[N].resolvedType),K=11===$||14===$?this._fieldsArray[N].resolvedType&&eu(this.parent,this._fieldsArray[N].resolvedType)||this._fieldsArray[N].type:void 0;O.nestedType.push(T.DescriptorProto.create({name:R.typeName,field:[T.FieldDescriptorProto.create({name:"key",number:1,label:1,type:P}),T.FieldDescriptorProto.create({name:"value",number:2,label:1,type:$,typeName:K})],options:T.MessageOptions.create({mapEntry:!0})}))}for(N=0;N<this.oneofsArray.length;++N)O.oneofDecl.push(this._oneofsArray[N].toDescriptor());for(N=0;N<this.nestedArray.length;++N)this._nestedArray[N]instanceof U?O.field.push(this._nestedArray[N].toDescriptor(S)):this._nestedArray[N]instanceof L?O.nestedType.push(this._nestedArray[N].toDescriptor(S)):this._nestedArray[N]instanceof M&&O.enumType.push(this._nestedArray[N].toDescriptor());if(this.extensions)for(N=0;N<this.extensions.length;++N)O.extensionRange.push(T.DescriptorProto.ExtensionRange.create({start:this.extensions[N][0],end:this.extensions[N][1]}));if(this.reserved)for(N=0;N<this.reserved.length;++N)"string"==typeof this.reserved[N]?O.reservedName.push(this.reserved[N]):O.reservedRange.push(T.DescriptorProto.ReservedRange.create({start:this.reserved[N][0],end:this.reserved[N][1]}));return O.options=eo(this.options,T.MessageOptions),O};var X=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;U.fromDescriptor=function(S,R){if("number"==typeof S.length&&(S=T.DescriptorProto.decode(S)),"number"!=typeof S.number)throw Error("missing field id");switch(N=S.typeName&&S.typeName.length?S.typeName:en(S.type),S.label){case 1:O=void 0;break;case 2:O="required";break;case 3:O="repeated";break;default:throw Error("illegal label: "+S.label)}var N,O,P=S.extendee;void 0!==S.extendee&&(P=P.length?P:void 0);var M=new U(S.name.length?S.name:"field"+S.number,S.number,N,O,P);if(M.options=ea(S.options,T.FieldOptions),S.defaultValue&&S.defaultValue.length){var L=S.defaultValue;switch(L){case"true":case"TRUE":L=!0;break;case"false":case"FALSE":L=!1;break;default:X.exec(L)&&(L=parseInt(L))}M.setOption("default",L)}return ei(S.type)&&("proto3"===R?S.options&&!S.options.packed&&M.setOption("packed",!1):S.options&&S.options.packed||M.setOption("packed",!1)),M},U.prototype.toDescriptor=function(S){var R=T.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)R.type=11,R.typeName=N.util.ucFirst(this.name),R.label=3;else{switch(R.type=es(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:R.typeName=this.resolvedType?eu(this.parent,this.resolvedType):this.type}switch(this.rule){case"repeated":R.label=3;break;case"required":R.label=2;break;default:R.label=1}}if(R.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(R.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(R.options=eo(this.options,T.FieldOptions),null!=this.options.default&&(R.defaultValue=String(this.options.default))),"proto3"===S?this.packed||((R.options||(R.options=T.FieldOptions.create())).packed=!1):this.packed&&((R.options||(R.options=T.FieldOptions.create())).packed=!0),R};var Z=0;M.fromDescriptor=function(S){"number"==typeof S.length&&(S=T.EnumDescriptorProto.decode(S));var R={};if(S.value)for(var N=0;N<S.value.length;++N){var O=S.value[N].name,P=S.value[N].number||0;R[O&&O.length?O:"NAME"+P]=P}return new M(S.name&&S.name.length?S.name:"Enum"+Z++,R,ea(S.options,T.EnumOptions))},M.prototype.toDescriptor=function(){for(var S=[],R=0,N=Object.keys(this.values);R<N.length;++R)S.push(T.EnumValueDescriptorProto.create({name:N[R],number:this.values[N[R]]}));return T.EnumDescriptorProto.create({name:this.name,value:S,options:eo(this.options,T.EnumOptions)})};var ee=0;$.fromDescriptor=function(S){return"number"==typeof S.length&&(S=T.OneofDescriptorProto.decode(S)),new $(S.name&&S.name.length?S.name:"oneof"+ee++)},$.prototype.toDescriptor=function(){return T.OneofDescriptorProto.create({name:this.name})};var et=0;K.fromDescriptor=function(S){"number"==typeof S.length&&(S=T.ServiceDescriptorProto.decode(S));var R=new K(S.name&&S.name.length?S.name:"Service"+et++,ea(S.options,T.ServiceOptions));if(S.method)for(var N=0;N<S.method.length;++N)R.add(W.fromDescriptor(S.method[N]));return R},K.prototype.toDescriptor=function(){for(var S=[],R=0;R<this.methodsArray.length;++R)S.push(this._methodsArray[R].toDescriptor());return T.ServiceDescriptorProto.create({name:this.name,method:S,options:eo(this.options,T.ServiceOptions)})};var er=0;function en(S){switch(S){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+S)}function ei(S){switch(S){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function es(S,T){switch(S){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(T instanceof M)return 14;if(T instanceof L)return T.group?10:11;throw Error("illegal type: "+S)}function ea(S,T){if(S){for(var R,O,P,L=[],U=0;U<T.fieldsArray.length;++U)"uninterpretedOption"!==(O=(R=T._fieldsArray[U]).name)&&S.hasOwnProperty(O)&&(P=S[O],R.resolvedType instanceof M&&"number"==typeof P&&void 0!==R.resolvedType.valuesById[P]&&(P=R.resolvedType.valuesById[P]),L.push(ec(O),P));return L.length?N.util.toObject(L):void 0}}function eo(S,T){if(S){for(var R,O,P=[],M=0,L=Object.keys(S);M<L.length;++M)if(O=S[R=L[M]],"default"!==R){var U=T.fields[R];(U||(U=T.fields[R=N.util.camelCase(R)]))&&P.push(R,O)}return P.length?T.fromObject(N.util.toObject(P)):void 0}}function eu(S,T){var R=S.fullName.split("."),N=T.fullName.split("."),M=0,L=0,U=N.length-1;if(!(S instanceof P)&&T instanceof O)for(;M<R.length&&L<U&&R[M]===N[L];){var V=T.lookup(R[M++],!0);if(null!==V&&V!==T)break;++L}else for(;M<R.length&&L<U&&R[M]===N[L];++M,++L);return N.slice(L).join(".")}function ec(S){return S.substring(0,1)+S.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(S,T){return"_"+T.toLowerCase()})}W.fromDescriptor=function(S){return"number"==typeof S.length&&(S=T.MethodDescriptorProto.decode(S)),new W(S.name&&S.name.length?S.name:"Method"+er++,"rpc",S.inputType,S.outputType,!!S.clientStreaming,!!S.serverStreaming,ea(S.options,T.MethodOptions))},W.prototype.toDescriptor=function(){return T.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:eo(this.options,T.MethodOptions)})}},5269:(S,T,R)=>{"use strict";S.exports=R(7954)},2516:S=>{"use strict";S.exports=N;var T,R=/\/|\./;function N(S,T){R.test(S)||(S="google/protobuf/"+S+".proto",T={nested:{google:{nested:{protobuf:{nested:T}}}}}),N[S]=T}N("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),N("duration",{Duration:T={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),N("timestamp",{Timestamp:T}),N("empty",{Empty:{fields:{}}}),N("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),N("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),N("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),N.get=function(S){return N[S]||null}},5944:(S,T,R)=>{"use strict";var N=T,O=R(5519),P=R(8289);function M(S,T,R,N){var P=!1;if(T.resolvedType){if(T.resolvedType instanceof O){S("switch(d%s){",N);for(var M=T.resolvedType.values,L=Object.keys(M),U=0;U<L.length;++U)M[L[U]]!==T.typeDefault||P||(S("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',N,N,N),T.repeated||S("break"),P=!0),S("case%j:",L[U])("case %i:",M[L[U]])("m%s=%j",N,M[L[U]])("break");S("}")}else S('if(typeof d%s!=="object")',N)("throw TypeError(%j)",T.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",N,R,N)}else{var V=!1;switch(T.type){case"double":case"float":S("m%s=Number(d%s)",N,N);break;case"uint32":case"fixed32":S("m%s=d%s>>>0",N,N);break;case"int32":case"sint32":case"sfixed32":S("m%s=d%s|0",N,N);break;case"uint64":V=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":S("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",N,N,V)('else if(typeof d%s==="string")',N)("m%s=parseInt(d%s,10)",N,N)('else if(typeof d%s==="number")',N)("m%s=d%s",N,N)('else if(typeof d%s==="object")',N)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",N,N,N,V?"true":"");break;case"bytes":S('if(typeof d%s==="string")',N)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",N,N,N)("else if(d%s.length >= 0)",N)("m%s=d%s",N,N);break;case"string":S("m%s=String(d%s)",N,N);break;case"bool":S("m%s=Boolean(d%s)",N,N)}}return S}function L(S,T,R,N){if(T.resolvedType)T.resolvedType instanceof O?S("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",N,R,N,N,R,N,N):S("d%s=types[%i].toObject(m%s,o)",N,R,N);else{var P=!1;switch(T.type){case"double":case"float":S("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",N,N,N,N);break;case"uint64":P=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":S('if(typeof m%s==="number")',N)("d%s=o.longs===String?String(m%s):m%s",N,N,N)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",N,N,N,N,P?"true":"",N);break;case"bytes":S("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",N,N,N,N,N);break;default:S("d%s=m%s",N,N)}}return S}N.fromObject=function(S){var T=S.fieldsArray,R=P.codegen(["d"],S.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!T.length)return R("return new this.ctor");R("var m=new this.ctor");for(var N=0;N<T.length;++N){var L=T[N].resolve(),U=P.safeProp(L.name);L.map?(R("if(d%s){",U)('if(typeof d%s!=="object")',U)("throw TypeError(%j)",L.fullName+": object expected")("m%s={}",U)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",U),M(R,L,N,U+"[ks[i]]")("}")("}")):L.repeated?(R("if(d%s){",U)("if(!Array.isArray(d%s))",U)("throw TypeError(%j)",L.fullName+": array expected")("m%s=[]",U)("for(var i=0;i<d%s.length;++i){",U),M(R,L,N,U+"[i]")("}")("}")):(L.resolvedType instanceof O||R("if(d%s!=null){",U),M(R,L,N,U),L.resolvedType instanceof O||R("}"))}return R("return m")},N.toObject=function(S){var T=S.fieldsArray.slice().sort(P.compareFieldsById);if(!T.length)return P.codegen()("return {}");for(var R=P.codegen(["m","o"],S.name+"$toObject")("if(!o)")("o={}")("var d={}"),N=[],M=[],U=[],V=0;V<T.length;++V)T[V].partOf||(T[V].resolve().repeated?N:T[V].map?M:U).push(T[V]);if(N.length){for(R("if(o.arrays||o.defaults){"),V=0;V<N.length;++V)R("d%s=[]",P.safeProp(N[V].name));R("}")}if(M.length){for(R("if(o.objects||o.defaults){"),V=0;V<M.length;++V)R("d%s={}",P.safeProp(M[V].name));R("}")}if(U.length){for(R("if(o.defaults){"),V=0;V<U.length;++V){var $=U[V],K=P.safeProp($.name);if($.resolvedType instanceof O)R("d%s=o.enums===String?%j:%j",K,$.resolvedType.valuesById[$.typeDefault],$.typeDefault);else if($.long)R("if(util.Long){")("var n=new util.Long(%i,%i,%j)",$.typeDefault.low,$.typeDefault.high,$.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",K)("}else")("d%s=o.longs===String?%j:%i",K,$.typeDefault.toString(),$.typeDefault.toNumber());else if($.bytes){var W="["+Array.prototype.slice.call($.typeDefault).join(",")+"]";R("if(o.bytes===String)d%s=%j",K,String.fromCharCode.apply(String,$.typeDefault))("else{")("d%s=%s",K,W)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",K,K)("}")}else R("d%s=%j",K,$.typeDefault)}R("}")}var Q=!1;for(V=0;V<T.length;++V){var $=T[V],Y=S._fieldsArray.indexOf($),K=P.safeProp($.name);$.map?(Q||(Q=!0,R("var ks2")),R("if(m%s&&(ks2=Object.keys(m%s)).length){",K,K)("d%s={}",K)("for(var j=0;j<ks2.length;++j){"),L(R,$,Y,K+"[ks2[j]]")("}")):$.repeated?(R("if(m%s&&m%s.length){",K,K)("d%s=[]",K)("for(var j=0;j<m%s.length;++j){",K),L(R,$,Y,K+"[j]")("}")):(R("if(m%s!=null&&m.hasOwnProperty(%j)){",K,$.name),L(R,$,Y,K),$.partOf&&R("if(o.oneofs)")("d%s=%j",P.safeProp($.partOf.name),$.name)),R("}")}return R("return d")}},8983:(S,T,R)=>{"use strict";S.exports=L;var N=R(5519),O=R(1627),P=R(8289);function M(S){return"missing required '"+S.name+"'"}function L(S){var T=P.codegen(["r","l"],S.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(S.fieldsArray.filter(function(S){return S.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");S.group&&T("if((t&7)===4)")("break"),T("switch(t>>>3){");for(var R=0;R<S.fieldsArray.length;++R){var L=S._fieldsArray[R].resolve(),U=L.resolvedType instanceof N?"int32":L.type,V="m"+P.safeProp(L.name);T("case %i: {",L.id),L.map?(T("if(%s===util.emptyObject)",V)("%s={}",V)("var c2 = r.uint32()+r.pos"),void 0!==O.defaults[L.keyType]?T("k=%j",O.defaults[L.keyType]):T("k=null"),void 0!==O.defaults[U]?T("value=%j",O.defaults[U]):T("value=null"),T("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",L.keyType)("case 2:"),void 0===O.basic[U]?T("value=types[%i].decode(r,r.uint32())",R):T("value=r.%s()",U),T("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),T(void 0!==O.long[L.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",V)):L.repeated?(T("if(!(%s&&%s.length))",V,V)("%s=[]",V),void 0!==O.packed[U]&&T("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",V,U)("}else"),void 0===O.basic[U]?T(L.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",V,R):T("%s.push(r.%s())",V,U)):void 0===O.basic[U]?T(L.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",V,R):T("%s=r.%s()",V,U),T("break")("}")}for(T("default:")("r.skipType(t&7)")("break")("}")("}"),R=0;R<S._fieldsArray.length;++R){var $=S._fieldsArray[R];$.required&&T("if(!m.hasOwnProperty(%j))",$.name)("throw util.ProtocolError(%j,{instance:m})",M($))}return T("return m")}},7337:(S,T,R)=>{"use strict";S.exports=L;var N=R(5519),O=R(1627),P=R(8289);function M(S,T,R,N){return T.resolvedType.group?S("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",R,N,(T.id<<3|3)>>>0,(T.id<<3|4)>>>0):S("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",R,N,(T.id<<3|2)>>>0)}function L(S){for(var T,R,L=P.codegen(["m","w"],S.name+"$encode")("if(!w)")("w=Writer.create()"),U=S.fieldsArray.slice().sort(P.compareFieldsById),T=0;T<U.length;++T){var V=U[T].resolve(),$=S._fieldsArray.indexOf(V),K=V.resolvedType instanceof N?"int32":V.type,W=O.basic[K];R="m"+P.safeProp(V.name),V.map?(L("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",R,V.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",R)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(V.id<<3|2)>>>0,8|O.mapKey[V.keyType],V.keyType),void 0===W?L("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",$,R):L(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|W,K,R),L("}")("}")):V.repeated?(L("if(%s!=null&&%s.length){",R,R),V.packed&&void 0!==O.packed[K]?L("w.uint32(%i).fork()",(V.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",R)("w.%s(%s[i])",K,R)("w.ldelim()"):(L("for(var i=0;i<%s.length;++i)",R),void 0===W?M(L,V,$,R+"[i]"):L("w.uint32(%i).%s(%s[i])",(V.id<<3|W)>>>0,K,R)),L("}")):(V.optional&&L("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",R,V.name),void 0===W?M(L,V,$,R):L("w.uint32(%i).%s(%s)",(V.id<<3|W)>>>0,K,R))}return L("return w")}},5519:(S,T,R)=>{"use strict";S.exports=M;var N=R(8831);((M.prototype=Object.create(N.prototype)).constructor=M).className="Enum";var O=R(4622),P=R(8289);function M(S,T,R,O,P,M){if(N.call(this,S,R),T&&"object"!=typeof T)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=O,this.comments=P||{},this.valuesOptions=M,this.reserved=void 0,T)for(var L=Object.keys(T),U=0;U<L.length;++U)"number"==typeof T[L[U]]&&(this.valuesById[this.values[L[U]]=T[L[U]]]=L[U])}M.fromJSON=function(S,T){var R=new M(S,T.values,T.options,T.comment,T.comments);return R.reserved=T.reserved,R},M.prototype.toJSON=function(S){var T=!!S&&!!S.keepComments;return P.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",T?this.comment:void 0,"comments",T?this.comments:void 0])},M.prototype.add=function(S,T,R,N){if(!P.isString(S))throw TypeError("name must be a string");if(!P.isInteger(T))throw TypeError("id must be an integer");if(void 0!==this.values[S])throw Error("duplicate name '"+S+"' in "+this);if(this.isReservedId(T))throw Error("id "+T+" is reserved in "+this);if(this.isReservedName(S))throw Error("name '"+S+"' is reserved in "+this);if(void 0!==this.valuesById[T]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+T+" in "+this);this.values[S]=T}else this.valuesById[this.values[S]=T]=S;return N&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[S]=N||null),this.comments[S]=R||null,this},M.prototype.remove=function(S){if(!P.isString(S))throw TypeError("name must be a string");var T=this.values[S];if(null==T)throw Error("name '"+S+"' does not exist in "+this);return delete this.valuesById[T],delete this.values[S],delete this.comments[S],this.valuesOptions&&delete this.valuesOptions[S],this},M.prototype.isReservedId=function(S){return O.isReservedId(this.reserved,S)},M.prototype.isReservedName=function(S){return O.isReservedName(this.reserved,S)}},2548:(S,T,R)=>{"use strict";S.exports=V;var N,O=R(8831);((V.prototype=Object.create(O.prototype)).constructor=V).className="Field";var P=R(5519),M=R(1627),L=R(8289),U=/^required|optional|repeated$/;function V(S,T,R,N,P,V,$){if(L.isObject(N)?($=P,V=N,N=P=void 0):L.isObject(P)&&($=V,V=P,P=void 0),O.call(this,S,V),!L.isInteger(T)||T<0)throw TypeError("id must be a non-negative integer");if(!L.isString(R))throw TypeError("type must be a string");if(void 0!==N&&!U.test(N=N.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==P&&!L.isString(P))throw TypeError("extend must be a string");"proto3_optional"===N&&(N="optional"),this.rule=N&&"optional"!==N?N:void 0,this.type=R,this.id=T,this.extend=P||void 0,this.required="required"===N,this.optional=!this.required,this.repeated="repeated"===N,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!L.Long&&void 0!==M.long[R],this.bytes="bytes"===R,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=$}V.fromJSON=function(S,T){return new V(S,T.id,T.type,T.rule,T.extend,T.options,T.comment)},Object.defineProperty(V.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),V.prototype.setOption=function(S,T,R){return"packed"===S&&(this._packed=null),O.prototype.setOption.call(this,S,T,R)},V.prototype.toJSON=function(S){var T=!!S&&!!S.keepComments;return L.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",T?this.comment:void 0])},V.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=M.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof N?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof P&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof P)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=L.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var S;L.base64.test(this.typeDefault)?L.base64.decode(this.typeDefault,S=L.newBuffer(L.base64.length(this.typeDefault)),0):L.utf8.write(this.typeDefault,S=L.newBuffer(L.utf8.length(this.typeDefault)),0),this.typeDefault=S}return this.map?this.defaultValue=L.emptyObject:this.repeated?this.defaultValue=L.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof N&&(this.parent.ctor.prototype[this.name]=this.defaultValue),O.prototype.resolve.call(this)},V.d=function(S,T,R,N){return"function"==typeof T?T=L.decorateType(T).name:T&&"object"==typeof T&&(T=L.decorateEnum(T).name),function(O,P){L.decorateType(O.constructor).add(new V(P,S,T,R,{default:N}))}},V._configure=function(S){N=S}},2822:(S,T,R)=>{"use strict";var N=S.exports=R(5748);function O(S,T,R){return"function"==typeof T?(R=T,T=new N.Root):T||(T=new N.Root),T.load(S,R)}function P(S,T){return T||(T=new N.Root),T.loadSync(S)}N.build="light",N.load=O,N.loadSync=P,N.encoder=R(7337),N.decoder=R(8983),N.verifier=R(1181),N.converter=R(5944),N.ReflectionObject=R(8831),N.Namespace=R(4622),N.Root=R(4955),N.Enum=R(5519),N.Type=R(9396),N.Field=R(2548),N.OneOf=R(5677),N.MapField=R(372),N.Service=R(6962),N.Method=R(1670),N.Message=R(5326),N.wrappers=R(2969),N.types=R(1627),N.util=R(8289),N.ReflectionObject._configure(N.Root),N.Namespace._configure(N.Type,N.Service,N.Enum),N.Root._configure(N.Type),N.Field._configure(N.Type)},5748:(S,T,R)=>{"use strict";var N=T;function O(){N.util._configure(),N.Writer._configure(N.BufferWriter),N.Reader._configure(N.BufferReader)}N.build="minimal",N.Writer=R(7474),N.BufferWriter=R(6985),N.Reader=R(8645),N.BufferReader=R(2126),N.util=R(6416),N.rpc=R(4415),N.roots=R(3675),N.configure=O,O()},7954:(S,T,R)=>{"use strict";var N=S.exports=R(2822);N.build="full",N.tokenize=R(2494),N.parse=R(580),N.common=R(2516),N.Root._configure(N.Type,N.parse,N.common)},372:(S,T,R)=>{"use strict";S.exports=M;var N=R(2548);((M.prototype=Object.create(N.prototype)).constructor=M).className="MapField";var O=R(1627),P=R(8289);function M(S,T,R,O,M,L){if(N.call(this,S,T,O,void 0,void 0,M,L),!P.isString(R))throw TypeError("keyType must be a string");this.keyType=R,this.resolvedKeyType=null,this.map=!0}M.fromJSON=function(S,T){return new M(S,T.id,T.keyType,T.type,T.options,T.comment)},M.prototype.toJSON=function(S){var T=!!S&&!!S.keepComments;return P.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",T?this.comment:void 0])},M.prototype.resolve=function(){if(this.resolved)return this;if(void 0===O.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return N.prototype.resolve.call(this)},M.d=function(S,T,R){return"function"==typeof R?R=P.decorateType(R).name:R&&"object"==typeof R&&(R=P.decorateEnum(R).name),function(N,O){P.decorateType(N.constructor).add(new M(O,S,T,R))}}},5326:(S,T,R)=>{"use strict";S.exports=O;var N=R(6416);function O(S){if(S)for(var T=Object.keys(S),R=0;R<T.length;++R)this[T[R]]=S[T[R]]}O.create=function(S){return this.$type.create(S)},O.encode=function(S,T){return this.$type.encode(S,T)},O.encodeDelimited=function(S,T){return this.$type.encodeDelimited(S,T)},O.decode=function(S){return this.$type.decode(S)},O.decodeDelimited=function(S){return this.$type.decodeDelimited(S)},O.verify=function(S){return this.$type.verify(S)},O.fromObject=function(S){return this.$type.fromObject(S)},O.toObject=function(S,T){return this.$type.toObject(S,T)},O.prototype.toJSON=function(){return this.$type.toObject(this,N.toJSONOptions)}},1670:(S,T,R)=>{"use strict";S.exports=P;var N=R(8831);((P.prototype=Object.create(N.prototype)).constructor=P).className="Method";var O=R(8289);function P(S,T,R,P,M,L,U,V,$){if(O.isObject(M)?(U=M,M=L=void 0):O.isObject(L)&&(U=L,L=void 0),!(void 0===T||O.isString(T)))throw TypeError("type must be a string");if(!O.isString(R))throw TypeError("requestType must be a string");if(!O.isString(P))throw TypeError("responseType must be a string");N.call(this,S,U),this.type=T||"rpc",this.requestType=R,this.requestStream=!!M||void 0,this.responseType=P,this.responseStream=!!L||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=V,this.parsedOptions=$}P.fromJSON=function(S,T){return new P(S,T.type,T.requestType,T.responseType,T.requestStream,T.responseStream,T.options,T.comment,T.parsedOptions)},P.prototype.toJSON=function(S){var T=!!S&&!!S.keepComments;return O.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",T?this.comment:void 0,"parsedOptions",this.parsedOptions])},P.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),N.prototype.resolve.call(this))}},4622:(S,T,R)=>{"use strict";S.exports=K;var N,O,P,M=R(8831);((K.prototype=Object.create(M.prototype)).constructor=K).className="Namespace";var L=R(2548),U=R(8289),V=R(5677);function $(S,T){if(S&&S.length){for(var R={},N=0;N<S.length;++N)R[S[N].name]=S[N].toJSON(T);return R}}function K(S,T){M.call(this,S,T),this.nested=void 0,this._nestedArray=null}function W(S){return S._nestedArray=null,S}K.fromJSON=function(S,T){return new K(S,T.options).addJSON(T.nested)},K.arrayToJSON=$,K.isReservedId=function(S,T){if(S){for(var R=0;R<S.length;++R)if("string"!=typeof S[R]&&S[R][0]<=T&&S[R][1]>T)return!0}return!1},K.isReservedName=function(S,T){if(S){for(var R=0;R<S.length;++R)if(S[R]===T)return!0}return!1},Object.defineProperty(K.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=U.toArray(this.nested))}}),K.prototype.toJSON=function(S){return U.toObject(["options",this.options,"nested",$(this.nestedArray,S)])},K.prototype.addJSON=function(S){var T=this;if(S)for(var R,M=Object.keys(S),U=0;U<M.length;++U)R=S[M[U]],T.add((void 0!==R.fields?N.fromJSON:void 0!==R.values?P.fromJSON:void 0!==R.methods?O.fromJSON:void 0!==R.id?L.fromJSON:K.fromJSON)(M[U],R));return this},K.prototype.get=function(S){return this.nested&&this.nested[S]||null},K.prototype.getEnum=function(S){if(this.nested&&this.nested[S]instanceof P)return this.nested[S].values;throw Error("no such enum: "+S)},K.prototype.add=function(S){if(!(S instanceof L&&void 0!==S.extend||S instanceof N||S instanceof V||S instanceof P||S instanceof O||S instanceof K))throw TypeError("object must be a valid nested object");if(this.nested){var T=this.get(S.name);if(T){if(T instanceof K&&S instanceof K&&!(T instanceof N||T instanceof O)){for(var R=T.nestedArray,M=0;M<R.length;++M)S.add(R[M]);this.remove(T),this.nested||(this.nested={}),S.setOptions(T.options,!0)}else throw Error("duplicate name '"+S.name+"' in "+this)}}else this.nested={};return this.nested[S.name]=S,S.onAdd(this),W(this)},K.prototype.remove=function(S){if(!(S instanceof M))throw TypeError("object must be a ReflectionObject");if(S.parent!==this)throw Error(S+" is not a member of "+this);return delete this.nested[S.name],Object.keys(this.nested).length||(this.nested=void 0),S.onRemove(this),W(this)},K.prototype.define=function(S,T){if(U.isString(S))S=S.split(".");else if(!Array.isArray(S))throw TypeError("illegal path");if(S&&S.length&&""===S[0])throw Error("path must be relative");for(var R=this;S.length>0;){var N=S.shift();if(R.nested&&R.nested[N]){if(!((R=R.nested[N])instanceof K))throw Error("path conflicts with non-namespace objects")}else R.add(R=new K(N))}return T&&R.addJSON(T),R},K.prototype.resolveAll=function(){for(var S=this.nestedArray,T=0;T<S.length;)S[T]instanceof K?S[T++].resolveAll():S[T++].resolve();return this.resolve()},K.prototype.lookup=function(S,T,R){if("boolean"==typeof T?(R=T,T=void 0):T&&!Array.isArray(T)&&(T=[T]),U.isString(S)&&S.length){if("."===S)return this.root;S=S.split(".")}else if(!S.length)return this;if(""===S[0])return this.root.lookup(S.slice(1),T);var N=this.get(S[0]);if(N){if(1===S.length){if(!T||T.indexOf(N.constructor)>-1)return N}else if(N instanceof K&&(N=N.lookup(S.slice(1),T,!0)))return N}else for(var O=0;O<this.nestedArray.length;++O)if(this._nestedArray[O]instanceof K&&(N=this._nestedArray[O].lookup(S,T,!0)))return N;return null===this.parent||R?null:this.parent.lookup(S,T)},K.prototype.lookupType=function(S){var T=this.lookup(S,[N]);if(!T)throw Error("no such type: "+S);return T},K.prototype.lookupEnum=function(S){var T=this.lookup(S,[P]);if(!T)throw Error("no such Enum '"+S+"' in "+this);return T},K.prototype.lookupTypeOrEnum=function(S){var T=this.lookup(S,[N,P]);if(!T)throw Error("no such Type or Enum '"+S+"' in "+this);return T},K.prototype.lookupService=function(S){var T=this.lookup(S,[O]);if(!T)throw Error("no such Service '"+S+"' in "+this);return T},K._configure=function(S,T,R){N=S,O=T,P=R}},8831:(S,T,R)=>{"use strict";S.exports=P,P.className="ReflectionObject";var N,O=R(8289);function P(S,T){if(!O.isString(S))throw TypeError("name must be a string");if(T&&!O.isObject(T))throw TypeError("options must be an object");this.options=T,this.parsedOptions=null,this.name=S,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(P.prototype,{root:{get:function(){for(var S=this;null!==S.parent;)S=S.parent;return S}},fullName:{get:function(){for(var S=[this.name],T=this.parent;T;)S.unshift(T.name),T=T.parent;return S.join(".")}}}),P.prototype.toJSON=function(){throw Error()},P.prototype.onAdd=function(S){this.parent&&this.parent!==S&&this.parent.remove(this),this.parent=S,this.resolved=!1;var T=S.root;T instanceof N&&T._handleAdd(this)},P.prototype.onRemove=function(S){var T=S.root;T instanceof N&&T._handleRemove(this),this.parent=null,this.resolved=!1},P.prototype.resolve=function(){return this.resolved||this.root instanceof N&&(this.resolved=!0),this},P.prototype.getOption=function(S){if(this.options)return this.options[S]},P.prototype.setOption=function(S,T,R){return R&&this.options&&void 0!==this.options[S]||((this.options||(this.options={}))[S]=T),this},P.prototype.setParsedOption=function(S,T,R){this.parsedOptions||(this.parsedOptions=[]);var N=this.parsedOptions;if(R){var P=N.find(function(T){return Object.prototype.hasOwnProperty.call(T,S)});if(P){var M=P[S];O.setProperty(M,R,T)}else(P={})[S]=O.setProperty({},R,T),N.push(P)}else{var L={};L[S]=T,N.push(L)}return this},P.prototype.setOptions=function(S,T){if(S)for(var R=Object.keys(S),N=0;N<R.length;++N)this.setOption(R[N],S[R[N]],T);return this},P.prototype.toString=function(){var S=this.constructor.className,T=this.fullName;return T.length?S+" "+T:S},P._configure=function(S){N=S}},5677:(S,T,R)=>{"use strict";S.exports=M;var N=R(8831);((M.prototype=Object.create(N.prototype)).constructor=M).className="OneOf";var O=R(2548),P=R(8289);function M(S,T,R,O){if(Array.isArray(T)||(R=T,T=void 0),N.call(this,S,R),!(void 0===T||Array.isArray(T)))throw TypeError("fieldNames must be an Array");this.oneof=T||[],this.fieldsArray=[],this.comment=O}function L(S){if(S.parent)for(var T=0;T<S.fieldsArray.length;++T)S.fieldsArray[T].parent||S.parent.add(S.fieldsArray[T])}M.fromJSON=function(S,T){return new M(S,T.oneof,T.options,T.comment)},M.prototype.toJSON=function(S){var T=!!S&&!!S.keepComments;return P.toObject(["options",this.options,"oneof",this.oneof,"comment",T?this.comment:void 0])},M.prototype.add=function(S){if(!(S instanceof O))throw TypeError("field must be a Field");return S.parent&&S.parent!==this.parent&&S.parent.remove(S),this.oneof.push(S.name),this.fieldsArray.push(S),S.partOf=this,L(this),this},M.prototype.remove=function(S){if(!(S instanceof O))throw TypeError("field must be a Field");var T=this.fieldsArray.indexOf(S);if(T<0)throw Error(S+" is not a member of "+this);return this.fieldsArray.splice(T,1),(T=this.oneof.indexOf(S.name))>-1&&this.oneof.splice(T,1),S.partOf=null,this},M.prototype.onAdd=function(S){N.prototype.onAdd.call(this,S);for(var T=this,R=0;R<this.oneof.length;++R){var O=S.get(this.oneof[R]);O&&!O.partOf&&(O.partOf=T,T.fieldsArray.push(O))}L(this)},M.prototype.onRemove=function(S){for(var T,R=0;R<this.fieldsArray.length;++R)(T=this.fieldsArray[R]).parent&&T.parent.remove(T);N.prototype.onRemove.call(this,S)},M.d=function(){for(var S=Array(arguments.length),T=0;T<arguments.length;)S[T]=arguments[T++];return function(T,R){P.decorateType(T.constructor).add(new M(R,S)),Object.defineProperty(T,R,{get:P.oneOfGetter(S),set:P.oneOfSetter(S)})}}},580:(S,T,R)=>{"use strict";S.exports=eo,eo.filename=null,eo.defaults={keepCase:!1};var N=R(2494),O=R(4955),P=R(9396),M=R(2548),L=R(372),U=R(5677),V=R(5519),$=R(6962),K=R(1670),W=R(1627),Q=R(8289),Y=/^[1-9][0-9]*$/,X=/^-?[1-9][0-9]*$/,Z=/^0[x][0-9a-fA-F]+$/,ee=/^-?0[x][0-9a-fA-F]+$/,et=/^0[0-7]+$/,er=/^-?0[0-7]+$/,en=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,ei=/^[a-zA-Z_][a-zA-Z_0-9]*$/,es=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,ea=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function eo(S,T,R){T instanceof O||(R=T,T=new O),R||(R=eo.defaults);var eu,ec,eh,ed,ep,ef=R.preferTrailingComment||!1,eg=N(S,R.alternateCommentMode||!1),em=eg.next,ey=eg.push,ev=eg.peek,eb=eg.skip,eS=eg.cmnt,eT=!0,ew=!1,eC=T,eE=R.keepCase?function(S){return S}:Q.camelCase;function eI(S,T,R){var N=eo.filename;return R||(eo.filename=null),Error("illegal "+(T||"token")+" '"+S+"' ("+(N?N+", ":"")+"line "+eg.line+")")}function e_(){var S,T=[];do{if('"'!==(S=em())&&"'"!==S)throw eI(S);T.push(em()),eb(S),S=ev()}while('"'===S||"'"===S);return T.join("")}function ek(S){var T=em();switch(T){case"'":case'"':return ey(T),e_();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return eA(T,!0)}catch(R){if(S&&es.test(T))return T;throw eI(T,"value")}}function eR(S,T){do T&&('"'===(R=ev())||"'"===R)?S.push(e_()):S.push([N=eD(em()),eb("to",!0)?eD(em()):N]);while(eb(",",!0));var R,N,O={options:void 0};O.setOption=function(S,T){void 0===this.options&&(this.options={}),this.options[S]=T},eM(O,function(S){if("option"===S)eq(O,S),eb(";");else throw eI(S)},function(){eH(O)})}function eA(S,T){var R=1;switch("-"===S.charAt(0)&&(R=-1,S=S.substring(1)),S){case"inf":case"INF":case"Inf":return 1/0*R;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(Y.test(S))return R*parseInt(S,10);if(Z.test(S))return R*parseInt(S,16);if(et.test(S))return R*parseInt(S,8);if(en.test(S))return R*parseFloat(S);throw eI(S,"number",T)}function eD(S,T){switch(S){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!T&&"-"===S.charAt(0))throw eI(S,"id");if(X.test(S))return parseInt(S,10);if(ee.test(S))return parseInt(S,16);if(er.test(S))return parseInt(S,8);throw eI(S,"id")}function eN(){if(void 0!==ec)throw eI("package");if(ec=em(),!es.test(ec))throw eI(ec,"name");eC=eC.define(ec),eb(";")}function eO(){var S,T=ev();switch(T){case"weak":S=ed||(ed=[]),em();break;case"public":em();default:S=eh||(eh=[])}T=e_(),eb(";"),S.push(T)}function ex(){if(eb("="),!(ew="proto3"===(ep=e_()))&&"proto2"!==ep)throw eI(ep,"syntax");T.setOption("syntax",ep),eb(";")}function eP(S,T){switch(T){case"option":return eq(S,T),eb(";"),!0;case"message":return eL(S,T),!0;case"enum":return eV(S,T),!0;case"service":return eW(S,T),!0;case"extend":return eY(S,T),!0}return!1}function eM(S,T,R){var N,O=eg.line;if(S&&("string"!=typeof S.comment&&(S.comment=eS()),S.filename=eo.filename),eb("{",!0)){for(;"}"!==(N=em());)T(N);eb(";",!0)}else R&&R(),eb(";"),S&&("string"!=typeof S.comment||ef)&&(S.comment=eS(O)||S.comment)}function eL(S,T){if(!ei.test(T=em()))throw eI(T,"type name");var R=new P(T);eM(R,function(S){if(!eP(R,S))switch(S){case"map":eU(R,S);break;case"required":case"repeated":eB(R,S);break;case"optional":ew?eB(R,"proto3_optional"):eB(R,"optional");break;case"oneof":ej(R,S);break;case"extensions":eR(R.extensions||(R.extensions=[]));break;case"reserved":eR(R.reserved||(R.reserved=[]),!0);break;default:if(!ew||!es.test(S))throw eI(S);ey(S),eB(R,"optional")}}),S.add(R)}function eB(S,T,R){var N=em();if("group"===N){eF(S,T);return}for(;N.endsWith(".")||ev().startsWith(".");)N+=em();if(!es.test(N))throw eI(N,"type");var O=em();if(!ei.test(O))throw eI(O,"name");O=eE(O),eb("=");var P=new M(O,eD(em()),N,T,R);if(eM(P,function(S){if("option"===S)eq(P,S),eb(";");else throw eI(S)},function(){eH(P)}),"proto3_optional"===T){var L=new U("_"+O);P.setOption("proto3_optional",!0),L.add(P),S.add(L)}else S.add(P);!ew&&P.repeated&&(void 0!==W.packed[N]||void 0===W.basic[N])&&P.setOption("packed",!1,!0)}function eF(S,T){var R=em();if(!ei.test(R))throw eI(R,"name");var N=Q.lcFirst(R);R===N&&(R=Q.ucFirst(R)),eb("=");var O=eD(em()),L=new P(R);L.group=!0;var U=new M(N,O,R,T);U.filename=eo.filename,eM(L,function(S){switch(S){case"option":eq(L,S),eb(";");break;case"required":case"repeated":eB(L,S);break;case"optional":ew?eB(L,"proto3_optional"):eB(L,"optional");break;case"message":eL(L,S);break;case"enum":eV(L,S);break;default:throw eI(S)}}),S.add(L).add(U)}function eU(S){eb("<");var T=em();if(void 0===W.mapKey[T])throw eI(T,"type");eb(",");var R=em();if(!es.test(R))throw eI(R,"type");eb(">");var N=em();if(!ei.test(N))throw eI(N,"name");eb("=");var O=new L(eE(N),eD(em()),T,R);eM(O,function(S){if("option"===S)eq(O,S),eb(";");else throw eI(S)},function(){eH(O)}),S.add(O)}function ej(S,T){if(!ei.test(T=em()))throw eI(T,"name");var R=new U(eE(T));eM(R,function(S){"option"===S?(eq(R,S),eb(";")):(ey(S),eB(R,"optional"))}),S.add(R)}function eV(S,T){if(!ei.test(T=em()))throw eI(T,"name");var R=new V(T);eM(R,function(S){switch(S){case"option":eq(R,S),eb(";");break;case"reserved":eR(R.reserved||(R.reserved=[]),!0);break;default:ez(R,S)}}),S.add(R)}function ez(S,T){if(!ei.test(T))throw eI(T,"name");eb("=");var R=eD(em(),!0),N={options:void 0};N.setOption=function(S,T){void 0===this.options&&(this.options={}),this.options[S]=T},eM(N,function(S){if("option"===S)eq(N,S),eb(";");else throw eI(S)},function(){eH(N)}),S.add(T,R,N.comment,N.options)}function eq(S,T){var R,N=eb("(",!0);if(!es.test(T=em()))throw eI(T,"name");var O=T,P=O;N&&(eb(")"),P=O="("+O+")",T=ev(),ea.test(T)&&(R=T.slice(1),O+=T,em())),eb("=");var M=e$(S,O);eK(S,P,M,R)}function e$(S,T){if(eb("{",!0)){for(var R={};!eb("}",!0);){if(!ei.test(eu=em()))throw eI(eu,"name");if(null===eu)throw eI(eu,"end of input");var N,O,P=eu;if(eb(":",!0),"{"===ev())N=e$(S,T+"."+eu);else if("["===ev()){if(N=[],eb("[",!0)){do O=ek(!0),N.push(O);while(eb(",",!0));eb("]"),void 0!==O&&eG(S,T+"."+eu,O)}}else N=ek(!0),eG(S,T+"."+eu,N);var M=R[P];M&&(N=[].concat(M).concat(N)),R[P]=N,eb(",",!0),eb(";",!0)}return R}var L=ek(!0);return eG(S,T,L),L}function eG(S,T,R){S.setOption&&S.setOption(T,R)}function eK(S,T,R,N){S.setParsedOption&&S.setParsedOption(T,R,N)}function eH(S){if(eb("[",!0)){do eq(S,"option");while(eb(",",!0));eb("]")}return S}function eW(S,T){if(!ei.test(T=em()))throw eI(T,"service name");var R=new $(T);eM(R,function(S){if(!eP(R,S)){if("rpc"===S)eQ(R,S);else throw eI(S)}}),S.add(R)}function eQ(S,T){var R=eS(),N=T;if(!ei.test(T=em()))throw eI(T,"name");var O,P,M,L,U=T;if(eb("("),eb("stream",!0)&&(P=!0),!es.test(T=em())||(O=T,eb(")"),eb("returns"),eb("("),eb("stream",!0)&&(L=!0),!es.test(T=em())))throw eI(T);M=T,eb(")");var V=new K(U,N,O,M,P,L);V.comment=R,eM(V,function(S){if("option"===S)eq(V,S),eb(";");else throw eI(S)}),S.add(V)}function eY(S,T){if(!es.test(T=em()))throw eI(T,"reference");var R=T;eM(null,function(T){switch(T){case"required":case"repeated":eB(S,T,R);break;case"optional":ew?eB(S,"proto3_optional",R):eB(S,"optional",R);break;default:if(!ew||!es.test(T))throw eI(T);ey(T),eB(S,"optional",R)}})}for(;null!==(eu=em());)switch(eu){case"package":if(!eT)throw eI(eu);eN();break;case"import":if(!eT)throw eI(eu);eO();break;case"syntax":if(!eT)throw eI(eu);ex();break;case"option":eq(eC,eu),eb(";");break;default:if(eP(eC,eu)){eT=!1;continue}throw eI(eu)}return eo.filename=null,{package:ec,imports:eh,weakImports:ed,syntax:ep,root:T}}},8645:(S,T,R)=>{"use strict";S.exports=U;var N,O=R(6416),P=O.LongBits,M=O.utf8;function L(S,T){return RangeError("index out of range: "+S.pos+" + "+(T||1)+" > "+S.len)}function U(S){this.buf=S,this.pos=0,this.len=S.length}var V="undefined"!=typeof Uint8Array?function(S){if(S instanceof Uint8Array||Array.isArray(S))return new U(S);throw Error("illegal buffer")}:function(S){if(Array.isArray(S))return new U(S);throw Error("illegal buffer")},$=function(){return O.Buffer?function(S){return(U.create=function(S){return O.Buffer.isBuffer(S)?new N(S):V(S)})(S)}:V};function K(){var S=new P(0,0),T=0;if(this.len-this.pos>4){for(;T<4;++T)if(S.lo=(S.lo|(127&this.buf[this.pos])<<7*T)>>>0,this.buf[this.pos++]<128)return S;if(S.lo=(S.lo|(127&this.buf[this.pos])<<28)>>>0,S.hi=(S.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return S;T=0}else{for(;T<3;++T){if(this.pos>=this.len)throw L(this);if(S.lo=(S.lo|(127&this.buf[this.pos])<<7*T)>>>0,this.buf[this.pos++]<128)return S}return S.lo=(S.lo|(127&this.buf[this.pos++])<<7*T)>>>0,S}if(this.len-this.pos>4){for(;T<5;++T)if(S.hi=(S.hi|(127&this.buf[this.pos])<<7*T+3)>>>0,this.buf[this.pos++]<128)return S}else for(;T<5;++T){if(this.pos>=this.len)throw L(this);if(S.hi=(S.hi|(127&this.buf[this.pos])<<7*T+3)>>>0,this.buf[this.pos++]<128)return S}throw Error("invalid varint encoding")}function W(S,T){return(S[T-4]|S[T-3]<<8|S[T-2]<<16|S[T-1]<<24)>>>0}function Q(){if(this.pos+8>this.len)throw L(this,8);return new P(W(this.buf,this.pos+=4),W(this.buf,this.pos+=4))}U.create=$(),U.prototype._slice=O.Array.prototype.subarray||O.Array.prototype.slice,U.prototype.uint32=function(){var S=4294967295;return function(){if(S=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(S=(S|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(S=(S|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(S=(S|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(S=(S|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return S;if((this.pos+=5)>this.len)throw this.pos=this.len,L(this,10);return S}}(),U.prototype.int32=function(){return 0|this.uint32()},U.prototype.sint32=function(){var S=this.uint32();return S>>>1^-(1&S)|0},U.prototype.bool=function(){return 0!==this.uint32()},U.prototype.fixed32=function(){if(this.pos+4>this.len)throw L(this,4);return W(this.buf,this.pos+=4)},U.prototype.sfixed32=function(){if(this.pos+4>this.len)throw L(this,4);return 0|W(this.buf,this.pos+=4)},U.prototype.float=function(){if(this.pos+4>this.len)throw L(this,4);var S=O.float.readFloatLE(this.buf,this.pos);return this.pos+=4,S},U.prototype.double=function(){if(this.pos+8>this.len)throw L(this,4);var S=O.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,S},U.prototype.bytes=function(){var S=this.uint32(),T=this.pos,R=this.pos+S;if(R>this.len)throw L(this,S);if(this.pos+=S,Array.isArray(this.buf))return this.buf.slice(T,R);if(T===R){var N=O.Buffer;return N?N.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,T,R)},U.prototype.string=function(){var S=this.bytes();return M.read(S,0,S.length)},U.prototype.skip=function(S){if("number"==typeof S){if(this.pos+S>this.len)throw L(this,S);this.pos+=S}else do if(this.pos>=this.len)throw L(this);while(128&this.buf[this.pos++]);return this},U.prototype.skipType=function(S){switch(S){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(S=7&this.uint32());)this.skipType(S);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+S+" at offset "+this.pos)}return this},U._configure=function(S){N=S,U.create=$(),N._configure();var T=O.Long?"toLong":"toNumber";O.merge(U.prototype,{int64:function(){return K.call(this)[T](!1)},uint64:function(){return K.call(this)[T](!0)},sint64:function(){return K.call(this).zzDecode()[T](!1)},fixed64:function(){return Q.call(this)[T](!0)},sfixed64:function(){return Q.call(this)[T](!1)}})}},2126:(S,T,R)=>{"use strict";S.exports=P;var N=R(8645);(P.prototype=Object.create(N.prototype)).constructor=P;var O=R(6416);function P(S){N.call(this,S)}P._configure=function(){O.Buffer&&(P.prototype._slice=O.Buffer.prototype.slice)},P.prototype.string=function(){var S=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+S,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+S,this.len))},P._configure()},4955:(S,T,R)=>{"use strict";S.exports=K;var N,O,P,M=R(4622);((K.prototype=Object.create(M.prototype)).constructor=K).className="Root";var L=R(2548),U=R(5519),V=R(5677),$=R(8289);function K(S){M.call(this,"",S),this.deferred=[],this.files=[]}function W(){}K.fromJSON=function(S,T){return T||(T=new K),S.options&&T.setOptions(S.options),T.addJSON(S.nested)},K.prototype.resolvePath=$.path.resolve,K.prototype.fetch=$.fetch,K.prototype.load=function S(T,R,N){"function"==typeof R&&(N=R,R=void 0);var M=this;if(!N)return $.asPromise(S,M,T,R);var L=N===W;function U(S,T){if(N){if(L)throw S;var R=N;N=null,R(S,T)}}function V(S){var T=S.lastIndexOf("google/protobuf/");if(T>-1){var R=S.substring(T);if(R in P)return R}return null}function K(S,T){try{if($.isString(T)&&"{"===T.charAt(0)&&(T=JSON.parse(T)),$.isString(T)){O.filename=S;var N,P=O(T,M,R),K=0;if(P.imports)for(;K<P.imports.length;++K)(N=V(P.imports[K])||M.resolvePath(S,P.imports[K]))&&Q(N);if(P.weakImports)for(K=0;K<P.weakImports.length;++K)(N=V(P.weakImports[K])||M.resolvePath(S,P.weakImports[K]))&&Q(N,!0)}else M.setOptions(T.options).addJSON(T.nested)}catch(S){U(S)}L||Y||U(null,M)}function Q(S,T){if(S=V(S)||S,!(M.files.indexOf(S)>-1)){if(M.files.push(S),S in P){L?K(S,P[S]):(++Y,setTimeout(function(){--Y,K(S,P[S])}));return}if(L){var R;try{R=$.fs.readFileSync(S).toString("utf8")}catch(S){T||U(S);return}K(S,R)}else++Y,M.fetch(S,function(R,O){if(--Y,N){if(R){T?Y||U(null,M):U(R);return}K(S,O)}})}}var Y=0;$.isString(T)&&(T=[T]);for(var X,Z=0;Z<T.length;++Z)(X=M.resolvePath("",T[Z]))&&Q(X);if(L)return M;Y||U(null,M)},K.prototype.loadSync=function(S,T){if(!$.isNode)throw Error("not supported");return this.load(S,T,W)},K.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(S){return"'extend "+S.extend+"' in "+S.parent.fullName}).join(", "));return M.prototype.resolveAll.call(this)};var Q=/^[A-Z]/;function Y(S,T){var R=T.parent.lookup(T.extend);if(R){var N=new L(T.fullName,T.id,T.type,T.rule,void 0,T.options);return!!R.get(N.name)||(N.declaringField=T,T.extensionField=N,R.add(N),!0)}return!1}K.prototype._handleAdd=function(S){if(S instanceof L)void 0===S.extend||S.extensionField||Y(this,S)||this.deferred.push(S);else if(S instanceof U)Q.test(S.name)&&(S.parent[S.name]=S.values);else if(!(S instanceof V)){if(S instanceof N)for(var T=0;T<this.deferred.length;)Y(this,this.deferred[T])?this.deferred.splice(T,1):++T;for(var R=0;R<S.nestedArray.length;++R)this._handleAdd(S._nestedArray[R]);Q.test(S.name)&&(S.parent[S.name]=S)}},K.prototype._handleRemove=function(S){if(S instanceof L){if(void 0!==S.extend){if(S.extensionField)S.extensionField.parent.remove(S.extensionField),S.extensionField=null;else{var T=this.deferred.indexOf(S);T>-1&&this.deferred.splice(T,1)}}}else if(S instanceof U)Q.test(S.name)&&delete S.parent[S.name];else if(S instanceof M){for(var R=0;R<S.nestedArray.length;++R)this._handleRemove(S._nestedArray[R]);Q.test(S.name)&&delete S.parent[S.name]}},K._configure=function(S,T,R){N=S,O=T,P=R}},3675:S=>{"use strict";S.exports={}},4415:(S,T,R)=>{"use strict";T.Service=R(9861)},9861:(S,T,R)=>{"use strict";S.exports=O;var N=R(6416);function O(S,T,R){if("function"!=typeof S)throw TypeError("rpcImpl must be a function");N.EventEmitter.call(this),this.rpcImpl=S,this.requestDelimited=!!T,this.responseDelimited=!!R}(O.prototype=Object.create(N.EventEmitter.prototype)).constructor=O,O.prototype.rpcCall=function S(T,R,O,P,M){if(!P)throw TypeError("request must be specified");var L=this;if(!M)return N.asPromise(S,L,T,R,O,P);if(!L.rpcImpl){setTimeout(function(){M(Error("already ended"))},0);return}try{return L.rpcImpl(T,R[L.requestDelimited?"encodeDelimited":"encode"](P).finish(),function(S,R){if(S)return L.emit("error",S,T),M(S);if(null===R){L.end(!0);return}if(!(R instanceof O))try{R=O[L.responseDelimited?"decodeDelimited":"decode"](R)}catch(S){return L.emit("error",S,T),M(S)}return L.emit("data",R,T),M(null,R)})}catch(S){L.emit("error",S,T),setTimeout(function(){M(S)},0);return}},O.prototype.end=function(S){return this.rpcImpl&&(S||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},6962:(S,T,R)=>{"use strict";S.exports=L;var N=R(4622);((L.prototype=Object.create(N.prototype)).constructor=L).className="Service";var O=R(1670),P=R(8289),M=R(4415);function L(S,T){N.call(this,S,T),this.methods={},this._methodsArray=null}function U(S){return S._methodsArray=null,S}L.fromJSON=function(S,T){var R=new L(S,T.options);if(T.methods)for(var N=Object.keys(T.methods),P=0;P<N.length;++P)R.add(O.fromJSON(N[P],T.methods[N[P]]));return T.nested&&R.addJSON(T.nested),R.comment=T.comment,R},L.prototype.toJSON=function(S){var T=N.prototype.toJSON.call(this,S),R=!!S&&!!S.keepComments;return P.toObject(["options",T&&T.options||void 0,"methods",N.arrayToJSON(this.methodsArray,S)||{},"nested",T&&T.nested||void 0,"comment",R?this.comment:void 0])},Object.defineProperty(L.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=P.toArray(this.methods))}}),L.prototype.get=function(S){return this.methods[S]||N.prototype.get.call(this,S)},L.prototype.resolveAll=function(){for(var S=this.methodsArray,T=0;T<S.length;++T)S[T].resolve();return N.prototype.resolve.call(this)},L.prototype.add=function(S){if(this.get(S.name))throw Error("duplicate name '"+S.name+"' in "+this);return S instanceof O?(this.methods[S.name]=S,S.parent=this,U(this)):N.prototype.add.call(this,S)},L.prototype.remove=function(S){if(S instanceof O){if(this.methods[S.name]!==S)throw Error(S+" is not a member of "+this);return delete this.methods[S.name],S.parent=null,U(this)}return N.prototype.remove.call(this,S)},L.prototype.create=function(S,T,R){for(var N,O=new M.Service(S,T,R),L=0;L<this.methodsArray.length;++L){var U=P.lcFirst((N=this._methodsArray[L]).resolve().name).replace(/[^$\w_]/g,"");O[U]=P.codegen(["r","c"],P.isReserved(U)?U+"_":U)("return this.rpcCall(m,q,s,r,c)")({m:N,q:N.resolvedRequestType.ctor,s:N.resolvedResponseType.ctor})}return O}},2494:S=>{"use strict";S.exports=K;var T=/[\s{}=;:[\],'"()<>]/g,R=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,N=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,O=/^ *[*/]+ */,P=/^\s*\*?\/*/,M=/\n/g,L=/\s/,U=/\\(.?)/g,V={0:"\x00",r:"\r",n:"\n",t:"	"};function $(S){return S.replace(U,function(S,T){switch(T){case"\\":case"":return T;default:return V[T]||""}})}function K(S,U){S=S.toString();var V=0,K=S.length,W=1,Q=0,Y={},X=[],Z=null;function ee(S){return Error("illegal "+S+" (line "+W+")")}function et(){var T="'"===Z?N:R;T.lastIndex=V-1;var O=T.exec(S);if(!O)throw ee("string");return V=T.lastIndex,eo(Z),Z=null,$(O[1])}function er(T){return S.charAt(T)}function en(T,R,N){var L,V,$={type:S.charAt(T++),lineEmpty:!1,leading:N},K=T-(L=U?2:3);do if(--K<0||"\n"===(V=S.charAt(K))){$.lineEmpty=!0;break}while(" "===V||"	"===V);for(var X=S.substring(T,R).split(M),Z=0;Z<X.length;++Z)X[Z]=X[Z].replace(U?P:O,"").trim();$.text=X.join("\n").trim(),Y[W]=$,Q=W}function ei(T){var R=es(T),N=S.substring(T,R);return/^\s*\/\//.test(N)}function es(S){for(var T=S;T<K&&"\n"!==er(T);)T++;return T}function ea(){if(X.length>0)return X.shift();if(Z)return et();var R,N,O,P,M,$=0===V;do{if(V===K)return null;for(R=!1;L.test(O=er(V));)if("\n"===O&&($=!0,++W),++V===K)return null;if("/"===er(V)){if(++V===K)throw ee("comment");if("/"===er(V)){if(U){if(P=V,M=!1,ei(V-1)){M=!0;do if((V=es(V))===K||(V++,!$))break;while(ei(V))}else V=Math.min(K,es(V)+1);M&&(en(P,V,$),$=!0),W++,R=!0}else{for(M="/"===er(P=V+1);"\n"!==er(++V);)if(V===K)return null;++V,M&&(en(P,V-1,$),$=!0),++W,R=!0}}else{if("*"!==(O=er(V)))return"/";P=V+1,M=U||"*"===er(P);do{if("\n"===O&&++W,++V===K)throw ee("comment");N=O,O=er(V)}while("*"!==N||"/"!==O);++V,M&&(en(P,V-2,$),$=!0),R=!0}}}while(R);var Q=V;if(T.lastIndex=0,!T.test(er(Q++)))for(;Q<K&&!T.test(er(Q));)++Q;var Y=S.substring(V,V=Q);return('"'===Y||"'"===Y)&&(Z=Y),Y}function eo(S){X.push(S)}function eu(){if(!X.length){var S=ea();if(null===S)return null;eo(S)}return X[0]}function ec(S,T){var R=eu();if(R===S)return ea(),!0;if(!T)throw ee("token '"+R+"', '"+S+"' expected");return!1}function eh(S){var T,R=null;return void 0===S?(T=Y[W-1],delete Y[W-1],T&&(U||"*"===T.type||T.lineEmpty)&&(R=T.leading?T.text:null)):(Q<S&&eu(),T=Y[S],delete Y[S],T&&!T.lineEmpty&&(U||"/"===T.type)&&(R=T.leading?null:T.text)),R}return Object.defineProperty({next:ea,peek:eu,push:eo,skip:ec,cmnt:eh},"line",{get:function(){return W}})}K.unescape=$},9396:(S,T,R)=>{"use strict";S.exports=et;var N=R(4622);((et.prototype=Object.create(N.prototype)).constructor=et).className="Type";var O=R(5519),P=R(5677),M=R(2548),L=R(372),U=R(6962),V=R(5326),$=R(8645),K=R(7474),W=R(8289),Q=R(7337),Y=R(8983),X=R(1181),Z=R(5944),ee=R(2969);function et(S,T){N.call(this,S,T),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function er(S){return S._fieldsById=S._fieldsArray=S._oneofsArray=null,delete S.encode,delete S.decode,delete S.verify,S}Object.defineProperties(et.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var S=Object.keys(this.fields),T=0;T<S.length;++T){var R=this.fields[S[T]],N=R.id;if(this._fieldsById[N])throw Error("duplicate id "+N+" in "+this);this._fieldsById[N]=R}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=W.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=W.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=et.generateConstructor(this)())},set:function(S){var T=S.prototype;T instanceof V||((S.prototype=new V).constructor=S,W.merge(S.prototype,T)),S.$type=S.prototype.$type=this,W.merge(S,V,!0),this._ctor=S;for(var R=0;R<this.fieldsArray.length;++R)this._fieldsArray[R].resolve();var N={};for(R=0;R<this.oneofsArray.length;++R)N[this._oneofsArray[R].resolve().name]={get:W.oneOfGetter(this._oneofsArray[R].oneof),set:W.oneOfSetter(this._oneofsArray[R].oneof)};R&&Object.defineProperties(S.prototype,N)}}}),et.generateConstructor=function(S){for(var T,R=W.codegen(["p"],S.name),N=0;N<S.fieldsArray.length;++N)(T=S._fieldsArray[N]).map?R("this%s={}",W.safeProp(T.name)):T.repeated&&R("this%s=[]",W.safeProp(T.name));return R("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},et.fromJSON=function(S,T){var R=new et(S,T.options);R.extensions=T.extensions,R.reserved=T.reserved;for(var V=Object.keys(T.fields),$=0;$<V.length;++$)R.add((void 0!==T.fields[V[$]].keyType?L.fromJSON:M.fromJSON)(V[$],T.fields[V[$]]));if(T.oneofs)for(V=Object.keys(T.oneofs),$=0;$<V.length;++$)R.add(P.fromJSON(V[$],T.oneofs[V[$]]));if(T.nested)for(V=Object.keys(T.nested),$=0;$<V.length;++$){var K=T.nested[V[$]];R.add((void 0!==K.id?M.fromJSON:void 0!==K.fields?et.fromJSON:void 0!==K.values?O.fromJSON:void 0!==K.methods?U.fromJSON:N.fromJSON)(V[$],K))}return T.extensions&&T.extensions.length&&(R.extensions=T.extensions),T.reserved&&T.reserved.length&&(R.reserved=T.reserved),T.group&&(R.group=!0),T.comment&&(R.comment=T.comment),R},et.prototype.toJSON=function(S){var T=N.prototype.toJSON.call(this,S),R=!!S&&!!S.keepComments;return W.toObject(["options",T&&T.options||void 0,"oneofs",N.arrayToJSON(this.oneofsArray,S),"fields",N.arrayToJSON(this.fieldsArray.filter(function(S){return!S.declaringField}),S)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",T&&T.nested||void 0,"comment",R?this.comment:void 0])},et.prototype.resolveAll=function(){for(var S=this.fieldsArray,T=0;T<S.length;)S[T++].resolve();var R=this.oneofsArray;for(T=0;T<R.length;)R[T++].resolve();return N.prototype.resolveAll.call(this)},et.prototype.get=function(S){return this.fields[S]||this.oneofs&&this.oneofs[S]||this.nested&&this.nested[S]||null},et.prototype.add=function(S){if(this.get(S.name))throw Error("duplicate name '"+S.name+"' in "+this);if(S instanceof M&&void 0===S.extend){if(this._fieldsById?this._fieldsById[S.id]:this.fieldsById[S.id])throw Error("duplicate id "+S.id+" in "+this);if(this.isReservedId(S.id))throw Error("id "+S.id+" is reserved in "+this);if(this.isReservedName(S.name))throw Error("name '"+S.name+"' is reserved in "+this);return S.parent&&S.parent.remove(S),this.fields[S.name]=S,S.message=this,S.onAdd(this),er(this)}return S instanceof P?(this.oneofs||(this.oneofs={}),this.oneofs[S.name]=S,S.onAdd(this),er(this)):N.prototype.add.call(this,S)},et.prototype.remove=function(S){if(S instanceof M&&void 0===S.extend){if(!this.fields||this.fields[S.name]!==S)throw Error(S+" is not a member of "+this);return delete this.fields[S.name],S.parent=null,S.onRemove(this),er(this)}if(S instanceof P){if(!this.oneofs||this.oneofs[S.name]!==S)throw Error(S+" is not a member of "+this);return delete this.oneofs[S.name],S.parent=null,S.onRemove(this),er(this)}return N.prototype.remove.call(this,S)},et.prototype.isReservedId=function(S){return N.isReservedId(this.reserved,S)},et.prototype.isReservedName=function(S){return N.isReservedName(this.reserved,S)},et.prototype.create=function(S){return new this.ctor(S)},et.prototype.setup=function(){for(var S=this.fullName,T=[],R=0;R<this.fieldsArray.length;++R)T.push(this._fieldsArray[R].resolve().resolvedType);this.encode=Q(this)({Writer:K,types:T,util:W}),this.decode=Y(this)({Reader:$,types:T,util:W}),this.verify=X(this)({types:T,util:W}),this.fromObject=Z.fromObject(this)({types:T,util:W}),this.toObject=Z.toObject(this)({types:T,util:W});var N=ee[S];if(N){var O=Object.create(this);O.fromObject=this.fromObject,this.fromObject=N.fromObject.bind(O),O.toObject=this.toObject,this.toObject=N.toObject.bind(O)}return this},et.prototype.encode=function(S,T){return this.setup().encode(S,T)},et.prototype.encodeDelimited=function(S,T){return this.encode(S,T&&T.len?T.fork():T).ldelim()},et.prototype.decode=function(S,T){return this.setup().decode(S,T)},et.prototype.decodeDelimited=function(S){return S instanceof $||(S=$.create(S)),this.decode(S,S.uint32())},et.prototype.verify=function(S){return this.setup().verify(S)},et.prototype.fromObject=function(S){return this.setup().fromObject(S)},et.prototype.toObject=function(S,T){return this.setup().toObject(S,T)},et.d=function(S){return function(T){W.decorateType(T,S)}}},1627:(S,T,R)=>{"use strict";var N=T,O=R(8289),P=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function M(S,T){var R=0,N={};for(T|=0;R<S.length;)N[P[R+T]]=S[R++];return N}N.basic=M([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),N.defaults=M([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",O.emptyArray,null]),N.long=M([0,0,0,1,1],7),N.mapKey=M([0,0,0,5,5,0,0,0,1,1,0,2],2),N.packed=M([1,5,0,0,0,5,5,0,0,0,1,1,0])},8289:(S,T,R)=>{"use strict";var N,O,P=S.exports=R(6416),M=R(3675);P.codegen=R(2012),P.fetch=R(3035),P.path=R(9986),P.fs=P.inquire("fs"),P.toArray=function(S){if(S){for(var T=Object.keys(S),R=Array(T.length),N=0;N<T.length;)R[N]=S[T[N++]];return R}return[]},P.toObject=function(S){for(var T={},R=0;R<S.length;){var N=S[R++],O=S[R++];void 0!==O&&(T[N]=O)}return T};var L=/\\/g,U=/"/g;P.isReserved=function(S){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(S)},P.safeProp=function(S){return!/^[$\w_]+$/.test(S)||P.isReserved(S)?'["'+S.replace(L,"\\\\").replace(U,'\\"')+'"]':"."+S},P.ucFirst=function(S){return S.charAt(0).toUpperCase()+S.substring(1)};var V=/_([a-z])/g;P.camelCase=function(S){return S.substring(0,1)+S.substring(1).replace(V,function(S,T){return T.toUpperCase()})},P.compareFieldsById=function(S,T){return S.id-T.id},P.decorateType=function(S,T){if(S.$type)return T&&S.$type.name!==T&&(P.decorateRoot.remove(S.$type),S.$type.name=T,P.decorateRoot.add(S.$type)),S.$type;N||(N=R(9396));var O=new N(T||S.name);return P.decorateRoot.add(O),O.ctor=S,Object.defineProperty(S,"$type",{value:O,enumerable:!1}),Object.defineProperty(S.prototype,"$type",{value:O,enumerable:!1}),O};var $=0;P.decorateEnum=function(S){if(S.$type)return S.$type;O||(O=R(5519));var T=new O("Enum"+$++,S);return P.decorateRoot.add(T),Object.defineProperty(S,"$type",{value:T,enumerable:!1}),T},P.setProperty=function(S,T,R){function N(S,T,R){var O=T.shift();if("__proto__"===O||"prototype"===O)return S;if(T.length>0)S[O]=N(S[O]||{},T,R);else{var P=S[O];P&&(R=[].concat(P).concat(R)),S[O]=R}return S}if("object"!=typeof S)throw TypeError("dst must be an object");if(!T)throw TypeError("path must be specified");return N(S,T=T.split("."),R)},Object.defineProperty(P,"decorateRoot",{get:function(){return M.decorated||(M.decorated=new(R(4955)))}})},9535:(S,T,R)=>{"use strict";S.exports=O;var N=R(6416);function O(S,T){this.lo=S>>>0,this.hi=T>>>0}var P=O.zero=new O(0,0);P.toNumber=function(){return 0},P.zzEncode=P.zzDecode=function(){return this},P.length=function(){return 1};var M=O.zeroHash="\x00\x00\x00\x00\x00\x00\x00\x00";O.fromNumber=function(S){if(0===S)return P;var T=S<0;T&&(S=-S);var R=S>>>0,N=(S-R)/4294967296>>>0;return T&&(N=~N>>>0,R=~R>>>0,++R>4294967295&&(R=0,++N>4294967295&&(N=0))),new O(R,N)},O.from=function(S){if("number"==typeof S)return O.fromNumber(S);if(N.isString(S)){if(!N.Long)return O.fromNumber(parseInt(S,10));S=N.Long.fromString(S)}return S.low||S.high?new O(S.low>>>0,S.high>>>0):P},O.prototype.toNumber=function(S){if(!S&&this.hi>>>31){var T=~this.lo+1>>>0,R=~this.hi>>>0;return T||(R=R+1>>>0),-(T+4294967296*R)}return this.lo+4294967296*this.hi},O.prototype.toLong=function(S){return N.Long?new N.Long(0|this.lo,0|this.hi,!!S):{low:0|this.lo,high:0|this.hi,unsigned:!!S}};var L=String.prototype.charCodeAt;O.fromHash=function(S){return S===M?P:new O((L.call(S,0)|L.call(S,1)<<8|L.call(S,2)<<16|L.call(S,3)<<24)>>>0,(L.call(S,4)|L.call(S,5)<<8|L.call(S,6)<<16|L.call(S,7)<<24)>>>0)},O.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},O.prototype.zzEncode=function(){var S=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^S)>>>0,this.lo=(this.lo<<1^S)>>>0,this},O.prototype.zzDecode=function(){var S=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^S)>>>0,this.hi=(this.hi>>>1^S)>>>0,this},O.prototype.length=function(){var S=this.lo,T=(this.lo>>>28|this.hi<<4)>>>0,R=this.hi>>>24;return 0===R?0===T?S<16384?S<128?1:2:S<2097152?3:4:T<16384?T<128?5:6:T<2097152?7:8:R<128?9:10}},6416:function(S,T,R){"use strict";var N=T;function O(S,T,R){for(var N=Object.keys(T),O=0;O<N.length;++O)void 0!==S[N[O]]&&R||(S[N[O]]=T[N[O]]);return S}function P(S){function T(S,R){if(!(this instanceof T))return new T(S,R);Object.defineProperty(this,"message",{get:function(){return S}}),Error.captureStackTrace?Error.captureStackTrace(this,T):Object.defineProperty(this,"stack",{value:Error().stack||""}),R&&O(this,R)}return T.prototype=Object.create(Error.prototype,{constructor:{value:T,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return S},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),T}N.asPromise=R(799),N.base64=R(2130),N.EventEmitter=R(854),N.float=R(4324),N.inquire=R(449),N.utf8=R(8131),N.pool=R(6035),N.LongBits=R(9535),N.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),N.global=N.isNode&&global||"undefined"!=typeof self&&self||this,N.emptyArray=Object.freeze?Object.freeze([]):[],N.emptyObject=Object.freeze?Object.freeze({}):{},N.isInteger=Number.isInteger||function(S){return"number"==typeof S&&isFinite(S)&&Math.floor(S)===S},N.isString=function(S){return"string"==typeof S||S instanceof String},N.isObject=function(S){return S&&"object"==typeof S},N.isset=N.isSet=function(S,T){var R=S[T];return!!(null!=R&&S.hasOwnProperty(T))&&("object"!=typeof R||(Array.isArray(R)?R.length:Object.keys(R).length)>0)},N.Buffer=function(){try{var S=N.inquire("buffer").Buffer;return S.prototype.utf8Write?S:null}catch(S){return null}}(),N._Buffer_from=null,N._Buffer_allocUnsafe=null,N.newBuffer=function(S){return"number"==typeof S?N.Buffer?N._Buffer_allocUnsafe(S):new N.Array(S):N.Buffer?N._Buffer_from(S):"undefined"==typeof Uint8Array?S:new Uint8Array(S)},N.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,N.Long=N.global.dcodeIO&&N.global.dcodeIO.Long||N.global.Long||N.inquire("long"),N.key2Re=/^true|false|0|1$/,N.key32Re=/^-?(?:0|[1-9][0-9]*)$/,N.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,N.longToHash=function(S){return S?N.LongBits.from(S).toHash():N.LongBits.zeroHash},N.longFromHash=function(S,T){var R=N.LongBits.fromHash(S);return N.Long?N.Long.fromBits(R.lo,R.hi,T):R.toNumber(!!T)},N.merge=O,N.lcFirst=function(S){return S.charAt(0).toLowerCase()+S.substring(1)},N.newError=P,N.ProtocolError=P("ProtocolError"),N.oneOfGetter=function(S){for(var T={},R=0;R<S.length;++R)T[S[R]]=1;return function(){for(var S=Object.keys(this),R=S.length-1;R>-1;--R)if(1===T[S[R]]&&void 0!==this[S[R]]&&null!==this[S[R]])return S[R]}},N.oneOfSetter=function(S){return function(T){for(var R=0;R<S.length;++R)S[R]!==T&&delete this[S[R]]}},N.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},N._configure=function(){var S=N.Buffer;if(!S){N._Buffer_from=N._Buffer_allocUnsafe=null;return}N._Buffer_from=S.from!==Uint8Array.from&&S.from||function(T,R){return new S(T,R)},N._Buffer_allocUnsafe=S.allocUnsafe||function(T){return new S(T)}}},1181:(S,T,R)=>{"use strict";S.exports=U;var N=R(5519),O=R(8289);function P(S,T){return S.name+": "+T+(S.repeated&&"array"!==T?"[]":S.map&&"object"!==T?"{k:"+S.keyType+"}":"")+" expected"}function M(S,T,R,O){if(T.resolvedType){if(T.resolvedType instanceof N){S("switch(%s){",O)("default:")("return%j",P(T,"enum value"));for(var M=Object.keys(T.resolvedType.values),L=0;L<M.length;++L)S("case %i:",T.resolvedType.values[M[L]]);S("break")("}")}else S("{")("var e=types[%i].verify(%s);",R,O)("if(e)")("return%j+e",T.name+".")("}")}else switch(T.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":S("if(!util.isInteger(%s))",O)("return%j",P(T,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":S("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",O,O,O,O)("return%j",P(T,"integer|Long"));break;case"float":case"double":S('if(typeof %s!=="number")',O)("return%j",P(T,"number"));break;case"bool":S('if(typeof %s!=="boolean")',O)("return%j",P(T,"boolean"));break;case"string":S("if(!util.isString(%s))",O)("return%j",P(T,"string"));break;case"bytes":S('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',O,O,O)("return%j",P(T,"buffer"))}return S}function L(S,T,R){switch(T.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":S("if(!util.key32Re.test(%s))",R)("return%j",P(T,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":S("if(!util.key64Re.test(%s))",R)("return%j",P(T,"integer|Long key"));break;case"bool":S("if(!util.key2Re.test(%s))",R)("return%j",P(T,"boolean key"))}return S}function U(S){var T=O.codegen(["m"],S.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),R=S.oneofsArray,N={};R.length&&T("var p={}");for(var U=0;U<S.fieldsArray.length;++U){var V=S._fieldsArray[U].resolve(),$="m"+O.safeProp(V.name);if(V.optional&&T("if(%s!=null&&m.hasOwnProperty(%j)){",$,V.name),V.map)T("if(!util.isObject(%s))",$)("return%j",P(V,"object"))("var k=Object.keys(%s)",$)("for(var i=0;i<k.length;++i){"),L(T,V,"k[i]"),M(T,V,U,$+"[k[i]]")("}");else if(V.repeated)T("if(!Array.isArray(%s))",$)("return%j",P(V,"array"))("for(var i=0;i<%s.length;++i){",$),M(T,V,U,$+"[i]")("}");else{if(V.partOf){var K=O.safeProp(V.partOf.name);1===N[V.partOf.name]&&T("if(p%s===1)",K)("return%j",V.partOf.name+": multiple values"),N[V.partOf.name]=1,T("p%s=1",K)}M(T,V,U,$)}V.optional&&T("}")}return T("return null")}},2969:(S,T,R)=>{"use strict";var N=T,O=R(5326);N[".google.protobuf.Any"]={fromObject:function(S){if(S&&S["@type"]){var T=S["@type"].substring(S["@type"].lastIndexOf("/")+1),R=this.lookup(T);if(R){var N="."===S["@type"].charAt(0)?S["@type"].slice(1):S["@type"];return -1===N.indexOf("/")&&(N="/"+N),this.create({type_url:N,value:R.encode(R.fromObject(S)).finish()})}}return this.fromObject(S)},toObject:function(S,T){var R="type.googleapis.com/",N="",P="";if(T&&T.json&&S.type_url&&S.value){P=S.type_url.substring(S.type_url.lastIndexOf("/")+1),N=S.type_url.substring(0,S.type_url.lastIndexOf("/")+1);var M=this.lookup(P);M&&(S=M.decode(S.value))}if(!(S instanceof this.ctor)&&S instanceof O){var L=S.$type.toObject(S,T),U="."===S.$type.fullName[0]?S.$type.fullName.slice(1):S.$type.fullName;return""===N&&(N=R),P=N+U,L["@type"]=P,L}return this.toObject(S,T)}}},7474:(S,T,R)=>{"use strict";S.exports=K;var N,O=R(6416),P=O.LongBits,M=O.base64,L=O.utf8;function U(S,T,R){this.fn=S,this.len=T,this.next=void 0,this.val=R}function V(){}function $(S){this.head=S.head,this.tail=S.tail,this.len=S.len,this.next=S.states}function K(){this.len=0,this.head=new U(V,0,0),this.tail=this.head,this.states=null}var W=function(){return O.Buffer?function(){return(K.create=function(){return new N})()}:function(){return new K}};function Q(S,T,R){T[R]=255&S}function Y(S,T,R){for(;S>127;)T[R++]=127&S|128,S>>>=7;T[R]=S}function X(S,T){this.len=S,this.next=void 0,this.val=T}function Z(S,T,R){for(;S.hi;)T[R++]=127&S.lo|128,S.lo=(S.lo>>>7|S.hi<<25)>>>0,S.hi>>>=7;for(;S.lo>127;)T[R++]=127&S.lo|128,S.lo=S.lo>>>7;T[R++]=S.lo}function ee(S,T,R){T[R]=255&S,T[R+1]=S>>>8&255,T[R+2]=S>>>16&255,T[R+3]=S>>>24}K.create=W(),K.alloc=function(S){return new O.Array(S)},O.Array!==Array&&(K.alloc=O.pool(K.alloc,O.Array.prototype.subarray)),K.prototype._push=function(S,T,R){return this.tail=this.tail.next=new U(S,T,R),this.len+=T,this},X.prototype=Object.create(U.prototype),X.prototype.fn=Y,K.prototype.uint32=function(S){return this.len+=(this.tail=this.tail.next=new X((S>>>=0)<128?1:S<16384?2:S<2097152?3:S<268435456?4:5,S)).len,this},K.prototype.int32=function(S){return S<0?this._push(Z,10,P.fromNumber(S)):this.uint32(S)},K.prototype.sint32=function(S){return this.uint32((S<<1^S>>31)>>>0)},K.prototype.uint64=function(S){var T=P.from(S);return this._push(Z,T.length(),T)},K.prototype.int64=K.prototype.uint64,K.prototype.sint64=function(S){var T=P.from(S).zzEncode();return this._push(Z,T.length(),T)},K.prototype.bool=function(S){return this._push(Q,1,S?1:0)},K.prototype.fixed32=function(S){return this._push(ee,4,S>>>0)},K.prototype.sfixed32=K.prototype.fixed32,K.prototype.fixed64=function(S){var T=P.from(S);return this._push(ee,4,T.lo)._push(ee,4,T.hi)},K.prototype.sfixed64=K.prototype.fixed64,K.prototype.float=function(S){return this._push(O.float.writeFloatLE,4,S)},K.prototype.double=function(S){return this._push(O.float.writeDoubleLE,8,S)};var et=O.Array.prototype.set?function(S,T,R){T.set(S,R)}:function(S,T,R){for(var N=0;N<S.length;++N)T[R+N]=S[N]};K.prototype.bytes=function(S){var T=S.length>>>0;if(!T)return this._push(Q,1,0);if(O.isString(S)){var R=K.alloc(T=M.length(S));M.decode(S,R,0),S=R}return this.uint32(T)._push(et,T,S)},K.prototype.string=function(S){var T=L.length(S);return T?this.uint32(T)._push(L.write,T,S):this._push(Q,1,0)},K.prototype.fork=function(){return this.states=new $(this),this.head=this.tail=new U(V,0,0),this.len=0,this},K.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new U(V,0,0),this.len=0),this},K.prototype.ldelim=function(){var S=this.head,T=this.tail,R=this.len;return this.reset().uint32(R),R&&(this.tail.next=S.next,this.tail=T,this.len+=R),this},K.prototype.finish=function(){for(var S=this.head.next,T=this.constructor.alloc(this.len),R=0;S;)S.fn(S.val,T,R),R+=S.len,S=S.next;return T},K._configure=function(S){N=S,K.create=W(),N._configure()}},6985:(S,T,R)=>{"use strict";S.exports=P;var N=R(7474);(P.prototype=Object.create(N.prototype)).constructor=P;var O=R(6416);function P(){N.call(this)}function M(S,T,R){S.length<40?O.utf8.write(S,T,R):T.utf8Write?T.utf8Write(S,R):T.write(S,R)}P._configure=function(){P.alloc=O._Buffer_allocUnsafe,P.writeBytesBuffer=O.Buffer&&O.Buffer.prototype instanceof Uint8Array&&"set"===O.Buffer.prototype.set.name?function(S,T,R){T.set(S,R)}:function(S,T,R){if(S.copy)S.copy(T,R,0,S.length);else for(var N=0;N<S.length;)T[R++]=S[N++]}},P.prototype.bytes=function(S){O.isString(S)&&(S=O._Buffer_from(S,"base64"));var T=S.length>>>0;return this.uint32(T),T&&this._push(P.writeBytesBuffer,T,S),this},P.prototype.string=function(S){var T=O.Buffer.byteLength(S);return this.uint32(T),T&&this._push(M,T,S),this},P._configure()},8241:(S,T,R)=>{"use strict";R.r(T),R.d(T,{$$typeof:()=>P,__esModule:()=>O,default:()=>M});let N=(0,R(6843).createProxy)(String.raw`/Users/webtrova/Documents/GitHub/tourneyV5/app/(auth)/login/page.tsx`),{__esModule:O,$$typeof:P}=N,M=N.default},1468:function(S,T){var R;!function(N,O){function P(S){return"default"in S?S.default:S}void 0!==(R=(function(){var S={};return O(S),P(S)}).apply(T,[]))&&(S.exports=R)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(S){"use strict";Object.defineProperty(S,"__esModule",{value:!0}),S.default=void 0;/**
     * @license
     * Copyright 2009 The Closure Library Authors
     * Copyright 2020 Daniel Wirtz / The long.js Authors.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * SPDX-License-Identifier: Apache-2.0
     */var T=null;try{T=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function R(S,T,R){this.low=0|S,this.high=0|T,this.unsigned=!!R}function N(S){return!0===(S&&S.__isLong__)}function O(S){var T=Math.clz32(S&-S);return S?31-T:T}R.prototype.__isLong__,Object.defineProperty(R.prototype,"__isLong__",{value:!0}),R.isLong=N;var P={},M={};function L(S,T){var R,N,O;return T?(S>>>=0,(O=0<=S&&S<256)&&(N=M[S]))?N:(R=V(S,0,!0),O&&(M[S]=R),R):(S|=0,(O=-128<=S&&S<128)&&(N=P[S]))?N:(R=V(S,S<0?-1:0,!1),O&&(P[S]=R),R)}function U(S,T){if(isNaN(S))return T?et:ee;if(T){if(S<0)return et;if(S>=Y)return ea}else{if(S<=-X)return eo;if(S+1>=X)return es}return S<0?U(-S,T).neg():V(S%Q|0,S/Q|0,T)}function V(S,T,N){return new R(S,T,N)}R.fromInt=L,R.fromNumber=U,R.fromBits=V;var $=Math.pow;function K(S,T,R){if(0===S.length)throw Error("empty string");if("number"==typeof T?(R=T,T=!1):T=!!T,"NaN"===S||"Infinity"===S||"+Infinity"===S||"-Infinity"===S)return T?et:ee;if((R=R||10)<2||36<R)throw RangeError("radix");if((N=S.indexOf("-"))>0)throw Error("interior hyphen");if(0===N)return K(S.substring(1),T,R).neg();for(var N,O=U($(R,8)),P=ee,M=0;M<S.length;M+=8){var L=Math.min(8,S.length-M),V=parseInt(S.substring(M,M+L),R);if(L<8){var W=U($(R,L));P=P.mul(W).add(U(V))}else P=(P=P.mul(O)).add(U(V))}return P.unsigned=T,P}function W(S,T){return"number"==typeof S?U(S,T):"string"==typeof S?K(S,T):V(S.low,S.high,"boolean"==typeof T?T:S.unsigned)}R.fromString=K,R.fromValue=W;var Q=4294967296,Y=18446744073709552e3,X=0x7fffffffffffffff,Z=L(16777216),ee=L(0);R.ZERO=ee;var et=L(0,!0);R.UZERO=et;var er=L(1);R.ONE=er;var en=L(1,!0);R.UONE=en;var ei=L(-1);R.NEG_ONE=ei;var es=V(-1,2147483647,!1);R.MAX_VALUE=es;var ea=V(-1,-1,!0);R.MAX_UNSIGNED_VALUE=ea;var eo=V(0,-2147483648,!1);R.MIN_VALUE=eo;var eu=R.prototype;eu.toInt=function(){return this.unsigned?this.low>>>0:this.low},eu.toNumber=function(){return this.unsigned?(this.high>>>0)*Q+(this.low>>>0):this.high*Q+(this.low>>>0)},eu.toString=function(S){if((S=S||10)<2||36<S)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(eo))return"-"+this.neg().toString(S);var T=U(S),R=this.div(T),N=R.mul(T).sub(this);return R.toString(S)+N.toInt().toString(S)}for(var O=U($(S,6),this.unsigned),P=this,M="";;){var L=P.div(O),V=(P.sub(L.mul(O)).toInt()>>>0).toString(S);if((P=L).isZero())return V+M;for(;V.length<6;)V="0"+V;M=""+V+M}},eu.getHighBits=function(){return this.high},eu.getHighBitsUnsigned=function(){return this.high>>>0},eu.getLowBits=function(){return this.low},eu.getLowBitsUnsigned=function(){return this.low>>>0},eu.getNumBitsAbs=function(){if(this.isNegative())return this.eq(eo)?64:this.neg().getNumBitsAbs();for(var S=0!=this.high?this.high:this.low,T=31;T>0&&(S&1<<T)==0;T--);return 0!=this.high?T+33:T+1},eu.isSafeInteger=function(){var S=this.high>>21;return!S||!this.unsigned&&-1===S&&!(0===this.low&&-2097152===this.high)},eu.isZero=function(){return 0===this.high&&0===this.low},eu.eqz=eu.isZero,eu.isNegative=function(){return!this.unsigned&&this.high<0},eu.isPositive=function(){return this.unsigned||this.high>=0},eu.isOdd=function(){return(1&this.low)==1},eu.isEven=function(){return(1&this.low)==0},eu.equals=function(S){return N(S)||(S=W(S)),(this.unsigned===S.unsigned||this.high>>>31!=1||S.high>>>31!=1)&&this.high===S.high&&this.low===S.low},eu.eq=eu.equals,eu.notEquals=function(S){return!this.eq(S)},eu.neq=eu.notEquals,eu.ne=eu.notEquals,eu.lessThan=function(S){return 0>this.comp(S)},eu.lt=eu.lessThan,eu.lessThanOrEqual=function(S){return 0>=this.comp(S)},eu.lte=eu.lessThanOrEqual,eu.le=eu.lessThanOrEqual,eu.greaterThan=function(S){return this.comp(S)>0},eu.gt=eu.greaterThan,eu.greaterThanOrEqual=function(S){return this.comp(S)>=0},eu.gte=eu.greaterThanOrEqual,eu.ge=eu.greaterThanOrEqual,eu.compare=function(S){if(N(S)||(S=W(S)),this.eq(S))return 0;var T=this.isNegative(),R=S.isNegative();return T&&!R?-1:!T&&R?1:this.unsigned?S.high>>>0>this.high>>>0||S.high===this.high&&S.low>>>0>this.low>>>0?-1:1:this.sub(S).isNegative()?-1:1},eu.comp=eu.compare,eu.negate=function(){return!this.unsigned&&this.eq(eo)?eo:this.not().add(er)},eu.neg=eu.negate,eu.add=function(S){N(S)||(S=W(S));var T,R,O=this.high>>>16,P=65535&this.high,M=this.low>>>16,L=65535&this.low,U=S.high>>>16,$=65535&S.high,K=S.low>>>16,Q=65535&S.low,Y=0,X=0;return T=0+((R=0+(L+Q))>>>16),R&=65535,T+=M+K,X+=T>>>16,T&=65535,X+=P+$,Y+=X>>>16,X&=65535,Y+=O+U,V(T<<16|R,(Y&=65535)<<16|X,this.unsigned)},eu.subtract=function(S){return N(S)||(S=W(S)),this.add(S.neg())},eu.sub=eu.subtract,eu.multiply=function(S){if(this.isZero())return this;if(N(S)||(S=W(S)),T)return V(T.mul(this.low,this.high,S.low,S.high),T.get_high(),this.unsigned);if(S.isZero())return this.unsigned?et:ee;if(this.eq(eo))return S.isOdd()?eo:ee;if(S.eq(eo))return this.isOdd()?eo:ee;if(this.isNegative())return S.isNegative()?this.neg().mul(S.neg()):this.neg().mul(S).neg();if(S.isNegative())return this.mul(S.neg()).neg();if(this.lt(Z)&&S.lt(Z))return U(this.toNumber()*S.toNumber(),this.unsigned);var R,O,P=this.high>>>16,M=65535&this.high,L=this.low>>>16,$=65535&this.low,K=S.high>>>16,Q=65535&S.high,Y=S.low>>>16,X=65535&S.low,er=0,en=0;return R=0+((O=0+$*X)>>>16),O&=65535,R+=L*X,en+=R>>>16,R&=65535,R+=$*Y,en+=R>>>16,R&=65535,en+=M*X,er+=en>>>16,en&=65535,en+=L*Y,er+=en>>>16,en&=65535,en+=$*Q,er+=en>>>16,en&=65535,er+=P*X+M*Y+L*Q+$*K,V(R<<16|O,(er&=65535)<<16|en,this.unsigned)},eu.mul=eu.multiply,eu.divide=function(S){if(N(S)||(S=W(S)),S.isZero())throw Error("division by zero");if(T){var R,O,P;return this.unsigned||-2147483648!==this.high||-1!==S.low||-1!==S.high?V((this.unsigned?T.div_u:T.div_s)(this.low,this.high,S.low,S.high),T.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?et:ee;if(this.unsigned){if(S.unsigned||(S=S.toUnsigned()),S.gt(this))return et;if(S.gt(this.shru(1)))return en;P=et}else{if(this.eq(eo))return S.eq(er)||S.eq(ei)?eo:S.eq(eo)?er:(R=this.shr(1).div(S).shl(1)).eq(ee)?S.isNegative()?er:ei:(O=this.sub(S.mul(R)),P=R.add(O.div(S)));if(S.eq(eo))return this.unsigned?et:ee;if(this.isNegative())return S.isNegative()?this.neg().div(S.neg()):this.neg().div(S).neg();if(S.isNegative())return this.div(S.neg()).neg();P=ee}for(O=this;O.gte(S);){for(var M=Math.ceil(Math.log(R=Math.max(1,Math.floor(O.toNumber()/S.toNumber())))/Math.LN2),L=M<=48?1:$(2,M-48),K=U(R),Q=K.mul(S);Q.isNegative()||Q.gt(O);)R-=L,Q=(K=U(R,this.unsigned)).mul(S);K.isZero()&&(K=er),P=P.add(K),O=O.sub(Q)}return P},eu.div=eu.divide,eu.modulo=function(S){return(N(S)||(S=W(S)),T)?V((this.unsigned?T.rem_u:T.rem_s)(this.low,this.high,S.low,S.high),T.get_high(),this.unsigned):this.sub(this.div(S).mul(S))},eu.mod=eu.modulo,eu.rem=eu.modulo,eu.not=function(){return V(~this.low,~this.high,this.unsigned)},eu.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},eu.clz=eu.countLeadingZeros,eu.countTrailingZeros=function(){return this.low?O(this.low):O(this.high)+32},eu.ctz=eu.countTrailingZeros,eu.and=function(S){return N(S)||(S=W(S)),V(this.low&S.low,this.high&S.high,this.unsigned)},eu.or=function(S){return N(S)||(S=W(S)),V(this.low|S.low,this.high|S.high,this.unsigned)},eu.xor=function(S){return N(S)||(S=W(S)),V(this.low^S.low,this.high^S.high,this.unsigned)},eu.shiftLeft=function(S){return(N(S)&&(S=S.toInt()),0==(S&=63))?this:S<32?V(this.low<<S,this.high<<S|this.low>>>32-S,this.unsigned):V(0,this.low<<S-32,this.unsigned)},eu.shl=eu.shiftLeft,eu.shiftRight=function(S){return(N(S)&&(S=S.toInt()),0==(S&=63))?this:S<32?V(this.low>>>S|this.high<<32-S,this.high>>S,this.unsigned):V(this.high>>S-32,this.high>=0?0:-1,this.unsigned)},eu.shr=eu.shiftRight,eu.shiftRightUnsigned=function(S){return(N(S)&&(S=S.toInt()),0==(S&=63))?this:S<32?V(this.low>>>S|this.high<<32-S,this.high>>>S,this.unsigned):32===S?V(this.high,0,this.unsigned):V(this.high>>>S-32,0,this.unsigned)},eu.shru=eu.shiftRightUnsigned,eu.shr_u=eu.shiftRightUnsigned,eu.rotateLeft=function(S){var T;return(N(S)&&(S=S.toInt()),0==(S&=63))?this:32===S?V(this.high,this.low,this.unsigned):S<32?(T=32-S,V(this.low<<S|this.high>>>T,this.high<<S|this.low>>>T,this.unsigned)):(S-=32,T=32-S,V(this.high<<S|this.low>>>T,this.low<<S|this.high>>>T,this.unsigned))},eu.rotl=eu.rotateLeft,eu.rotateRight=function(S){var T;return(N(S)&&(S=S.toInt()),0==(S&=63))?this:32===S?V(this.high,this.low,this.unsigned):S<32?(T=32-S,V(this.high<<T|this.low>>>S,this.low<<T|this.high>>>S,this.unsigned)):(S-=32,T=32-S,V(this.low<<T|this.high>>>S,this.high<<T|this.low>>>S,this.unsigned))},eu.rotr=eu.rotateRight,eu.toSigned=function(){return this.unsigned?V(this.low,this.high,!1):this},eu.toUnsigned=function(){return this.unsigned?this:V(this.low,this.high,!0)},eu.toBytes=function(S){return S?this.toBytesLE():this.toBytesBE()},eu.toBytesLE=function(){var S=this.high,T=this.low;return[255&T,T>>>8&255,T>>>16&255,T>>>24,255&S,S>>>8&255,S>>>16&255,S>>>24]},eu.toBytesBE=function(){var S=this.high,T=this.low;return[S>>>24,S>>>16&255,S>>>8&255,255&S,T>>>24,T>>>16&255,T>>>8&255,255&T]},R.fromBytes=function(S,T,N){return N?R.fromBytesLE(S,T):R.fromBytesBE(S,T)},R.fromBytesLE=function(S,T){return new R(S[0]|S[1]<<8|S[2]<<16|S[3]<<24,S[4]|S[5]<<8|S[6]<<16|S[7]<<24,T)},R.fromBytesBE=function(S,T){return new R(S[4]<<24|S[5]<<16|S[6]<<8|S[7],S[0]<<24|S[1]<<16|S[2]<<8|S[3],T)},"function"==typeof BigInt&&(R.fromBigInt=function(S,T){return V(Number(BigInt.asIntN(32,S)),Number(BigInt.asIntN(32,S>>BigInt(32))),T)},R.fromValue=function(S,T){return"bigint"==typeof S?fromBigInt(S,T):W(S,T)},eu.toBigInt=function(){var S=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|S}),S.default=R})},7231:S=>{"use strict";S.exports={i8:"1.9.15"}},6541:S=>{"use strict";S.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},9987:S=>{"use strict";S.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"FileDescriptorSet":{"fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}}},"FileDescriptorProto":{"fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10,"options":{"packed":false}},"weakDependency":{"rule":"repeated","type":"int32","id":11,"options":{"packed":false}},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12}}},"DescriptorProto":{"fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"FieldDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REQUIRED":2,"LABEL_REPEATED":3}}}},"OneofDescriptorProto":{"fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3}}},"EnumValueDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[38,38]],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[8,8]]},"FieldOptions":{"fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}}}},"OneofOptions":{"fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumValueOptions":{"fields":{"deprecated":{"type":"bool","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"UninterpretedOption":{"fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"SourceCodeInfo":{"fields":{"location":{"rule":"repeated","type":"Location","id":1}},"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"span":{"rule":"repeated","type":"int32","id":2},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4}}}}}}}}}}}')},9827:S=>{"use strict";S.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},3795:S=>{"use strict";S.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')}};var __webpack_require__=require("../../../webpack-runtime.js");__webpack_require__.C(exports);var __webpack_exec__=S=>__webpack_require__(__webpack_require__.s=S),__webpack_exports__=__webpack_require__.X(0,[638,873,337,369],()=>__webpack_exec__(3593));module.exports=__webpack_exports__})();